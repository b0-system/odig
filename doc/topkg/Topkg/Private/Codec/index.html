<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Codec (topkg.Topkg.Private.Codec)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../index.html">topkg</a> &#x00BB; <a href="../../index.html">Topkg</a> &#x00BB; <a href="../index.html">Private</a> &#x00BB; Codec</nav><header class="odoc-preamble"><h1>Module <code><span>Private.Codec</span></code></h1><p>Topkg interprocess communication codec.</p><p>Codecs for communication between the <code>topkg</code> tool and topkg description files.</p></header><nav class="odoc-toc"><ul><li><a href="#decode-errors">Decode errors</a></li><li><a href="#codecs">Codecs</a></li><li><a href="#base">Base type codecs</a></li><li><a href="#topkg">Topkg types</a></li></ul></nav><div class="odoc-content"><h2 id="decode-errors"><a href="#decode-errors" class="anchor"></a>Decode errors</h2><div class="odoc-spec"><div class="spec type" id="type-error" class="anchored"><a href="#type-error" class="anchor"></a><code><span><span class="keyword">type</span> error</span><span> = </span></code><table><tr id="type-error.Corrupted" class="anchored"><td class="def variant constructor"><a href="#type-error.Corrupted" class="anchor"></a><code><span>| </span><span><span class="constructor">Corrupted</span> <span class="keyword">of</span> string * string</span></code></td></tr><tr id="type-error.Version" class="anchored"><td class="def variant constructor"><a href="#type-error.Version" class="anchor"></a><code><span>| </span><span><span class="constructor">Version</span> <span class="keyword">of</span> int * int</span></code></td></tr></table></div><div class="spec-doc"><p>The type for decode errors.</p><ul><li><code>Corrupted (kind, data)</code>, an error occured while decoding <code>data</code> for <code>kind</code>.</li><li><code>Version (exp, fnd)</code>, a <a href="#val-version">versioned</a> decoder expected version <code>exp</code> but found <code>fnd</code></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-pp_error" class="anchored"><a href="#val-pp_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_error : <span><a href="../../../../ocaml/Stdlib/Format/index.html#type-formatter">Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-error">error</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>pp_error ppf e</code> prints an unspecified representation of <code>e</code> on <code>ppf</code>.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Error" class="anchored"><a href="#exception-Error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Error</span> <span class="keyword">of</span> <a href="#type-error">error</a></span></code></div><div class="spec-doc"><p>Raised on decode errors.</p></div></div><h2 id="codecs"><a href="#codecs" class="anchor"></a>Codecs</h2><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p>The type for codec for OCaml values of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-v" class="anchored"><a href="#val-v" class="anchor"></a><code><span><span class="keyword">val</span> v : <span>kind:string <span class="arrow">&#45;&gt;</span></span> <span>enc:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span> <span>dec:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>v kind enc dec</code> is a codec for value identified as <code>kind</code> using <code>enc</code> to encode and <code>dec</code> to decode.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-kind" class="anchored"><a href="#val-kind" class="anchor"></a><code><span><span class="keyword">val</span> kind : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>kind c</code> is <code>c</code>'s kind.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-enc" class="anchored"><a href="#val-enc" class="anchor"></a><code><span><span class="keyword">val</span> enc : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>enc c</code> is <code>c</code>'s encoder.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dec" class="anchored"><a href="#val-dec" class="anchor"></a><code><span><span class="keyword">val</span> dec : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>dec c</code> is <code>c</code>'s decoder. The decoder </p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Error</span> <p>in case of decode error</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-dec_result" class="anchored"><a href="#val-dec_result" class="anchor"></a><code><span><span class="keyword">val</span> dec_result : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>dec c</code> is like <a href="#val-dec"><code>dec</code></a> but doesn't raise. The exception is turned into an error message using <a href="#val-pp_error"><code>pp_error</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_kind" class="anchored"><a href="#val-with_kind" class="anchor"></a><code><span><span class="keyword">val</span> with_kind : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>with_kind k c</code> is <code>c</code> with kind <code>k</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write" class="anchored"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span><a href="../../index.html#type-fpath">fpath</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>write f c v</code> encodes value <code>v</code> with <code>c</code> to <code>f</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read" class="anchored"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span><a href="../../index.html#type-fpath">fpath</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>read f c</code> reads a value with <code>c</code> from <code>f</code>.</p></div></div><h2 id="base"><a href="#base" class="anchor"></a>Base type codecs</h2><div class="odoc-spec"><div class="spec value" id="val-unit" class="anchored"><a href="#val-unit" class="anchor"></a><code><span><span class="keyword">val</span> unit : <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>unit</code> codecs a <code>()</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-const" class="anchored"><a href="#val-const" class="anchor"></a><code><span><span class="keyword">val</span> const : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>const v</code> codecs the constant <code>v</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bool" class="anchored"><a href="#val-bool" class="anchor"></a><code><span><span class="keyword">val</span> bool : <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>bool</code> codecs booleans.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int" class="anchored"><a href="#val-int" class="anchor"></a><code><span><span class="keyword">val</span> int : <span>int <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>int</code> codecs integers.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string" class="anchored"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>string</code> codecs strings.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-option" class="anchored"><a href="#val-option" class="anchor"></a><code><span><span class="keyword">val</span> option : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>option el</code> codecs <code>el</code> options.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-result" class="anchored"><a href="#val-result" class="anchor"></a><code><span><span class="keyword">val</span> result : <span>ok:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>error:<span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../../index.html#type-r">r</a></span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>result ~ok ~error</code> codecs <code>ok</code>, <code>error</code> results.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-list" class="anchored"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>list el</code> codecs <code>el</code> lists.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pair" class="anchored"><a href="#val-pair" class="anchor"></a><code><span><span class="keyword">val</span> pair : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>pair c0 c1</code> codecs <code>c0</code>, <code>c1</code> pairs.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-t3" class="anchored"><a href="#val-t3" class="anchor"></a><code><span><span class="keyword">val</span> t3 : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'c</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span> * <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>t3</code> is like <a href="#val-pair"><code>pair</code></a> but for triples.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-t4" class="anchored"><a href="#val-t4" class="anchor"></a><code><span><span class="keyword">val</span> t4 : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'c</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'d</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span> * <span class="type-var">'c</span> * <span class="type-var">'d</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>t4</code> is like <a href="#val-pair"><code>pair</code></a> but for quadruples.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-t5" class="anchored"><a href="#val-t5" class="anchor"></a><code><span><span class="keyword">val</span> t5 : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'c</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'d</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'e</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span> * <span class="type-var">'c</span> * <span class="type-var">'d</span> * <span class="type-var">'e</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>t5</code> is like <a href="#val-pair"><code>pair</code></a> but for qintuples.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-alt" class="anchored"><a href="#val-alt" class="anchor"></a><code><span><span class="keyword">val</span> alt : <span>kind:string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> array</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>alt tag cs</code> codecs values by tagging them with <code>tag</code> and using the corresponding codec in <code>cs</code>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if <code>Array.length cs &gt; 256</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-version" class="anchored"><a href="#val-version" class="anchor"></a><code><span><span class="keyword">val</span> version : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>version num c</code> versions codec <code>c</code> with number <code>num</code>. On decode a version number mismatch raises an error see <a href="#type-error"><code>error</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-view" class="anchored"><a href="#val-view" class="anchor"></a><code><span><span class="keyword">val</span> view : <span>?kind:string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> * <span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>view kind t c</code> views <code>t</code> as <code>c</code> for codecing.</p></div></div><h2 id="topkg"><a href="#topkg" class="anchor"></a>Topkg types</h2><div class="odoc-spec"><div class="spec value" id="val-msg" class="anchored"><a href="#val-msg" class="anchor"></a><code><span><span class="keyword">val</span> msg : <span><span>[ <span>`Msg of string</span> ]</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>msg</code> codecs error messages.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-result_error_msg" class="anchored"><a href="#val-result_error_msg" class="anchor"></a><code><span><span class="keyword">val</span> result_error_msg : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../../index.html#type-result">result</a></span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>result_error_msg ok</code> codecs <code>ok</code> or error message results.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fpath" class="anchored"><a href="#val-fpath" class="anchor"></a><code><span><span class="keyword">val</span> fpath : <span><a href="../../Fpath/index.html#type-t">Fpath.t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>fpath</code> codecs files paths.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-cmd" class="anchored"><a href="#val-cmd" class="anchor"></a><code><span><span class="keyword">val</span> cmd : <span><a href="../../Cmd/index.html#type-t">Cmd.t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>cmd</code> codecs command line fragments.</p></div></div></div></body></html>