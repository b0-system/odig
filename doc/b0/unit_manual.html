<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>unit_manual (b0.unit_manual)</title><link rel="stylesheet" href="../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="index.html">Up</a> â€“ <a href="index.html">b0</a> &#x00BB; unit_manual</nav><header class="odoc-preamble"><h1 id="build-unit-manual"><a href="#build-unit-manual" class="anchor"></a>Build unit manual</h1><p>This manual shows how to deal with B0 build units and create your own.</p></header><nav class="odoc-toc"><ul><li><a href="#custom">Custom unit tutorial</a></li></ul></nav><div class="odoc-content"><h2 id="custom"><a href="#custom" class="anchor"></a>Custom unit tutorial</h2><p>We show how to devise a custom unit that compiles a <code>.ml</code> file to a bytecode executable.</p><p>To create a custom unit from scratch it is better not to clutter your B0 file too much and develop it in its own file. At the root of your project issue:</p><pre><code>mkdir B0
touch B0/custom.ml</code></pre><p>And <em>at the very beginning</em> of your <code>B0.ml</code> file add:</p><pre><code>#mod_use &quot;B0/custom.ml&quot;
open B0_kit.V000</code></pre><p>You now have the <code>Custom</code> module and its definitions available in the B0 file. To make sure everything is working propery. Write in <code>custom.ml</code></p><pre><code>let () = print_endline &quot;Hop!&quot; (* In practice, don't do that ! *)</code></pre><p>and test that everything runs properly:</p><pre>&gt; b0 --what
Hop!
Empty build.</pre><p>A build unit is just a build script with static and dynamic metadata attached. Best is to start writing the minimal ad-hoc script and only gradually abstract over parts of it later to make it customizable and eventually turn it into a library if appropriate.</p><p>In <code>B0/custom.ml</code> erase that silly print statement and start over by defining an empty build shell, made of a dummy build procedure and a function that produces build units invoking it.</p><pre><code>open B00_kit.V000
open B00_std
open Fut.Syntax
open B00_memo

let exe_proc b =
  let m = B0_build.memo b in
  Memo.notify `Warn &quot;Not building, yet.&quot;;
  Fut.return ()

let exe ?doc ?meta ?action n =
   B0_unit.v ?doc ?meta ?action n exe_proc</code></pre><p>and in <code>B0.ml</code> declare your unit:</p><pre><code>let echo = Custom.exe &quot;echo&quot; ~doc:&quot;A tool screaming in the void&quot;</code></pre><p>We now have a unit and a silly build procedure.</p><pre>&gt; b0 unit list
[   ] echo A tool screaming in the void
&gt; b0
[WARN] [echo]: Not building, yet.</pre></div></body></html>