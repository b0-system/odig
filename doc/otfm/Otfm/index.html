<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Otfm (otfm.Otfm)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">otfm</a> &#x00BB; Otfm</nav><h1>Module <code>Otfm</code></h1><p>OpenType font decoder.</p><p><b>WARNING.</b> This interface is subject to change in the future.</p><p><code>Otfm</code> is an in-memory decoder for the OpenType font data format. It provides low-level access to OpenType fonts tables and functions to decode some of them.</p><p>Consult the <a href="index.html#limitations"><span>limitations</span></a> and <a href="index.html#examples"><span>example</span></a> of use.</p><p><b>Note.</b> Unless otherwise specified the strings returned are UTF-8 encoded.</p><p><em>v0.3.0 - <a href="http://erratique.ch/software/otfm">homepage</a></em></p><h4 id="references"><a href="#references" class="anchor"></a>References</h4><ul><li>Microsoft. <em><a href="http://www.microsoft.com/typography/otspec/default.htm">The OpenType Specification</a></em>, 2009.</li></ul><nav class="toc"><ul><li><a href="#tags">Tags</a></li><li><a href="#unicode-code-points">Unicode code points</a></li><li><a href="#decode">Decode</a></li><li><a href="#table-decoding">Table decoding</a><ul><li><a href="#convenience">Convenience decodes</a></li><li><a href="#cmap">cmap table</a></li><li><a href="#glyf">glyf table</a></li><li><a href="#head">head table</a></li><li><a href="#hhea">hhea table</a></li><li><a href="#hmtx">hmtx table</a></li><li><a href="#name">name table</a></li><li><a href="#os2">OS/2 table</a></li><li><a href="#kern">kern table</a></li><li><a href="#loca">loca table</a></li></ul></li><li><a href="#limitations">Limitations</a></li><li><a href="#examples">Examples</a></li></ul></nav></header><section><header><h2 id="tags"><a href="#tags" class="anchor"></a>Tags</h2></header><dl><dt class="spec type" id="type-tag"><a href="#type-tag" class="anchor"></a><code><span class="keyword">type</span> tag</code></dt><dd><p>The type for OpenType tags.</p></dd></dl><dl><dt class="spec module" id="module-Tag"><a href="#module-Tag" class="anchor"></a><code><span class="keyword">module</span> <a href="Tag/index.html">Tag</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Tags.</p></dd></dl></section><section><header><h2 id="unicode-code-points"><a href="#unicode-code-points" class="anchor"></a>Unicode code points</h2><p>For some reason OpenType allows the (textually meaningless) <a href="http://unicode.org/glossary/#surrogate_code_point">surrogate code points</a> to be mapped to glyphs. Hence we deal with Unicode <a href="http://unicode.org/glossary/#code_point">code points</a> not <a href="http://unicode.org/glossary/#unicode_scalar_value">scalar values</a>.</p></header><dl><dt class="spec type" id="type-cp"><a href="#type-cp" class="anchor"></a><code><span class="keyword">type</span> cp</code><code> = int</code></dt><dd><p>The type for Unicode <a href="http://unicode.org/glossary/#code_point">code points</a>, ranges from <code>0x0000</code> to <code>0x10_FFFF</code>. Any code point returned by <code>Otfm</code> is guaranteed to be in the range.</p></dd></dl><dl><dt class="spec type" id="type-cp_range"><a href="#type-cp_range" class="anchor"></a><code><span class="keyword">type</span> cp_range</code><code> = <a href="index.html#type-cp">cp</a> * <a href="index.html#type-cp">cp</a></code></dt><dd><p>The type for Unicode code point ranges. Any range <code>(u0, u1)</code> returned by <code>Otfm</code> has <code>u0 &lt;= u1</code>.</p></dd></dl><dl><dt class="spec value" id="val-is_cp"><a href="#val-is_cp" class="anchor"></a><code><span class="keyword">val</span> is_cp : int <span>&#45;&gt;</span> bool</code></dt><dd><p><code>is_cp i</code> is <code>true</code> if <code>i</code> is an Unicode <a href="http://unicode.org/glossary/#code_point">code point</a>.</p></dd></dl><dl><dt class="spec value" id="val-pp_cp"><a href="#val-pp_cp" class="anchor"></a><code><span class="keyword">val</span> pp_cp : <a href="../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> <a href="index.html#type-cp">cp</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>pp_cp ppf cp</code> prints an unspecified representation of <code>cp</code> on <code>ppf</code>.</p></dd></dl></section><section><header><h2 id="decode"><a href="#decode" class="anchor"></a>Decode</h2></header><dl><dt class="spec type" id="type-error_ctx"><a href="#type-error_ctx" class="anchor"></a><code><span class="keyword">type</span> error_ctx</code> = <code>[ </code><table class="variant"><tr id="type-error_ctx.Table" class="anchored"><td class="def constructor"><a href="#type-error_ctx.Table" class="anchor"></a><code>| </code><code>`Table <span class="keyword">of</span> <a href="index.html#type-tag">tag</a></code></td></tr><tr id="type-error_ctx.Offset_table" class="anchored"><td class="def constructor"><a href="#type-error_ctx.Offset_table" class="anchor"></a><code>| </code><code>`Offset_table</code></td></tr><tr id="type-error_ctx.Table_directory" class="anchored"><td class="def constructor"><a href="#type-error_ctx.Table_directory" class="anchor"></a><code>| </code><code>`Table_directory</code></td></tr></table><code> ]</code></dt><dd><p>The type for error contexts.</p></dd></dl><dl><dt class="spec type" id="type-error"><a href="#type-error" class="anchor"></a><code><span class="keyword">type</span> error</code> = <code>[ </code><table class="variant"><tr id="type-error.Unknown_flavour" class="anchored"><td class="def constructor"><a href="#type-error.Unknown_flavour" class="anchor"></a><code>| </code><code>`Unknown_flavour <span class="keyword">of</span> <a href="index.html#type-tag">tag</a></code></td></tr><tr id="type-error.Unsupported_TTC" class="anchored"><td class="def constructor"><a href="#type-error.Unsupported_TTC" class="anchor"></a><code>| </code><code>`Unsupported_TTC</code></td></tr><tr id="type-error.Unsupported_cmaps" class="anchored"><td class="def constructor"><a href="#type-error.Unsupported_cmaps" class="anchor"></a><code>| </code><code>`Unsupported_cmaps <span class="keyword">of</span> (int * int * int) list</code></td></tr><tr id="type-error.Unsupported_glyf_matching_points" class="anchored"><td class="def constructor"><a href="#type-error.Unsupported_glyf_matching_points" class="anchor"></a><code>| </code><code>`Unsupported_glyf_matching_points</code></td></tr><tr id="type-error.Missing_required_table" class="anchored"><td class="def constructor"><a href="#type-error.Missing_required_table" class="anchor"></a><code>| </code><code>`Missing_required_table <span class="keyword">of</span> <a href="index.html#type-tag">tag</a></code></td></tr><tr id="type-error.Unknown_version" class="anchored"><td class="def constructor"><a href="#type-error.Unknown_version" class="anchor"></a><code>| </code><code>`Unknown_version <span class="keyword">of</span> <a href="index.html#type-error_ctx">error_ctx</a> * int32</code></td></tr><tr id="type-error.Unknown_loca_format" class="anchored"><td class="def constructor"><a href="#type-error.Unknown_loca_format" class="anchor"></a><code>| </code><code>`Unknown_loca_format <span class="keyword">of</span> <a href="index.html#type-error_ctx">error_ctx</a> * int</code></td></tr><tr id="type-error.Unknown_composite_format" class="anchored"><td class="def constructor"><a href="#type-error.Unknown_composite_format" class="anchor"></a><code>| </code><code>`Unknown_composite_format <span class="keyword">of</span> <a href="index.html#type-error_ctx">error_ctx</a> * int</code></td></tr><tr id="type-error.Invalid_offset" class="anchored"><td class="def constructor"><a href="#type-error.Invalid_offset" class="anchor"></a><code>| </code><code>`Invalid_offset <span class="keyword">of</span> <a href="index.html#type-error_ctx">error_ctx</a> * int</code></td></tr><tr id="type-error.Invalid_cp" class="anchored"><td class="def constructor"><a href="#type-error.Invalid_cp" class="anchor"></a><code>| </code><code>`Invalid_cp <span class="keyword">of</span> int</code></td></tr><tr id="type-error.Invalid_cp_range" class="anchored"><td class="def constructor"><a href="#type-error.Invalid_cp_range" class="anchor"></a><code>| </code><code>`Invalid_cp_range <span class="keyword">of</span> int * int</code></td></tr><tr id="type-error.Invalid_postscript_name" class="anchored"><td class="def constructor"><a href="#type-error.Invalid_postscript_name" class="anchor"></a><code>| </code><code>`Invalid_postscript_name <span class="keyword">of</span> string</code></td></tr><tr id="type-error.Unexpected_eoi" class="anchored"><td class="def constructor"><a href="#type-error.Unexpected_eoi" class="anchor"></a><code>| </code><code>`Unexpected_eoi <span class="keyword">of</span> <a href="index.html#type-error_ctx">error_ctx</a></code></td></tr></table><code> ]</code></dt><dd><p>The type for decoding errors.</p><p><b>Note.</b> In case of <code>`Invalid_poscript_name</code> a string of <em>bytes</em> is returned.</p></dd></dl><dl><dt class="spec value" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><code><span class="keyword">val</span> pp_error : <a href="../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> [&lt; <a href="index.html#type-error">error</a> ] <span>&#45;&gt;</span> unit</code></dt><dd><p><code>pp_error ppf e</code> prints an uspecified representation of <code>e</code> on <code>ppf</code>.</p></dd></dl><dl><dt class="spec type" id="type-src"><a href="#type-src" class="anchor"></a><code><span class="keyword">type</span> src</code> = <code>[ </code><table class="variant"><tr id="type-src.String" class="anchored"><td class="def constructor"><a href="#type-src.String" class="anchor"></a><code>| </code><code>`String <span class="keyword">of</span> string</code></td></tr></table><code> ]</code></dt><dd><p>The type for input sources.</p></dd></dl><dl><dt class="spec type" id="type-decoder"><a href="#type-decoder" class="anchor"></a><code><span class="keyword">type</span> decoder</code></dt><dd><p>The type for OpenType font decoders.</p></dd></dl><dl><dt class="spec value" id="val-decoder"><a href="#val-decoder" class="anchor"></a><code><span class="keyword">val</span> decoder : [&lt; <a href="index.html#type-src">src</a> ] <span>&#45;&gt;</span> <a href="index.html#type-decoder">decoder</a></code></dt><dd><p><code>decoder src</code> is a decoder decoding from <code>src</code>.</p></dd></dl><dl><dt class="spec value" id="val-decoder_src"><a href="#val-decoder_src" class="anchor"></a><code><span class="keyword">val</span> decoder_src : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> <a href="index.html#type-src">src</a></code></dt><dd><p><code>decoder_src d</code> is <code>d</code>'s input source.</p></dd></dl></section><section><header><h2 id="table-decoding"><a href="#table-decoding" class="anchor"></a>Table decoding</h2><p>These functions can be used in any order and are robust: when they return an error the decoder is back to a consistant state and can be used further. However if <a href="index.html#type-flavour"><code>flavour</code></a> or <a href="index.html#val-table_list"><code>table_list</code></a> returns an error you can safely assume that all other functions will. The fields are in general not documented please refer to the OpenType <a href="http://www.microsoft.com/typography/otspec/default.htm">specification</a> for details.</p></header><dl><dt class="spec type" id="type-flavour"><a href="#type-flavour" class="anchor"></a><code><span class="keyword">type</span> flavour</code> = <code>[ </code><table class="variant"><tr id="type-flavour.TTF" class="anchored"><td class="def constructor"><a href="#type-flavour.TTF" class="anchor"></a><code>| </code><code>`TTF</code></td></tr><tr id="type-flavour.CFF" class="anchored"><td class="def constructor"><a href="#type-flavour.CFF" class="anchor"></a><code>| </code><code>`CFF</code></td></tr></table><code> ]</code></dt><dd><p>The type for OpenType flavours.</p></dd></dl><dl><dt class="spec value" id="val-flavour"><a href="#val-flavour" class="anchor"></a><code><span class="keyword">val</span> flavour : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> (<a href="index.html#type-flavour">flavour</a>, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>decode_flavour d</code> is the flavour of the font decoded by <code>d</code>.</p></dd></dl><dl><dt class="spec value" id="val-table_list"><a href="#val-table_list" class="anchor"></a><code><span class="keyword">val</span> table_list : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> (<a href="index.html#type-tag">tag</a> list, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>table_list t</code> is the list of tables of the font decoded by <code>d</code>.</p></dd></dl><dl><dt class="spec value" id="val-table_mem"><a href="#val-table_mem" class="anchor"></a><code><span class="keyword">val</span> table_mem : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> <a href="index.html#type-tag">tag</a> <span>&#45;&gt;</span> (bool, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>table_mem d t</code> is <code>true</code> if table <code>t</code> is in the font decoded by <code>d</code>.</p></dd></dl><dl><dt class="spec value" id="val-table_raw"><a href="#val-table_raw" class="anchor"></a><code><span class="keyword">val</span> table_raw : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> <a href="index.html#type-tag">tag</a> <span>&#45;&gt;</span> (string option, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>table_raw d t</code> is the (unpadded) data of the table <code>t</code> as a string if the table <code>t</code> exists.</p></dd></dl><section><header><h3 id="convenience"><a href="#convenience" class="anchor"></a>Convenience decodes</h3><p>These functions lookup data in the right table.</p></header><dl><dt class="spec value" id="val-glyph_count"><a href="#val-glyph_count" class="anchor"></a><code><span class="keyword">val</span> glyph_count : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> (int, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>glyph_count d</code> is the number of glyphs in the font (bounded by <code>65535</code>).</p></dd></dl><dl><dt class="spec value" id="val-postscript_name"><a href="#val-postscript_name" class="anchor"></a><code><span class="keyword">val</span> postscript_name : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> (string option, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>poscript_name d</code> is the PostScript name of <code>d</code>. Looks up and validates as mandated by the OTF standard, don't rely on <a href="index.html#name"><span>name table</span></a> if you really need this information.</p></dd></dl></section><section><header><h3 id="cmap"><a href="#cmap" class="anchor"></a>cmap table</h3></header><dl><dt class="spec type" id="type-glyph_id"><a href="#type-glyph_id" class="anchor"></a><code><span class="keyword">type</span> glyph_id</code><code> = int</code></dt><dd><p>The type for glyph ids, from <code>0</code> to <code>65534</code>.</p></dd></dl><dl><dt class="spec type" id="type-map_kind"><a href="#type-map_kind" class="anchor"></a><code><span class="keyword">type</span> map_kind</code> = <code>[ </code><table class="variant"><tr id="type-map_kind.Glyph" class="anchored"><td class="def constructor"><a href="#type-map_kind.Glyph" class="anchor"></a><code>| </code><code>`Glyph</code></td></tr><tr id="type-map_kind.Glyph_range" class="anchored"><td class="def constructor"><a href="#type-map_kind.Glyph_range" class="anchor"></a><code>| </code><code>`Glyph_range</code></td></tr></table><code> ]</code></dt><dd><p>The type for map kinds.</p><p>Determines how an unicode range <code>(u0, u1)</code> and a glyph id <code>gid</code> must be interpreted in the folding function of <a href="index.html#cmap"><span>cmap table</span></a>.</p><ul><li><code>`Glyph</code> all characters in the range map to to <code>gid</code>.</li><li><code>`Glyph_range</code>, <code>u0</code> maps to <code>gid</code>, <code>u0 + 1</code> to <code>gid + 1</code>, ... and <code>u1</code> to <code>gid + (u1 - u0)</code></li></ul></dd></dl><dl><dt class="spec value" id="val-cmap"><a href="#val-cmap" class="anchor"></a><code><span class="keyword">val</span> cmap : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-map_kind">map_kind</a> <span>&#45;&gt;</span> <a href="index.html#type-cp_range">cp_range</a> <span>&#45;&gt;</span> <a href="index.html#type-glyph_id">glyph_id</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> ((int * int * int) * <span class="type-var">'a</span>, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>cmap d f acc</code> folds over a mapping from unicode scalar values to glyph ids by reading the <a href="http://www.microsoft.com/typography/otspec/cmap.htm">cmap</a> table. The returned triple of integer indicates the platform id, encoding id and format of the cmap used.</p><p><b>Limitations.</b> Only the format 13 (last resort font), format 12 (UCS-4) and format 4 (UCS-2) cmap table formats are supported.</p><p>If multiple tables are present, it favours 13 over 12 over 4. If multiple tables of the same format are present it takes the first one it finds.</p><p>If no supported cmap table is found the error <code>`Unsupported_cmaps</code> is returned with the list of platform id, encoding id, format available in the font.</p></dd></dl></section><section><header><h3 id="glyf"><a href="#glyf" class="anchor"></a>glyf table</h3></header><dl><dt class="spec type" id="type-glyf_loc"><a href="#type-glyf_loc" class="anchor"></a><code><span class="keyword">type</span> glyf_loc</code></dt><dd><p>The type for glyph locations. See <a href="index.html#loca"><span>loca table</span></a> table.</p></dd></dl><dl><dt class="spec type" id="type-glyph_simple_descr"><a href="#type-glyph_simple_descr" class="anchor"></a><code><span class="keyword">type</span> glyph_simple_descr</code><code> = (bool * int * int) list list</code></dt><dd><p>The type for simple glyph descriptions. Lists of contours, contours are list of points with a boolean indicating whether the point is on or off curve.</p></dd></dl><dl><dt class="spec type" id="type-glyph_composite_descr"><a href="#type-glyph_composite_descr" class="anchor"></a><code><span class="keyword">type</span> glyph_composite_descr</code><code> = (<a href="index.html#type-glyph_id">glyph_id</a> * (int * int) * (float * float * float * float) option) list</code></dt><dd><p>The type for glyph composites. A list of components made of a glyph id, a translation and an optional linear transform <code>a b c d</code> (column major).</p></dd></dl><dl><dt class="spec type" id="type-glyph_descr"><a href="#type-glyph_descr" class="anchor"></a><code><span class="keyword">type</span> glyph_descr</code><code> = [ `Simple of <a href="index.html#type-glyph_simple_descr">glyph_simple_descr</a> | `Composite of <a href="index.html#type-glyph_composite_descr">glyph_composite_descr</a> ] * (int * int * int * int)</code></dt><dd><p>The type for glyph descriptions. A simple or composite descriptions with the glyph's <code>(minx, miny, maxx, maxy)</code>'s bounding box.</p></dd></dl><dl><dt class="spec value" id="val-glyf"><a href="#val-glyf" class="anchor"></a><code><span class="keyword">val</span> glyf : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> <a href="index.html#type-glyf_loc">glyf_loc</a> <span>&#45;&gt;</span> (<a href="index.html#type-glyph_descr">glyph_descr</a>, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>glyf d loc</code> is the glyph descroption located at <code>loc</code> by reading the <a href="http://www.microsoft.com/typography/otspec/glyf.htm">glyf</a> table. Glyph locations are obtainted via <a href="index.html#loca"><span>loca table</span></a>.</p></dd></dl></section><section><header><h3 id="head"><a href="#head" class="anchor"></a>head table</h3></header><dl><dt class="spec type" id="type-head"><a href="#type-head" class="anchor"></a><code><span class="keyword">type</span> head</code><code> = </code><code>{</code><table class="record"><tr id="type-head.head_font_revision" class="anchored"><td class="def field"><a href="#type-head.head_font_revision" class="anchor"></a><code>head_font_revision : int32;</code></td></tr><tr id="type-head.head_flags" class="anchored"><td class="def field"><a href="#type-head.head_flags" class="anchor"></a><code>head_flags : int;</code></td></tr><tr id="type-head.head_units_per_em" class="anchored"><td class="def field"><a href="#type-head.head_units_per_em" class="anchor"></a><code>head_units_per_em : int;</code></td></tr><tr id="type-head.head_created" class="anchored"><td class="def field"><a href="#type-head.head_created" class="anchor"></a><code>head_created : float;</code></td><td class="doc"><p>Unix timestamp.</p></td></tr><tr id="type-head.head_modified" class="anchored"><td class="def field"><a href="#type-head.head_modified" class="anchor"></a><code>head_modified : float;</code></td><td class="doc"><p>Unix timestamp.</p></td></tr><tr id="type-head.head_xmin" class="anchored"><td class="def field"><a href="#type-head.head_xmin" class="anchor"></a><code>head_xmin : int;</code></td></tr><tr id="type-head.head_ymin" class="anchored"><td class="def field"><a href="#type-head.head_ymin" class="anchor"></a><code>head_ymin : int;</code></td></tr><tr id="type-head.head_xmax" class="anchored"><td class="def field"><a href="#type-head.head_xmax" class="anchor"></a><code>head_xmax : int;</code></td></tr><tr id="type-head.head_ymax" class="anchored"><td class="def field"><a href="#type-head.head_ymax" class="anchor"></a><code>head_ymax : int;</code></td></tr><tr id="type-head.head_mac_style" class="anchored"><td class="def field"><a href="#type-head.head_mac_style" class="anchor"></a><code>head_mac_style : int;</code></td></tr><tr id="type-head.head_lowest_rec_ppem" class="anchored"><td class="def field"><a href="#type-head.head_lowest_rec_ppem" class="anchor"></a><code>head_lowest_rec_ppem : int;</code></td></tr><tr id="type-head.head_index_to_loc_format" class="anchored"><td class="def field"><a href="#type-head.head_index_to_loc_format" class="anchor"></a><code>head_index_to_loc_format : int;</code></td></tr></table><code>}</code></dt><dd><p>The type for representing <a href="http://www.microsoft.com/typography/otspec/head.htm">head</a> tables.</p></dd></dl><dl><dt class="spec value" id="val-head"><a href="#val-head" class="anchor"></a><code><span class="keyword">val</span> head : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> (<a href="index.html#type-head">head</a>, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>head d</code> is the head table.</p></dd></dl></section><section><header><h3 id="hhea"><a href="#hhea" class="anchor"></a>hhea table</h3></header><dl><dt class="spec type" id="type-hhea"><a href="#type-hhea" class="anchor"></a><code><span class="keyword">type</span> hhea</code><code> = </code><code>{</code><table class="record"><tr id="type-hhea.hhea_ascender" class="anchored"><td class="def field"><a href="#type-hhea.hhea_ascender" class="anchor"></a><code>hhea_ascender : int;</code></td></tr><tr id="type-hhea.hhea_descender" class="anchored"><td class="def field"><a href="#type-hhea.hhea_descender" class="anchor"></a><code>hhea_descender : int;</code></td></tr><tr id="type-hhea.hhea_line_gap" class="anchored"><td class="def field"><a href="#type-hhea.hhea_line_gap" class="anchor"></a><code>hhea_line_gap : int;</code></td></tr><tr id="type-hhea.hhea_advance_width_max" class="anchored"><td class="def field"><a href="#type-hhea.hhea_advance_width_max" class="anchor"></a><code>hhea_advance_width_max : int;</code></td></tr><tr id="type-hhea.hhea_min_left_side_bearing" class="anchored"><td class="def field"><a href="#type-hhea.hhea_min_left_side_bearing" class="anchor"></a><code>hhea_min_left_side_bearing : int;</code></td></tr><tr id="type-hhea.hhea_min_right_side_bearing" class="anchored"><td class="def field"><a href="#type-hhea.hhea_min_right_side_bearing" class="anchor"></a><code>hhea_min_right_side_bearing : int;</code></td></tr><tr id="type-hhea.hhea_xmax_extent" class="anchored"><td class="def field"><a href="#type-hhea.hhea_xmax_extent" class="anchor"></a><code>hhea_xmax_extent : int;</code></td></tr><tr id="type-hhea.hhea_caret_slope_rise" class="anchored"><td class="def field"><a href="#type-hhea.hhea_caret_slope_rise" class="anchor"></a><code>hhea_caret_slope_rise : int;</code></td></tr><tr id="type-hhea.hhea_caret_slope_run" class="anchored"><td class="def field"><a href="#type-hhea.hhea_caret_slope_run" class="anchor"></a><code>hhea_caret_slope_run : int;</code></td></tr><tr id="type-hhea.hhea_caret_offset" class="anchored"><td class="def field"><a href="#type-hhea.hhea_caret_offset" class="anchor"></a><code>hhea_caret_offset : int;</code></td></tr></table><code>}</code></dt><dd><p>The type for <a href="http://www.microsoft.com/typography/otspec/hhea.htm">hhea</a> tables.</p></dd></dl><dl><dt class="spec value" id="val-hhea"><a href="#val-hhea" class="anchor"></a><code><span class="keyword">val</span> hhea : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> (<a href="index.html#type-hhea">hhea</a>, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>hhea d</code> is the hhea table.</p></dd></dl></section><section><header><h3 id="hmtx"><a href="#hmtx" class="anchor"></a>hmtx table</h3></header><dl><dt class="spec value" id="val-hmtx"><a href="#val-hmtx" class="anchor"></a><code><span class="keyword">val</span> hmtx : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-glyph_id">glyph_id</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>hmtx d f acc</code> folds over the horizontal metrics of the font by reading the <a href="http://www.microsoft.com/typography/otspec/hmtx.htm">hmtx</a> table. <code>f</code> is applied on each entry with <code>f acc' gid adv lsb</code> with <code>gid</code> the glyph id (guaranteed to range, in order, from <code>0</code> to glyph count minus one), <code>adv</code> the (unsigned) advance width, and <code>lsb</code> the (signed) left side bearing.</p></dd></dl></section><section><header><h3 id="name"><a href="#name" class="anchor"></a>name table</h3></header><dl><dt class="spec type" id="type-lang"><a href="#type-lang" class="anchor"></a><code><span class="keyword">type</span> lang</code><code> = string</code></dt><dd><p>The type for <a href="http://tools.ietf.org/html/bcp47">BCP 47</a> language tags.</p></dd></dl><dl><dt class="spec value" id="val-name"><a href="#val-name" class="anchor"></a><code><span class="keyword">val</span> name : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <a href="index.html#type-lang">lang</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>name d f acc</code> folds over the name records of the font by reading the <a href="http://www.microsoft.com/typography/otspec/name.htm">name</a> table. <code>f</code> is applied on each name id entry with <code>f acc' nid lang name</code> with <code>nid</code> the name id, lang the language tag, and <code>name</code> the UTF-8 encoded name value.</p><p><b>Note.</b> The module normalizes Windows language ids to lowercased BCP 47 ids. Language tags found in language tag records should be BCP 47 language tags but are not checked for conformance.</p><p><b>Tip.</b> If you are looking for the postcript name use <a href="index.html#val-postscript_name"><code>postscript_name</code></a>.</p><p><b>Limitations.</b> Lookups data only in platform ids 0, 2 and 3 (Unicode, ISO and Windows) with UTF-16BE encoding and reports only the data of the first one it finds for a given name id.</p></dd></dl></section><section><header><h3 id="os2"><a href="#os2" class="anchor"></a>OS/2 table</h3></header><dl><dt class="spec type" id="type-os2"><a href="#type-os2" class="anchor"></a><code><span class="keyword">type</span> os2</code><code> = </code><code>{</code><table class="record"><tr id="type-os2.os2_x_avg_char_width" class="anchored"><td class="def field"><a href="#type-os2.os2_x_avg_char_width" class="anchor"></a><code>os2_x_avg_char_width : int;</code></td></tr><tr id="type-os2.os2_us_weight_class" class="anchored"><td class="def field"><a href="#type-os2.os2_us_weight_class" class="anchor"></a><code>os2_us_weight_class : int;</code></td></tr><tr id="type-os2.os2_us_width_class" class="anchored"><td class="def field"><a href="#type-os2.os2_us_width_class" class="anchor"></a><code>os2_us_width_class : int;</code></td></tr><tr id="type-os2.os2_fs_type" class="anchored"><td class="def field"><a href="#type-os2.os2_fs_type" class="anchor"></a><code>os2_fs_type : int;</code></td></tr><tr id="type-os2.os2_y_subscript_x_size" class="anchored"><td class="def field"><a href="#type-os2.os2_y_subscript_x_size" class="anchor"></a><code>os2_y_subscript_x_size : int;</code></td></tr><tr id="type-os2.os2_y_subscript_y_size" class="anchored"><td class="def field"><a href="#type-os2.os2_y_subscript_y_size" class="anchor"></a><code>os2_y_subscript_y_size : int;</code></td></tr><tr id="type-os2.os2_y_subscript_x_offset" class="anchored"><td class="def field"><a href="#type-os2.os2_y_subscript_x_offset" class="anchor"></a><code>os2_y_subscript_x_offset : int;</code></td></tr><tr id="type-os2.os2_y_subscript_y_offset" class="anchored"><td class="def field"><a href="#type-os2.os2_y_subscript_y_offset" class="anchor"></a><code>os2_y_subscript_y_offset : int;</code></td></tr><tr id="type-os2.os2_y_superscript_x_size" class="anchored"><td class="def field"><a href="#type-os2.os2_y_superscript_x_size" class="anchor"></a><code>os2_y_superscript_x_size : int;</code></td></tr><tr id="type-os2.os2_y_superscript_y_size" class="anchored"><td class="def field"><a href="#type-os2.os2_y_superscript_y_size" class="anchor"></a><code>os2_y_superscript_y_size : int;</code></td></tr><tr id="type-os2.os2_y_superscript_x_offset" class="anchored"><td class="def field"><a href="#type-os2.os2_y_superscript_x_offset" class="anchor"></a><code>os2_y_superscript_x_offset : int;</code></td></tr><tr id="type-os2.os2_y_superscript_y_offset" class="anchored"><td class="def field"><a href="#type-os2.os2_y_superscript_y_offset" class="anchor"></a><code>os2_y_superscript_y_offset : int;</code></td></tr><tr id="type-os2.os2_y_strikeout_size" class="anchored"><td class="def field"><a href="#type-os2.os2_y_strikeout_size" class="anchor"></a><code>os2_y_strikeout_size : int;</code></td></tr><tr id="type-os2.os2_y_strikeout_position" class="anchored"><td class="def field"><a href="#type-os2.os2_y_strikeout_position" class="anchor"></a><code>os2_y_strikeout_position : int;</code></td></tr><tr id="type-os2.os2_family_class" class="anchored"><td class="def field"><a href="#type-os2.os2_family_class" class="anchor"></a><code>os2_family_class : int;</code></td></tr><tr id="type-os2.os2_panose" class="anchored"><td class="def field"><a href="#type-os2.os2_panose" class="anchor"></a><code>os2_panose : string;</code></td><td class="doc"><p>10 bytes</p></td></tr><tr id="type-os2.os2_ul_unicode_range1" class="anchored"><td class="def field"><a href="#type-os2.os2_ul_unicode_range1" class="anchor"></a><code>os2_ul_unicode_range1 : int32;</code></td></tr><tr id="type-os2.os2_ul_unicode_range2" class="anchored"><td class="def field"><a href="#type-os2.os2_ul_unicode_range2" class="anchor"></a><code>os2_ul_unicode_range2 : int32;</code></td></tr><tr id="type-os2.os2_ul_unicode_range3" class="anchored"><td class="def field"><a href="#type-os2.os2_ul_unicode_range3" class="anchor"></a><code>os2_ul_unicode_range3 : int32;</code></td></tr><tr id="type-os2.os2_ul_unicode_range4" class="anchored"><td class="def field"><a href="#type-os2.os2_ul_unicode_range4" class="anchor"></a><code>os2_ul_unicode_range4 : int32;</code></td></tr><tr id="type-os2.os2_ach_vend_id" class="anchored"><td class="def field"><a href="#type-os2.os2_ach_vend_id" class="anchor"></a><code>os2_ach_vend_id : int32;</code></td></tr><tr id="type-os2.os2_fs_selection" class="anchored"><td class="def field"><a href="#type-os2.os2_fs_selection" class="anchor"></a><code>os2_fs_selection : int;</code></td></tr><tr id="type-os2.os2_us_first_char_index" class="anchored"><td class="def field"><a href="#type-os2.os2_us_first_char_index" class="anchor"></a><code>os2_us_first_char_index : int;</code></td></tr><tr id="type-os2.os2_us_last_char_index" class="anchored"><td class="def field"><a href="#type-os2.os2_us_last_char_index" class="anchor"></a><code>os2_us_last_char_index : int;</code></td></tr><tr id="type-os2.os2_s_typo_ascender" class="anchored"><td class="def field"><a href="#type-os2.os2_s_typo_ascender" class="anchor"></a><code>os2_s_typo_ascender : int;</code></td></tr><tr id="type-os2.os2_s_type_descender" class="anchored"><td class="def field"><a href="#type-os2.os2_s_type_descender" class="anchor"></a><code>os2_s_type_descender : int;</code></td></tr><tr id="type-os2.os2_s_typo_linegap" class="anchored"><td class="def field"><a href="#type-os2.os2_s_typo_linegap" class="anchor"></a><code>os2_s_typo_linegap : int;</code></td></tr><tr id="type-os2.os2_us_win_ascent" class="anchored"><td class="def field"><a href="#type-os2.os2_us_win_ascent" class="anchor"></a><code>os2_us_win_ascent : int;</code></td></tr><tr id="type-os2.os2_us_win_descent" class="anchored"><td class="def field"><a href="#type-os2.os2_us_win_descent" class="anchor"></a><code>os2_us_win_descent : int;</code></td></tr><tr id="type-os2.os2_ul_code_page_range_1" class="anchored"><td class="def field"><a href="#type-os2.os2_ul_code_page_range_1" class="anchor"></a><code>os2_ul_code_page_range_1 : int32 option;</code></td></tr><tr id="type-os2.os2_ul_code_page_range_2" class="anchored"><td class="def field"><a href="#type-os2.os2_ul_code_page_range_2" class="anchor"></a><code>os2_ul_code_page_range_2 : int32 option;</code></td></tr><tr id="type-os2.os2_s_x_height" class="anchored"><td class="def field"><a href="#type-os2.os2_s_x_height" class="anchor"></a><code>os2_s_x_height : int option;</code></td></tr><tr id="type-os2.os2_s_cap_height" class="anchored"><td class="def field"><a href="#type-os2.os2_s_cap_height" class="anchor"></a><code>os2_s_cap_height : int option;</code></td></tr><tr id="type-os2.os2_us_default_char" class="anchored"><td class="def field"><a href="#type-os2.os2_us_default_char" class="anchor"></a><code>os2_us_default_char : int option;</code></td></tr><tr id="type-os2.os2_us_break_char" class="anchored"><td class="def field"><a href="#type-os2.os2_us_break_char" class="anchor"></a><code>os2_us_break_char : int option;</code></td></tr><tr id="type-os2.os2_us_max_context" class="anchored"><td class="def field"><a href="#type-os2.os2_us_max_context" class="anchor"></a><code>os2_us_max_context : int option;</code></td></tr></table><code>}</code></dt><dd><p>The type for <a href="http://www.microsoft.com/typography/otspec/os2.htm">OS/2</a> tables.</p></dd></dl><dl><dt class="spec value" id="val-os2"><a href="#val-os2" class="anchor"></a><code><span class="keyword">val</span> os2 : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> (<a href="index.html#type-os2">os2</a>, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>os2 d</code> is the OS/2 table.</p></dd></dl></section><section><header><h3 id="kern"><a href="#kern" class="anchor"></a>kern table</h3></header><dl><dt class="spec type" id="type-kern_info"><a href="#type-kern_info" class="anchor"></a><code><span class="keyword">type</span> kern_info</code><code> = </code><code>{</code><table class="record"><tr id="type-kern_info.kern_dir" class="anchored"><td class="def field"><a href="#type-kern_info.kern_dir" class="anchor"></a><code>kern_dir : [ `H | `V ];</code></td></tr><tr id="type-kern_info.kern_kind" class="anchored"><td class="def field"><a href="#type-kern_info.kern_kind" class="anchor"></a><code>kern_kind : [ `Min | `Kern ];</code></td></tr><tr id="type-kern_info.kern_cross_stream" class="anchored"><td class="def field"><a href="#type-kern_info.kern_cross_stream" class="anchor"></a><code>kern_cross_stream : bool;</code></td></tr></table><code>}</code></dt><dd><p>The type for kerning (sub)table information.</p></dd></dl><dl><dt class="spec value" id="val-kern"><a href="#val-kern" class="anchor"></a><code><span class="keyword">val</span> kern : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-kern_info">kern_info</a> <span>&#45;&gt;</span> [ `Skip | `Fold ] * <span class="type-var">'a</span>) <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-glyph_id">glyph_id</a> <span>&#45;&gt;</span> <a href="index.html#type-glyph_id">glyph_id</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>kern d t p acc</code> folds over the kerning tables of <code>d</code> by reading the <a href="http://www.microsoft.com/typography/otspec/kern.htm">kern</a> table. <code>t</code> is called on each new (sub)table, the table pairs are skipped if it returns <code>`Skip</code> otherwise <code>p acc' left right value</code> is called on each kerning pair of the table. The function returns <code>acc</code> if there is no kern table.</p><p><b>Limitations.</b> Only format 0 kerning tables are supported.</p></dd></dl></section><section><header><h3 id="loca"><a href="#loca" class="anchor"></a>loca table</h3></header><dl><dt class="spec value" id="val-loca"><a href="#val-loca" class="anchor"></a><code><span class="keyword">val</span> loca : <a href="index.html#type-decoder">decoder</a> <span>&#45;&gt;</span> <a href="index.html#type-glyph_id">glyph_id</a> <span>&#45;&gt;</span> (<a href="index.html#type-glyf_loc">glyf_loc</a> option, <a href="index.html#type-error">error</a>) <a href="../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>loca d gid</code> looks up the location of the glyph with id <code>gid</code> by reading the <a href="http://www.microsoft.com/typography/otspec/loca.htm">loca</a> table. The result can be used with <a href="index.html#val-glyf"><code>glyf</code></a> to lookup the glyph.</p></dd></dl></section></section><section><header><h2 id="limitations"><a href="#limitations" class="anchor"></a>Limitations</h2><p>As it stands <code>Otfm</code> has the following limitations. Some of these may be lifted in the future and a few of these can be overcome by pre-processing your font (e.g. extract <code>.ttc</code> files to <code>.ttf</code>, or removing hinting information to reduce the font size). See also the individual table decoding functions for other limitations.</p><ul><li>True Type collections (<code>.ttc</code> files) are not supported</li><li>The whole font needs to be loaded in memory as a string. This may be a limiting factor on 32 bits platforms (but non <code>.ttc</code> font files tend to be smaller than 16 Mo).</li><li>Table checksums are not verified.</li></ul></header></section><section><header><h2 id="examples"><a href="#examples" class="anchor"></a>Examples</h2><p>The following code prints the postscript name of the font on stdout.</p><pre><code class="ml">let otf_postscript_name bytes =
  let d = Otfm.decoder (`String bytes) in
  match Otfm.postscript_name d with
  | Error e -&gt; Format.eprintf &quot;@[%a@]@.&quot; Otfm.pp_error e
  | Ok (Some n) -&gt; Format.printf &quot;%s@.&quot; n;
  | Ok None -&gt; ()</code></pre></header></section></div></body></html>