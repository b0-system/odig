<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamProcess (opam-core.OpamProcess)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">opam-core</a> &#x00BB; OpamProcess</nav><header class="odoc-preamble"><h1>Module <code><span>OpamProcess</span></code></h1><p>Process and job handling, with logs, termination status, etc.</p></header><nav class="odoc-toc"><ul><li><a href="#misc">Misc</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-command" class="anchored"><a href="#type-command" class="anchor"></a><code><span><span class="keyword">type</span> command</span></code></div><div class="spec-doc"><p>The type of shell commands</p></div></div><div class="odoc-spec"><div class="spec value" id="val-command" class="anchored"><a href="#val-command" class="anchor"></a><code><span><span class="keyword">val</span> command : <span>?env:<span>string array</span> <span class="arrow">&#45;&gt;</span></span> <span>?verbose:bool <span class="arrow">&#45;&gt;</span></span> <span>?name:string <span class="arrow">&#45;&gt;</span></span>
<span>?metadata:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?dir:string <span class="arrow">&#45;&gt;</span></span> <span>?allow_stdin:bool <span class="arrow">&#45;&gt;</span></span>
<span>?stdout:string <span class="arrow">&#45;&gt;</span></span> <span>?text:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-command">command</a></span></code></div><div class="spec-doc"><p>Builds a shell command for later execution.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">env</span> <p>environment for the command</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">verbose</span> <p>force verbosity</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">name</span> <p>title, used to name log files, etc.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">metadata</span> <p>additional info to log</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">dir</span> <p>CWD for the command</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">allow_stdin</span> <p>whether to forward stdin</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">stdout</span> <p>redirect stdout to the given file instead of the logs</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">text</span> <p>Short text that may be displayed in the status-line</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">command</span> <p>The command itself</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">args</span> <p>Command-line arguments</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-string_of_command" class="anchored"><a href="#val-string_of_command" class="anchor"></a><code><span><span class="keyword">val</span> string_of_command : <span><a href="#type-command">command</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-text_of_command" class="anchored"><a href="#val-text_of_command" class="anchor"></a><code><span><span class="keyword">val</span> text_of_command : <span><a href="#type-command">command</a> <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-is_verbose_command" class="anchored"><a href="#val-is_verbose_command" class="anchor"></a><code><span><span class="keyword">val</span> is_verbose_command : <span><a href="#type-command">command</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-make_command_text" class="anchored"><a href="#val-make_command_text" class="anchor"></a><code><span><span class="keyword">val</span> make_command_text : <span>?color:<a href="../OpamConsole/index.html#type-text_style">OpamConsole.text_style</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>?args:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Returns a label suitable for printing the summary of running commands. First string is the topic (e.g. package), second the action (e.g. command name). Optional command arguments may be used for details (e.g. make action).</p></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><table><tr id="type-t.p_name" class="anchored"><td class="def record field"><a href="#type-t.p_name" class="anchor"></a><code><span>p_name : string;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Command name</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.p_args" class="anchored"><td class="def record field"><a href="#type-t.p_args" class="anchor"></a><code><span>p_args : <span>string list</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Command args</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.p_pid" class="anchored"><td class="def record field"><a href="#type-t.p_pid" class="anchor"></a><code><span>p_pid : int;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Process PID</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.p_cwd" class="anchored"><td class="def record field"><a href="#type-t.p_cwd" class="anchor"></a><code><span>p_cwd : string;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Process initial working directory</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.p_time" class="anchored"><td class="def record field"><a href="#type-t.p_time" class="anchor"></a><code><span>p_time : float;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Process start time</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.p_stdout" class="anchored"><td class="def record field"><a href="#type-t.p_stdout" class="anchor"></a><code><span>p_stdout : <span>string option</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>stdout dump file</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.p_stderr" class="anchored"><td class="def record field"><a href="#type-t.p_stderr" class="anchor"></a><code><span>p_stderr : <span>string option</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>stderr dump file</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.p_env" class="anchored"><td class="def record field"><a href="#type-t.p_env" class="anchor"></a><code><span>p_env : <span>string option</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>dump environment variables</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.p_info" class="anchored"><td class="def record field"><a href="#type-t.p_info" class="anchor"></a><code><span>p_info : <span>string option</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>dump process info</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.p_metadata" class="anchored"><td class="def record field"><a href="#type-t.p_metadata" class="anchor"></a><code><span>p_metadata : <span><span>(string * string)</span> list</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Metadata associated to the process</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.p_verbose" class="anchored"><td class="def record field"><a href="#type-t.p_verbose" class="anchor"></a><code><span>p_verbose : bool;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>whether output of the process should be displayed</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.p_tmp_files" class="anchored"><td class="def record field"><a href="#type-t.p_tmp_files" class="anchor"></a><code><span>p_tmp_files : <span>string list</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>temporary files that should be cleaned up upon completion</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>The type for processes</p></div></div><div class="odoc-spec"><div class="spec type" id="type-result" class="anchored"><a href="#type-result" class="anchor"></a><code><span><span class="keyword">type</span> result</span><span> = </span><span>{</span></code><table><tr id="type-result.r_code" class="anchored"><td class="def record field"><a href="#type-result.r_code" class="anchor"></a><code><span>r_code : int;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Process exit code, or 256 on error</p><span class="comment-delim">*)</span></td></tr><tr id="type-result.r_signal" class="anchored"><td class="def record field"><a href="#type-result.r_signal" class="anchor"></a><code><span>r_signal : <span>int option</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Signal received if the processed was killed</p><span class="comment-delim">*)</span></td></tr><tr id="type-result.r_duration" class="anchored"><td class="def record field"><a href="#type-result.r_duration" class="anchor"></a><code><span>r_duration : float;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Process duration</p><span class="comment-delim">*)</span></td></tr><tr id="type-result.r_info" class="anchored"><td class="def record field"><a href="#type-result.r_info" class="anchor"></a><code><span>r_info : <span><span>(string * string)</span> list</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Process info</p><span class="comment-delim">*)</span></td></tr><tr id="type-result.r_stdout" class="anchored"><td class="def record field"><a href="#type-result.r_stdout" class="anchor"></a><code><span>r_stdout : <span>string list</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Content of stdout dump file</p><span class="comment-delim">*)</span></td></tr><tr id="type-result.r_stderr" class="anchored"><td class="def record field"><a href="#type-result.r_stderr" class="anchor"></a><code><span>r_stderr : <span>string list</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Content of stderr dump file</p><span class="comment-delim">*)</span></td></tr><tr id="type-result.r_cleanup" class="anchored"><td class="def record field"><a href="#type-result.r_cleanup" class="anchor"></a><code><span>r_cleanup : <span>string list</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>List of files to clean-up</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>Process results</p></div></div><div class="odoc-spec"><div class="spec value" id="val-run" class="anchored"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span><a href="#type-command">command</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-result">result</a></span></code></div><div class="spec-doc"><p><code>run command</code> synchronously call the command <code>command.cmd</code> with arguments <code>command.args</code>. It waits until the process is finished. The files <code>name.info</code>, <code>name.env</code>, <code>name.out</code> and <code>name.err</code>, with <code>name = command.cmd_name</code> are created, and contain the process main description, the environment variables, the standard output and the standard error. Don't forget to call <code>cleanup result</code> afterwards</p></div></div><div class="odoc-spec"><div class="spec value" id="val-run_background" class="anchored"><a href="#val-run_background" class="anchor"></a><code><span><span class="keyword">val</span> run_background : <span><a href="#type-command">command</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Same as <code>run</code>, but doesn't wait. Use wait_one to wait and collect results; Don't forget to call <code>cleanup result</code> afterwards</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dry_run_background" class="anchored"><a href="#val-dry_run_background" class="anchor"></a><code><span><span class="keyword">val</span> dry_run_background : <span><a href="#type-command">command</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Similar to <code>run_background</code>, except that no process is created, and a dummy process (suitable for dry_wait_one) is returned.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-wait" class="anchored"><a href="#val-wait" class="anchor"></a><code><span><span class="keyword">val</span> wait : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-result">result</a></span></code></div><div class="spec-doc"><p><code>wait p</code> waits for the processus <code>p</code> to end and returns its results. Be careful to handle Sys.Break</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dontwait" class="anchored"><a href="#val-dontwait" class="anchor"></a><code><span><span class="keyword">val</span> dontwait : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-result">result</a> option</span></span></code></div><div class="spec-doc"><p>Like <code>wait</code>, but returns None immediately if the process hasn't ended</p></div></div><div class="odoc-spec"><div class="spec value" id="val-wait_one" class="anchored"><a href="#val-wait_one" class="anchor"></a><code><span><span class="keyword">val</span> wait_one : <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a> * <a href="#type-result">result</a></span></code></div><div class="spec-doc"><p>Wait for the first of the listed processes to terminate, and return its termination status</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dry_wait_one" class="anchored"><a href="#val-dry_wait_one" class="anchor"></a><code><span><span class="keyword">val</span> dry_wait_one : <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a> * <a href="#type-result">result</a></span></code></div><div class="spec-doc"><p>Similar to <code>wait_one</code> for simulations, to be used with <code>dry_run_background</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-interrupt" class="anchored"><a href="#val-interrupt" class="anchor"></a><code><span><span class="keyword">val</span> interrupt : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Send SIGINT to a process (or SIGKILL on Windows)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_success" class="anchored"><a href="#val-is_success" class="anchor"></a><code><span><span class="keyword">val</span> is_success : <span><a href="#type-result">result</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Is the process result a success?</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_failure" class="anchored"><a href="#val-is_failure" class="anchor"></a><code><span><span class="keyword">val</span> is_failure : <span><a href="#type-result">result</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Is the process result a failure?</p></div></div><div class="odoc-spec"><div class="spec value" id="val-cleanup" class="anchored"><a href="#val-cleanup" class="anchor"></a><code><span><span class="keyword">val</span> cleanup : <span>?force:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-result">result</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Should be called after process termination, to cleanup temporary files. Leaves artefacts in case OpamGlobals.debug is on and on failure, unless force has been set.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check_success_and_cleanup" class="anchored"><a href="#val-check_success_and_cleanup" class="anchor"></a><code><span><span class="keyword">val</span> check_success_and_cleanup : <span><a href="#type-result">result</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Like <code>is_success</code>, with an added cleanup side-effect (as <code>cleanup
    ~force:true</code>). Use this when not returning 0 is not an error case: since the default behaviour is to cleanup only when the command returned 0, which is not what is expected in that case.</p></div></div><h3 id="misc"><a href="#misc" class="anchor"></a>Misc</h3><div class="odoc-spec"><div class="spec value" id="val-read_lines" class="anchored"><a href="#val-read_lines" class="anchor"></a><code><span><span class="keyword">val</span> read_lines : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p>Reads a text file and returns a list of lines</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string_of_result" class="anchored"><a href="#val-string_of_result" class="anchor"></a><code><span><span class="keyword">val</span> string_of_result : <span>?color:<a href="../OpamConsole/index.html#type-text_style">OpamConsole.text_style</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-result">result</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Detailed report on process outcome</p></div></div><div class="odoc-spec"><div class="spec value" id="val-result_summary" class="anchored"><a href="#val-result_summary" class="anchor"></a><code><span><span class="keyword">val</span> result_summary : <span><a href="#type-result">result</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Short report on process outcome</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Job" class="anchored"><a href="#module-Job" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Job/index.html">Job</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Higher-level interface to allow parallelism</p></div></div><div class="odoc-spec"><div class="spec type" id="type-job" class="anchored"><a href="#type-job" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a job</span></span><span> = <span><span class="type-var">'a</span> <a href="Job/Op/index.html#type-job">Job.Op.job</a></span></span></code></div></div></div></body></html>