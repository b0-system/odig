<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Codec (topkg.Topkg.Private.Codec)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">topkg</a> &#x00BB; <a href="../../index.html">Topkg</a> &#x00BB; <a href="../index.html">Private</a> &#x00BB; Codec</nav><h1>Module <code>Private.Codec</code></h1><p>Topkg interprocess communication codec.</p><p>Codecs for communication between the <code>topkg</code> tool and topkg description files.</p><nav class="toc"><ul><li><a href="#decode-errors">Decode errors</a></li><li><a href="#codecs">Codecs</a></li><li><a href="#base">Base type codecs</a></li><li><a href="#topkg">Topkg types</a></li></ul></nav></header><section><header><h2 id="decode-errors"><a href="#decode-errors" class="anchor"></a>Decode errors</h2></header><dl><dt class="spec type" id="type-error"><a href="#type-error" class="anchor"></a><code><span class="keyword">type</span> error</code><code> = </code><table class="variant"><tr id="type-error.Corrupted" class="anchored"><td class="def constructor"><a href="#type-error.Corrupted" class="anchor"></a><code>| </code><code><span class="constructor">Corrupted</span> <span class="keyword">of</span> string * string</code></td></tr><tr id="type-error.Version" class="anchored"><td class="def constructor"><a href="#type-error.Version" class="anchor"></a><code>| </code><code><span class="constructor">Version</span> <span class="keyword">of</span> int * int</code></td></tr></table></dt><dd><p>The type for decode errors.</p><ul><li><code>Corrupted (kind, data)</code>, an error occured while decoding <code>data</code> for <code>kind</code>.</li><li><code>Version (exp, fnd)</code>, a <a href="index.html#val-version"><span>versioned</span></a> decoder expected version <code>exp</code> but found <code>fnd</code></li></ul></dd></dl><dl><dt class="spec value" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><code><span class="keyword">val</span> pp_error : <a href="../../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> <a href="index.html#type-error">error</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>pp_error ppf e</code> prints an unspecified representation of <code>e</code> on <code>ppf</code>.</p></dd></dl><dl><dt class="spec exception" id="exception-Error"><a href="#exception-Error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Error</span> <span class="keyword">of</span> <a href="index.html#type-error">error</a></code></dt><dd><p>Raised on decode errors.</p></dd></dl></section><section><header><h2 id="codecs"><a href="#codecs" class="anchor"></a>Codecs</h2></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> 'a t</code></dt><dd><p>The type for codec for OCaml values of type <code>'a</code>.</p></dd></dl><dl><dt class="spec value" id="val-v"><a href="#val-v" class="anchor"></a><code><span class="keyword">val</span> v : kind:string <span>&#45;&gt;</span> enc:(<span class="type-var">'a</span> <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> dec:(string <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>v kind enc dec</code> is a codec for value identified as <code>kind</code> using <code>enc</code> to encode and <code>dec</code> to decode.</p></dd></dl><dl><dt class="spec value" id="val-kind"><a href="#val-kind" class="anchor"></a><code><span class="keyword">val</span> kind : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>kind c</code> is <code>c</code>'s kind.</p></dd></dl><dl><dt class="spec value" id="val-enc"><a href="#val-enc" class="anchor"></a><code><span class="keyword">val</span> enc : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> string</code></dt><dd><p><code>enc c</code> is <code>c</code>'s encoder.</p></dd></dl><dl><dt class="spec value" id="val-dec"><a href="#val-dec" class="anchor"></a><code><span class="keyword">val</span> dec : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>dec c</code> is <code>c</code>'s decoder. The decoder </p><dl><dt>raises Error</dt><dd><p>in case of decode error</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-dec_result"><a href="#val-dec_result" class="anchor"></a><code><span class="keyword">val</span> dec_result : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../index.html#type-result">result</a></code></dt><dd><p><code>dec c</code> is like <a href="index.html#val-dec"><code>dec</code></a> but doesn't raise. The exception is turned into an error message using <a href="index.html#val-pp_error"><code>pp_error</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-with_kind"><a href="#val-with_kind" class="anchor"></a><code><span class="keyword">val</span> with_kind : string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>with_kind k c</code> is <code>c</code> with kind <code>k</code>.</p></dd></dl><dl><dt class="spec value" id="val-write"><a href="#val-write" class="anchor"></a><code><span class="keyword">val</span> write : <a href="../../index.html#type-fpath">fpath</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit <a href="../../index.html#type-result">result</a></code></dt><dd><p><code>write f c v</code> encodes value <code>v</code> with <code>c</code> to <code>f</code>.</p></dd></dl><dl><dt class="spec value" id="val-read"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : <a href="../../index.html#type-fpath">fpath</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../index.html#type-result">result</a></code></dt><dd><p><code>read f c</code> reads a value with <code>c</code> from <code>f</code>.</p></dd></dl></section><section><header><h2 id="base"><a href="#base" class="anchor"></a>Base type codecs</h2></header><dl><dt class="spec value" id="val-unit"><a href="#val-unit" class="anchor"></a><code><span class="keyword">val</span> unit : unit <a href="index.html#type-t">t</a></code></dt><dd><p><code>unit</code> codecs a <code>()</code>.</p></dd></dl><dl><dt class="spec value" id="val-const"><a href="#val-const" class="anchor"></a><code><span class="keyword">val</span> const : <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>const v</code> codecs the constant <code>v</code>.</p></dd></dl><dl><dt class="spec value" id="val-bool"><a href="#val-bool" class="anchor"></a><code><span class="keyword">val</span> bool : bool <a href="index.html#type-t">t</a></code></dt><dd><p><code>bool</code> codecs booleans.</p></dd></dl><dl><dt class="spec value" id="val-int"><a href="#val-int" class="anchor"></a><code><span class="keyword">val</span> int : int <a href="index.html#type-t">t</a></code></dt><dd><p><code>int</code> codecs integers.</p></dd></dl><dl><dt class="spec value" id="val-string"><a href="#val-string" class="anchor"></a><code><span class="keyword">val</span> string : string <a href="index.html#type-t">t</a></code></dt><dd><p><code>string</code> codecs strings.</p></dd></dl><dl><dt class="spec value" id="val-option"><a href="#val-option" class="anchor"></a><code><span class="keyword">val</span> option : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> option <a href="index.html#type-t">t</a></code></dt><dd><p><code>option el</code> codecs <code>el</code> options.</p></dd></dl><dl><dt class="spec value" id="val-result"><a href="#val-result" class="anchor"></a><code><span class="keyword">val</span> result : ok:<span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> error:<span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="../../../../result/Result/index.html#type-result">Result.result</a> <a href="index.html#type-t">t</a></code></dt><dd><p><code>result ~ok ~error</code> codecs <code>ok</code>, <code>error</code> results.</p></dd></dl><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">val</span> list : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> list <a href="index.html#type-t">t</a></code></dt><dd><p><code>list el</code> codecs <code>el</code> lists.</p></dd></dl><dl><dt class="spec value" id="val-pair"><a href="#val-pair" class="anchor"></a><code><span class="keyword">val</span> pair : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> * <span class="type-var">'b</span>) <a href="index.html#type-t">t</a></code></dt><dd><p><code>pair c0 c1</code> codecs <code>c0</code>, <code>c1</code> pairs.</p></dd></dl><dl><dt class="spec value" id="val-t3"><a href="#val-t3" class="anchor"></a><code><span class="keyword">val</span> t3 : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'c</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> * <span class="type-var">'b</span> * <span class="type-var">'c</span>) <a href="index.html#type-t">t</a></code></dt><dd><p><code>t3</code> is like <a href="index.html#val-pair"><code>pair</code></a> but for triples.</p></dd></dl><dl><dt class="spec value" id="val-t4"><a href="#val-t4" class="anchor"></a><code><span class="keyword">val</span> t4 : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'c</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'d</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> * <span class="type-var">'b</span> * <span class="type-var">'c</span> * <span class="type-var">'d</span>) <a href="index.html#type-t">t</a></code></dt><dd><p><code>t4</code> is like <a href="index.html#val-pair"><code>pair</code></a> but for quadruples.</p></dd></dl><dl><dt class="spec value" id="val-t5"><a href="#val-t5" class="anchor"></a><code><span class="keyword">val</span> t5 : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'c</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'d</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'e</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> * <span class="type-var">'b</span> * <span class="type-var">'c</span> * <span class="type-var">'d</span> * <span class="type-var">'e</span>) <a href="index.html#type-t">t</a></code></dt><dd><p><code>t5</code> is like <a href="index.html#val-pair"><code>pair</code></a> but for qintuples.</p></dd></dl><dl><dt class="spec value" id="val-alt"><a href="#val-alt" class="anchor"></a><code><span class="keyword">val</span> alt : kind:string <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> int) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> array <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>alt tag cs</code> codecs values by tagging them with <code>tag</code> and using the corresponding codec in <code>cs</code>.</p><dl><dt>raises Invalid_argument</dt><dd><p>if <code>Array.length cs &gt; 256</code>.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-version"><a href="#val-version" class="anchor"></a><code><span class="keyword">val</span> version : int <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>version num c</code> versions codec <code>c</code> with number <code>num</code>. On decode a version number mismatch raises an error see <a href="index.html#type-error"><code>error</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-view"><a href="#val-view" class="anchor"></a><code><span class="keyword">val</span> view : ?&#8288;kind:string <span>&#45;&gt;</span> ((<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) * (<span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>)) <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>view kind t c</code> views <code>t</code> as <code>c</code> for codecing.</p></dd></dl></section><section><header><h2 id="topkg"><a href="#topkg" class="anchor"></a>Topkg types</h2></header><dl><dt class="spec value" id="val-msg"><a href="#val-msg" class="anchor"></a><code><span class="keyword">val</span> msg : [ `Msg of string ] <a href="index.html#type-t">t</a></code></dt><dd><p><code>msg</code> codecs error messages.</p></dd></dl><dl><dt class="spec value" id="val-result_error_msg"><a href="#val-result_error_msg" class="anchor"></a><code><span class="keyword">val</span> result_error_msg : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../index.html#type-result">result</a> <a href="index.html#type-t">t</a></code></dt><dd><p><code>result_error_msg ok</code> codecs <code>ok</code> or error message results.</p></dd></dl><dl><dt class="spec value" id="val-fpath"><a href="#val-fpath" class="anchor"></a><code><span class="keyword">val</span> fpath : <a href="../../Fpath/index.html#type-t">Fpath.t</a> <a href="index.html#type-t">t</a></code></dt><dd><p><code>fpath</code> codecs files paths.</p></dd></dl><dl><dt class="spec value" id="val-cmd"><a href="#val-cmd" class="anchor"></a><code><span class="keyword">val</span> cmd : <a href="../../Cmd/index.html#type-t">Cmd.t</a> <a href="index.html#type-t">t</a></code></dt><dd><p><code>cmd</code> codecs command line fragments.</p></dd></dl></section></div></body></html>