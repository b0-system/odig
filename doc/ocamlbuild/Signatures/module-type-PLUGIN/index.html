<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>PLUGIN (ocamlbuild.Signatures.PLUGIN)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">ocamlbuild</a> &#x00BB; <a href="../index.html">Signatures</a> &#x00BB; PLUGIN</nav><h1>Module type <code>Signatures.PLUGIN</code></h1><p>This module contains the functions and values that can be used by plugins.</p></header><div class="spec module" id="module-Pathname"><a href="#module-Pathname" class="anchor"></a><code><span class="keyword">module</span> <a href="Pathname/index.html">Pathname</a> : <a href="../index.html#module-type-PATHNAME">PATHNAME</a></code></div><div class="spec module" id="module-Tags"><a href="#module-Tags" class="anchor"></a><code><span class="keyword">module</span> <a href="Tags/index.html">Tags</a> : <a href="../index.html#module-type-TAGS">TAGS</a></code></div><div class="spec module" id="module-Command"><a href="#module-Command" class="anchor"></a><code><span class="keyword">module</span> <a href="Command/index.html">Command</a> : <a href="../index.html#module-type-COMMAND">COMMAND</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../module-type-COMMAND/index.html#type-tags">tags</a> = <a href="Tags/index.html#type-t">Tags.t</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="../module-type-COMMAND/index.html#type-pathname">pathname</a> = <a href="Pathname/index.html#type-t">Pathname.t</a></code></div><div class="spec module" id="module-Outcome"><a href="#module-Outcome" class="anchor"></a><code><span class="keyword">module</span> <a href="Outcome/index.html">Outcome</a> : <a href="../index.html#module-type-OUTCOME">OUTCOME</a></code></div><div class="spec module" id="module-String"><a href="#module-String" class="anchor"></a><code><span class="keyword">module</span> <a href="String/index.html">String</a> : <a href="../index.html#module-type-STRING">STRING</a></code></div><div class="spec module" id="module-List"><a href="#module-List" class="anchor"></a><code><span class="keyword">module</span> <a href="List/index.html">List</a> : <a href="../index.html#module-type-LIST">LIST</a></code></div><div class="spec module" id="module-StringSet"><a href="#module-StringSet" class="anchor"></a><code><span class="keyword">module</span> <a href="StringSet/index.html">StringSet</a> : <a href="../../../ocaml/Stdlib/Set/index.html#module-type-S">Stdlib.Set.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../ocaml/Stdlib/Set/module-type-S/index.html#type-elt">elt</a> = <a href="String/index.html#type-t">String.t</a></code></div><div class="spec module" id="module-Options"><a href="#module-Options" class="anchor"></a><code><span class="keyword">module</span> <a href="Options/index.html">Options</a> : <a href="../index.html#module-type-OPTIONS">OPTIONS</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../module-type-OPTIONS/index.html#type-command_spec">command_spec</a> = <a href="Command/index.html#type-spec">Command.spec</a></code></div><div class="spec module" id="module-Arch"><a href="#module-Arch" class="anchor"></a><code><span class="keyword">module</span> <a href="Arch/index.html">Arch</a> : <a href="../index.html#module-type-ARCH">ARCH</a></code></div><div class="spec module" id="module-Findlib"><a href="#module-Findlib" class="anchor"></a><code><span class="keyword">module</span> <a href="Findlib/index.html">Findlib</a> : <a href="../index.html#module-type-FINDLIB">FINDLIB</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../module-type-FINDLIB/index.html#type-command_spec">command_spec</a> = <a href="Command/index.html#type-spec">Command.spec</a></code></div><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../index.html#module-type-MISC">MISC</a></code></span></summary><dl><dt class="spec value" id="val-opt_print"><a href="#val-opt_print" class="anchor"></a><code><span class="keyword">val</span> opt_print : (<a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> <a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> option <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-the"><a href="#val-the" class="anchor"></a><code><span class="keyword">val</span> the : <span class="type-var">'a</span> option <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dt class="spec value" id="val-getenv"><a href="#val-getenv" class="anchor"></a><code><span class="keyword">val</span> getenv : ?&#8288;default:string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string</code></dt><dt class="spec value" id="val-with_input_file"><a href="#val-with_input_file" class="anchor"></a><code><span class="keyword">val</span> with_input_file : ?&#8288;bin:bool <span>&#45;&gt;</span> string <span>&#45;&gt;</span> (<a href="../../../ocaml/Stdlib/index.html#type-in_channel">Stdlib.in_channel</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dt class="spec value" id="val-with_output_file"><a href="#val-with_output_file" class="anchor"></a><code><span class="keyword">val</span> with_output_file : ?&#8288;bin:bool <span>&#45;&gt;</span> string <span>&#45;&gt;</span> (<a href="../../../ocaml/Stdlib/index.html#type-out_channel">Stdlib.out_channel</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dt class="spec value" id="val-with_temp_file"><a href="#val-with_temp_file" class="anchor"></a><code><span class="keyword">val</span> with_temp_file : string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> (string <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dt class="spec value" id="val-read_file"><a href="#val-read_file" class="anchor"></a><code><span class="keyword">val</span> read_file : string <span>&#45;&gt;</span> string</code></dt><dt class="spec value" id="val-copy_chan"><a href="#val-copy_chan" class="anchor"></a><code><span class="keyword">val</span> copy_chan : <a href="../../../ocaml/Stdlib/index.html#type-in_channel">Stdlib.in_channel</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Stdlib/index.html#type-out_channel">Stdlib.out_channel</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-copy_file"><a href="#val-copy_file" class="anchor"></a><code><span class="keyword">val</span> copy_file : string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-print_string_list"><a href="#val-print_string_list" class="anchor"></a><code><span class="keyword">val</span> print_string_list : <a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-(!*)"><a href="#val-(!*)" class="anchor"></a><code><span class="keyword">val</span> (!*) : <span class="type-var">'a</span> <a href="../../../ocaml/Stdlib/Lazy/index.html#type-t">Stdlib.Lazy.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>A shortcut to force lazy value (See <code>Lazy.force</code>).</p></dd></dl><dl><dt class="spec value" id="val-(&amp;)"><a href="#val-(&amp;)" class="anchor"></a><code><span class="keyword">val</span> (&amp;) : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><p>The right associative application. Useful when writing to much parentheses: &lt;&lt; f (g x ... t) &gt;&gt; becomes &lt;&lt; f&amp; g x ... t &gt;&gt; &lt;&lt; f (g (h x)) &gt;&gt; becomes &lt;&lt; f&amp; g&amp; h x &gt;&gt;</p></dd></dl><dl><dt class="spec value" id="val-(|&gt;)"><a href="#val-(|&gt;)" class="anchor"></a><code><span class="keyword">val</span> (|&gt;) : <span class="type-var">'a</span> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><p>The reversed application combinator. Useful to describe some operations chaining. &lt;&lt; f x (g y (h z)) &gt;&gt; becomes &lt;&lt; z |&gt; h |&gt; g y |&gt; f x &gt;&gt;</p></dd></dl><dl><dt class="spec value" id="val-(@:=)"><a href="#val-(@:=)" class="anchor"></a><code><span class="keyword">val</span> (@:=) : <span class="type-var">'a</span> list <a href="../../../ocaml/Stdlib/index.html#type-ref">Stdlib.ref</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> list <span>&#45;&gt;</span> unit</code></dt><dd><p><code>r @:= l</code> is equivalent to <code>r := !r @ l</code></p></dd></dl><dl><dt class="spec value" id="val-memo"><a href="#val-memo" class="anchor"></a><code><span class="keyword">val</span> memo : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dt class="spec value" id="val-memo2"><a href="#val-memo2" class="anchor"></a><code><span class="keyword">val</span> memo2 : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span></code></dt><dt class="spec value" id="val-memo3"><a href="#val-memo3" class="anchor"></a><code><span class="keyword">val</span> memo3 : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'d</span></code></dt></dl></details></div></div></div><dl><dt class="spec type" id="type-command"><a href="#type-command" class="anchor"></a><code><span class="keyword">type</span> command</code><code> = <a href="Command/index.html#type-t">Command.t</a></code><code> = </code><table class="variant"><tr id="type-command.Seq" class="anchored"><td class="def constructor"><a href="#type-command.Seq" class="anchor"></a><code>| </code><code><span class="constructor">Seq</span> <span class="keyword">of</span> <a href="index.html#type-command">command</a> list</code></td></tr><tr id="type-command.Cmd" class="anchored"><td class="def constructor"><a href="#type-command.Cmd" class="anchor"></a><code>| </code><code><span class="constructor">Cmd</span> <span class="keyword">of</span> <a href="index.html#type-spec">spec</a></code></td></tr><tr id="type-command.Echo" class="anchored"><td class="def constructor"><a href="#type-command.Echo" class="anchor"></a><code>| </code><code><span class="constructor">Echo</span> <span class="keyword">of</span> string list * <a href="Pathname/index.html#type-t">Pathname.t</a></code></td></tr><tr id="type-command.Nop" class="anchored"><td class="def constructor"><a href="#type-command.Nop" class="anchor"></a><code>| </code><code><span class="constructor">Nop</span></code></td></tr></table></dt><dd><p>See <a href="../module-type-COMMAND/index.html#type-t"><code>COMMAND.t</code></a> for the description of this type.</p></dd></dl><dl><dt class="spec type" id="type-spec"><a href="#type-spec" class="anchor"></a><code><span class="keyword">and</span> spec</code><code> = <a href="Command/index.html#type-spec">Command.spec</a></code><code> = </code><table class="variant"><tr id="type-spec.N" class="anchored"><td class="def constructor"><a href="#type-spec.N" class="anchor"></a><code>| </code><code><span class="constructor">N</span></code></td></tr><tr id="type-spec.S" class="anchored"><td class="def constructor"><a href="#type-spec.S" class="anchor"></a><code>| </code><code><span class="constructor">S</span> <span class="keyword">of</span> <a href="index.html#type-spec">spec</a> list</code></td></tr><tr id="type-spec.A" class="anchored"><td class="def constructor"><a href="#type-spec.A" class="anchor"></a><code>| </code><code><span class="constructor">A</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-spec.P" class="anchored"><td class="def constructor"><a href="#type-spec.P" class="anchor"></a><code>| </code><code><span class="constructor">P</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-spec.Px" class="anchored"><td class="def constructor"><a href="#type-spec.Px" class="anchor"></a><code>| </code><code><span class="constructor">Px</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-spec.Sh" class="anchored"><td class="def constructor"><a href="#type-spec.Sh" class="anchor"></a><code>| </code><code><span class="constructor">Sh</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-spec.T" class="anchored"><td class="def constructor"><a href="#type-spec.T" class="anchor"></a><code>| </code><code><span class="constructor">T</span> <span class="keyword">of</span> <a href="Tags/index.html#type-t">Tags.t</a></code></td></tr><tr id="type-spec.V" class="anchored"><td class="def constructor"><a href="#type-spec.V" class="anchor"></a><code>| </code><code><span class="constructor">V</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-spec.Quote" class="anchored"><td class="def constructor"><a href="#type-spec.Quote" class="anchor"></a><code>| </code><code><span class="constructor">Quote</span> <span class="keyword">of</span> <a href="index.html#type-spec">spec</a></code></td></tr></table></dt><dd><p>See <a href="../module-type-COMMAND/index.html#type-spec"><code>COMMAND.spec</code></a> for the description of this type.</p></dd></dl><dl><dt class="spec value" id="val-(/)"><a href="#val-(/)" class="anchor"></a><code><span class="keyword">val</span> (/) : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a></code></dt><dd><p><code>path1/path2</code> Join the given path names.</p></dd></dl><dl><dt class="spec value" id="val-(-.-)"><a href="#val-(-.-)" class="anchor"></a><code><span class="keyword">val</span> (-.-) : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a></code></dt><dd><p><code>path-.-extension</code> Add the given extension to the given pathname.</p></dd></dl><dl><dt class="spec value" id="val-(++)"><a href="#val-(++)" class="anchor"></a><code><span class="keyword">val</span> (++) : <a href="Tags/index.html#type-t">Tags.t</a> <span>&#45;&gt;</span> <a href="Tags/index.html#type-elt">Tags.elt</a> <span>&#45;&gt;</span> <a href="Tags/index.html#type-t">Tags.t</a></code></dt><dd><p><code>tags++tag</code> Add the given tag to the given set of tags.</p></dd></dl><dl><dt class="spec value" id="val-(--)"><a href="#val-(--)" class="anchor"></a><code><span class="keyword">val</span> (--) : <a href="Tags/index.html#type-t">Tags.t</a> <span>&#45;&gt;</span> <a href="Tags/index.html#type-elt">Tags.elt</a> <span>&#45;&gt;</span> <a href="Tags/index.html#type-t">Tags.t</a></code></dt><dd><p><code>tags--tag</code> Remove the given tag to the given set of tags.</p></dd></dl><dl><dt class="spec value" id="val-(+++)"><a href="#val-(+++)" class="anchor"></a><code><span class="keyword">val</span> (+++) : <a href="Tags/index.html#type-t">Tags.t</a> <span>&#45;&gt;</span> <a href="Tags/index.html#type-elt">Tags.elt</a> option <span>&#45;&gt;</span> <a href="Tags/index.html#type-t">Tags.t</a></code></dt><dd><p><code>tags+++optional_tag</code> Add the given optional tag to the given set of tags if the given option is Some.</p></dd></dl><dl><dt class="spec value" id="val-(---)"><a href="#val-(---)" class="anchor"></a><code><span class="keyword">val</span> (---) : <a href="Tags/index.html#type-t">Tags.t</a> <span>&#45;&gt;</span> <a href="Tags/index.html#type-elt">Tags.elt</a> option <span>&#45;&gt;</span> <a href="Tags/index.html#type-t">Tags.t</a></code></dt><dd><p><code>tags---optional_tag</code> Remove the given optional tag to the given set of tags if the given option is Some.</p></dd></dl><dl><dt class="spec type" id="type-env"><a href="#type-env" class="anchor"></a><code><span class="keyword">type</span> env</code><code> = <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a></code></dt><dd><p>Targets and dependencies in rules are patterns, which are matched by the actual targets requested by the user. For example, if a rule explains how to build &quot;%.cmo&quot; from &quot;%.ml&quot;, it will be fired if the user tries to build &quot;foo.cmo&quot;.</p><p>The environment records the value of the pattern variables (here &quot;%&quot;) in this matching. In the context of our example, the environment will be a function substituting &quot;%&quot; by &quot;foo&quot;; calling it on &quot;%.cmo&quot; will return &quot;foo.cmo&quot;, and calling it on &quot;%.ml&quot; will return &quot;foo.ml&quot;.</p><p>For a typical example of use of the environment, see the <code>ocamldep_ml_command</code> example in the documentation of <a href="index.html#type-action"><code>action</code></a> below.</p></dd></dl><dl><dt class="spec type" id="type-builder"><a href="#type-builder" class="anchor"></a><code><span class="keyword">type</span> builder</code><code> = <a href="Pathname/index.html#type-t">Pathname.t</a> list list <span>&#45;&gt;</span> (<a href="Pathname/index.html#type-t">Pathname.t</a>, exn) <a href="Outcome/index.html#type-t">Outcome.t</a> list</code></dt><dd><p>A builder is a function that waits for a conjunction of alternative targets. The alternatives are here to support some choices, for instance for an OCaml module an alternatives can be foo.cmo or Foo.cmo. Conjunctions are here to enable parallelism: commands that are independent will be run concurrently.</p><p>For example, passing <code>[&quot;foo.cmi&quot;; &quot;Foo.cmi&quot;]; [&quot;bar.cmi&quot;; &quot;Bar.cmi&quot;]</code> will build the interfaces of the modules Foo and Bar, trying both possible capitalization of the source file names.</p><p>For an example of use of a builder function, see the <code>targets</code> function given as an example in the documentation of the <a href="index.html#type-action"><code>action</code></a> type below.</p></dd></dl><dl><dt class="spec type" id="type-action"><a href="#type-action" class="anchor"></a><code><span class="keyword">type</span> action</code><code> = <a href="index.html#type-env">env</a> <span>&#45;&gt;</span> <a href="index.html#type-builder">builder</a> <span>&#45;&gt;</span> <a href="Command/index.html#type-t">Command.t</a></code></dt><dd><p>This is the type for rule actions. An action receive as argument, the environment lookup function (see <a href="index.html#type-env"><code>env</code></a>), and a function to dynamically build more targets (see <a href="index.html#type-builder"><code>builder</code></a>). An action should return the command to run in order to build the rule productions using the rule dependencies.</p><p>For example, here is an action to build an <code>ocamldep</code> command, for use in the example of rule given in the documentation of <a href="index.html#val-rule"><code>rule</code></a> below:</p><pre><code class="ml">let ocamldep_ml_command env _build =
  let arg = env &quot;%.ml&quot; and out = env &quot;%.ml.depends&quot; in
  let tags = tags_of_pathname arg ++ &quot;ocaml&quot; ++ &quot;ocamldep&quot; in
  Cmd(S[A &quot;ocamldep&quot;; T tags; A &quot;-modules&quot;; P arg; Sh &quot;&gt;&quot;; Px out])</code></pre><p>In the example above, the build function is not used, as there are no dynamic dependencies. There are in the example below: we build a list of targets dynamically read from a &quot;foo.itarget&quot; file. The final command returned by the action links each of them in the current directory.</p><pre><code class="ml">let target_list env build =
    let itarget = env &quot;%.itarget&quot; in
    let targets =
      let dir = Pathname.dirname itarget in
      let files = string_list_of_file itarget in
      List.map (fun file -&gt; [Pathname.concat dir file]) files
    in
    let results = List.map Outcome.good (build targets) in
    let link_command result =
      Cmd (S [A &quot;ln&quot;; A &quot;-sf&quot;;
              P (Pathname.concat !Options.build_dir result);
              A Pathname.pwd])
    in
    Seq (List.map link_command results)</code></pre></dd></dl><dl><dt class="spec value" id="val-rule"><a href="#val-rule" class="anchor"></a><code><span class="keyword">val</span> rule : string <span>&#45;&gt;</span> ?&#8288;tags:string list <span>&#45;&gt;</span> ?&#8288;prods:string list <span>&#45;&gt;</span> ?&#8288;deps:string list <span>&#45;&gt;</span> ?&#8288;prod:string <span>&#45;&gt;</span> ?&#8288;dep:string <span>&#45;&gt;</span> ?&#8288;stamp:string <span>&#45;&gt;</span> ?&#8288;insert:[ `top | `before of string | `after of string | `bottom ] <span>&#45;&gt;</span> ?&#8288;doc:string <span>&#45;&gt;</span> <a href="index.html#type-action">action</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>This is the main function for adding a rule to the ocamlbuild engine.</p><ul><li>The first argument is the name of the rule (should be unique).</li><li>It takes files that the rule produces. Use <code>~prod</code> for one file, <code>~prods</code> for list of files.</li><li>It also takes files that the rule uses. Use <code>~dep</code> for one file, <code>~deps</code> for list of files.</li><li>It finally takes the action to perform in order to produce the productions files using the dependencies (see <code>action</code>).</li></ul><p>There are some more optional parameters:</p><ul><li>The <code>~insert</code> argument allows to insert the rules precisely between other rules.</li><li>The <code>~stamp</code> argument specifies the name of a file that will be automatically produced by ocamlbuild. This file can serve as a virtual target (or phony target), since it will be filled up by a digest of it dependencies.</li><li>The <code>~tags</code> argument in deprecated, don't use it.</li></ul><p>Finally, the optional <code>~doc</code> argument allows to give an informal explanation of the rule purpose and behavior, that will be displayed by <code>ocamlbuild -documentation</code>. For example, it is a good place to specify the commands that will be called, any new tags introduced by the rule, and dynamic dependencies.</p><p>For example, here is how a rule producing <code>foo.ml.depends</code> from <code>foo.ml</code> (calling <code>ocamldep</code>) is defined, slightly simplified from the built-in definition.</p><pre><code class="ml">rule &quot;ocaml dependencies ml&quot;
  ~prod:&quot;%.ml.depends&quot;
  ~dep:&quot;%.ml&quot;
  ~doc:&quot;call ocamldep to compute a syntactic over-approximation \\
        of the dependencies of the corresponding implementation file&quot;
  ocamldep_ml_command</code></pre><p>The rule that builds a list of targets from a <code>%.itarget</code> file is an example of use of the <code>?stamp</code> argument. It uses the <code>target_list</code> action provided in the documentation of <a href="index.html#type-action"><code>action</code></a> above. Besides the targets listed in the <code>%.itarget</code> file, this command will also produce a <code>%.otarget</code> file (the &quot;stamp&quot;) that contains the digest of all the <code>%.itarget</code> dependencies. This stamp file is the name to use when you want to ask OCamlbuild to build the targets listed: invoking <code>ocamlbuild foo.otarget</code> will build the the targets listed in <code>foo.itarget</code>. Similarly, new rules that would depend on that list of targets should depend on <code>%.otarget</code> (output), not <code>%.itarget</code> (input).</p><pre><code class="ml">rule &quot;target files&quot;
  ~dep:&quot;%.itarget&quot;
  ~stamp:&quot;%.otarget&quot;
  ~doc:&quot;If foo.itarget contains a list of ocamlbuild targets, \
        asking ocamlbuild to produce foo.otarget will \
        build each of those targets in turn.&quot;
  target_list</code></pre></dd></dl><dl><dt class="spec value" id="val-copy_rule"><a href="#val-copy_rule" class="anchor"></a><code><span class="keyword">val</span> copy_rule : string <span>&#45;&gt;</span> ?&#8288;insert:[ `top | `before of string | `after of string | `bottom ] <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>copy_rule name ?insert source destination</code></p></dd></dl><dl><dt class="spec value" id="val-clear_rules"><a href="#val-clear_rules" class="anchor"></a><code><span class="keyword">val</span> clear_rules : unit <span>&#45;&gt;</span> unit</code></dt><dd><p>Empties the list of rules of the ocamlbuild engine.</p></dd></dl><dl><dt class="spec value" id="val-dep"><a href="#val-dep" class="anchor"></a><code><span class="keyword">val</span> dep : <a href="Tags/index.html#type-elt">Tags.elt</a> list <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> list <span>&#45;&gt;</span> unit</code></dt><dd><p><code>dep tags deps</code> Will build <code>deps</code> when all <code>tags</code> will be activated. If you do not know which tags to use, have a look to the file _build/_log after trying to compile your code.</p></dd></dl><dl><dt class="spec value" id="val-pdep"><a href="#val-pdep" class="anchor"></a><code><span class="keyword">val</span> pdep : <a href="Tags/index.html#type-elt">Tags.elt</a> list <span>&#45;&gt;</span> <a href="Tags/index.html#type-elt">Tags.elt</a> <span>&#45;&gt;</span> (string <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> list) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>pdep tags ptag deps</code> is equivalent to <code>dep tags deps</code>, with an additional parametrized tag <code>ptag</code>. <code>deps</code> is now a function which takes the parameter of the tag <code>ptag</code> as an argument.</p><p>Example: <code>pdep [&quot;ocaml&quot;; &quot;compile&quot;] &quot;autodep&quot; (fun param -&gt; param)</code> says that the tag <code>autodep(file)</code> can now be used to automatically add <code>file</code> as a dependency when compiling an OCaml program.</p></dd></dl><dl><dt class="spec value" id="val-flag"><a href="#val-flag" class="anchor"></a><code><span class="keyword">val</span> flag : <a href="Tags/index.html#type-elt">Tags.elt</a> list <span>&#45;&gt;</span> <a href="Command/index.html#type-spec">Command.spec</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>flag tags command_spec</code> Will inject the given piece of command (<code>command_spec</code>) when all <code>tags</code> will be activated. If you do not know which tags to use, have a look to the file _build/_log after trying to compile your code.</p></dd></dl><dl><dt class="spec value" id="val-pflag"><a href="#val-pflag" class="anchor"></a><code><span class="keyword">val</span> pflag : <a href="Tags/index.html#type-elt">Tags.elt</a> list <span>&#45;&gt;</span> <a href="Tags/index.html#type-elt">Tags.elt</a> <span>&#45;&gt;</span> (string <span>&#45;&gt;</span> <a href="Command/index.html#type-spec">Command.spec</a>) <span>&#45;&gt;</span> unit</code></dt><dd><p>Allows to use <code>flag</code> with a parametrized tag (as <code>pdep</code> for <code>dep</code>).</p><p>Example: <code>pflag [&quot;ocaml&quot;; &quot;compile&quot;] &quot;inline&quot;
           (fun count -&gt; S [A &quot;-inline&quot;; A count])</code> says that command line option <code>&quot;-inline 42&quot;</code> should be added when compiling OCaml modules tagged with <code>&quot;inline(42)&quot;</code>.</p></dd></dl><dl><dt class="spec value" id="val-flag_and_dep"><a href="#val-flag_and_dep" class="anchor"></a><code><span class="keyword">val</span> flag_and_dep : <a href="Tags/index.html#type-elt">Tags.elt</a> list <span>&#45;&gt;</span> <a href="Command/index.html#type-spec">Command.spec</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>flag_and_dep tags command_spec</code> Combines <code>flag</code> and <code>dep</code> function. Basically it calls <code>flag tags command_spec</code>, and calls <code>dep tags files</code> where <code>files</code> is the list of all pathnames in <code>command_spec</code>. Pathnames selected are those in the constructor <code>P</code> or <code>Px</code>, or the pathname argument of builtins like <code>Echo</code>.</p></dd></dl><dl><dt class="spec value" id="val-pflag_and_dep"><a href="#val-pflag_and_dep" class="anchor"></a><code><span class="keyword">val</span> pflag_and_dep : <a href="Tags/index.html#type-elt">Tags.elt</a> list <span>&#45;&gt;</span> <a href="Tags/index.html#type-elt">Tags.elt</a> <span>&#45;&gt;</span> (string <span>&#45;&gt;</span> <a href="Command/index.html#type-spec">Command.spec</a>) <span>&#45;&gt;</span> unit</code></dt><dd><p>Allows to use <code>flag_and_dep</code> with a parametrized tag (as <code>pdep</code> for <code>dep</code>).</p></dd></dl><dl><dt class="spec value" id="val-mark_tag_used"><a href="#val-mark_tag_used" class="anchor"></a><code><span class="keyword">val</span> mark_tag_used : <a href="Tags/index.html#type-elt">Tags.elt</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>manually mark the tag as &quot;useful&quot; to silence the warning about tags that are not part of any flag declaration.</p><p>This is useful, for example, if the tag is used in a flag declaration that is only performed in a conditional branch: <code>if we_are_on_Windows then flag [&quot;libfoo&quot;] (A &quot;bar&quot;);</code></p><p>When <code>we_are_on_Windows</code> is not true, you could get a warning about &quot;libfoo&quot; not used in any flag declaration.</p></dd></dl><dl><dt class="spec value" id="val-non_dependency"><a href="#val-non_dependency" class="anchor"></a><code><span class="keyword">val</span> non_dependency : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>non_dependency module_path module_name</code> Example: <code>non_dependency &quot;foo/bar/baz&quot; &quot;Goo&quot;</code> Says that the module <code>Baz</code> in the file <code>foo/bar/baz.*</code> does not depend on <code>Goo</code>.</p></dd></dl><dl><dt class="spec value" id="val-use_lib"><a href="#val-use_lib" class="anchor"></a><code><span class="keyword">val</span> use_lib : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>use_lib module_path lib_path</code></p></dd></dl><dl><dt class="spec value" id="val-ocaml_lib"><a href="#val-ocaml_lib" class="anchor"></a><code><span class="keyword">val</span> ocaml_lib : ?&#8288;extern:bool <span>&#45;&gt;</span> ?&#8288;byte:bool <span>&#45;&gt;</span> ?&#8288;native:bool <span>&#45;&gt;</span> ?&#8288;dir:<a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> ?&#8288;tag_name:string <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>ocaml_lib &lt;options&gt; library_pathname</code> Declare an ocaml library. This informs ocamlbuild and produce tags to use the library; they are named by default use_#</p><p>brary_name</p><p>}</p><p>.</p><p>Example: <code>ocaml_lib &quot;foo/bar&quot;</code> will setup the tag use_bar. At link time it will include: foo/bar.cma or foo/bar.cmxa</p><dl><dt>parameter dir</dt><dd><p>supply the <code>~dir:&quot;boo&quot;</code> option to add '-I boo' at link and compile time.</p></dd></dl><dl><dt>parameter extern</dt><dd><p>use ~extern:true for non-ocamlbuild handled libraries. Set this to add libraries whose sources are not in your project.</p></dd></dl><dl><dt>parameter byte</dt><dd><p>use ~byte:false to disable byte mode.</p></dd></dl><dl><dt>parameter native</dt><dd><p>use ~native:false to disable native mode.</p></dd></dl><dl><dt>parameter tag_name</dt><dd><p>Use ~tag_name:&quot;usebar&quot; to override the default tag name.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-expand_module"><a href="#val-expand_module" class="anchor"></a><code><span class="keyword">val</span> expand_module : <a href="Pathname/index.html#type-t">Pathname.t</a> list <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> list</code></dt><dd><p><code>expand_module include_dirs module_name extensions</code> Example: <code>expand_module [&quot;a&quot;;&quot;b&quot;;&quot;c&quot;] &quot;Foo&quot; [&quot;cmo&quot;;&quot;cmi&quot;] =
      [&quot;a/foo.cmo&quot;; &quot;a/Foo.cmo&quot;; &quot;a/foo.cmi&quot;; &quot;a/Foo.cmi&quot;;
      &quot;b/foo.cmo&quot;; &quot;b/Foo.cmo&quot;; &quot;b/foo.cmi&quot;; &quot;b/Foo.cmi&quot;;
      &quot;c/foo.cmo&quot;; &quot;c/Foo.cmo&quot;; &quot;c/foo.cmi&quot;; &quot;c/Foo.cmi&quot;]</code></p></dd></dl><dl><dt class="spec value" id="val-string_list_of_file"><a href="#val-string_list_of_file" class="anchor"></a><code><span class="keyword">val</span> string_list_of_file : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> string list</code></dt><dd><p>Reads the given file, parse it has list of words separated by blanks. It ignore lines that begins with a '#' character.</p></dd></dl><dl><dt class="spec value" id="val-module_name_of_pathname"><a href="#val-module_name_of_pathname" class="anchor"></a><code><span class="keyword">val</span> module_name_of_pathname : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Takes a pathname and returns an OCaml module name. Basically it will remove directories and extensions, and then capitalize the string.</p></dd></dl><dl><dt class="spec value" id="val-mv"><a href="#val-mv" class="anchor"></a><code><span class="keyword">val</span> mv : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Command/index.html#type-t">Command.t</a></code></dt><dd><p>The Unix mv command.</p></dd></dl><dl><dt class="spec value" id="val-cp"><a href="#val-cp" class="anchor"></a><code><span class="keyword">val</span> cp : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Command/index.html#type-t">Command.t</a></code></dt><dd><p>The Unix cp command.</p></dd></dl><dl><dt class="spec value" id="val-ln_f"><a href="#val-ln_f" class="anchor"></a><code><span class="keyword">val</span> ln_f : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Command/index.html#type-t">Command.t</a></code></dt><dd><p>The Unix ln -f command.</p></dd></dl><dl><dt class="spec value" id="val-ln_s"><a href="#val-ln_s" class="anchor"></a><code><span class="keyword">val</span> ln_s : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Command/index.html#type-t">Command.t</a></code></dt><dd><p>The Unix ln -s command.</p></dd></dl><dl><dt class="spec value" id="val-rm_f"><a href="#val-rm_f" class="anchor"></a><code><span class="keyword">val</span> rm_f : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Command/index.html#type-t">Command.t</a></code></dt><dd><p>The Unix rm -f command.</p></dd></dl><dl><dt class="spec value" id="val-chmod"><a href="#val-chmod" class="anchor"></a><code><span class="keyword">val</span> chmod : <a href="Command/index.html#type-spec">Command.spec</a> <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Command/index.html#type-t">Command.t</a></code></dt><dd><p>The Unix chmod command (almost deprecated).</p></dd></dl><dl><dt class="spec value" id="val-cmp"><a href="#val-cmp" class="anchor"></a><code><span class="keyword">val</span> cmp : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Command/index.html#type-t">Command.t</a></code></dt><dd><p>The Unix cmp command (almost deprecated).</p></dd></dl><dl><dt class="spec value" id="val-hide_package_contents"><a href="#val-hide_package_contents" class="anchor"></a><code><span class="keyword">val</span> hide_package_contents : string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>hide_package_contents pack_name</code> Don't treat the given package as an open package. So a module will not be replaced during linking by this package even if it contains that module.</p></dd></dl><dl><dt class="spec value" id="val-tag_file"><a href="#val-tag_file" class="anchor"></a><code><span class="keyword">val</span> tag_file : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Tags/index.html#type-elt">Tags.elt</a> list <span>&#45;&gt;</span> unit</code></dt><dd><p><code>tag_file filename tag_list</code> Tag the given filename with all given tags. Prefix a tag with the minus sign to remove it. This is usually used as an <code>After_rules</code> hook. For example <code>tag_file &quot;bla.ml&quot; [&quot;use_unix&quot;]</code> tags the file &quot;bla.ml&quot; with &quot;use_unix&quot; and <code>tag_file &quot;bla.ml&quot; [&quot;-use_unix&quot;]</code> removes the tag &quot;use_unix&quot; from the file &quot;bla.ml&quot;.</p></dd></dl><dl><dt class="spec value" id="val-tag_any"><a href="#val-tag_any" class="anchor"></a><code><span class="keyword">val</span> tag_any : <a href="Tags/index.html#type-elt">Tags.elt</a> list <span>&#45;&gt;</span> unit</code></dt><dd><p><code>tag_any tag_list</code> Tag anything with all given tags.</p></dd></dl><dl><dt class="spec value" id="val-tags_of_pathname"><a href="#val-tags_of_pathname" class="anchor"></a><code><span class="keyword">val</span> tags_of_pathname : <a href="Pathname/index.html#type-t">Pathname.t</a> <span>&#45;&gt;</span> <a href="Tags/index.html#type-t">Tags.t</a></code></dt><dd><p>Returns the set of tags that applies to the given pathname.</p></dd></dl><dl><dt class="spec value" id="val-run_and_read"><a href="#val-run_and_read" class="anchor"></a><code><span class="keyword">val</span> run_and_read : string <span>&#45;&gt;</span> string</code></dt><dd><p>Run the given command and returns it's output as a string.</p></dd></dl><dl><dt class="spec type" id="type-hook"><a href="#type-hook" class="anchor"></a><code><span class="keyword">type</span> hook</code><code> = </code><table class="variant"><tr id="type-hook.Before_hygiene" class="anchored"><td class="def constructor"><a href="#type-hook.Before_hygiene" class="anchor"></a><code>| </code><code><span class="constructor">Before_hygiene</span></code></td></tr><tr id="type-hook.After_hygiene" class="anchored"><td class="def constructor"><a href="#type-hook.After_hygiene" class="anchor"></a><code>| </code><code><span class="constructor">After_hygiene</span></code></td></tr><tr id="type-hook.Before_options" class="anchored"><td class="def constructor"><a href="#type-hook.Before_options" class="anchor"></a><code>| </code><code><span class="constructor">Before_options</span></code></td></tr><tr id="type-hook.After_options" class="anchored"><td class="def constructor"><a href="#type-hook.After_options" class="anchor"></a><code>| </code><code><span class="constructor">After_options</span></code></td></tr><tr id="type-hook.Before_rules" class="anchored"><td class="def constructor"><a href="#type-hook.Before_rules" class="anchor"></a><code>| </code><code><span class="constructor">Before_rules</span></code></td></tr><tr id="type-hook.After_rules" class="anchored"><td class="def constructor"><a href="#type-hook.After_rules" class="anchor"></a><code>| </code><code><span class="constructor">After_rules</span></code></td></tr></table></dt><dd><p>Here is the list of hooks that the dispatch function have to handle. Generally one responds to one or two hooks (like After_rules) and do nothing in the default case.</p></dd></dl><dl><dt class="spec value" id="val-dispatch"><a href="#val-dispatch" class="anchor"></a><code><span class="keyword">val</span> dispatch : (<a href="index.html#type-hook">hook</a> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>dispatch hook_handler</code> Is the entry point for ocamlbuild plugins. Every plugin must call it with a <code>hook_handler</code> where all calls to plugin functions lives.</p></dd></dl></div></body></html>