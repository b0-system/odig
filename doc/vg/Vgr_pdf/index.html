<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Vgr_pdf (vg.Vgr_pdf)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../index.html">vg</a> &#x00BB; Vgr_pdf</nav><header class="odoc-preamble"><h1>Module <code><span>Vgr_pdf</span></code></h1><p>Vg PDF renderer.</p><p>Renders a sequence of renderables as a multi-page PDF 1.7 document. Each renderable defines a page of the document.</p><p><b>Bug reports.</b> PDF being an insane standard, rendering abilities of PDF readers vary wildly. No rendering bug report for this renderer will be considered if it cannot be reproduced in the latest Adobe Acrobat Reader.</p><p><em>v0.9.4 - <a href="https://erratique.ch/software/vg">homepage</a></em></p></header><nav class="odoc-toc"><ul><li><a href="#fonts">Font resolution</a></li><li><a href="#target">PDF render targets</a></li><li><a href="#text">Text rendering</a></li><li><a href="#limits">Render warnings and limitations</a></li></ul></nav><div class="odoc-content"><h2 id="fonts"><a href="#fonts" class="anchor"></a>Font resolution</h2><p>Font resolution happens during the rendering of <a href="../Vg/I/index.html#val-cut_glyphs"><code>Vg.I.cut_glyphs</code></a> images through the <code>font</code> callback given to the PDF rendering <a href="#val-target"><code>target</code></a>. See <a href="#text">Text rendering</a> for more details.</p><div class="odoc-spec"><div class="spec type" id="type-otf_font" class="anchored"><a href="#type-otf_font" class="anchor"></a><code><span><span class="keyword">type</span> otf_font</span></code></div><div class="spec-doc"><p>The type for OpenType fonts.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-otf_font" class="anchored"><a href="#val-otf_font" class="anchor"></a><code><span><span class="keyword">val</span> otf_font : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>[&gt; <span>`Otf of <a href="#type-otf_font">otf_font</a></span> ]</span>, <a href="../../otfm/Otfm/index.html#type-error">Otfm.error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>otf_font bytes</code> is an OpenType font from the OpenType byte serialization <code>bytes</code>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-font" class="anchored"><a href="#type-font" class="anchor"></a><code><span><span class="keyword">type</span> font</span><span> = </span><span>[ </span></code><table><tr id="type-font.Otf" class="anchored"><td class="def constructor"><a href="#type-font.Otf" class="anchor"></a><code><span>| </span></code><code><span>`Otf <span class="keyword">of</span> <a href="#type-otf_font">otf_font</a></span></code></td></tr><tr id="type-font.Serif" class="anchored"><td class="def constructor"><a href="#type-font.Serif" class="anchor"></a><code><span>| </span></code><code><span>`Serif</span></code></td></tr><tr id="type-font.Sans" class="anchored"><td class="def constructor"><a href="#type-font.Sans" class="anchor"></a><code><span>| </span></code><code><span>`Sans</span></code></td></tr><tr id="type-font.Fixed" class="anchored"><td class="def constructor"><a href="#type-font.Fixed" class="anchor"></a><code><span>| </span></code><code><span>`Fixed</span></code></td></tr><tr id="type-font.Helvetica" class="anchored"><td class="def constructor"><a href="#type-font.Helvetica" class="anchor"></a><code><span>| </span></code><code><span>`Helvetica</span></code></td></tr><tr id="type-font.Times" class="anchored"><td class="def constructor"><a href="#type-font.Times" class="anchor"></a><code><span>| </span></code><code><span>`Times</span></code></td></tr><tr id="type-font.Courier" class="anchored"><td class="def constructor"><a href="#type-font.Courier" class="anchor"></a><code><span>| </span></code><code><span>`Courier</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>The type for font resolution results. Any case different from <code>`Otf</code> ends up using the PDF standard fonts. See <a href="#text">Text rendering</a> for details.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-font" class="anchored"><a href="#val-font" class="anchor"></a><code><span><span class="keyword">val</span> font : <span><a href="../Vg/index.html#type-font">Vg.font</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-font">font</a></span></code></div><div class="spec-doc"><p><code>font</code> is the default font resolver. Given a <a href="../Vg/index.html#type-font"><code>Vg.font</code></a> <code>f</code> it performs the following resolutions according to value of <code>f.Font.name</code>:</p><ul><li><code>&quot;Helvetica&quot;</code>, returns <code>`Sans</code></li><li><code>&quot;Times&quot;</code>, returns <code>`Serif</code></li><li><code>&quot;Courier&quot;</code>, returns <code>`Fixed</code></li><li>Any other, returns <code>`Sans</code></li></ul><p>See <a href="#text">Text rendering</a> for understanding what this entails.</p></div></div><h2 id="target"><a href="#target" class="anchor"></a>PDF render targets</h2><div class="odoc-spec"><div class="spec value" id="val-target" class="anchored"><a href="#val-target" class="anchor"></a><code><span><span class="keyword">val</span> target : <span>?font:<span>(<span><a href="../Vg/index.html#type-font">Vg.font</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-font">font</a>)</span> <span class="arrow">&#45;&gt;</span></span> <span>?xmp:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="../Vg/Vgr/index.html#type-dst_stored">Vg.Vgr.dst_stored</a> <a href="../Vg/Vgr/index.html#type-target">Vg.Vgr.target</a></span></span></code></div><div class="spec-doc"><p><code>target font xmp ()</code> is a PDF render target for rendering to the stored destination given to <a href="../Vg/Vgr/index.html#val-create"><code>Vg.Vgr.create</code></a>.</p><ul><li><code>font</code> is the font resolver, defaults to <a href="#val-font"><code>font</code></a>, see <a href="#text">Text rendering</a> for details. Note that <code>font</code> results are cached by the renderer.</li><li><code>xmp</code> is an optional UTF-8 encoded XML XMP metadata packet describing the PDF document (see ISO 16684-1 or the equivalent <a href="http://www.adobe.com/devnet/xmp.html">Adobe spec.</a>). The convenience function <a href="../Vg/Vgr/index.html#val-xmp"><code>Vg.Vgr.xmp</code></a> can be used to generate a packet.</li></ul><p><b>Multiple image.</b> Multiple image render is supported. Each image defines a page of the resulting PDF file.</p></div></div><h2 id="text"><a href="#text" class="anchor"></a>Text rendering</h2><p>Text rendering depends on the way fonts are resolved by the function specified in the rendering <a href="#val-target"><code>target</code></a>. Given a glyph cut:</p><p><a href="../Vg/I/index.html#val-cut_glyphs"><code>Vg.I.cut_glyphs</code></a><code> ~text ~blocks ~advances font glyphs</code></p><p>First, if the optional <code>text</code> and <code>blocks</code> arguments are specified, they are always used to map the rendered glyphs to text for PDF text extraction. Then the following happens according to the resolution of the <code>font</code> argument by the render target:</p><ul><li><code>`Otf otf</code>, the values in <code>glyphs</code> are glyph indexes of the OpenType font <code>otf</code>. If <code>advances</code> is specified these vectors are used to position the glyphs (e.g. you need to use this to perform kerning), otherwise the font's glyph advances, as found in <code>otf</code>, are used.</li><li><code>`Helvetica</code>, uses one of the standard PDF font Helvetica, Helvetica-Bold, Helvetica, Helvetica-Bold, Helvetica-Oblique, Helvetica-BoldOblique according to <code>font</code>'s <a href="../Vg/Font/index.html#type-slant"><code>Vg.Font.slant</code></a> and <a href="../Vg/Font/index.html#type-weight"><code>Vg.Font.weight</code></a>. The values in <code>glyphs</code> are glyph indexes representing the corresponding Unicode character (e.g. glyph index <code>0x20</code> is the glyph for character <code>U+0020</code>). The font supports glyph indexes for all the characters listed in the in the second column of <a href="http://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WINDOWS/CP1252.TXT">this document</a> which is all the Basic Latin block, the Latin-1 Supplement block without its control characters and some additional characters (those at rows 0x80-0x9F in that document). If a glyph index is not supported it is replaced by <code>0</code>. If <code>advances</code> is specified these vectors are used to position the glyphs, otherwise the internal font's glyphs advances are used.</li><li><code>`Times</code>, same as <code>`Helvetica</code> but uses one of the standard PDF font Times-Roman, Times-Bold, Times-Italic or Times-BoldItalic.</li><li><code>`Courier</code>, same as <code>`Helvetica</code> but uses one of the standard PDF font Courier, Courier-Bold, Courier-Oblique, Courier-BoldOblique.</li><li><code>`Sans</code> is the same as <code>`Helvetica</code> except <code>advances</code> and <code>glyphs</code> are <b>ignored</b>. Instead the UTF-8 string <code>text</code> is used to generate a corresponding <code>glyphs</code> list, mapping supported characters as mentioned above to their corresponding glyph. Unsupported characters are mapped to glyph 0.</li><li><code>`Serif</code> same as <code>`Sans</code> but uses the same fonts as <code>`Times</code>.</li><li><code>`Fixed</code> same as <code>`Sans</code> but uses the same fonts as <code>`Courier</code>.</li></ul><p>So what should be used ? In general clients should use a font resolution mechanism independent from <code>Vg</code> in order to get an OpenType font <code>otf</code> for <code>font</code>. Using this <code>otf</code> font is should compute, using again a mechanism independent from <code>Vg</code>, a glyph layout resulting in <code>advances</code> and <code>glyphs</code> to use with <a href="../Vg/I/index.html#val-cut_glyphs"><code>Vg.I.cut_glyphs</code></a> and finally resolve <code>font</code> in the target with <code>`Otf otf</code>. This means that font resolution should:</p><ul><li>Use <code>`Otf otf</code> whenever it is guaranteed that the glyph indexes in <code>glyphs</code> actually correspond to the glyph indexes of <code>otf</code>.</li><li>Use <code>`Sans</code>, <code>`Serif</code> or <code>`Fixed</code> whenever its is unable to resolve <code>font</code> to an appropriate <code>otf</code>, this may not result in the expected rendering but still at least show (the latin) part of the text.</li><li>Use <code>`Helvetica</code>, <code>`Times</code> or <code>`Courier</code> to perform glyph layout using PDF's standard fonts without having to embed the fonts in the PDF (the font metrics can be downloaded <a href="https://www.adobe.com/devnet/font.html">here</a>). PDFs without embedded fonts are however not recommended.</li></ul><h2 id="limits"><a href="#limits" class="anchor"></a>Render warnings and limitations</h2><p>The following render warnings are reported.</p><ul><li><code>`Unsupported_cut (`O o, i)</code>, outline area cuts can be performed only on (possibly transformed) <a href="../Vg/I/index.html#val-const"><code>Vg.I.const</code></a>, <a href="../Vg/I/index.html#val-axial"><code>Vg.I.axial</code></a>, <a href="../Vg/I/index.html#val-radial"><code>Vg.I.radial</code></a> images.</li><li><code>`Unsupported_glyph_cut (`O o, i)</code>, outline area glyph cuts can be performed only on (possibly transformed) <a href="../Vg/I/index.html#val-const"><code>Vg.I.const</code></a>, <a href="../Vg/I/index.html#val-axial"><code>Vg.I.axial</code></a>, <a href="../Vg/I/index.html#val-radial"><code>Vg.I.radial</code></a> images.</li></ul><p>The following limitations should be taken into account:</p><ul><li><p>Streams in the PDF files are currently uncompressed and fonts are embedded without subsetting which may result in large file sizes. This will be lifted in future versions of the library. Meanwhile if you need to reduce the size of generated PDFs you can pass them through <a href="http://community.coherentpdf.com">cpdf</a> or <a href="http://www.ghostscript.com">ghostscript</a>.</p><pre>&gt; cpdf -compress -o output.pdf input.pdf
&gt; gs -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -sOutputFile=output.pdf input.pdf</pre></li></ul></div></body></html>