<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Store (brr.Brr_note_legacy.Store)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">brr</a> &#x00BB; <a href="../index.html">Brr_note_legacy</a> &#x00BB; Store</nav><header class="odoc-preamble"><h1>Module <code><span>Brr_note_legacy.Store</span></code></h1><p>Persistent storage.</p><p>Persisent key-value store implemented over <a href="http://www.w3.org/TR/webstorage/">webstorage</a>. Safe if no one tampers with the storage outside of the program.</p><p><b>XXX.</b></p><ul><li>This still relies on the jsoo representation, add safer keys with type indexed codecs.</li><li>Provide something sensitive for storage events</li></ul></header><nav class="odoc-toc"><ul><li><a href="#storage-scope">Storage scope</a></li><li><a href="#keys">Keys</a></li><li><a href="#storage">Storage</a></li><li><a href="#versioning">Versioning</a></li></ul></nav><div class="odoc-content"><h2 id="storage-scope"><a href="#storage-scope" class="anchor"></a>Storage scope</h2><div class="odoc-spec"><div class="spec type" id="type-scope" class="anchored"><a href="#type-scope" class="anchor"></a><code><span><span class="keyword">type</span> scope</span><span> = </span><span>[ </span></code><table><tr id="type-scope.Session" class="anchored"><td class="def constructor"><a href="#type-scope.Session" class="anchor"></a><code><span>| </span></code><code><span>`Session</span></code></td></tr><tr id="type-scope.Persist" class="anchored"><td class="def constructor"><a href="#type-scope.Persist" class="anchor"></a><code><span>| </span></code><code><span>`Persist</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>The storage scope.</p></div></div><h2 id="keys"><a href="#keys" class="anchor"></a>Keys</h2><div class="odoc-spec"><div class="spec type" id="type-key" class="anchored"><a href="#type-key" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a key</span></span></code></div><div class="spec-doc"><p>The type for keys whose lookup value is 'a</p></div></div><div class="odoc-spec"><div class="spec value" id="val-key" class="anchored"><a href="#val-key" class="anchor"></a><code><span><span class="keyword">val</span> key : <span>?ns:<a href="../../Jstr/index.html#type-t">Jstr.t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-key">key</a></span></span></code></div><div class="spec-doc"><p><code>key ~ns ()</code> is a new storage key in namespace <code>ns</code>. If <code>ns</code> is unspecified, the key lives in a global namespace.</p><p><b>Warning.</b> Reordering invocations of <a href="#val-key"><code>key</code></a> in the same namespace will most of the time corrupt existing storage. This means that all <a href="#val-key"><code>key</code></a> calls should always be performed at initialization time. <a href="#val-force_version"><code>Store.force_version</code></a> can be used to easily version your store and aleviate this problem.</p></div></div><h2 id="storage"><a href="#storage" class="anchor"></a>Storage</h2><p>In the functions below <code>scope</code> defaults to <code>`Persist</code>.</p><div class="odoc-spec"><div class="spec value" id="val-mem" class="anchored"><a href="#val-mem" class="anchor"></a><code><span><span class="keyword">val</span> mem : <span>?scope:<a href="#type-scope">scope</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>mem k</code> is <code>true</code> iff <code>k</code> has a mapping.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-add" class="anchored"><a href="#val-add" class="anchor"></a><code><span><span class="keyword">val</span> add : <span>?scope:<a href="#type-scope">scope</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>add k v</code> maps <code>k</code> to <code>v</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-rem" class="anchored"><a href="#val-rem" class="anchor"></a><code><span><span class="keyword">val</span> rem : <span>?scope:<a href="#type-scope">scope</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>rem k</code> unbinds <code>k</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find" class="anchored"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : <span>?scope:<a href="#type-scope">scope</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span></span></code></div><div class="spec-doc"><p><code>find k</code> is <code>k</code>'s mapping in <code>m</code>, if any.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get" class="anchored"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span>?scope:<a href="#type-scope">scope</a> <span class="arrow">&#45;&gt;</span></span> <span>?absent:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>get k</code> is <code>k</code>'s mapping. If <code>absent</code> is provided and <code>m</code> has not binding for <code>k</code>, <code>absent</code> is returned.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if <code>k</code> is not bound and <code>absent</code> is unspecified or if <code>scope</code> is not <code>support</code>ed.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-clear" class="anchored"><a href="#val-clear" class="anchor"></a><code><span><span class="keyword">val</span> clear : <span>?scope:<a href="#type-scope">scope</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>clear ()</code>, clears all mapping.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-ev" class="anchored"><a href="#val-ev" class="anchor"></a><code><span><span class="keyword">val</span> ev : <span>unit <a href="../../../note/Note/index.html#type-event">Note.event</a></span></span></code></div><div class="spec-doc"><p><code>ev</code> fires on storage changes. FIXME provide something sensitive, e.g. key watching.</p></div></div><h2 id="versioning"><a href="#versioning" class="anchor"></a>Versioning</h2><div class="odoc-spec"><div class="spec value" id="val-force_version" class="anchored"><a href="#val-force_version" class="anchor"></a><code><span><span class="keyword">val</span> force_version : <span>?scope:<a href="#type-scope">scope</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>force_version v</code> checks that the version of the store is <code>v</code>. If it's not it <a href="#val-clear"><code>clear</code></a>s the store and sets the version to <code>v</code>.</p></div></div></div></body></html>