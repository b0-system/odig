<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Util (yojson.Yojson.Safe.Util)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../index.html">yojson</a> &#x00BB; <a href="../../index.html">Yojson</a> &#x00BB; <a href="../index.html">Safe</a> &#x00BB; Util</nav><h1>Module <code>Safe.Util</code></h1><nav class="toc"><ul><li><a href="#exception-free-filters">Exception-free filters</a></li></ul></nav></header><aside><p>This module provides combinators for extracting fields from JSON values. This approach is recommended for reading a few fields from data returned by public APIs. However for more complex applications we recommend <a href="https://github.com/MyLifeLabs/atdgen">Atdgen</a>.</p><p>Here is some sample JSON data:</p><pre>\{
  &quot;id&quot;: &quot;398eb027&quot;,
  &quot;name&quot;: &quot;John Doe&quot;,
  &quot;pages&quot;: [
    \{
      &quot;id&quot;: 1,
      &quot;title&quot;: &quot;The Art of Flipping Coins&quot;,
      &quot;url&quot;: &quot;http://example.com/398eb027/1&quot;
    },
    \{
      &quot;id&quot;: 2,
      &quot;deleted&quot;: true
    },
    \{
      &quot;id&quot;: 3,
      &quot;title&quot;: &quot;Artichoke Salad&quot;,
      &quot;url&quot;: &quot;http://example.com/398eb027/3&quot;
    },
    \{
      &quot;id&quot;: 4,
      &quot;title&quot;: &quot;Flying Bananas&quot;,
      &quot;url&quot;: &quot;http://example.com/398eb027/4&quot;
    }
  ]
}</pre><p>In order to extract the &quot;id&quot; field, assuming it is mandatory, we would use the following OCaml code that operates on single JSON nodes:</p><pre>open Yojson.Basic.Util
...
  let id = json |&gt; member &quot;id&quot; |&gt; to_string in
  ...</pre><p>In order to extract all the &quot;title&quot; fields, we would write the following OCaml code that operates on lists of JSON nodes, skipping undefined nodes and nodes of unexpected type:</p><pre>open Yojson.Basic.Util

let extract_titles (json : Yojson.Basic.t) : string list =
  [json]
    |&gt; filter_member &quot;pages&quot;
    |&gt; flatten
    |&gt; filter_member &quot;title&quot;
    |&gt; filter_string</pre></aside><dl><dt class="spec exception" id="exception-Type_error"><a href="#exception-Type_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Type_error</span> <span class="keyword">of</span> string * <a href="../index.html#type-t">t</a></code></dt><dd><p>Raised when the JSON value is not of the correct type to support an operation, e.g. <code>member</code> on an <code>`Int</code>. The string message explains the mismatch.</p></dd></dl><dl><dt class="spec exception" id="exception-Undefined"><a href="#exception-Undefined" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Undefined</span> <span class="keyword">of</span> string * <a href="../index.html#type-t">t</a></code></dt><dd><p>Raised when the equivalent JavaScript operation on the JSON value would return undefined. Currently this only happens when an array index is out of bounds.</p></dd></dl><dl><dt class="spec value" id="val-(|&gt;)"><a href="#val-(|&gt;)" class="anchor"></a><code><span class="keyword">val</span> (|&gt;) : <span class="type-var">'a</span> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><dl><dt>deprecated</dt><dd><p>Forward pipe operator; useful for composing JSON access functions without too many parentheses</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-keys"><a href="#val-keys" class="anchor"></a><code><span class="keyword">val</span> keys : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> string list</code></dt><dd><p>Returns all the key names in the given JSON object</p></dd></dl><dl><dt class="spec value" id="val-values"><a href="#val-values" class="anchor"></a><code><span class="keyword">val</span> values : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> list</code></dt><dd><p>Return all the value in the given JSON object</p></dd></dl><dl><dt class="spec value" id="val-combine"><a href="#val-combine" class="anchor"></a><code><span class="keyword">val</span> combine : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a></code></dt><dd><p>Combine two JSON Objects together</p></dd></dl><dl><dt class="spec value" id="val-member"><a href="#val-member" class="anchor"></a><code><span class="keyword">val</span> member : string <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a></code></dt><dd><p><code>member k obj</code> returns the value associated with the key <code>k</code> in the JSON object <code>obj</code>, or <code>`Null</code> if <code>k</code> is not present in <code>obj</code>.</p></dd></dl><dl><dt class="spec value" id="val-index"><a href="#val-index" class="anchor"></a><code><span class="keyword">val</span> index : int <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a></code></dt><dd><p><code>index i arr</code> returns the value at index <code>i</code> in the JSON array <code>arr</code>. Negative indices count from the end of the list (so -1 is the last element).</p></dd></dl><dl><dt class="spec value" id="val-map"><a href="#val-map" class="anchor"></a><code><span class="keyword">val</span> map : (<a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a>) <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a></code></dt><dd><p><code>map f arr</code> calls the function <code>f</code> on each element of the JSON array <code>arr</code>, and returns a JSON array containing the results.</p></dd></dl><dl><dt class="spec value" id="val-to_assoc"><a href="#val-to_assoc" class="anchor"></a><code><span class="keyword">val</span> to_assoc : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> (string * <a href="../index.html#type-t">t</a>) list</code></dt><dd><p>Extract the items of a JSON object or raise <code>Type_error</code>.</p></dd></dl><dl><dt class="spec value" id="val-to_option"><a href="#val-to_option" class="anchor"></a><code><span class="keyword">val</span> to_option : (<a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> option</code></dt><dd><p>Return <code>None</code> if the JSON value is null or map the JSON value to <code>Some</code> value using the provided function.</p></dd></dl><dl><dt class="spec value" id="val-to_bool"><a href="#val-to_bool" class="anchor"></a><code><span class="keyword">val</span> to_bool : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>Extract a boolean value or raise <code>Type_error</code>.</p></dd></dl><dl><dt class="spec value" id="val-to_bool_option"><a href="#val-to_bool_option" class="anchor"></a><code><span class="keyword">val</span> to_bool_option : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> bool option</code></dt><dd><p>Extract <code>Some</code> boolean value, return <code>None</code> if the value is null, or raise <code>Type_error</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-to_number"><a href="#val-to_number" class="anchor"></a><code><span class="keyword">val</span> to_number : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> float</code></dt><dd><p>Extract a number or raise <code>Type_error</code>.</p></dd></dl><dl><dt class="spec value" id="val-to_number_option"><a href="#val-to_number_option" class="anchor"></a><code><span class="keyword">val</span> to_number_option : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> float option</code></dt><dd><p>Extract <code>Some</code> number, return <code>None</code> if the value is null, or raise <code>Type_error</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-to_float"><a href="#val-to_float" class="anchor"></a><code><span class="keyword">val</span> to_float : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> float</code></dt><dd><p>Extract a float value or raise <code>Type_error</code>. <code>to_number</code> is generally preferred as it also works with int literals.</p></dd></dl><dl><dt class="spec value" id="val-to_float_option"><a href="#val-to_float_option" class="anchor"></a><code><span class="keyword">val</span> to_float_option : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> float option</code></dt><dd><p>Extract <code>Some</code> float value, return <code>None</code> if the value is null, or raise <code>Type_error</code> otherwise. <code>to_number_option</code> is generally preferred as it also works with int literals.</p></dd></dl><dl><dt class="spec value" id="val-to_int"><a href="#val-to_int" class="anchor"></a><code><span class="keyword">val</span> to_int : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Extract an int from a JSON int or raise <code>Type_error</code>.</p></dd></dl><dl><dt class="spec value" id="val-to_int_option"><a href="#val-to_int_option" class="anchor"></a><code><span class="keyword">val</span> to_int_option : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> int option</code></dt><dd><p>Extract <code>Some</code> int from a JSON int, return <code>None</code> if the value is null, or raise <code>Type_error</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-to_list"><a href="#val-to_list" class="anchor"></a><code><span class="keyword">val</span> to_list : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> list</code></dt><dd><p>Extract a list from JSON array or raise <code>Type_error</code>.</p></dd></dl><dl><dt class="spec value" id="val-to_string"><a href="#val-to_string" class="anchor"></a><code><span class="keyword">val</span> to_string : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Extract a string from a JSON string or raise <code>Type_error</code>.</p></dd></dl><dl><dt class="spec value" id="val-to_string_option"><a href="#val-to_string_option" class="anchor"></a><code><span class="keyword">val</span> to_string_option : <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> string option</code></dt><dd><p>Extract <code>Some</code> string from a JSON string, return <code>None</code> if the value is null, or raise <code>Type_error</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-convert_each"><a href="#val-convert_each" class="anchor"></a><code><span class="keyword">val</span> convert_each : (<a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> list</code></dt><dd><p>The conversion functions above cannot be used with <code>map</code>, because they do not return JSON values. This convenience function <code>convert_each to_f arr</code> is equivalent to <code>List.map to_f (to_list arr)</code>.</p></dd></dl><section><header><h4 id="exception-free-filters"><a href="#exception-free-filters" class="anchor"></a>Exception-free filters</h4></header><aside><p>The following functions operate on lists of JSON nodes. None of them raises an exception when a certain kind of node is expected but no node or the wrong kind of node is found. Instead of raising an exception, nodes that are not as expected are simply ignored.</p></aside><dl><dt class="spec value" id="val-filter_map"><a href="#val-filter_map" class="anchor"></a><code><span class="keyword">val</span> filter_map : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> option) <span>&#45;&gt;</span> <span class="type-var">'a</span> list <span>&#45;&gt;</span> <span class="type-var">'b</span> list</code></dt><dd><p><code>filter_map f l</code> maps each element of the list <code>l</code> to an optional value using function <code>f</code> and unwraps the resulting values.</p></dd></dl><dl><dt class="spec value" id="val-flatten"><a href="#val-flatten" class="anchor"></a><code><span class="keyword">val</span> flatten : <a href="../index.html#type-t">t</a> list <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> list</code></dt><dd><p>Expects JSON arrays and returns all their elements as a single list. <code>flatten l</code> is equivalent to <code>List.flatten (filter_list l)</code>.</p></dd></dl><dl><dt class="spec value" id="val-filter_index"><a href="#val-filter_index" class="anchor"></a><code><span class="keyword">val</span> filter_index : int <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> list <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> list</code></dt><dd><p>Expects JSON arrays and returns all their elements existing at the given position.</p></dd></dl><dl><dt class="spec value" id="val-filter_list"><a href="#val-filter_list" class="anchor"></a><code><span class="keyword">val</span> filter_list : <a href="../index.html#type-t">t</a> list <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> list list</code></dt><dd><p>Expects JSON arrays and unwraps them.</p></dd></dl><dl><dt class="spec value" id="val-filter_member"><a href="#val-filter_member" class="anchor"></a><code><span class="keyword">val</span> filter_member : string <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> list <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> list</code></dt><dd><p>Expects JSON objects and returns all the fields of the given name (at most one field per object).</p></dd></dl><dl><dt class="spec value" id="val-filter_assoc"><a href="#val-filter_assoc" class="anchor"></a><code><span class="keyword">val</span> filter_assoc : <a href="../index.html#type-t">t</a> list <span>&#45;&gt;</span> (string * <a href="../index.html#type-t">t</a>) list list</code></dt><dd><p>Expects JSON objects and unwraps them.</p></dd></dl><dl><dt class="spec value" id="val-filter_bool"><a href="#val-filter_bool" class="anchor"></a><code><span class="keyword">val</span> filter_bool : <a href="../index.html#type-t">t</a> list <span>&#45;&gt;</span> bool list</code></dt><dd><p>Expects JSON booleans and unwraps them.</p></dd></dl><dl><dt class="spec value" id="val-filter_int"><a href="#val-filter_int" class="anchor"></a><code><span class="keyword">val</span> filter_int : <a href="../index.html#type-t">t</a> list <span>&#45;&gt;</span> int list</code></dt><dd><p>Expects JSON integers (<code>`Int</code> nodes) and unwraps them.</p></dd></dl><dl><dt class="spec value" id="val-filter_float"><a href="#val-filter_float" class="anchor"></a><code><span class="keyword">val</span> filter_float : <a href="../index.html#type-t">t</a> list <span>&#45;&gt;</span> float list</code></dt><dd><p>Expects JSON floats (<code>`Float</code> nodes) and unwraps them.</p></dd></dl><dl><dt class="spec value" id="val-filter_number"><a href="#val-filter_number" class="anchor"></a><code><span class="keyword">val</span> filter_number : <a href="../index.html#type-t">t</a> list <span>&#45;&gt;</span> float list</code></dt><dd><p>Expects JSON numbers (<code>`Int</code> or <code>`Float</code>) and unwraps them. Ints are converted to floats.</p></dd></dl><dl><dt class="spec value" id="val-filter_string"><a href="#val-filter_string" class="anchor"></a><code><span class="keyword">val</span> filter_string : <a href="../index.html#type-t">t</a> list <span>&#45;&gt;</span> string list</code></dt><dd><p>Expects JSON strings and unwraps them.</p></dd></dl></section></div></body></html>