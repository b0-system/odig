<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamSystem (opam-core.OpamSystem)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../index.html">opam-core</a> &#x00BB; OpamSystem</nav><header class="odoc-preamble"><h1>Module <code><span>OpamSystem</span></code></h1><p>Bindings of lots of filesystem and system operations</p></header><nav class="odoc-toc"><ul><li><a href="#filesystem-management">Filesystem management</a></li><li><a href="#file-locking-function">File locking function</a></li><li><a href="#misc">Misc</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec exception" id="exception-Process_error" class="anchored"><a href="#exception-Process_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Process_error</span> <span class="keyword">of</span> <a href="../OpamProcess/index.html#type-result">OpamProcess.result</a></span></code></div><div class="spec-doc"><p>Exception raised when subprocess fails</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Command_not_found" class="anchored"><a href="#exception-Command_not_found" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Command_not_found</span> <span class="keyword">of</span> string</span></code></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Permission_denied" class="anchored"><a href="#exception-Permission_denied" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Permission_denied</span> <span class="keyword">of</span> string</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-process_error" class="anchored"><a href="#val-process_error" class="anchor"></a><code><span><span class="keyword">val</span> process_error : <span><a href="../OpamProcess/index.html#type-result">OpamProcess.result</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>raise <code>Process_error</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-raise_on_process_error" class="anchored"><a href="#val-raise_on_process_error" class="anchor"></a><code><span><span class="keyword">val</span> raise_on_process_error : <span><a href="../OpamProcess/index.html#type-result">OpamProcess.result</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>raise <code>Process_error</code> if the process didn't return 0</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Internal_error" class="anchored"><a href="#exception-Internal_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Internal_error</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>Exception raised when a computation in the current process fails.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-internal_error" class="anchored"><a href="#val-internal_error" class="anchor"></a><code><span><span class="keyword">val</span> internal_error : <span><span><span>(<span class="type-var">'a</span>, unit, string, <span class="type-var">'b</span>)</span> <a href="../../ocaml/Stdlib/index.html#type-format4">format4</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Raise <code>Internal_error</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_tmp_dir" class="anchored"><a href="#val-with_tmp_dir" class="anchor"></a><code><span><span class="keyword">val</span> with_tmp_dir : <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_tmp_dir fn</code> executes <code>fn</code> in a tempory directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_tmp_dir_job" class="anchored"><a href="#val-with_tmp_dir_job" class="anchor"></a><code><span><span class="keyword">val</span> with_tmp_dir_job : <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../OpamProcess/index.html#type-job">OpamProcess.job</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../OpamProcess/index.html#type-job">OpamProcess.job</a></span></span></code></div><div class="spec-doc"><p>Runs a job with a temp dir that is cleaned up afterwards</p></div></div><div class="odoc-spec"><div class="spec value" id="val-verbose_for_base_commands" class="anchored"><a href="#val-verbose_for_base_commands" class="anchor"></a><code><span><span class="keyword">val</span> verbose_for_base_commands : <span>unit <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Returns true if the default verbose level for base commands (cp, mv, etc.) is reached</p></div></div><h3 id="filesystem-management"><a href="#filesystem-management" class="anchor"></a>Filesystem management</h3><div class="odoc-spec"><div class="spec value" id="val-mk_temp_dir" class="anchored"><a href="#val-mk_temp_dir" class="anchor"></a><code><span><span class="keyword">val</span> mk_temp_dir : <span>?prefix:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Returns a directory name, in the temporary directory, composed by <i>opam</i> (if <code>prefix</code> is not set), pid, and random number.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-copy_file" class="anchored"><a href="#val-copy_file" class="anchor"></a><code><span><span class="keyword">val</span> copy_file : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>copy_file src dst</code> copies <code>src</code> to <code>dst</code>. Remove <code>dst</code> before the copy if it is a link.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-copy_dir" class="anchored"><a href="#val-copy_dir" class="anchor"></a><code><span><span class="keyword">val</span> copy_dir : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>copy_dir src dst</code> copies the contents of directory <code>src</code> into directory <code>dst</code>, creating it if necessary, merging directory contents and ovewriting files otherwise</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mv" class="anchored"><a href="#val-mv" class="anchor"></a><code><span><span class="keyword">val</span> mv : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-install_warning" class="anchored"><a href="#type-install_warning" class="anchor"></a><code><span><span class="keyword">type</span> install_warning</span><span> = </span><span>[ </span></code><table><tr id="type-install_warning.Add_exe" class="anchored"><td class="def constructor"><a href="#type-install_warning.Add_exe" class="anchor"></a><code><span>| </span></code><code><span>`Add_exe</span></code></td></tr><tr id="type-install_warning.Install_dll" class="anchored"><td class="def constructor"><a href="#type-install_warning.Install_dll" class="anchor"></a><code><span>| </span></code><code><span>`Install_dll</span></code></td></tr><tr id="type-install_warning.Install_script" class="anchored"><td class="def constructor"><a href="#type-install_warning.Install_script" class="anchor"></a><code><span>| </span></code><code><span>`Install_script</span></code></td></tr><tr id="type-install_warning.Install_unknown" class="anchored"><td class="def constructor"><a href="#type-install_warning.Install_unknown" class="anchor"></a><code><span>| </span></code><code><span>`Install_unknown</span></code></td></tr><tr id="type-install_warning.Cygwin" class="anchored"><td class="def constructor"><a href="#type-install_warning.Cygwin" class="anchor"></a><code><span>| </span></code><code><span>`Cygwin</span></code></td></tr><tr id="type-install_warning.Cygwin_libraries" class="anchored"><td class="def constructor"><a href="#type-install_warning.Cygwin_libraries" class="anchor"></a><code><span>| </span></code><code><span>`Cygwin_libraries</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>Warnings which come from <a href="#val-install"><code>install</code></a></p></div></div><div class="odoc-spec"><div class="spec type" id="type-install_warning_fn" class="anchored"><a href="#type-install_warning_fn" class="anchor"></a><code><span><span class="keyword">type</span> install_warning_fn</span><span> = <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-install_warning">install_warning</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-default_install_warning" class="anchored"><a href="#val-default_install_warning" class="anchor"></a><code><span><span class="keyword">val</span> default_install_warning : <a href="#type-install_warning_fn">install_warning_fn</a></span></code></div><div class="spec-doc"><p>The default warning function - displays a message on OpamConsole</p></div></div><div class="odoc-spec"><div class="spec value" id="val-install" class="anchored"><a href="#val-install" class="anchor"></a><code><span><span class="keyword">val</span> install : <span>?warning:<a href="#type-install_warning_fn">install_warning_fn</a> <span class="arrow">&#45;&gt;</span></span> <span>?exec:bool <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>install ?exec src dst</code> copies file <code>src</code> as file <code>dst</code> using <code>install</code>. If <code>exec</code>, make the resulting file executable (otherwise, look at the permissions of the original file to decide).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_exec" class="anchored"><a href="#val-is_exec" class="anchor"></a><code><span><span class="keyword">val</span> is_exec : <span>string <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Checks if a file is an executable (regular file with execution permission)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-file_is_empty" class="anchored"><a href="#val-file_is_empty" class="anchor"></a><code><span><span class="keyword">val</span> file_is_empty : <span>string <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-link" class="anchored"><a href="#val-link" class="anchor"></a><code><span><span class="keyword">val</span> link : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>link src dst</code> links <code>src</code> to <code>dst</code>. Remove <code>dst</code> if it is a file, not a directory.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-real_path" class="anchored"><a href="#val-real_path" class="anchor"></a><code><span><span class="keyword">val</span> real_path : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>real_path p</code> returns the real path associated to <code>p</code>: <code>..</code> are expanded and relative paths become absolute.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string_of_channel" class="anchored"><a href="#val-string_of_channel" class="anchor"></a><code><span><span class="keyword">val</span> string_of_channel : <span><a href="../../ocaml/Stdlib/index.html#type-in_channel">in_channel</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Return the contents of a channel.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-File_not_found" class="anchored"><a href="#exception-File_not_found" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">File_not_found</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>Raised when a file or directory can't be accessed (doesn't exist, bad permissions, etc.)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read" class="anchored"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>read filename</code> returns the contents of <code>filename</code> (while taking an advisory read lock to prevent concurrent writes)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write" class="anchored"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write filename contents</code> write <code>contents</code> to <code>filename</code> (while taking an advisory write lock to prevent concurrent reads or writes)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-remove" class="anchored"><a href="#val-remove" class="anchor"></a><code><span><span class="keyword">val</span> remove : <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>remove filename</code> removes <code>filename</code>. Works whether <code>filename</code> is a file or a directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-remove_file" class="anchored"><a href="#val-remove_file" class="anchor"></a><code><span><span class="keyword">val</span> remove_file : <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>remove_file filename</code> removes <code>filename</code>. Works only for normal files (or also at least for symlinks)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-remove_dir" class="anchored"><a href="#val-remove_dir" class="anchor"></a><code><span><span class="keyword">val</span> remove_dir : <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>remove_dir filename</code> removes <code>filename</code>. Works only for directory (not for symlinks or other files).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-chdir" class="anchored"><a href="#val-chdir" class="anchor"></a><code><span><span class="keyword">val</span> chdir : <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Change the current working directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-in_dir" class="anchored"><a href="#val-in_dir" class="anchor"></a><code><span><span class="keyword">val</span> in_dir : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>in_dir dir fn</code> evaluates <code>fn</code> in the directory <code>dir</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-ls" class="anchored"><a href="#val-ls" class="anchor"></a><code><span><span class="keyword">val</span> ls : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p>Returns the list of files and directories in the given directory (full names)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-files_with_links" class="anchored"><a href="#val-files_with_links" class="anchor"></a><code><span><span class="keyword">val</span> files_with_links : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p><code>files_with_links dir</code> returns the files in the directory <code>dir</code>. Links simulating directory are ignored, others links are returned.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-rec_files" class="anchored"><a href="#val-rec_files" class="anchor"></a><code><span><span class="keyword">val</span> rec_files : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p><code>rec_files dir</code> returns the list of all files in <code>dir</code>, recursively. Links behaving like directory are crossed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-files" class="anchored"><a href="#val-files" class="anchor"></a><code><span><span class="keyword">val</span> files : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p>Return the list of files in the current directory.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-rec_dirs" class="anchored"><a href="#val-rec_dirs" class="anchor"></a><code><span><span class="keyword">val</span> rec_dirs : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p><code>rec_dirs dir</code> return the list list of all directories recursively (going through symbolink links).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dirs" class="anchored"><a href="#val-dirs" class="anchor"></a><code><span><span class="keyword">val</span> dirs : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p>Return the list of directories in the current directory.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dir_is_empty" class="anchored"><a href="#val-dir_is_empty" class="anchor"></a><code><span><span class="keyword">val</span> dir_is_empty : <span>string <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-directories_with_links" class="anchored"><a href="#val-directories_with_links" class="anchor"></a><code><span><span class="keyword">val</span> directories_with_links : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p><code>directories_with_links dir</code> returns the directories in the directory <code>dir</code>. Links pointing to directory are also returned.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-make_command" class="anchored"><a href="#val-make_command" class="anchor"></a><code><span><span class="keyword">val</span> make_command : <span>?verbose:bool <span class="arrow">&#45;&gt;</span></span> <span>?env:<span>string array</span> <span class="arrow">&#45;&gt;</span></span> <span>?name:string <span class="arrow">&#45;&gt;</span></span>
<span>?text:string <span class="arrow">&#45;&gt;</span></span> <span>?metadata:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?allow_stdin:bool <span class="arrow">&#45;&gt;</span></span>
<span>?stdout:string <span class="arrow">&#45;&gt;</span></span> <span>?dir:string <span class="arrow">&#45;&gt;</span></span> <span>?resolve_path:bool <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <a href="../OpamProcess/index.html#type-command">OpamProcess.command</a></span></code></div><div class="spec-doc"><p>Make a comman suitable for OpamProcess.Job. if <code>verbose</code>, is set, command and output will be displayed (at command end for the latter, if concurrent commands are running). <code>name</code> is used for naming log files. <code>text</code> is what is displayed in the status line for this command. May raise Command_not_found, unless <code>resolve_path</code> is set to false (in which case you can end up with a process error instead)</p></div></div><p>OLD COMMAND API, DEPRECATED</p><div class="odoc-spec"><div class="spec type" id="type-command" class="anchored"><a href="#type-command" class="anchor"></a><code><span><span class="keyword">type</span> command</span><span> = <span>string list</span></span></code></div><div class="spec-doc"><p>a command is a list of words</p></div></div><div class="odoc-spec"><div class="spec value" id="val-resolve_command" class="anchored"><a href="#val-resolve_command" class="anchor"></a><code><span><span class="keyword">val</span> resolve_command : <span>?env:<span>string array</span> <span class="arrow">&#45;&gt;</span></span> <span>?dir:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div><div class="spec-doc"><p>Test whether a command exists in the environment, and returns it (resolved if found in PATH)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_cygpath_function" class="anchored"><a href="#val-get_cygpath_function" class="anchor"></a><code><span><span class="keyword">val</span> get_cygpath_function : <span>command:string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> string)</span> lazy_t</span></span></code></div><div class="spec-doc"><p>Returns a function which should be applied to arguments for a given command by determining if the command is the Cygwin variant of the command. Returns the identity function otherwise.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-command" class="anchored"><a href="#val-command" class="anchor"></a><code><span><span class="keyword">val</span> command : <span>?verbose:bool <span class="arrow">&#45;&gt;</span></span> <span>?env:<span>string array</span> <span class="arrow">&#45;&gt;</span></span> <span>?name:string <span class="arrow">&#45;&gt;</span></span>
<span>?metadata:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?allow_stdin:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-command">command</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>command cmd</code> executes the command <code>cmd</code> in the correct OPAM environment.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-commands" class="anchored"><a href="#val-commands" class="anchor"></a><code><span><span class="keyword">val</span> commands : <span>?verbose:bool <span class="arrow">&#45;&gt;</span></span> <span>?env:<span>string array</span> <span class="arrow">&#45;&gt;</span></span> <span>?name:string <span class="arrow">&#45;&gt;</span></span>
<span>?metadata:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?keep_going:bool <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-command">command</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>commands cmds</code> executes the commands <code>cmds</code> in the correct OPAM environment. It stops whenever one command fails unless <code>keep_going</code> is set to <code>true</code>. In this case, the first error is re-raised at the end.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_command_output" class="anchored"><a href="#val-read_command_output" class="anchor"></a><code><span><span class="keyword">val</span> read_command_output : <span>?verbose:bool <span class="arrow">&#45;&gt;</span></span> <span>?env:<span>string array</span> <span class="arrow">&#45;&gt;</span></span>
<span>?metadata:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?allow_stdin:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-command">command</a> <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p><code>read_command_output cmd</code> executes the command <code>cmd</code> in the correct OPAM environment and return the lines from stdout if the command exists normally. If the command does not exist or if the command exited with a non-empty exit-code, throw an error.</p></div></div><p>END</p><div class="odoc-spec"><div class="spec value" id="val-is_archive" class="anchored"><a href="#val-is_archive" class="anchor"></a><code><span><span class="keyword">val</span> is_archive : <span>string <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Test whether the file is an archive, by looking as its extension</p></div></div><div class="odoc-spec"><div class="spec value" id="val-extract" class="anchored"><a href="#val-extract" class="anchor"></a><code><span><span class="keyword">val</span> extract : <span>dir:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>extract ~dir:dirname filename</code> extracts the archive <code>filename</code> into <code>dirname</code>. <code>dirname</code> should not exists and <code>filename</code> should contain only one top-level directory.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-extract_job" class="anchored"><a href="#val-extract_job" class="anchor"></a><code><span><span class="keyword">val</span> extract_job : <span>dir:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>exn option</span> <a href="../OpamProcess/index.html#type-job">OpamProcess.job</a></span></span></code></div><div class="spec-doc"><p>Same as <code>extract</code>, but as an OpamProcess.job</p></div></div><div class="odoc-spec"><div class="spec value" id="val-extract_in" class="anchored"><a href="#val-extract_in" class="anchor"></a><code><span><span class="keyword">val</span> extract_in : <span>dir:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>extract_in ~dir:dirname filename</code> extracts the archive <code>filename</code> into <code>dirname</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-extract_in_job" class="anchored"><a href="#val-extract_in_job" class="anchor"></a><code><span><span class="keyword">val</span> extract_in_job : <span>dir:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>exn option</span> <a href="../OpamProcess/index.html#type-job">OpamProcess.job</a></span></span></code></div><div class="spec-doc"><p><code>extract_in_job</code> is similar to <code>extract_in</code>, but as a job</p></div></div><div class="odoc-spec"><div class="spec value" id="val-make_tar_gz_job" class="anchored"><a href="#val-make_tar_gz_job" class="anchor"></a><code><span><span class="keyword">val</span> make_tar_gz_job : <span>dir:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>exn option</span> <a href="../OpamProcess/index.html#type-job">OpamProcess.job</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-mkdir" class="anchored"><a href="#val-mkdir" class="anchor"></a><code><span><span class="keyword">val</span> mkdir : <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Create a directory. Do not fail if the directory already exist.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-cpu_count" class="anchored"><a href="#val-cpu_count" class="anchor"></a><code><span><span class="keyword">val</span> cpu_count : <span>unit <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Get the number of active processors on the system</p></div></div><h3 id="file-locking-function"><a href="#file-locking-function" class="anchor"></a>File locking function</h3><div class="odoc-spec"><div class="spec type" id="type-lock" class="anchored"><a href="#type-lock" class="anchor"></a><code><span><span class="keyword">type</span> lock</span></code></div><div class="spec-doc"><p>Unix file locks (mutable structure, to follow actual semantics)</p></div></div><div class="odoc-spec"><div class="spec type" id="type-actual_lock_flag" class="anchored"><a href="#type-actual_lock_flag" class="anchor"></a><code><span><span class="keyword">type</span> actual_lock_flag</span><span> = </span><span>[ </span></code><table><tr id="type-actual_lock_flag.Lock_read" class="anchored"><td class="def constructor"><a href="#type-actual_lock_flag.Lock_read" class="anchor"></a><code><span>| </span></code><code><span>`Lock_read</span></code></td></tr><tr id="type-actual_lock_flag.Lock_write" class="anchored"><td class="def constructor"><a href="#type-actual_lock_flag.Lock_write" class="anchor"></a><code><span>| </span></code><code><span>`Lock_write</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>The different kinds of unix advisory locks available (`Lock_none doesn't actually lock anything, or even create the lock file)</p></div></div><div class="odoc-spec"><div class="spec type" id="type-lock_flag" class="anchored"><a href="#type-lock_flag" class="anchor"></a><code><span><span class="keyword">type</span> lock_flag</span><span> = </span><span>[ </span></code><table><tr id="type-lock_flag.Lock_none" class="anchored"><td class="def constructor"><a href="#type-lock_flag.Lock_none" class="anchor"></a><code><span>| </span></code><code><span>`Lock_none</span></code></td></tr><tr id="type-lock_flag.actual_lock_flag" class="anchored"><td class="def type"><a href="#type-lock_flag.actual_lock_flag" class="anchor"></a><code><span>| </span></code><code><span><a href="#type-actual_lock_flag">actual_lock_flag</a></span></code></td></tr></table><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-lock_none" class="anchored"><a href="#val-lock_none" class="anchor"></a><code><span><span class="keyword">val</span> lock_none : <a href="#type-lock">lock</a></span></code></div><div class="spec-doc"><p>Dummy lock</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Locked" class="anchored"><a href="#exception-Locked" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Locked</span></span></code></div><div class="spec-doc"><p>Raised when locks can't be acquired and <code>dontblock</code> was specified)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-release_all_locks" class="anchored"><a href="#val-release_all_locks" class="anchor"></a><code><span><span class="keyword">val</span> release_all_locks : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Force releases all open locks in the process. Required for Windows if an exception has been raised, since Windows doesn't permit unlinking while handles are open.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-flock" class="anchored"><a href="#val-flock" class="anchor"></a><code><span><span class="keyword">val</span> flock : <span><span>[&lt; <a href="#type-lock_flag">lock_flag</a> ]</span> <span class="arrow">&#45;&gt;</span></span> <span>?dontblock:bool <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-lock">lock</a></span></code></div><div class="spec-doc"><p>Acquires a lock on the given file. Raises <code>Locked</code> if the lock can't be acquired and <code>dontblock</code> is set. Raises <code>OpamStd.Sys.Exit</code> if <code>safe_mode</code> is set and a write lock is required. Also raises Unix errors if the lock file can't be opened.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-flock_update" class="anchored"><a href="#val-flock_update" class="anchor"></a><code><span><span class="keyword">val</span> flock_update : <span><span>[&lt; <a href="#type-lock_flag">lock_flag</a> ]</span> <span class="arrow">&#45;&gt;</span></span> <span>?dontblock:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-lock">lock</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Updates an existing lock to the given level. Raises the same exceptions as <code>flock</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-funlock" class="anchored"><a href="#val-funlock" class="anchor"></a><code><span><span class="keyword">val</span> funlock : <span><a href="#type-lock">lock</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Releases an acquired lock (equivalent to <code>flock_update `Lock_none</code>)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-lock_max" class="anchored"><a href="#val-lock_max" class="anchor"></a><code><span><span class="keyword">val</span> lock_max : <span><a href="#type-lock_flag">lock_flag</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-lock_flag">lock_flag</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-lock_flag">lock_flag</a></span></code></div><div class="spec-doc"><p>Returns the highest of the two lock flags (with the order no lock &lt; read lock &lt; write lock)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-lock_isatleast" class="anchored"><a href="#val-lock_isatleast" class="anchor"></a><code><span><span class="keyword">val</span> lock_isatleast : <span><span>[&lt; <a href="#type-lock_flag">lock_flag</a> ]</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-lock">lock</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Returns true if the lock already has the lock_flag rights or more</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_lock_flag" class="anchored"><a href="#val-get_lock_flag" class="anchor"></a><code><span><span class="keyword">val</span> get_lock_flag : <span><a href="#type-lock">lock</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-lock_flag">lock_flag</a></span></code></div><div class="spec-doc"><p>Returns the current kind of the lock</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_lock_fd" class="anchored"><a href="#val-get_lock_fd" class="anchor"></a><code><span><span class="keyword">val</span> get_lock_fd : <span><a href="#type-lock">lock</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a></span></code></div><div class="spec-doc"><p>Returns the underlying fd for the lock or raises Not_found for `No_lock</p></div></div><h3 id="misc"><a href="#misc" class="anchor"></a>Misc</h3><div class="odoc-spec"><div class="spec value" id="val-patch" class="anchored"><a href="#val-patch" class="anchor"></a><code><span><span class="keyword">val</span> patch : <span>?preprocess:bool <span class="arrow">&#45;&gt;</span></span> <span>dir:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>exn option</span> <a href="../OpamProcess/index.html#type-job">OpamProcess.job</a></span></span></code></div><div class="spec-doc"><p>Apply a patch file in the current directory. If <code>preprocess</code> is set to false, there is no CRLF translation. Returns the error if the patch didn't apply.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_eol_encoding" class="anchored"><a href="#val-get_eol_encoding" class="anchor"></a><code><span><span class="keyword">val</span> get_eol_encoding : <span>string <span class="arrow">&#45;&gt;</span></span> <span>bool option</span></span></code></div><div class="spec-doc"><p>Returns the end-of-line encoding style for the given file. <code>None</code> means that either the encoding of line endings is mixed, or the file contains no line endings at all (an empty file, or a file with one line and no EOL at EOF). Otherwise it returns <code>Some true</code> if all endings are encoded CRLF.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-translate_patch" class="anchored"><a href="#val-translate_patch" class="anchor"></a><code><span><span class="keyword">val</span> translate_patch : <span>dir:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>translate_patch ~dir input_patch output_patch</code> writes a copy of <code>input_patch</code> to <code>output_patch</code> as though <code>input_patch</code> had been applied in <code>dir</code>. The patch is rewritten such that if text files have different line endings then the patch is transformed to patch using the encoding on disk. In particular, this means that patches generated against Unix checkouts of Git sources will correctly apply to Windows checkouts of the same sources.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-temp_file" class="anchored"><a href="#val-temp_file" class="anchor"></a><code><span><span class="keyword">val</span> temp_file : <span>?auto_clean:bool <span class="arrow">&#45;&gt;</span></span> <span>?dir:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Create a temporary file in <i>~/.opam/logs/&lt;name&gt;XXX</i>, if <code>dir</code> is not set. ?auto_clean controls whether the file is automatically deleted when opam terminates (default: <code>true</code>).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-print_stats" class="anchored"><a href="#val-print_stats" class="anchor"></a><code><span><span class="keyword">val</span> print_stats : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Print stats</p></div></div><div class="odoc-spec"><div class="spec value" id="val-register_printer" class="anchored"><a href="#val-register_printer" class="anchor"></a><code><span><span class="keyword">val</span> register_printer : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Registers an exception printer that adds some OPAM version info, and details on process and Unix errors</p></div></div><div class="odoc-spec"><div class="spec value" id="val-init" class="anchored"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Initialises signal handlers, catch_break and some exception printers. The lib may not perform properly without this if <code>Sys.catch_break</code> isn't set and SIGPIPE isn't handled (with a no-op)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-forward_to_back" class="anchored"><a href="#val-forward_to_back" class="anchor"></a><code><span><span class="keyword">val</span> forward_to_back : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>On Unix, a no-op. On Windows, convert / to \</p></div></div><div class="odoc-spec"><div class="spec value" id="val-back_to_forward" class="anchored"><a href="#val-back_to_forward" class="anchor"></a><code><span><span class="keyword">val</span> back_to_forward : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>On Unix, a no-op. On Windows, convert \ to /</p></div></div><div class="odoc-spec"><div class="spec value" id="val-classify_executable" class="anchored"><a href="#val-classify_executable" class="anchor"></a><code><span><span class="keyword">val</span> classify_executable : <span>string <span class="arrow">&#45;&gt;</span></span> <span>[ <span>`Exe of <span>[ `i386 <span>| `x86</span> <span>| `x86_64</span> ]</span></span> <span><span>| `Dll</span> of <span>[ `x86 <span>| `x86_64</span> ]</span></span> <span>| `Script</span> <span>| `Unknown</span> ]</span></span></code></div><div class="spec-doc"><p>Identifies kinds of executable files. At present, only useful on Windows. Executable or DLLs are recognised based on their content, not on their filename. Any file beginning &quot;#!&quot; is assumed to be a shell script and all files are classified <code>`Unknown</code>.</p></div></div></div></body></html>