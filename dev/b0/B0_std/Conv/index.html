<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Conv (b0.B0_std.Conv)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">b0</a> &#x00BB; <a href="../index.html">B0_std</a> &#x00BB; Conv</nav><h1>Module <code>B0_std.Conv</code></h1><p>Value converters.</p><p>A value converter describes how to encode and decode OCaml values to a binary presentation and a textual, human specifiable, <a href="index.html#sexp_syntax"><span>s-expression based</span></a>, representation.</p><p><b>Notation.</b> Given a value <code>v</code> and a converter <code>c</code> we write [<code>v</code>]<sub>c</sub> the textual encoding of <code>v</code> according to <code>c</code>.</p><nav class="toc"><ul><li><a href="#low_codec">Low-level encoders and decoders</a></li><li><a href="#converters">Converters</a></li><li><a href="#converting">Converting</a></li><li><a href="#predef">Predefined converters</a></li><li><a href="#non_composable">Non-composable predefined converters</a></li><li><a href="#sexp_syntax">S-expressions syntax</a><ul><li><a href="#sexp">S-expressions and sequences thereof</a></li><li><a href="#whitespace">Whitespace</a></li><li><a href="#comments">Comments</a></li><li><a href="#atoms">Atoms</a></li><li><a href="#lists">Lists</a></li><li><a href="#grammar">S-expression grammar</a></li></ul></li></ul></nav></header><section><header><h2 id="low_codec"><a href="#low_codec" class="anchor"></a>Low-level encoders and decoders</h2></header><dl><dt class="spec exception" id="exception-Error"><a href="#exception-Error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Error</span> <span class="keyword">of</span> int * int * string</code></dt><dd><p>The exception for conversion errors. This exception is raised both by encoders and decoders with <code>raise_notrace</code>. The integers indicates a byte index range in the input on decoding errors, it is meaningless on encoding ones.</p><p><b>Note.</b> This exception is used for defining converters. High-level <span class="xref-unresolved" title="unresolved reference to &quot;convert&quot;"><span>converting functions</span></span> do not raise but use result values to report errors.</p></dd></dl><dl><dt class="spec module" id="module-Bin"><a href="#module-Bin" class="anchor"></a><code><span class="keyword">module</span> <a href="Bin/index.html">Bin</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Binary codecs.</p></dd></dl><dl><dt class="spec module" id="module-Txt"><a href="#module-Txt" class="anchor"></a><code><span class="keyword">module</span> <a href="Txt/index.html">Txt</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Textual codecs</p></dd></dl></section><section><header><h2 id="converters"><a href="#converters" class="anchor"></a>Converters</h2></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> 'a t</code></dt><dd><p>The type for converters.</p></dd></dl><dl><dt class="spec value" id="val-v"><a href="#val-v" class="anchor"></a><code><span class="keyword">val</span> v : kind:string <span>&#45;&gt;</span> docvar:string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="Bin/index.html#type-enc">Bin.enc</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="Bin/index.html#type-dec">Bin.dec</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="Txt/index.html#type-enc">Txt.enc</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="Txt/index.html#type-dec">Txt.dec</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>v ~kind ~docvar bin_enc bin_dec txt_enc txt_dec</code> is a value converter using <code>bin_enc</code>, <code>bin_dec</code>, <code>txt_enc</code>, <code>txt_dec</code> for binary and textual conversions. <code>kind</code> documents the kind of converted value and <code>docvar</code> a meta-variable used in documentation to stand for these values (use uppercase e.g. <code>INT</code> for integers).</p></dd></dl><dl><dt class="spec value" id="val-kind"><a href="#val-kind" class="anchor"></a><code><span class="keyword">val</span> kind : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>kind c</code> is the documented kind of value converted by <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-docvar"><a href="#val-docvar" class="anchor"></a><code><span class="keyword">val</span> docvar : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>docvar c</code> is the documentation meta-variable for values converted by <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-bin_enc"><a href="#val-bin_enc" class="anchor"></a><code><span class="keyword">val</span> bin_enc : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="Bin/index.html#type-enc">Bin.enc</a></code></dt><dd><p><code>bin_enc c</code> is the binary encoder of <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-bin_dec"><a href="#val-bin_dec" class="anchor"></a><code><span class="keyword">val</span> bin_dec : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="Bin/index.html#type-dec">Bin.dec</a></code></dt><dd><p><code>bin_dec c</code> is the binary decoder of <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-txt_enc"><a href="#val-txt_enc" class="anchor"></a><code><span class="keyword">val</span> txt_enc : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="Txt/index.html#type-enc">Txt.enc</a></code></dt><dd><p><code>txt_enc c</code> is the textual encoder of <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-txt_dec"><a href="#val-txt_dec" class="anchor"></a><code><span class="keyword">val</span> txt_dec : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="Txt/index.html#type-dec">Txt.dec</a></code></dt><dd><p><code>txt_dec c</code> is the textual decoder of <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-with_kind"><a href="#val-with_kind" class="anchor"></a><code><span class="keyword">val</span> with_kind : ?&#8288;docvar:string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>with_kind ~docvar k c</code> is <code>c</code> with kind <code>k</code> and documentation meta-variable <code>docvar</code> (defaults to <code>docvar c</code>).</p></dd></dl><dl><dt class="spec value" id="val-with_docvar"><a href="#val-with_docvar" class="anchor"></a><code><span class="keyword">val</span> with_docvar : string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>with_docvar docvar c</code> is <code>c</code> with documentation meta-variable <code>docvar</code>.</p></dd></dl><dl><dt class="spec value" id="val-with_conv"><a href="#val-with_conv" class="anchor"></a><code><span class="keyword">val</span> with_conv : kind:string <span>&#45;&gt;</span> docvar:string <span>&#45;&gt;</span> (<span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>with_conv ~kind ~docvar to_t of_t t_conv</code> is a converter for type <code>'b</code> given a converter <code>t_conv</code> for type <code>'a</code> and conversion functions from and to type <code>'b</code>. The conversion functions should raise <a href="index.html#exception-Error"><code>Error</code></a> if they are not total.</p></dd></dl></section><section><header><h2 id="converting"><a href="#converting" class="anchor"></a>Converting</h2></header><dl><dt class="spec value" id="val-to_bin"><a href="#val-to_bin" class="anchor"></a><code><span class="keyword">val</span> to_bin : ?&#8288;buf:<a href="../../../ocaml/Stdlib/Buffer/index.html#type-t">Stdlib.Buffer.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> (string, string) <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></code></dt><dd><p><code>to_bin c v</code> binary encodes <code>v</code> using <code>c</code>. <code>buf</code> is used as the internal buffer if specified (it is <span class="xref-unresolved" title="unresolved reference to &quot;Buffer.clear&quot;"><code>Buffer</code>.clear</span>ed before usage).</p></dd></dl><dl><dt class="spec value" id="val-of_bin"><a href="#val-of_bin" class="anchor"></a><code><span class="keyword">val</span> of_bin : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> (<span class="type-var">'a</span>, string) <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></code></dt><dd><p><code>of_bin c s</code> binary decodes a value from <code>s</code> using <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-to_txt"><a href="#val-to_txt" class="anchor"></a><code><span class="keyword">val</span> to_txt : ?&#8288;buf:<a href="../../../ocaml/Stdlib/Buffer/index.html#type-t">Stdlib.Buffer.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> (string, string) <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></code></dt><dd><p><code>to_txt c v</code> textually encodes <code>v</code> using <code>c</code>. <code>buf</code> is used as the internal buffer if specified (it is <span class="xref-unresolved" title="unresolved reference to &quot;Buffer.clear&quot;"><code>Buffer</code>.clear</span>ed before usage).</p></dd></dl><dl><dt class="spec value" id="val-of_txt"><a href="#val-of_txt" class="anchor"></a><code><span class="keyword">val</span> of_txt : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> (<span class="type-var">'a</span>, string) <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></code></dt><dd><p><code>of_txt c s</code> textually decodes a value from <code>s</code> using <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-to_pp"><a href="#val-to_pp" class="anchor"></a><code><span class="keyword">val</span> to_pp : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../Fmt/index.html#type-t">Fmt.t</a></code></dt><dd><p><code>to_pp c</code> is a formatter using <a href="index.html#val-to_txt"><code>to_txt</code></a> to format values. Any error that might occur is printed in the output using the s-expression (<em>conv-error</em> [<code>c</code>]<sub>kind</sub> [<code>e</code>]) with [<code>c</code>]<sub>kind</sub> the atom for the value <code>kind c</code> and [<code>e</code>] the atom for the error message.</p></dd></dl></section><section><header><h2 id="predef"><a href="#predef" class="anchor"></a>Predefined converters</h2></header><dl><dt class="spec value" id="val-bool"><a href="#val-bool" class="anchor"></a><code><span class="keyword">val</span> bool : bool <a href="index.html#type-t">t</a></code></dt><dd><p><code>bool</code> converts booleans. Textual conversions represent booleans with the <a href="index.html#atoms"><span>atoms</span></a> <em>true</em> and <em>false</em>.</p></dd></dl><dl><dt class="spec value" id="val-byte"><a href="#val-byte" class="anchor"></a><code><span class="keyword">val</span> byte : int <a href="index.html#type-t">t</a></code></dt><dd><p><code>byte</code> converts a byte. Textual decoding parses an <a href="index.html#atoms"><span>atom</span></a> according to the syntax of <code>int_of_string</code>. Conversions fail if the integer is not in the range [0;255].</p></dd></dl><dl><dt class="spec value" id="val-int"><a href="#val-int" class="anchor"></a><code><span class="keyword">val</span> int : int <a href="index.html#type-t">t</a></code></dt><dd><p><code>int</code> converts signed OCaml integers. Textual decoding parses an <a href="index.html#atoms"><span>atom</span></a> according to the syntax of <code>int_of_string</code>. Conversions fail if the integer is not in the range [-2<sup><span class="xref-unresolved" title="unresolved reference to &quot;Sys.int_size&quot;"><code>Sys</code>.int_size</span>-1</sup>;2<sup><span class="xref-unresolved" title="unresolved reference to &quot;Sys.int_size&quot;"><code>Sys</code>.int_size</span>-1</sup>-1].</p><p><b>Warning.</b> A large integer encoded on a 64-bit platform may fail to decode on a 32-bit platform, use <a href="index.html#val-int31"><code>int31</code></a> or <a href="index.html#val-int64"><code>int64</code></a> if this is a problem.</p></dd></dl><dl><dt class="spec value" id="val-int31"><a href="#val-int31" class="anchor"></a><code><span class="keyword">val</span> int31 : int <a href="index.html#type-t">t</a></code></dt><dd><p><code>int31</code> converts signed 31-bit integers. Textual decoding parses an <a href="index.html#atoms"><span>atom</span></a> according to the syntax of <code>int_of_string</code>. Conversions fail if the integer is not in the range [-2<sup>30</sup>;2<sup>30</sup>-1].</p></dd></dl><dl><dt class="spec value" id="val-int32"><a href="#val-int32" class="anchor"></a><code><span class="keyword">val</span> int32 : int32 <a href="index.html#type-t">t</a></code></dt><dd><p><code>int32</code> converts signed 32-bit integers. Textual decoding parses an <a href="index.html#atoms"><span>atom</span></a> according to the syntax of <span class="xref-unresolved" title="unresolved reference to &quot;Int32.of_string&quot;"><code>Int32</code>.of_string</span>. Conversions fail if the integer is not in the range [-2<sup>31</sup>;2<sup>31</sup>-1].</p></dd></dl><dl><dt class="spec value" id="val-int64"><a href="#val-int64" class="anchor"></a><code><span class="keyword">val</span> int64 : int64 <a href="index.html#type-t">t</a></code></dt><dd><p><code>int64</code> converts signed 64-bit integers. Textual decoding parses an <a href="index.html#atoms"><span>atom</span></a> according to the syntax of <span class="xref-unresolved" title="unresolved reference to &quot;Int64.of_string&quot;"><code>Int64</code>.of_string</span>. Conversions fail if the integer is not in the range [-2<sup>63</sup>;2<sup>63</sup>-1].</p></dd></dl><dl><dt class="spec value" id="val-float"><a href="#val-float" class="anchor"></a><code><span class="keyword">val</span> float : float <a href="index.html#type-t">t</a></code></dt><dd><p><code>float</code> converts floating point numbers. Textual decoding parses an <a href="index.html#atoms"><span>atom</span></a> using <code>float_of_string</code>.</p></dd></dl><dl><dt class="spec value" id="val-string_bytes"><a href="#val-string_bytes" class="anchor"></a><code><span class="keyword">val</span> string_bytes : string <a href="index.html#type-t">t</a></code></dt><dd><p><code>string_bytes</code> converts OCaml strings as byte sequences. Textual conversion represents the bytes of <code>s</code> with the s-expression (<em>hex</em> [<code>s</code>]<sub>hex</sub>) with [<code>s</code>]<sub>hex</sub> the <a href="index.html#atoms"><span>atom</span></a> resulting from <a href="../String/Ascii/index.html#val-to_hex"><code>String.Ascii.to_hex</code></a><code> s</code>. See also <a href="index.html#val-atom"><code>atom</code></a> and <code>only_string</code>.</p><p><b>Warning.</b> A large string encoded on a 64-bit platform may fail to decode on a 32-bit platform.</p></dd></dl><dl><dt class="spec value" id="val-atom"><a href="#val-atom" class="anchor"></a><code><span class="keyword">val</span> atom : string <a href="index.html#type-t">t</a></code></dt><dd><p><code>atom</code> converts strings assumed to represent UTF-8 encoded Unicode text; but the encoding is not checked. Textual conversions represent strings as <a href="index.html#atoms"><span>atoms</span></a>. See also <a href="index.html#val-string_bytes"><code>string_bytes</code></a> and <code>only_string</code>.</p><p><b>Warning.</b> A large atom encoded on a 64-bit platform may fail to decode on a 32-bit platform.</p></dd></dl><dl><dt class="spec value" id="val-atom_non_empty"><a href="#val-atom_non_empty" class="anchor"></a><code><span class="keyword">val</span> atom_non_empty : string <a href="index.html#type-t">t</a></code></dt><dd><p><code>atom_non_empty</code> is like <a href="index.html#val-atom"><code>atom</code></a> but ensures the atom is not empty.</p></dd></dl><dl><dt class="spec value" id="val-option"><a href="#val-option" class="anchor"></a><code><span class="keyword">val</span> option : ?&#8288;kind:string <span>&#45;&gt;</span> ?&#8288;docvar:string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> option <a href="index.html#type-t">t</a></code></dt><dd><p><code>option c</code> converts optional values converted with <code>c</code>. Textual conversions represent <code>None</code> with the <a href="index.html#atoms"><span>atom</span></a> <em>none</em> and <code>Some v</code> with the s-expression (<em>some</em> [<code>v</code>]<sub>c</sub>).</p></dd></dl><dl><dt class="spec value" id="val-some"><a href="#val-some" class="anchor"></a><code><span class="keyword">val</span> some : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> option <a href="index.html#type-t">t</a></code></dt><dd><p><code>some c</code> wraps decodes of <code>c</code> with <a href="../Option/index.html#val-some"><code>Option.some</code></a>. <b>Warning.</b> <code>None</code> can't be converted in either direction, use <a href="index.html#val-option"><code>option</code></a> for this.</p></dd></dl><dl><dt class="spec value" id="val-result"><a href="#val-result" class="anchor"></a><code><span class="keyword">val</span> result : ?&#8288;kind:string <span>&#45;&gt;</span> ?&#8288;docvar:string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a> <a href="index.html#type-t">t</a></code></dt><dd><p><code>result ok error</code> converts result values with <code>ok</code> and <code>error</code>. Textual conversions represent <code>Ok v</code> with the s-expression (<em>ok</em> [<code>v</code>]<sub>ok</sub>) and <code>Error e</code> with (<em>error</em> [<code>e</code>]<sub>error</sub>).</p></dd></dl><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">val</span> list : ?&#8288;kind:string <span>&#45;&gt;</span> ?&#8288;docvar:string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> list <a href="index.html#type-t">t</a></code></dt><dd><p><code>array c</code> converts a list of values converted with <code>c</code>. Textual conversions represent a list <code>[v0; ... vn]</code> by the s-expression ([<code>v0</code>]<sub>c</sub> ... [<code>vn</code>]<sub>c</sub>).</p><p><b>Warning.</b> A large list encoded on a 64-bit platform may fail to decode on a 32-bit platform.</p></dd></dl><dl><dt class="spec value" id="val-array"><a href="#val-array" class="anchor"></a><code><span class="keyword">val</span> array : ?&#8288;kind:string <span>&#45;&gt;</span> ?&#8288;docvar:string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> array <a href="index.html#type-t">t</a></code></dt><dd><p><code>array c</code> is like <a href="index.html#val-list"><code>list</code></a> but converts arrays.</p><p><b>Warning.</b> A large array encoded on a 64-bit platform may fail to decode on a 32-bit platform.</p></dd></dl><dl><dt class="spec value" id="val-pair"><a href="#val-pair" class="anchor"></a><code><span class="keyword">val</span> pair : ?&#8288;kind:string <span>&#45;&gt;</span> ?&#8288;docvar:string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> * <span class="type-var">'b</span>) <a href="index.html#type-t">t</a></code></dt><dd><p><code>pair c0 c1</code> converts pairs of values converted with <code>c0</code> and <code>c1</code>. Textual conversion represent a pair <code>(v0, v1)</code> by the s-expression ([<code>v0</code>]<sub>c0</sub> [<code>v1</code>]<sub>c1</sub>).</p></dd></dl><dl><dt class="spec value" id="val-enum"><a href="#val-enum" class="anchor"></a><code><span class="keyword">val</span> enum : kind:string <span>&#45;&gt;</span> docvar:string <span>&#45;&gt;</span> ?&#8288;eq:(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> bool) <span>&#45;&gt;</span> (string * <span class="type-var">'a</span>) list <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>enum ~kind ~docvar ~eq vs</code> converts values present in <code>vs</code>. <code>eq</code> is used to test equality among values (defaults to <code>( =
      )</code>). The list length should not exceed 256. Textual conversions use the strings of the pairs in <code>vs</code> as <a href="index.html#atoms"><span>atoms</span></a> to encode the corresponding value.</p></dd></dl></section><section><header><h2 id="non_composable"><a href="#non_composable" class="anchor"></a>Non-composable predefined converters</h2><p>Textual conversions performed by the following converters cannot be composed; they do not respect the syntax of s-expression <a href="index.html#val-atom"><span>atoms</span></a>. They can be used for direct conversions when one does not want to be subject to the syntactic constraints of s-expressions. For example when parsing command line interface arguments or environment variables.</p></header><dl><dt class="spec value" id="val-string_only"><a href="#val-string_only" class="anchor"></a><code><span class="keyword">val</span> string_only : string <a href="index.html#type-t">t</a></code></dt><dd><p><code>string_only</code> converts OCaml strings. Textual conversion is <b>not composable</b>, use <a href="index.html#val-string_bytes"><code>string_bytes</code></a> or <a href="index.html#val-atom"><code>atom</code></a> instead. Textual encoding passes the string as is and decoding ignores the initial starting point and returns the whole input string.</p><p><b>Warning.</b> A large string encoded on a 64-bit platform may fail to decode on a 32-bit platform.</p></dd></dl></section><section><header><h2 id="sexp_syntax"><a href="#sexp_syntax" class="anchor"></a>S-expressions syntax</h2><p>S-expressions are a general way of describing data via atoms (sequences of characters) and lists delimited by parentheses. Here are a few examples of s-expressions and their syntax:</p><pre>this-is-an-atom
(this is a list of seven atoms)
(this list contains (a nested) list)

; This is a comment
; Anything that follows a semi-colon is ignored until the next line

(this list ; has three atoms and an embededded ()
 comment)

&quot;this is a quoted atom, it can contain spaces ; and ()&quot;

&quot;quoted atoms can be split ^
 across lines or contain Unicode esc^u\{0061\}pes&quot;</pre><p>We define the syntax of s-expressions over a sequence of <a href="http://unicode.org/glossary/#unicode_scalar_value">Unicode characters</a> in which all US-ASCII <a href="../Char/Ascii/index.html#val-is_control"><span>control characters</span></a> except <a href="index.html#whitespace"><span>whitespace</span></a> are forbidden in unescaped form.</p><p><b>Note.</b> This module assumes the sequence of Unicode characters is encoded as UTF-8 although it doesn't check this for now.</p></header><section><header><h3 id="sexp"><a href="#sexp" class="anchor"></a>S-expressions and sequences thereof</h3><p>An <em>s-expression</em> is either an <a href="index.html#atoms"><span><em>atom</em></span></a> or a <a href="index.html#lists"><span><em>list</em></span></a> of s-expressions interspaced with <a href="index.html#whitespace"><span><em>whitespace</em></span></a> and <a href="index.html#comments"><span><em>comments</em></span></a>. A <em>sequence of s-expressions</em> is a succession of s-expressions interspaced with whitespace and comments.</p><p>These elements are informally described below and finally made precise via an ABNF <a href="index.html#grammar"><span>grammar</span></a>.</p></header></section><section><header><h3 id="whitespace"><a href="#whitespace" class="anchor"></a>Whitespace</h3><p>Whitespace is a sequence of whitespace characters, namely, space <code>' '</code> (U+0020), tab <code>'\t'</code> (U+0009), line feed <code>'\n'</code> (U+000A), vertical tab <code>'\t'</code> (U+000B), form feed (U+000C) and carriage return <code>'\r'</code> (U+000D).</p></header></section><section><header><h3 id="comments"><a href="#comments" class="anchor"></a>Comments</h3><p>Unless it occurs inside an atom in quoted form (see below) anything that follows a semicolon <code>';'</code> (U+003B) is ignored until the next <em>end of line</em>, that is either a line feed <code>'\n'</code> (U+000A), a carriage return <code>'\r'</code> (U+000D) or a carriage return and a line feed <code>&quot;\r\n&quot;</code> (&lt;U+000D,U+000A&gt;).</p><pre>(this is not a comment) ; This is a comment
(this is not a comment)</pre></header></section><section><header><h3 id="atoms"><a href="#atoms" class="anchor"></a>Atoms</h3><p>An atom represents ground data as a string of Unicode characters. It can, via escapes, represent any sequence of Unicode characters, including control characters and U+0000. It cannot represent an arbitrary byte sequence except via a client-defined encoding convention (e.g. Base64 or <a href="index.html#val-string_bytes"><span>hex encoding</span></a>).</p><p>Atoms can be specified either via an unquoted or a quoted form. In unquoted form the atom is written without delimiters. In quoted form the atom is delimited by double quote <code>'\&quot;'</code> (U+0022) characters, it is mandatory for atoms that contain <a href="index.html#whitespace"><span>whitespace</span></a>, parentheses <code>'('</code> <code>')'</code>, semicolons <code>';'</code>, quotes <code>'\&quot;'</code>, carets <code>'^'</code> or characters that need to be escaped.</p><pre>abc        ; a token for the atom &quot;abc&quot;
&quot;abc&quot;      ; a quoted token for the atom &quot;abc&quot;
&quot;abc; (d&quot;  ; a quoted token for the atom &quot;abc; (d&quot;
&quot;&quot;         ; the quoted token for the atom &quot;&quot;</pre><p>For atoms that do not need to be quoted, both their unquoted and quoted form represent the same string; e.g. the string <code>&quot;true&quot;</code> can be represented both by the atoms <em>true</em> and <em>&quot;true&quot;</em>. The empty string can only be represented in quoted form by <em>&quot;&quot;</em>.</p><p>In quoted form escapes are introduced by a caret <code>'^'</code>. Double quotes <code>'\&quot;'</code> and carets <code>'^'</code> must always be escaped.</p><pre>&quot;^^&quot;             ; atom for ^
&quot;^n&quot;             ; atom for line feed U+000A
&quot;^u\{0000\}&quot;       ; atom for U+0000
&quot;^&quot;^u\{1F42B\}^&quot;&quot;  ; atom with a quote, U+1F42B and a quote</pre><p>The following escape sequences are recognized:</p><ul><li><code>&quot;^ &quot;</code> (&lt;U+005E,U+0020&gt;) for space <code>' '</code> (U+0020)</li><li><code>&quot;^\&quot;&quot;</code> (&lt;U+005E,U+0022&gt;) for double quote <code>'\&quot;'</code> (U+0022) <b>mandatory</b></li><li><code>&quot;^^&quot;</code> (&lt;U+005E,U+005E&gt;) for caret <code>'^'</code> (U+005E) <b>mandatory</b></li><li><code>&quot;^n&quot;</code> (&lt;U+005E,U+006E&gt;) for line feed <code>'\n'</code> (U+000A)</li><li><code>&quot;^r&quot;</code> (&lt;U+005E,U+0072&gt;) for carriage return <code>'\r'</code> (U+000D)</li><li><code>&quot;^u{X}&quot;</code> with <code>X</code> is from 1 to at most 6 upper or lower case hexadecimal digits standing for the corresponding <a href="http://unicode.org/glossary/#unicode_scalar_value">Unicode character</a> U+X.</li><li>Any other character except line feed <code>'\n'</code> (U+000A) or carriage return <code>'\r'</code> (U+000D), following a caret is an illegal sequence of characters. In the two former cases the atom continues on the next line and white space is ignored.</li></ul><p>An atom in quoted form can be split across lines by using a caret <code>'^'</code> (U+005E) followed by a line feed <code>'\n'</code> (U+000A) or a carriage return <code>'\r'</code> (U+000D); any subsequent <a href="index.html#whitespace"><span>whitespace</span></a> is ignored.</p><pre>&quot;^
  a^
  ^ &quot; ; the atom &quot;a &quot;</pre><p>The character <code>'^'</code> (U+005E) is used as an escape character rather than the usual <code>'\\'</code> (U+005C) in order to make quoted Windows® file paths decently readable and, not the least, utterly please DKM.</p></header></section><section><header><h3 id="lists"><a href="#lists" class="anchor"></a>Lists</h3><p>Lists are delimited by left <code>'('</code> (U+0028) and right <code>')'</code> (U+0029) parentheses. Their elements are s-expressions separated by optional <a href="index.html#whitespace"><span>whitespace</span></a> and <a href="index.html#comments"><span>comments</span></a>. For example:</p><pre>(a list (of four) expressions)
(a list(of four)expressions)
(&quot;a&quot;list(&quot;of&quot;four)expressions)
(a list (of ; This is a comment
four) expressions)
() ; the empty list</pre></header></section><section><header><h3 id="grammar"><a href="#grammar" class="anchor"></a>S-expression grammar</h3><p>The following <a href="https://tools.ietf.org/html/rfc5234">RFC 5234</a> ABNF grammar is defined on a sequence of <a href="http://unicode.org/glossary/#unicode_scalar_value">Unicode characters</a>.</p><pre> sexp-seq = *(ws / comment / sexp)
     sexp = atom / list
     list = %x0028 sexp-seq %x0029
     atom = token / qtoken
    token = t-char *(t-char)
   qtoken = %x0022 *(q-char / escape / cont) %x0022
   escape = %x005E (%x0020 / %x0022 / %x005E / %x006E / %x0072 /
                    %x0075 %x007B unum %x007D)
     unum = 1*6(HEXDIG)
     cont = %x005E nl ws
       ws = *(ws-char)
  comment = %x003B *(c-char) nl
       nl = %x000A / %x000D / %x000D %x000A
   t-char = %x0021 / %x0023-0027 / %x002A-%x003A / %x003C-%x005D /
            %x005F-%x007E / %x0080-D7FF / %xE000-10FFFF
   q-char = t-char / ws-char / %x0028 / %x0029 / %x003B
  ws-char = %x0020 / %x0009 / %x000A / %x000B / %x000C / %x000D
   c-char = %x0009 / %x000B / %x000C / %x0020-D7FF / %xE000-10FFFF</pre><p>A few additional constraints not expressed by the grammar:</p><ul><li><code>unum</code> once interpreted as an hexadecimal number must be a <a href="http://unicode.org/glossary/#unicode_scalar_value">Unicode scalar value.</a></li><li>A comment can be ended by the end of the character sequence rather than <code>nl</code>.</li></ul></header></section></section></div></body></html>