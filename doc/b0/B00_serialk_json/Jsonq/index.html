<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Jsonq (b0.B00_serialk_json.Jsonq)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">b0</a> &#x00BB; <a href="../index.html">B00_serialk_json</a> &#x00BB; Jsonq</nav><header class="odoc-preamble"><h1>Module <code><span>B00_serialk_json.Jsonq</span></code></h1><p>JSON value queries.</p><p><b>TODO</b> maybe we could expose a bit more options for error reporting. In particular the internal <code>path</code> type and a combinator in the vein of <code>loc</code> to report back the path trace. Basically see <code>Serialk_sexp</code>.</p></header><nav class="odoc-toc"><ul><li><a href="#query">Queries</a></li><li><a href="#success">Success and failure</a></li><li><a href="#qcomb">Query combinators</a></li><li><a href="#json">JSON queries</a></li><li><a href="#nulls">Nulls</a></li><li><a href="#atoms">Atomic values</a></li><li><a href="#arrays">Arrays</a><ul><li><a href="#array_index">Array index queries</a></li></ul></li><li><a href="#objects">Objects</a></li></ul></nav><div class="odoc-content"><h2 id="query"><a href="#query" class="anchor"></a>Queries</h2><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p>The type JSON value queries. A query either fails or succeeds against a JSON value returning a value of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-query" class="anchored"><a href="#val-query" class="anchor"></a><code><span><span class="keyword">val</span> query : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Json/index.html#type-t">Json.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, string)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>query q j</code> is <code>Ok v</code> if que query <code>q</code> succeeds on <code>s</code> and a (multiline) <code>Error e</code> otherwise.</p></div></div><h2 id="success"><a href="#success" class="anchor"></a>Success and failure</h2><div class="odoc-spec"><div class="spec value" id="val-succeed" class="anchored"><a href="#val-succeed" class="anchor"></a><code><span><span class="keyword">val</span> succeed : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>succeed v</code> is a query that succeeds with value <code>v</code> on any JSON value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fail" class="anchored"><a href="#val-fail" class="anchor"></a><code><span><span class="keyword">val</span> fail : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>fail msg</code> is a query that fails on any JSON value with message <code>msg</code>. Do not include position information in <code>msg</code>, this is automatically handled by the module.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-failf" class="anchored"><a href="#val-failf" class="anchor"></a><code><span><span class="keyword">val</span> failf : <span><span><span>(<span class="type-var">'a</span>, <a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Format.formatter</a>, unit, <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <a href="../../../ocaml/Stdlib/index.html#type-format4">format4</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>failf fmt ...</code> is like <a href="#val-fail"><code>fail</code></a> but formats the message according to <code>fmt</code>.</p></div></div><h2 id="qcomb"><a href="#qcomb" class="anchor"></a>Query combinators</h2><div class="odoc-spec"><div class="spec value" id="val-app" class="anchored"><a href="#val-app" class="anchor"></a><code><span><span class="keyword">val</span> app : <span><span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>app fq q</code> queries a s-expression first with <code>fq</code> and then with <code>q</code> and applies the result of latter to the former.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-($)" class="anchored"><a href="#val-($)" class="anchor"></a><code><span><span class="keyword">val</span> ($) : <span><span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>f $ v</code> is <code>app f v</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pair" class="anchored"><a href="#val-pair" class="anchor"></a><code><span><span class="keyword">val</span> pair : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>pair q0 q1</code> queries first with <code>q0</code> and then with <code>q1</code> and returns the pair of their result.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bind" class="anchored"><a href="#val-bind" class="anchor"></a><code><span><span class="keyword">val</span> bind : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>bind q f</code> queries a s-expression with <code>q</code>, applies the result to <code>f</code> and re-queries the s-expression with the result.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-map" class="anchored"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>map f q</code> is <code>app (succeed f) q</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-some" class="anchored"><a href="#val-some" class="anchor"></a><code><span><span class="keyword">val</span> some : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>some q</code> is <code>map Option.some q</code>.</p></div></div><h2 id="json"><a href="#json" class="anchor"></a>JSON queries</h2><div class="odoc-spec"><div class="spec value" id="val-fold" class="anchored"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : <span>null:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>float:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>array:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>obj:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>fold</code> queries JSON values according to their kind using the provided queries.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-partial_fold" class="anchored"><a href="#val-partial_fold" class="anchor"></a><code><span><span class="keyword">val</span> partial_fold : <span>?null:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>?bool:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>?float:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>?string:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>?array:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
<span>?obj:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>partial_fold</code> is like <a href="#val-fold"><code>fold</code></a> but only queries the kinds that are explicitely specified. It errors on other kinds.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-json" class="anchored"><a href="#val-json" class="anchor"></a><code><span><span class="keyword">val</span> json : <span><a href="../Json/index.html#type-t">Json.t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>json</code> queries any JSON value and returns it.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-loc" class="anchored"><a href="#val-loc" class="anchor"></a><code><span><span class="keyword">val</span> loc : <span><a href="../Json/index.html#type-loc">Json.loc</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>loc</code>is <code>map Sexp.loc sexp</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_loc" class="anchored"><a href="#val-with_loc" class="anchor"></a><code><span><span class="keyword">val</span> with_loc : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <a href="../Json/index.html#type-loc">Json.loc</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>with_loc q</code> queries with <code>q</code> and returns the result with the location of the queried JSON value.</p></div></div><h2 id="nulls"><a href="#nulls" class="anchor"></a>Nulls</h2><div class="odoc-spec"><div class="spec value" id="val-is_null" class="anchored"><a href="#val-is_null" class="anchor"></a><code><span><span class="keyword">val</span> is_null : <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>is_null</code> tests for a JSON null value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-null" class="anchored"><a href="#val-null" class="anchor"></a><code><span><span class="keyword">val</span> null : <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>null</code> queries JSON null as unit and fails otherwise.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-nullable" class="anchored"><a href="#val-nullable" class="anchor"></a><code><span><span class="keyword">val</span> nullable : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>nullable q</code> is None on JSON null and otherwise queries the value with <code>q</code>.</p></div></div><h2 id="atoms"><a href="#atoms" class="anchor"></a>Atomic values</h2><div class="odoc-spec"><div class="spec value" id="val-bool" class="anchored"><a href="#val-bool" class="anchor"></a><code><span><span class="keyword">val</span> bool : <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>bool</code> queries JSON bool values as a <code>bool</code> value and fails otherwise.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-float" class="anchored"><a href="#val-float" class="anchor"></a><code><span><span class="keyword">val</span> float : <span>float <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>float</code> queries JSON number values as a <code>float</code> value and fails otherwise.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int" class="anchored"><a href="#val-int" class="anchor"></a><code><span><span class="keyword">val</span> int : <span>int <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>int</code> is <code>map truncate float</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string" class="anchored"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>string</code> queries JSON string values as a <code>string</code> value and fails otherwise.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string_to" class="anchored"><a href="#val-string_to" class="anchor"></a><code><span><span class="keyword">val</span> string_to : <span>kind:string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, string)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">result</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>string_to ~kind parse</code> queries a JSON string and parses it with <code>p</code>. In case of <code>Error m</code> error <a href="#val-fail"><code>fail</code></a>s with <code>m</code>. <code>kind</code> is the kind of value parsed, it is used for the error in case no JSON string is found.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-enum" class="anchored"><a href="#val-enum" class="anchor"></a><code><span><span class="keyword">val</span> enum : <span>kind:string <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../ocaml/Stdlib/Set/Make/index.html#type-t">Set.Make(String).t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>enum ~kind ss</code> queries a JSON string for one of the elements of <code>ss</code> and fails otherwise. <code>kind</code> is for the kind of elements in <code>ss</code>, it used for error reporting.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-enum_map" class="anchored"><a href="#val-enum_map" class="anchor"></a><code><span><span class="keyword">val</span> enum_map : <span>kind:string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../../../ocaml/Stdlib/Map/Make/index.html#type-t">Map.Make(String).t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>enum_map ~kind sm</code> queries a string for it's map in <code>sm</code> and fails if the string is not bound in <code>sm</code>. <code>kind</code> is for the kind elements in <code>sm</code>, it is used for error reporting.</p></div></div><h2 id="arrays"><a href="#arrays" class="anchor"></a>Arrays</h2><p>These queries only succeed on JSON array values.</p><div class="odoc-spec"><div class="spec value" id="val-is_empty_array" class="anchored"><a href="#val-is_empty_array" class="anchor"></a><code><span><span class="keyword">val</span> is_empty_array : <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>is_empty_array</code> queries an array for emptyness.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-hd" class="anchored"><a href="#val-hd" class="anchor"></a><code><span><span class="keyword">val</span> hd : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>hd q</code> queries the first element of an array with <code>q</code>. Fails on empty arrays.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tl" class="anchored"><a href="#val-tl" class="anchor"></a><code><span><span class="keyword">val</span> tl : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>tail q</code> queries the tail of an array with <code>q</code>. Fails on empty arrays.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fold_array" class="anchored"><a href="#val-fold_array" class="anchor"></a><code><span><span class="keyword">val</span> fold_array : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>fold_array f q acc</code> queries the elements of an array from left to right with <code>q</code> and folds the result with <code>f</code> starting with <code>acc</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-array" class="anchored"><a href="#val-array" class="anchor"></a><code><span><span class="keyword">val</span> array : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>array q</code> queries the elements of an array with <code>q</code>.</p></div></div><h3 id="array_index"><a href="#array_index" class="anchor"></a>Array index queries</h3><div class="odoc-spec"><div class="spec value" id="val-nth" class="anchored"><a href="#val-nth" class="anchor"></a><code><span><span class="keyword">val</span> nth : <span>?absent:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>nth ?absent n q</code> queries the <code>n</code>th element of an array with <code>q</code>. If <code>n</code> is negative counts from the end of the array, so <code>-1</code> is the last array element. If the element does not exist this fails if <code>absent</code> is <code>None</code> and succeeds with <code>v</code> if <code>absent</code> is <code>Some v</code>.</p></div></div><h2 id="objects"><a href="#objects" class="anchor"></a>Objects</h2><p>These queries only succeed on JSON object values.</p><div class="odoc-spec"><div class="spec value" id="val-mem" class="anchored"><a href="#val-mem" class="anchor"></a><code><span><span class="keyword">val</span> mem : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>mem n q</code> queries the member <code>n</code> of a JSON object with <code>q</code>. The query fails if <code>n</code> is unbound in the object.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-opt_mem" class="anchored"><a href="#val-opt_mem" class="anchor"></a><code><span><span class="keyword">val</span> opt_mem : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>absent:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>opt_mem n q ~absent</code> queries the member <code>n</code> of a JSON object with <code>q</code>. absent is returned if <code>n</code> is unbound in the object.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mem_dom" class="anchored"><a href="#val-mem_dom" class="anchor"></a><code><span><span class="keyword">val</span> mem_dom : <span>validate:<span><a href="../../../ocaml/Stdlib/Set/Make/index.html#type-t">Set.Make(String).t</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../ocaml/Stdlib/Set/Make/index.html#type-t">Set.Make(String).t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>mem_dom ~validate</code> queries the member domain of a JSON object. If <code>validate</code> is <code>Some dom</code>, the query fails if a member name is not in <code>dom</code>.</p></div></div></div></body></html>