<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Choice (choice.Choice)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">choice</a> &#x00BB; Choice</nav><h1>Module <code>Choice</code></h1><h2 id="backtracking-monad"><a href="#backtracking-monad" class="anchor"></a>Backtracking monad</h2><nav class="toc"><ul><li><a href="#example">Example</a></li><li><a href="#combinators">Combinators</a></li><li><a href="#enumerate-solutions">Enumerate solutions</a></li><li><a href="#monadic-operators">Monadic operators</a></li><li><a href="#infix-operators">Infix operators</a></li><li><a href="#enumerator">Enumerator</a></li><li><a href="#more-complex-combinators">More complex Combinators</a></li></ul></nav></header><aside><p>This is an attempt to implement the Logic monad, as described in <a href="http://hackage.haskell.org/packages/archive/logict/0.2.3/doc/html/Control-Monad-Logic.html">this Haskell library</a> or in <a href="http://www.cs.rutgers.edu/~ccshan/logicprog/LogicT-icfp2005.pdf">this paper</a>.</p><p>Some design choices are slightly different, since OCaml is strict. Performance may also vary from ghc-compiled code, since it performs some optimizations like deforestation.</p></aside><section><header><h4 id="example"><a href="#example" class="anchor"></a>Example</h4><p>We adapt the example from the LogicT paper.</p><pre><code class="ml">let rec insert e l = match l with
        | [] -&gt; return [e]
        | x::l' -&gt;
          mplus
            (return (e :: l))
            (insert e l' &gt;&gt;= fun l'' -&gt; return (x :: l''));;

      let rec permute = function
        | [] -&gt; return []
        | x::l -&gt;
          permute l &gt;&gt;= fun l' -&gt;
          insert x l';;

      let rec sorted l = match l with
        | [] | [_] -&gt; true
        | x::((y::l') as l) -&gt;
          x &lt;= y &amp;&amp; sorted l;;

      let bogosort l =
        once (filter sorted (permute l));;</code></pre><p>Then, running</p><pre><code class="ml">run_n 1 (bogosort [2;3;5;1;0]);; </code></pre><p>yields</p><pre><code class="ml">- : int list list = [[0; 1; 2; 3; 5]] </code></pre></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> 'a t</code></dt><dd><p>A choice among values of type 'a</p></dd></dl><dl><dt class="spec type" id="type-choice"><a href="#type-choice" class="anchor"></a><code><span class="keyword">type</span> 'a choice</code><code> = <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt></dl></section><section><header><h3 id="combinators"><a href="#combinators" class="anchor"></a>Combinators</h3></header><dl><dt class="spec value" id="val-return"><a href="#val-return" class="anchor"></a><code><span class="keyword">val</span> return : <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Return a value, and succeed</p></dd></dl><dl><dt class="spec value" id="val-of_list"><a href="#val-of_list" class="anchor"></a><code><span class="keyword">val</span> of_list : <span class="type-var">'a</span> list <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Multiple returns. Each element of the list is a candidate for success.</p></dd></dl><dl><dt class="spec value" id="val-from_fun"><a href="#val-from_fun" class="anchor"></a><code><span class="keyword">val</span> from_fun : (unit <span>&#45;&gt;</span> <span class="type-var">'a</span> option) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Call the function to get alternative choices. Example:</p><pre><code class="ml">let r = ref 0 in Choice.run_n 10
        (Choice.filter
           (Choice.from_fun (fun () -&gt; incr r; Some !r)) (fun x -&gt; x mod 3 = 0));;</code></pre><p>yields</p><pre><code class="ml">- : int list = [30; 27; 24; 21; 18; 15; 12; 9; 6; 3] </code></pre></dd></dl><dl><dt class="spec value" id="val-delay"><a href="#val-delay" class="anchor"></a><code><span class="keyword">val</span> delay : (unit <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Delay the computation (the closure will be called in each branch that uses the choice point</p></dd></dl><dl><dt class="spec value" id="val-fail"><a href="#val-fail" class="anchor"></a><code><span class="keyword">val</span> fail : <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Fail to yield a solution.</p></dd></dl><dl><dt class="spec value" id="val-guard"><a href="#val-guard" class="anchor"></a><code><span class="keyword">val</span> guard : bool <span>&#45;&gt;</span> unit <a href="index.html#type-t">t</a></code></dt><dd><p>Fails if condition does not hold</p><dl><dt>since</dt><dd>NEXT_RELEASE</dd></dl></dd></dl><dl><dt class="spec value" id="val-cons"><a href="#val-cons" class="anchor"></a><code><span class="keyword">val</span> cons : <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>cons x c</code> is a shortcut for <code>return x ++ c</code></p></dd></dl><dl><dt class="spec value" id="val-mplus"><a href="#val-mplus" class="anchor"></a><code><span class="keyword">val</span> mplus : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>mplus a b</code> enumerates choices from <code>a</code>, then choices from <code>b</code>.</p></dd></dl><dl><dt class="spec value" id="val-bind"><a href="#val-bind" class="anchor"></a><code><span class="keyword">val</span> bind : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Monadic bind. Each solution of the first argument is given to the function, that may in turn return several choices.</p></dd></dl><dl><dt class="spec value" id="val-interleave"><a href="#val-interleave" class="anchor"></a><code><span class="keyword">val</span> interleave : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Same as <a href="index.html#val-mplus"><code>mplus</code></a>, but fair, ie it enumerates solutions alternatively from its first and second arguments.</p></dd></dl><dl><dt class="spec value" id="val-fair_bind"><a href="#val-fair_bind" class="anchor"></a><code><span class="keyword">val</span> fair_bind : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Fair version of <a href="index.html#val-bind"><code>bind</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-ite"><a href="#val-ite" class="anchor"></a><code><span class="keyword">val</span> ite : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a>) <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>ite cond th el</code> enumerates the choices of <code>cond</code>. If <code>cond</code> fails, then it behaves like <code>el</code>, otherwise each solution of <code>cond</code> is given to <code>th</code>.</p></dd></dl><dl><dt class="spec value" id="val-map"><a href="#val-map" class="anchor"></a><code><span class="keyword">val</span> map : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Map solutions to other solutions</p></dd></dl><dl><dt class="spec value" id="val-product"><a href="#val-product" class="anchor"></a><code><span class="keyword">val</span> product : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> * <span class="type-var">'b</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Cartesian product of two choices</p></dd></dl><dl><dt class="spec value" id="val-fmap"><a href="#val-fmap" class="anchor"></a><code><span class="keyword">val</span> fmap : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> option) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Special case of <a href="index.html#val-bind"><code>bind</code></a>, with only zero or one possible output choices for each input choice.</p></dd></dl><dl><dt class="spec value" id="val-filter"><a href="#val-filter" class="anchor"></a><code><span class="keyword">val</span> filter : (<span class="type-var">'a</span> <span>&#45;&gt;</span> bool) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Only keep the solutions that satisfy the given predicate.</p></dd></dl><dl><dt class="spec value" id="val-once"><a href="#val-once" class="anchor"></a><code><span class="keyword">val</span> once : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Retain at most one solution (drop alternatives).</p></dd></dl><dl><dt class="spec value" id="val-take"><a href="#val-take" class="anchor"></a><code><span class="keyword">val</span> take : int <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Retain at most <code>n</code> solutions</p></dd></dl></section><section><header><h3 id="enumerate-solutions"><a href="#enumerate-solutions" class="anchor"></a>Enumerate solutions</h3></header><dl><dt class="spec value" id="val-run_one"><a href="#val-run_one" class="anchor"></a><code><span class="keyword">val</span> run_one : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> option</code></dt><dd><p>Run until we get one answer (or a failure)</p></dd></dl><dl><dt class="spec value" id="val-run_n"><a href="#val-run_n" class="anchor"></a><code><span class="keyword">val</span> run_n : int <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> list</code></dt><dd><p>The <code>n</code> first solutions, in <b>reverse</b> order.</p></dd></dl><dl><dt class="spec value" id="val-run_all"><a href="#val-run_all" class="anchor"></a><code><span class="keyword">val</span> run_all : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> list</code></dt><dd><p>All the solutions (in reverse order)</p></dd></dl><dl><dt class="spec value" id="val-to_list"><a href="#val-to_list" class="anchor"></a><code><span class="keyword">val</span> to_list : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> list</code></dt><dd><p>All the solutions (in correct order)</p></dd></dl><dl><dt class="spec value" id="val-iter"><a href="#val-iter" class="anchor"></a><code><span class="keyword">val</span> iter : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> bool) <span>&#45;&gt;</span> unit</code></dt><dd><p>Enumerate solutions, until none remains, or the callback returns <code>false</code> to signal it has had enough solutions</p></dd></dl><dl><dt class="spec value" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span class="keyword">val</span> fold : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Fold over all solutions</p></dd></dl><dl><dt class="spec value" id="val-count"><a href="#val-count" class="anchor"></a><code><span class="keyword">val</span> count : <span class="type-var">_</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Number of solutions</p></dd></dl><dl><dt class="spec value" id="val-is_empty"><a href="#val-is_empty" class="anchor"></a><code><span class="keyword">val</span> is_empty : <span class="type-var">_</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>return <code>true</code> iff the alternative stream is empty (failure)</p></dd></dl><dl><dt class="spec value" id="val-forall"><a href="#val-forall" class="anchor"></a><code><span class="keyword">val</span> forall : bool <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-exists"><a href="#val-exists" class="anchor"></a><code><span class="keyword">val</span> exists : bool <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt></dl></section><section><header><h3 id="monadic-operators"><a href="#monadic-operators" class="anchor"></a>Monadic operators</h3></header><dl><dt class="spec value" id="val-lift"><a href="#val-lift" class="anchor"></a><code><span class="keyword">val</span> lift : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-lift2"><a href="#val-lift2" class="anchor"></a><code><span class="keyword">val</span> lift2 : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'c</span> <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-liftFair"><a href="#val-liftFair" class="anchor"></a><code><span class="keyword">val</span> liftFair : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-liftFair2"><a href="#val-liftFair2" class="anchor"></a><code><span class="keyword">val</span> liftFair2 : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'c</span> <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-pure"><a href="#val-pure" class="anchor"></a><code><span class="keyword">val</span> pure : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-app"><a href="#val-app" class="anchor"></a><code><span class="keyword">val</span> app : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Applicative instance</p></dd></dl><dl><dt class="spec value" id="val-($$)"><a href="#val-($$)" class="anchor"></a><code><span class="keyword">val</span> ($$) : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Shortcut for <a href="index.html#val-app"><code>app</code></a></p></dd></dl></section><section><header><h3 id="infix-operators"><a href="#infix-operators" class="anchor"></a>Infix operators</h3></header><dl><dt class="spec value" id="val-(&gt;&gt;=)"><a href="#val-(&gt;&gt;=)" class="anchor"></a><code><span class="keyword">val</span> (&gt;&gt;=) : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a>) <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Infix version of <a href="index.html#val-bind"><code>bind</code></a></p></dd></dl><dl><dt class="spec value" id="val-(&gt;&gt;-)"><a href="#val-(&gt;&gt;-)" class="anchor"></a><code><span class="keyword">val</span> (&gt;&gt;-) : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a>) <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Infix version of <a href="index.html#val-fair_bind"><code>fair_bind</code></a></p></dd></dl><dl><dt class="spec value" id="val-(++)"><a href="#val-(++)" class="anchor"></a><code><span class="keyword">val</span> (++) : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Infix version of <a href="index.html#val-mplus"><code>mplus</code></a></p></dd></dl><dl><dt class="spec value" id="val-(&lt;|&gt;)"><a href="#val-(&lt;|&gt;)" class="anchor"></a><code><span class="keyword">val</span> (&lt;|&gt;) : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Infix version of <a href="index.html#val-interleave"><code>interleave</code></a></p></dd></dl></section><section><header><h3 id="enumerator"><a href="#enumerator" class="anchor"></a>Enumerator</h3></header><div class="spec module" id="module-Enum"><a href="#module-Enum" class="anchor"></a><code><span class="keyword">module</span> <a href="Enum/index.html">Enum</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section><section><header><h3 id="more-complex-combinators"><a href="#more-complex-combinators" class="anchor"></a>More complex Combinators</h3></header><div class="spec module" id="module-List"><a href="#module-List" class="anchor"></a><code><span class="keyword">module</span> <a href="List/index.html">List</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Array"><a href="#module-Array" class="anchor"></a><code><span class="keyword">module</span> <a href="Array/index.html">Array</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section></div></body></html>