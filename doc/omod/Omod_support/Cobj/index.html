<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Cobj (omod.Omod_support.Cobj)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">omod</a> &#x00BB; <a href="../index.html">Omod_support</a> &#x00BB; Cobj</nav><header class="odoc-preamble"><h1>Module <code><span>Omod_support.Cobj</span></code></h1><p>Compilation objects</p></header><nav class="odoc-toc"><ul><li><a href="#pkg_ids">Package identifiers</a></li><li><a href="#deps">Dependencies</a></li><li><a href="#specs">Specifications</a></li><li><a href="#cobjs">Compilation objects</a></li><li><a href="#pred">Predicates</a></li><li><a href="#fmt">Formatters</a></li><li><a href="#indexes-and-dependency-resolvers">Indexes and dependency resolvers</a></li></ul></nav><div class="odoc-content"><h2 id="pkg_ids"><a href="#pkg_ids" class="anchor"></a>Package identifiers</h2><div class="odoc-spec"><div class="spec type" id="type-pkg_id" class="anchored"><a href="#type-pkg_id" class="anchor"></a><code><span><span class="keyword">type</span> pkg_id</span><span> = string * <a href="../../Omod/index.html#type-fpath">Omod.fpath</a></span></code></div><div class="spec-doc"><p>The type for package identifiers. A package name and its root directory.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pp_pkg_id" class="anchored"><a href="#val-pp_pkg_id" class="anchor"></a><code><span><span class="keyword">val</span> pp_pkg_id : <span><a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-pkg_id">pkg_id</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>pp_pkg_id</code> formats package identifiers.</p></div></div><h2 id="deps"><a href="#deps" class="anchor"></a>Dependencies</h2><div class="odoc-spec"><div class="spec type" id="type-dep" class="anchored"><a href="#type-dep" class="anchor"></a><code><span><span class="keyword">type</span> dep</span><span> = string * <span><a href="../Digest/index.html#type-t">Digest.t</a> option</span></span></code></div><div class="spec-doc"><p>The type for compilation object dependencies. A module name and an optional interface digest.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pp_dep" class="anchored"><a href="#val-pp_dep" class="anchor"></a><code><span><span class="keyword">val</span> pp_dep : <span><a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-dep">dep</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>pp_dep</code> formats a dependency.</p></div></div><h2 id="specs"><a href="#specs" class="anchor"></a>Specifications</h2><div class="odoc-spec"><div class="spec value" id="val-spec_of_string" class="anchored"><a href="#val-spec_of_string" class="anchor"></a><code><span><span class="keyword">val</span> spec_of_string : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string option</span> * string * <span>string list</span>, string)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>spec_of_string s</code> parses a compilation object specification from <code>s</code>. This parses the <code>[PKG.]M(\@VARIANT)+</code> syntax.</p></div></div><h2 id="cobjs"><a href="#cobjs" class="anchor"></a>Compilation objects</h2><div class="odoc-spec"><div class="spec type" id="type-kind" class="anchored"><a href="#type-kind" class="anchor"></a><code><span><span class="keyword">type</span> kind</span><span> = </span></code><table><tr id="type-kind.Cmi" class="anchored"><td class="def variant constructor"><a href="#type-kind.Cmi" class="anchor"></a><code><span>| </span><span><span class="constructor">Cmi</span></span></code></td></tr><tr id="type-kind.Cmo" class="anchored"><td class="def variant constructor"><a href="#type-kind.Cmo" class="anchor"></a><code><span>| </span><span><span class="constructor">Cmo</span></span></code></td></tr><tr id="type-kind.Cmx" class="anchored"><td class="def variant constructor"><a href="#type-kind.Cmx" class="anchor"></a><code><span>| </span><span><span class="constructor">Cmx</span></span></code></td></tr></table></div><div class="spec-doc"><p>The type for kind of compilation objects.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-kind_of_string" class="anchored"><a href="#val-kind_of_string" class="anchor"></a><code><span><span class="keyword">val</span> kind_of_string : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-kind">kind</a> option</span></span></code></div><div class="spec-doc"><p><code>kind_of_string s</code> parses <code>s</code> into a kind.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-kind_to_string" class="anchored"><a href="#val-kind_to_string" class="anchor"></a><code><span><span class="keyword">val</span> kind_to_string : <span><a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>kind_to_string k</code> is <code>k</code> as a string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-exts" class="anchored"><a href="#val-exts" class="anchor"></a><code><span><span class="keyword">val</span> exts : <a href="../../Omod/Private/String/Set/index.html#type-t">Omod.Private.String.Set.t</a></span></code></div><div class="spec-doc"><p><code>exts</code> are the file extensions of compilation objects.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type for compilation objects.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-v" class="anchored"><a href="#val-v" class="anchor"></a><code><span><span class="keyword">val</span> v : <span>kind:<a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span> <span>pkg_id:<a href="#type-pkg_id">pkg_id</a> <span class="arrow">&#45;&gt;</span></span> <span>name:string <span class="arrow">&#45;&gt;</span></span> <span>iface_digest:<span><a href="../Digest/index.html#type-t">Digest.t</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span>iface_deps:<span><a href="#type-dep">dep</a> list</span> <span class="arrow">&#45;&gt;</span></span>
<span>in_archive:bool <span class="arrow">&#45;&gt;</span></span> <span>path:<a href="../../Omod/index.html#type-fpath">Omod.fpath</a> <span class="arrow">&#45;&gt;</span></span> <span>path_loads:<span><span><a href="#type-t">t</a> list</span> <a href="../../../ocaml/Stdlib/Lazy/index.html#type-t">Lazy.t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>v</code> is a compilation object with the given parameters, see the documentation of accessors for semantics.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-add_file" class="anchored"><a href="#val-add_file" class="anchor"></a><code><span><span class="keyword">val</span> add_file : <span>pkg_id:<a href="#type-pkg_id">pkg_id</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Omod/index.html#type-fpath">Omod.fpath</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-t">t</a> list</span>, string)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>add_file ~pkg_id acc f</code> adds the compilation objects of file <code>f</code> in package <code>pkg_id</code> to <code>acc</code>. If <code>f</code>'s extension doesn't match a supported compilation object file this is <code>acc</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-kind" class="anchored"><a href="#val-kind" class="anchor"></a><code><span><span class="keyword">val</span> kind : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-kind">kind</a></span></code></div><div class="spec-doc"><p><code>kind c</code> is <code>c</code>'s <a href="#type-kind">kind</a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pkg_id" class="anchored"><a href="#val-pkg_id" class="anchor"></a><code><span><span class="keyword">val</span> pkg_id : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-pkg_id">pkg_id</a></span></code></div><div class="spec-doc"><p><code>pkg_id c</code> is <code>c</code>'s package identifier.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-name" class="anchored"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>name c</code> is <code>c</code>'s capitalized module name (more precisely compilation unit name).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-variant" class="anchored"><a href="#val-variant" class="anchor"></a><code><span><span class="keyword">val</span> variant : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>variant c</code> is <code>c</code>'s variant.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-iface_digest" class="anchored"><a href="#val-iface_digest" class="anchor"></a><code><span><span class="keyword">val</span> iface_digest : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Digest/index.html#type-t">Digest.t</a> option</span></span></code></div><div class="spec-doc"><p><code>iface_digest c</code> is <code>c</code>'s interface digest (if any).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-iface_deps" class="anchored"><a href="#val-iface_deps" class="anchor"></a><code><span><span class="keyword">val</span> iface_deps : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-dep">dep</a> list</span></span></code></div><div class="spec-doc"><p><code>iface_deps c</code> is <code>c</code>'s interface dependencies.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-in_archive" class="anchored"><a href="#val-in_archive" class="anchor"></a><code><span><span class="keyword">val</span> in_archive : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>in_archive c</code> is <code>true</code> if <a href="#val-path"><code>path</code></a> is an object archive.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-path" class="anchored"><a href="#val-path" class="anchor"></a><code><span><span class="keyword">val</span> path : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Omod/index.html#type-fpath">Omod.fpath</a></span></code></div><div class="spec-doc"><p><code>path c</code> is <code>c</code>'s file path.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-path_loads" class="anchored"><a href="#val-path_loads" class="anchor"></a><code><span><span class="keyword">val</span> path_loads : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p><code>path_loads c</code> are all the objects that are loaded whenever <a href="#val-path"><code>path</code></a> is loaded (includes <code>c</code> itself). For paths that point to archives this has all the objects of the archive.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-to_dep" class="anchored"><a href="#val-to_dep" class="anchor"></a><code><span><span class="keyword">val</span> to_dep : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-dep">dep</a></span></code></div><div class="spec-doc"><p><code>to_dep c</code> is <code>c</code> as an interface dependency.</p></div></div><h2 id="pred"><a href="#pred" class="anchor"></a>Predicates</h2><div class="odoc-spec"><div class="spec value" id="val-is_kind" class="anchored"><a href="#val-is_kind" class="anchor"></a><code><span><span class="keyword">val</span> is_kind : <span><a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_kind k c</code> is <code>true</code> iff <code>kind c = k</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-equal" class="anchored"><a href="#val-equal" class="anchor"></a><code><span><span class="keyword">val</span> equal : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>equal c c'</code> tests <code>c</code> and <code>c'</code> for equality (all components must match).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-compare" class="anchored"><a href="#val-compare" class="anchor"></a><code><span><span class="keyword">val</span> compare : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>compare</code> is a total order compatible with <a href="#val-equal"><code>equal</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-ui_compare" class="anchored"><a href="#val-ui_compare" class="anchor"></a><code><span><span class="keyword">val</span> ui_compare : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>ui_compare</code> orders by name, package, variant and path.</p></div></div><h2 id="fmt"><a href="#fmt" class="anchor"></a>Formatters</h2><div class="odoc-spec"><div class="spec value" id="val-pp" class="anchored"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>pp</code> formats a compilation object.</p></div></div><h2 id="indexes-and-dependency-resolvers"><a href="#indexes-and-dependency-resolvers" class="anchor"></a>Indexes and dependency resolvers</h2><div class="odoc-spec"><div class="spec module" id="module-Index" class="anchored"><a href="#module-Index" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Index/index.html">Index</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Compilation object indexes.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-res" class="anchored"><a href="#type-res" class="anchor"></a><code><span><span class="keyword">type</span> res</span><span> = <span><a href="#type-t">t</a> <a href="../../Omod/Private/String/Map/index.html#type-t">Omod.Private.String.Map.t</a></span></span></code></div><div class="spec-doc"><p>The type for dependency resolutions. Maps module names to their resolved object.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-resolve_deps" class="anchored"><a href="#val-resolve_deps" class="anchor"></a><code><span><span class="keyword">val</span> resolve_deps : <span>variants:<a href="../../Omod/Private/String/Set/index.html#type-t">Omod.Private.String.Set.t</a> <span class="arrow">&#45;&gt;</span></span> <span>sat:<span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span>kind:<a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Index/index.html#type-t">Index.t</a> <span class="arrow">&#45;&gt;</span></span> <span>root_alts:<span><span><a href="#type-t">t</a> list</span> list</span> <span class="arrow">&#45;&gt;</span></span>
<span><span>(<span><a href="#type-res">res</a> list</span>, string)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>resolve_deps ~variants ~sat ~kind i roots</code> is a list of resolutions that recursively resolve the dependencies of the alternative root object roots <code>root_alts</code> to compilation objects of kind <code>kind</code> and satisfying <code>sat</code> using the twists of <a href="Index/index.html#val-cobjs_for_dep_res"><code>Index.cobjs_for_dep_res</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fold_res" class="anchored"><a href="#val-fold_res" class="anchor"></a><code><span><span class="keyword">val</span> fold_res : <span><a href="#type-res">res</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>fold_res res f acc</code> folds <code>f</code> with <code>acc</code> over the partial dependency order of <code>res</code> </p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if the dependencies of objects in <code>res</code> are not defined in <code>res</code>, this can't happen if the map is a result of <code>resolve_deps</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-loads" class="anchored"><a href="#val-loads" class="anchor"></a><code><span><span class="keyword">val</span> loads : <span>variants:<a href="../../Omod/Private/String/Set/index.html#type-t">Omod.Private.String.Set.t</a> <span class="arrow">&#45;&gt;</span></span> <span>sat:<span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span>kind:<a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Index/index.html#type-t">Index.t</a> <span class="arrow">&#45;&gt;</span></span> <span>root_alts:<span><span><a href="#type-t">t</a> list</span> list</span> <span class="arrow">&#45;&gt;</span></span>
<span><span>(<span><span><a href="../../Omod/index.html#type-fpath">Omod.fpath</a> list</span> list</span>, string)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>loads ~sat ~kind i root_alts</code> resolves the alternative root objects roots <code>root_alts</code> to alternative load sequences of object paths of that have objects of kind <code>kind</code> or <code>Cmi</code>s (mli-only modules). All the objects involved in the load sequence satisfy <code>sat</code>.</p></div></div></div></body></html>