<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamProcess (opam-core.OpamProcess)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">opam-core</a> &#x00BB; OpamProcess</nav><h1>Module <code>OpamProcess</code></h1><p>Process and job handling, with logs, termination status, etc.</p><nav class="toc"><ul><li><a href="#misc">Misc</a></li></ul></nav></header><dl><dt class="spec type" id="type-command"><a href="#type-command" class="anchor"></a><code><span class="keyword">type</span> command</code></dt><dd><p>The type of shell commands</p></dd></dl><dl><dt class="spec value" id="val-command"><a href="#val-command" class="anchor"></a><code><span class="keyword">val</span> command : ?&#8288;env:string array <span>&#45;&gt;</span> ?&#8288;verbose:bool <span>&#45;&gt;</span> ?&#8288;name:string <span>&#45;&gt;</span> ?&#8288;metadata:(string * string) list <span>&#45;&gt;</span> ?&#8288;dir:string <span>&#45;&gt;</span> ?&#8288;allow_stdin:bool <span>&#45;&gt;</span> ?&#8288;stdout:string <span>&#45;&gt;</span> ?&#8288;text:string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> <a href="index.html#type-command">command</a></code></dt><dd><p>Builds a shell command for later execution.</p><dl><dt>parameter env</dt><dd><p>environment for the command</p></dd></dl><dl><dt>parameter verbose</dt><dd><p>force verbosity</p></dd></dl><dl><dt>parameter name</dt><dd><p>title, used to name log files, etc.</p></dd></dl><dl><dt>parameter metadata</dt><dd><p>additional info to log</p></dd></dl><dl><dt>parameter dir</dt><dd><p>CWD for the command</p></dd></dl><dl><dt>parameter allow_stdin</dt><dd><p>whether to forward stdin</p></dd></dl><dl><dt>parameter stdout</dt><dd><p>redirect stdout to the given file instead of the logs</p></dd></dl><dl><dt>parameter text</dt><dd><p>Short text that may be displayed in the status-line</p></dd></dl><dl><dt>parameter command</dt><dd><p>The command itself</p></dd></dl><dl><dt>parameter args</dt><dd><p>Command-line arguments</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-string_of_command"><a href="#val-string_of_command" class="anchor"></a><code><span class="keyword">val</span> string_of_command : <a href="index.html#type-command">command</a> <span>&#45;&gt;</span> string</code></dt><dt class="spec value" id="val-text_of_command"><a href="#val-text_of_command" class="anchor"></a><code><span class="keyword">val</span> text_of_command : <a href="index.html#type-command">command</a> <span>&#45;&gt;</span> string option</code></dt><dt class="spec value" id="val-is_verbose_command"><a href="#val-is_verbose_command" class="anchor"></a><code><span class="keyword">val</span> is_verbose_command : <a href="index.html#type-command">command</a> <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-make_command_text"><a href="#val-make_command_text" class="anchor"></a><code><span class="keyword">val</span> make_command_text : ?&#8288;color:<a href="../OpamConsole/index.html#type-text_style">OpamConsole.text_style</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> ?&#8288;args:string list <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string</code></dt><dd><p>Returns a label suitable for printing the summary of running commands. First string is the topic (e.g. package), second the action (e.g. command name). Optional command arguments may be used for details (e.g. make action).</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code><code> = </code><code>{</code><table class="record"><tr id="type-t.p_name" class="anchored"><td class="def field"><a href="#type-t.p_name" class="anchor"></a><code>p_name : string;</code></td><td class="doc"><p>Command name</p></td></tr><tr id="type-t.p_args" class="anchored"><td class="def field"><a href="#type-t.p_args" class="anchor"></a><code>p_args : string list;</code></td><td class="doc"><p>Command args</p></td></tr><tr id="type-t.p_pid" class="anchored"><td class="def field"><a href="#type-t.p_pid" class="anchor"></a><code>p_pid : int;</code></td><td class="doc"><p>Process PID</p></td></tr><tr id="type-t.p_cwd" class="anchored"><td class="def field"><a href="#type-t.p_cwd" class="anchor"></a><code>p_cwd : string;</code></td><td class="doc"><p>Process initial working directory</p></td></tr><tr id="type-t.p_time" class="anchored"><td class="def field"><a href="#type-t.p_time" class="anchor"></a><code>p_time : float;</code></td><td class="doc"><p>Process start time</p></td></tr><tr id="type-t.p_stdout" class="anchored"><td class="def field"><a href="#type-t.p_stdout" class="anchor"></a><code>p_stdout : string option;</code></td><td class="doc"><p>stdout dump file</p></td></tr><tr id="type-t.p_stderr" class="anchored"><td class="def field"><a href="#type-t.p_stderr" class="anchor"></a><code>p_stderr : string option;</code></td><td class="doc"><p>stderr dump file</p></td></tr><tr id="type-t.p_env" class="anchored"><td class="def field"><a href="#type-t.p_env" class="anchor"></a><code>p_env : string option;</code></td><td class="doc"><p>dump environment variables</p></td></tr><tr id="type-t.p_info" class="anchored"><td class="def field"><a href="#type-t.p_info" class="anchor"></a><code>p_info : string option;</code></td><td class="doc"><p>dump process info</p></td></tr><tr id="type-t.p_metadata" class="anchored"><td class="def field"><a href="#type-t.p_metadata" class="anchor"></a><code>p_metadata : (string * string) list;</code></td><td class="doc"><p>Metadata associated to the process</p></td></tr><tr id="type-t.p_verbose" class="anchored"><td class="def field"><a href="#type-t.p_verbose" class="anchor"></a><code>p_verbose : bool;</code></td><td class="doc"><p>whether output of the process should be displayed</p></td></tr><tr id="type-t.p_tmp_files" class="anchored"><td class="def field"><a href="#type-t.p_tmp_files" class="anchor"></a><code>p_tmp_files : string list;</code></td><td class="doc"><p>temporary files that should be cleaned up upon completion</p></td></tr></table><code>}</code></dt><dd><p>The type for processes</p></dd></dl><dl><dt class="spec type" id="type-result"><a href="#type-result" class="anchor"></a><code><span class="keyword">type</span> result</code><code> = </code><code>{</code><table class="record"><tr id="type-result.r_code" class="anchored"><td class="def field"><a href="#type-result.r_code" class="anchor"></a><code>r_code : int;</code></td><td class="doc"><p>Process exit code, or 256 on error</p></td></tr><tr id="type-result.r_signal" class="anchored"><td class="def field"><a href="#type-result.r_signal" class="anchor"></a><code>r_signal : int option;</code></td><td class="doc"><p>Signal received if the processed was killed</p></td></tr><tr id="type-result.r_duration" class="anchored"><td class="def field"><a href="#type-result.r_duration" class="anchor"></a><code>r_duration : float;</code></td><td class="doc"><p>Process duration</p></td></tr><tr id="type-result.r_info" class="anchored"><td class="def field"><a href="#type-result.r_info" class="anchor"></a><code>r_info : (string * string) list;</code></td><td class="doc"><p>Process info</p></td></tr><tr id="type-result.r_stdout" class="anchored"><td class="def field"><a href="#type-result.r_stdout" class="anchor"></a><code>r_stdout : string list;</code></td><td class="doc"><p>Content of stdout dump file</p></td></tr><tr id="type-result.r_stderr" class="anchored"><td class="def field"><a href="#type-result.r_stderr" class="anchor"></a><code>r_stderr : string list;</code></td><td class="doc"><p>Content of stderr dump file</p></td></tr><tr id="type-result.r_cleanup" class="anchored"><td class="def field"><a href="#type-result.r_cleanup" class="anchor"></a><code>r_cleanup : string list;</code></td><td class="doc"><p>List of files to clean-up</p></td></tr></table><code>}</code></dt><dd><p>Process results</p></dd></dl><dl><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val</span> run : <a href="index.html#type-command">command</a> <span>&#45;&gt;</span> <a href="index.html#type-result">result</a></code></dt><dd><p><code>run command</code> synchronously call the command <code>command.cmd</code> with arguments <code>command.args</code>. It waits until the process is finished. The files <code>name.info</code>, <code>name.env</code>, <code>name.out</code> and <code>name.err</code>, with <code>name = command.cmd_name</code> are created, and contain the process main description, the environment variables, the standard output and the standard error. Don't forget to call <code>cleanup result</code> afterwards</p></dd></dl><dl><dt class="spec value" id="val-run_background"><a href="#val-run_background" class="anchor"></a><code><span class="keyword">val</span> run_background : <a href="index.html#type-command">command</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Same as <code>run</code>, but doesn't wait. Use wait_one to wait and collect results; Don't forget to call <code>cleanup result</code> afterwards</p></dd></dl><dl><dt class="spec value" id="val-dry_run_background"><a href="#val-dry_run_background" class="anchor"></a><code><span class="keyword">val</span> dry_run_background : <a href="index.html#type-command">command</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Similar to <code>run_background</code>, except that no process is created, and a dummy process (suitable for dry_wait_one) is returned.</p></dd></dl><dl><dt class="spec value" id="val-wait"><a href="#val-wait" class="anchor"></a><code><span class="keyword">val</span> wait : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-result">result</a></code></dt><dd><p><code>wait p</code> waits for the processus <code>p</code> to end and returns its results. Be careful to handle Sys.Break</p></dd></dl><dl><dt class="spec value" id="val-dontwait"><a href="#val-dontwait" class="anchor"></a><code><span class="keyword">val</span> dontwait : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-result">result</a> option</code></dt><dd><p>Like <code>wait</code>, but returns None immediately if the process hasn't ended</p></dd></dl><dl><dt class="spec value" id="val-wait_one"><a href="#val-wait_one" class="anchor"></a><code><span class="keyword">val</span> wait_one : <a href="index.html#type-t">t</a> list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> * <a href="index.html#type-result">result</a></code></dt><dd><p>Wait for the first of the listed processes to terminate, and return its termination status</p></dd></dl><dl><dt class="spec value" id="val-dry_wait_one"><a href="#val-dry_wait_one" class="anchor"></a><code><span class="keyword">val</span> dry_wait_one : <a href="index.html#type-t">t</a> list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> * <a href="index.html#type-result">result</a></code></dt><dd><p>Similar to <code>wait_one</code> for simulations, to be used with <code>dry_run_background</code></p></dd></dl><dl><dt class="spec value" id="val-interrupt"><a href="#val-interrupt" class="anchor"></a><code><span class="keyword">val</span> interrupt : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Send SIGINT to a process (or SIGKILL on Windows)</p></dd></dl><dl><dt class="spec value" id="val-is_success"><a href="#val-is_success" class="anchor"></a><code><span class="keyword">val</span> is_success : <a href="index.html#type-result">result</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>Is the process result a success?</p></dd></dl><dl><dt class="spec value" id="val-is_failure"><a href="#val-is_failure" class="anchor"></a><code><span class="keyword">val</span> is_failure : <a href="index.html#type-result">result</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>Is the process result a failure?</p></dd></dl><dl><dt class="spec value" id="val-cleanup"><a href="#val-cleanup" class="anchor"></a><code><span class="keyword">val</span> cleanup : ?&#8288;force:bool <span>&#45;&gt;</span> <a href="index.html#type-result">result</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Should be called after process termination, to cleanup temporary files. Leaves artefacts in case OpamGlobals.debug is on and on failure, unless force has been set.</p></dd></dl><dl><dt class="spec value" id="val-check_success_and_cleanup"><a href="#val-check_success_and_cleanup" class="anchor"></a><code><span class="keyword">val</span> check_success_and_cleanup : <a href="index.html#type-result">result</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>Like <code>is_success</code>, with an added cleanup side-effect (as <code>cleanup
    ~force:true</code>). Use this when not returning 0 is not an error case: since the default behaviour is to cleanup only when the command returned 0, which is not what is expected in that case.</p></dd></dl><section><header><h3 id="misc"><a href="#misc" class="anchor"></a>Misc</h3></header><dl><dt class="spec value" id="val-read_lines"><a href="#val-read_lines" class="anchor"></a><code><span class="keyword">val</span> read_lines : string <span>&#45;&gt;</span> string list</code></dt><dd><p>Reads a text file and returns a list of lines</p></dd></dl><dl><dt class="spec value" id="val-string_of_result"><a href="#val-string_of_result" class="anchor"></a><code><span class="keyword">val</span> string_of_result : ?&#8288;color:<a href="../OpamConsole/index.html#type-text_style">OpamConsole.text_style</a> <span>&#45;&gt;</span> <a href="index.html#type-result">result</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Detailed report on process outcome</p></dd></dl><dl><dt class="spec value" id="val-result_summary"><a href="#val-result_summary" class="anchor"></a><code><span class="keyword">val</span> result_summary : <a href="index.html#type-result">result</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Short report on process outcome</p></dd></dl><dl><dt class="spec module" id="module-Job"><a href="#module-Job" class="anchor"></a><code><span class="keyword">module</span> <a href="Job/index.html">Job</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Higher-level interface to allow parallelism</p></dd></dl><dl><dt class="spec type" id="type-job"><a href="#type-job" class="anchor"></a><code><span class="keyword">type</span> 'a job</code><code> = <span class="type-var">'a</span> <a href="Job/Op/index.html#type-job">Job.Op.job</a></code></dt></dl></section></div></body></html>