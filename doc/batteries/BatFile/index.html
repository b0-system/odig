<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>BatFile (batteries.BatFile)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">batteries</a> &#x00BB; BatFile</nav><header class="odoc-preamble"><h1>Module <code><span>BatFile</span></code></h1><p>File manipulation.</p><ul class="at-tags"><li class="author"><span class="at-tag">author</span> David Teller</li></ul></header><nav class="odoc-toc"><ul><li><a href="#utilities">Utilities</a></li><li><a href="#file-permissions">File permissions</a></li><li><a href="#opening-a-file-for-reading">Opening a file for reading</a></li><li><a href="#opening-a-file-for-writing">Opening a file for writing</a></li><li><a href="#opening-a-temporary-file-for-writing">Opening a temporary file for writing</a></li></ul></nav><div class="odoc-content"><h6 id="utilities"><a href="#utilities" class="anchor"></a>Utilities</h6><div class="odoc-spec"><div class="spec value" id="val-lines_of" class="anchored"><a href="#val-lines_of" class="anchor"></a><code><span><span class="keyword">val</span> lines_of : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <a href="../BatEnum/index.html#type-t">BatEnum.t</a></span></span></code></div><div class="spec-doc"><p><code>lines_of name</code> reads the contents of file <code>name</code> as an enumeration of lines. The file is automatically closed once the last line has been reached or the enumeration is garbage-collected.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-count_lines" class="anchored"><a href="#val-count_lines" class="anchor"></a><code><span><span class="keyword">val</span> count_lines : <span>string <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>count_lines filename</code> count the number of lines in given file. Lines are read by the stdlib's input_line function.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 3.1.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-write_lines" class="anchored"><a href="#val-write_lines" class="anchor"></a><code><span><span class="keyword">val</span> write_lines : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string <a href="../BatEnum/index.html#type-t">BatEnum.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write_lines name lines</code> writes strings given by <code>lines</code> to file <code>name</code> with newline character appended to each line.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-size_of" class="anchored"><a href="#val-size_of" class="anchor"></a><code><span><span class="keyword">val</span> size_of : <span>string <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>size_of name</code> returns the size of file <code>name</code> in bytes.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-size_of_big" class="anchored"><a href="#val-size_of_big" class="anchor"></a><code><span><span class="keyword">val</span> size_of_big : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="../../ocaml/Stdlib/Int64/index.html#type-t">Int64.t</a></span></code></div><div class="spec-doc"><p><code>size_of_big name</code> returns the size of file <code>name</code> in bytes, as a 64-bit integer.</p><p>This function is provided as the size of a file larger than 1 Gb cannot be represented with an <code>int</code> on a 32-bit machine.</p></div></div><h6 id="file-permissions"><a href="#file-permissions" class="anchor"></a>File permissions</h6><p>File permissions are used when creating a file to allow controlling which users may read, write or open that file. To use a permission, create a value of type <a href="#type-permission"><code>permission</code></a> and pass it as argument to <a href="#val-open_in"><code>open_in</code></a>, <a href="#val-open_out"><code>open_out</code></a>, <a href="#val-with_file_in"><code>with_file_in</code></a> or <a href="#val-with_file_out"><code>with_file_out</code></a>.</p><div class="odoc-spec"><div class="spec type" id="type-permission" class="anchored"><a href="#type-permission" class="anchor"></a><code><span><span class="keyword">type</span> permission</span></code></div><div class="spec-doc"><p>The list of operations which are permitted on a file.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_permission" class="anchored"><a href="#val-default_permission" class="anchor"></a><code><span><span class="keyword">val</span> default_permission : <a href="#type-permission">permission</a></span></code></div><div class="spec-doc"><p>Default permissions.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-user_read" class="anchored"><a href="#val-user_read" class="anchor"></a><code><span><span class="keyword">val</span> user_read : <a href="#type-permission">permission</a></span></code></div><div class="spec-doc"><p>Give the current user permission to read the file. Ignored under Windows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-user_write" class="anchored"><a href="#val-user_write" class="anchor"></a><code><span><span class="keyword">val</span> user_write : <a href="#type-permission">permission</a></span></code></div><div class="spec-doc"><p>Give the current user permission to write the file</p></div></div><div class="odoc-spec"><div class="spec value" id="val-user_exec" class="anchored"><a href="#val-user_exec" class="anchor"></a><code><span><span class="keyword">val</span> user_exec : <a href="#type-permission">permission</a></span></code></div><div class="spec-doc"><p>Give the current user permission to execute the file. Ignored under Windows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-group_read" class="anchored"><a href="#val-group_read" class="anchor"></a><code><span><span class="keyword">val</span> group_read : <a href="#type-permission">permission</a></span></code></div><div class="spec-doc"><p>Give the permission to read the file to the group containing the user. Ignored under Windows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-group_write" class="anchored"><a href="#val-group_write" class="anchor"></a><code><span><span class="keyword">val</span> group_write : <a href="#type-permission">permission</a></span></code></div><div class="spec-doc"><p>Give the permission to write the file to the group containing the user. Ignored under Windows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-group_exec" class="anchored"><a href="#val-group_exec" class="anchor"></a><code><span><span class="keyword">val</span> group_exec : <a href="#type-permission">permission</a></span></code></div><div class="spec-doc"><p>Give the permission to execute the file to the group containing the user. Ignored under Windows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-other_read" class="anchored"><a href="#val-other_read" class="anchor"></a><code><span><span class="keyword">val</span> other_read : <a href="#type-permission">permission</a></span></code></div><div class="spec-doc"><p>Give the permission to read the file to the rest of the world. Ignored under Windows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-other_write" class="anchored"><a href="#val-other_write" class="anchor"></a><code><span><span class="keyword">val</span> other_write : <a href="#type-permission">permission</a></span></code></div><div class="spec-doc"><p>Give the permission to modify the file to the rest of the world. Ignored under Windows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-other_exec" class="anchored"><a href="#val-other_exec" class="anchor"></a><code><span><span class="keyword">val</span> other_exec : <a href="#type-permission">permission</a></span></code></div><div class="spec-doc"><p>Give the permission to execute the file to the rest of the world. Ignored under Windows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-perm" class="anchored"><a href="#val-perm" class="anchor"></a><code><span><span class="keyword">val</span> perm : <span><span><a href="#type-permission">permission</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-permission">permission</a></span></code></div><div class="spec-doc"><p>Join permissions</p></div></div><div class="odoc-spec"><div class="spec value" id="val-unix_perm" class="anchored"><a href="#val-unix_perm" class="anchor"></a><code><span><span class="keyword">val</span> unix_perm : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-permission">permission</a></span></code></div><div class="spec-doc"><p>Create a permission from a Unix-style octal integer. See your favorite Unix documentation on <code>chmod</code> for more details.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if given number outside the <code>[0, 0o777]</code> range</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-set_permissions" class="anchored"><a href="#val-set_permissions" class="anchor"></a><code><span><span class="keyword">val</span> set_permissions : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-permission">permission</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set the permissions on a file.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-chmod" class="anchored"><a href="#val-chmod" class="anchor"></a><code><span><span class="keyword">val</span> chmod : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-permission">permission</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>As <a href="#val-set_permissions"><code>set_permissions</code></a></p></div></div><h6 id="opening-a-file-for-reading"><a href="#opening-a-file-for-reading" class="anchor"></a>Opening a file for reading</h6><div class="odoc-spec"><div class="spec type" id="type-open_in_flag" class="anchored"><a href="#type-open_in_flag" class="anchor"></a><code><span><span class="keyword">type</span> open_in_flag</span><span> = </span><span>[ </span></code><table><tr id="type-open_in_flag.create" class="anchored"><td class="def constructor"><a href="#type-open_in_flag.create" class="anchor"></a><code><span>| </span></code><code><span>`create</span></code></td></tr><tr id="type-open_in_flag.excl" class="anchored"><td class="def constructor"><a href="#type-open_in_flag.excl" class="anchor"></a><code><span>| </span></code><code><span>`excl</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Fail if the file exists and <code>`create</code> is set</p><span class="comment-delim">*)</span></td></tr><tr id="type-open_in_flag.text" class="anchored"><td class="def constructor"><a href="#type-open_in_flag.text" class="anchor"></a><code><span>| </span></code><code><span>`text</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Open in ascii mode -- if this flag is not specified or if the operating system does not perform conversions, the file is opened in binary mode.</p><span class="comment-delim">*)</span></td></tr><tr id="type-open_in_flag.nonblock" class="anchored"><td class="def constructor"><a href="#type-open_in_flag.nonblock" class="anchor"></a><code><span>| </span></code><code><span>`nonblock</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Open in non-blocking mode</p><span class="comment-delim">*)</span></td></tr><tr id="type-open_in_flag.mmap" class="anchored"><td class="def constructor"><a href="#type-open_in_flag.mmap" class="anchor"></a><code><span>| </span></code><code><span>`mmap</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Open in memory-mapped mode (experimental)</p><span class="comment-delim">*)</span></td></tr></table><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-open_in" class="anchored"><a href="#val-open_in" class="anchor"></a><code><span><span class="keyword">val</span> open_in : <span>?mode:<span><a href="#type-open_in_flag">open_in_flag</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?perm:<a href="#type-permission">permission</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="../BatInnerIO/index.html#type-input">BatInnerIO.input</a></span></code></div><div class="spec-doc"><p><code>open_in file_name</code> opens the file named <code>file_name</code> for reading.</p><p><b>Note</b> You will need to close the file manually, with <a href="../BatIO/index.html#val-close_in"><code>BatIO.close_in</code></a>. An alternative is to call <code>with_file_in</code> instead of <code>open_in</code>.</p><p>Naming conventions for files are platform-dependent.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_file_in" class="anchored"><a href="#val-with_file_in" class="anchor"></a><code><span><span class="keyword">val</span> with_file_in : <span>?mode:<span><a href="#type-open_in_flag">open_in_flag</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?perm:<a href="#type-permission">permission</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="../BatInnerIO/index.html#type-input">BatInnerIO.input</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_file_in file_name f</code> opens the file named <code>file_name</code> for reading, invokes <code>f</code> to process the contents of that file then, once <code>f</code> has returned or triggered an exception, closes the file before proceeding.</p></div></div><h6 id="opening-a-file-for-writing"><a href="#opening-a-file-for-writing" class="anchor"></a>Opening a file for writing</h6><div class="odoc-spec"><div class="spec type" id="type-open_out_flag" class="anchored"><a href="#type-open_out_flag" class="anchor"></a><code><span><span class="keyword">type</span> open_out_flag</span><span> = </span><span>[ </span></code><table><tr id="type-open_out_flag.append" class="anchored"><td class="def constructor"><a href="#type-open_out_flag.append" class="anchor"></a><code><span>| </span></code><code><span>`append</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Start writing at the end of the file rather than the start</p><span class="comment-delim">*)</span></td></tr><tr id="type-open_out_flag.create" class="anchored"><td class="def constructor"><a href="#type-open_out_flag.create" class="anchor"></a><code><span>| </span></code><code><span>`create</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Create the file if it does not exist</p><span class="comment-delim">*)</span></td></tr><tr id="type-open_out_flag.trunc" class="anchored"><td class="def constructor"><a href="#type-open_out_flag.trunc" class="anchor"></a><code><span>| </span></code><code><span>`trunc</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Empty the file if it already exists; on by default</p><span class="comment-delim">*)</span></td></tr><tr id="type-open_out_flag.excl" class="anchored"><td class="def constructor"><a href="#type-open_out_flag.excl" class="anchor"></a><code><span>| </span></code><code><span>`excl</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Fail if the file exists and <code>`create</code> is set</p><span class="comment-delim">*)</span></td></tr><tr id="type-open_out_flag.text" class="anchored"><td class="def constructor"><a href="#type-open_out_flag.text" class="anchor"></a><code><span>| </span></code><code><span>`text</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Open in ascii mode -- if this flag is not specified or if the operating system does not perform conversions, the file is opened in binary mode.</p><span class="comment-delim">*)</span></td></tr><tr id="type-open_out_flag.nonblock" class="anchored"><td class="def constructor"><a href="#type-open_out_flag.nonblock" class="anchor"></a><code><span>| </span></code><code><span>`nonblock</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Open in non-blocking mode</p><span class="comment-delim">*)</span></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>Flags governing file output; they correspond to the relevant flags to the POSIX <code>open()</code> call. The default flags are <code>[`create; `trunc]</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-open_out" class="anchored"><a href="#val-open_out" class="anchor"></a><code><span><span class="keyword">val</span> open_out : <span>?mode:<span><a href="#type-open_out_flag">open_out_flag</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?perm:<a href="#type-permission">permission</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../BatInnerIO/index.html#type-output">BatInnerIO.output</a></span></span></code></div><div class="spec-doc"><p><code>open_out file_name</code> opens the file named <code>file_name</code> for writing.</p><p><b>Note</b> You will need to close the file manually, with <a href="../BatIO/index.html#val-close_out"><code>BatIO.close_out</code></a>. An alternative is to call <code>with_file_out</code> instead of <code>open_out</code>.</p><p>Naming conventions for files are platform-dependent.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_file_out" class="anchored"><a href="#val-with_file_out" class="anchor"></a><code><span><span class="keyword">val</span> with_file_out : <span>?mode:<span><a href="#type-open_out_flag">open_out_flag</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?perm:<a href="#type-permission">permission</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span>unit <a href="../BatInnerIO/index.html#type-output">BatInnerIO.output</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_file_out file_name f</code> opens the file named <code>file_name</code> for writing, invokes <code>f</code> to write onto that file then, once <code>f</code> has returned or triggered an exception, closes the file before proceeding.</p></div></div><h6 id="opening-a-temporary-file-for-writing"><a href="#opening-a-temporary-file-for-writing" class="anchor"></a>Opening a temporary file for writing</h6><div class="odoc-spec"><div class="spec type" id="type-open_temporary_out_flag" class="anchored"><a href="#type-open_temporary_out_flag" class="anchor"></a><code><span><span class="keyword">type</span> open_temporary_out_flag</span><span> = </span><span>[ </span></code><table><tr id="type-open_temporary_out_flag.open_out_flag" class="anchored"><td class="def type"><a href="#type-open_temporary_out_flag.open_out_flag" class="anchor"></a><code><span>| </span></code><code><span><a href="#type-open_out_flag">open_out_flag</a></span></code></td></tr><tr id="type-open_temporary_out_flag.delete_on_exit" class="anchored"><td class="def constructor"><a href="#type-open_temporary_out_flag.delete_on_exit" class="anchor"></a><code><span>| </span></code><code><span>`delete_on_exit</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Should the file be deleted when program ends?</p><span class="comment-delim">*)</span></td></tr></table><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-open_temporary_out" class="anchored"><a href="#val-open_temporary_out" class="anchor"></a><code><span><span class="keyword">val</span> open_temporary_out : <span>?mode:<span><a href="#type-open_temporary_out_flag">open_temporary_out_flag</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?prefix:string <span class="arrow">&#45;&gt;</span></span> <span>?suffix:string <span class="arrow">&#45;&gt;</span></span>
<span>?temp_dir:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../BatInnerIO/index.html#type-output">BatInnerIO.output</a></span> * string</span></code></div><div class="spec-doc"><p><code>open_temporary_out ()</code> opens a new temporary file for writing.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">prefix</span> <p>a string which should appear at the start of your temporary file name (by default <code>&quot;ocaml&quot;</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">suffix</span> <p>a string which should appear at the end of your temporary file name (by default <code>&quot;tmp&quot;</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">temp_dir</span> <p>indicates what temp dir to use</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>The name of the file and the <code>output</code> for writing in it.</p><p><b>Note</b> You will need to close the file manually. An alternative is to call <code>with_temporary_out</code> instead of <code>open_out</code>.</p><p>Naming conventions for files are platform-dependent.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-with_temporary_out" class="anchored"><a href="#val-with_temporary_out" class="anchor"></a><code><span><span class="keyword">val</span> with_temporary_out : <span>?mode:<span><a href="#type-open_temporary_out_flag">open_temporary_out_flag</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?prefix:string <span class="arrow">&#45;&gt;</span></span> <span>?suffix:string <span class="arrow">&#45;&gt;</span></span>
<span>?temp_dir:string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span>unit <a href="../BatInnerIO/index.html#type-output">BatInnerIO.output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_temporary_out f</code> opens a new temporary file for writing, invokes <code>f</code> with to write onto that file then, once <code>f</code> has returned or triggered an exception, closes the file before proceeding.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">prefix</span> <p>a string which should appear at the start of your temporary file name (by default <code>&quot;ocaml&quot;</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">suffix</span> <p>a string which should appear at the end of your temporary file name (by default <code>&quot;tmp&quot;</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">temp_dir</span> <p>indicates what temp dir to use</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>The name of the file and the <code>output</code> for writing in it.</p><p>Naming conventions for files are platform-dependent.</p></li></ul></div></div></div></body></html>