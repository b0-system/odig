<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Store (b0.B00.Store)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">b0</a> &#x00BB; <a href="../index.html">B00</a> &#x00BB; Store</nav><header class="odoc-preamble"><h1>Module <code><span>B00.Store</span></code></h1><p>Lazy immutable stores.</p><p>These stores provide access to immutable, lazily determined, typed key-value bindings.</p><p>The value of a key in a store is defined either:</p><ul><li>Explicitly when the store is <span class="xref-unresolved">created</span>.</li><li>Lazily on the first key <span class="xref-unresolved">access</span> via a key determination function specified at <span class="xref-unresolved">key creation time</span>.</li></ul><p>Once determined the value of a key in the store never changes.</p><p><b>XXX.</b> Maybe move that at the B0 level.</p></header><nav class="odoc-toc"><ul><li><a href="#stores">Stores</a></li></ul></nav><div class="odoc-content"><h2 id="stores"><a href="#stores" class="anchor"></a>Stores</h2><div class="odoc-spec"><div class="spec type" id="type-key" class="anchored"><a href="#type-key" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a key</span></span></code></div><div class="spec-doc"><p>The type for keys binding values of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-binding" class="anchored"><a href="#type-binding" class="anchor"></a><code><span><span class="keyword">type</span> binding</span><span> = </span></code><table><tr id="type-binding.B" class="anchored"><td class="def variant constructor"><a href="#type-binding.B" class="anchor"></a><code><span>| </span><span><span class="constructor">B</span> : <span><span class="type-var">'a</span> <a href="#type-key">key</a></span> * <span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span> <a href="#type-binding">binding</a></span></code></td></tr></table></div><div class="spec-doc"><p>The type for store bindings. A key and its value.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type for stores.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><a href="../Memo/index.html#type-t">Memo.t</a> <span class="arrow">&#45;&gt;</span></span> <span>dir:<a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-binding">binding</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create memo ~dir bs</code> is a store with predefined bindings <code>bs</code>. If a key is mentioned more than once in <code>bs</code> the last binding takes over. The store uses <code>memo</code> to determine other keys as <a href="#val-get">needed</a>. <code>dir</code> is a scratch directory used by key determination functions to write memoized file outputs.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-memo" class="anchored"><a href="#val-memo" class="anchor"></a><code><span><span class="keyword">val</span> memo : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Memo/index.html#type-t">Memo.t</a></span></code></div><div class="spec-doc"><p><code>memo s</code> is <code>s</code>'s memo as given on <a href="#val-create"><code>create</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dir" class="anchored"><a href="#val-dir" class="anchor"></a><code><span><span class="keyword">val</span> dir : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a></span></code></div><div class="spec-doc"><p><code>dir s</code> is the scratch directory of <code>s</code>. Key determination functions using this directory to write files should do so using nice file name prefixes (e.g. lowercased module or lib names) to avoid name clashes.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-key" class="anchored"><a href="#val-key" class="anchor"></a><code><span><span class="keyword">val</span> key : <span>?mark:string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Memo/index.html#type-t">Memo.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../../B00_std/Fut/index.html#type-t">B00_std.Fut.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-key">key</a></span></span></code></div><div class="spec-doc"><p><code>key ~mark det</code> is a new key whose value is determined on <a href="#val-get">access</a> by the future:</p><pre><code>det s (Memo.with_mark mark (Store.memo s))</code></pre><p><code>mark</code> defaults to <code>&quot;&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get" class="anchored"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../../B00_std/Fut/index.html#type-t">B00_std.Fut.t</a></span></span></code></div><div class="spec-doc"><p><code>get s k</code> is a future that dermines with the value of <code>k</code> in <code>s</code>.</p></div></div></div></body></html>