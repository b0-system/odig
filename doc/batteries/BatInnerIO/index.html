<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>BatInnerIO (batteries.BatInnerIO)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">batteries</a> &#x00BB; BatInnerIO</nav><header class="odoc-preamble"><h1>Module <code><span>BatInnerIO</span></code></h1><p>Core of the BatIO module.</p><p>This module contains the core definitions of <a href="../BatIO/index.html"><code>BatIO</code></a>, so as to avoid circular dependencies between modules which only need simple functions of <a href="../BatIO/index.html"><code>BatIO</code></a> and that module itself.</p><p>Don't use this module, use <a href="../BatIO/index.html"><code>BatIO</code></a>.</p><ul class="at-tags"><li class="author"><span class="at-tag">author</span> Nicolas Cannasse</li></ul><ul class="at-tags"><li class="author"><span class="at-tag">author</span> David Teller</li></ul><ul class="at-tags"><li class="author"><span class="at-tag">author</span> Philippe Strauss</li></ul><ul class="at-tags"><li class="author"><span class="at-tag">author</span> Edgar Friendly</li></ul></header><nav class="odoc-toc"><ul><li><a href="#binary-files-api">Binary files API</a></li><li><a href="#for-compatibility-purposes">For compatibility purposes</a></li><li><a href="#standard-inputs/outputs">Standard inputs/outputs</a></li><li><a href="#comparison">Comparison</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-input" class="anchored"><a href="#type-input" class="anchor"></a><code><span><span class="keyword">type</span> input</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-output" class="anchored"><a href="#type-output" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a output</span></span></code></div></div><div class="odoc-spec"><div class="spec exception" id="exception-No_more_input" class="anchored"><a href="#exception-No_more_input" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">No_more_input</span></span></code></div><div class="spec-doc"><p>This exception is raised when reading on an input with the <code>read</code> or <code>nread</code> functions while there is no available token to read.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Input_closed" class="anchored"><a href="#exception-Input_closed" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Input_closed</span></span></code></div><div class="spec-doc"><p>This exception is raised when reading on a closed input.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Output_closed" class="anchored"><a href="#exception-Output_closed" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Output_closed</span></span></code></div><div class="spec-doc"><p>This exception is raised when reading on a closed output.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read" class="anchored"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> char</span></code></div><div class="spec-doc"><p>Read a single char from an input or raise <code>No_more_input</code> if no input available.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_all" class="anchored"><a href="#val-read_all" class="anchor"></a><code><span><span class="keyword">val</span> read_all : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>read all the contents of the input until <code>No_more_input</code> is raised.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pipe" class="anchored"><a href="#val-pipe" class="anchor"></a><code><span><span class="keyword">val</span> pipe : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-input">input</a> * <span>unit <a href="#type-output">output</a></span></span></code></div><div class="spec-doc"><p>Create a pipe between an input and an output. Data written from the output can be read from the input.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-nread" class="anchored"><a href="#val-nread" class="anchor"></a><code><span><span class="keyword">val</span> nread : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>nread i n</code> reads a string of size up to <code>n</code> from an input. The function will raise <code>No_more_input</code> if no input is available. It will raise <code>Invalid_argument</code> if <code>n</code> &lt; 0.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-really_nread" class="anchored"><a href="#val-really_nread" class="anchor"></a><code><span><span class="keyword">val</span> really_nread : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>really_nread i n</code> reads a string of exactly <code>n</code> characters from the input. </p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">No_more_input</span> <p>if at least <code>n</code> characters are not available. </p><p>@raise Invalid_argument</p><p>if <code>n</code> &lt; 0.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-input" class="anchored"><a href="#val-input" class="anchor"></a><code><span><span class="keyword">val</span> input : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>input i s p len</code> reads up to <code>len</code> bytes from the given input, storing them in byte sequence <code>s</code>, starting at position <code>p</code>. It returns the actual number of bytes read or raise <code>No_more_input</code> if no character can be read. It will raise <code>Invalid_argument</code> if <code>p</code> and <code>len</code> do not designate a valid subsequence of <code>s</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-really_input" class="anchored"><a href="#val-really_input" class="anchor"></a><code><span><span class="keyword">val</span> really_input : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>really_input i s p len</code> reads exactly <code>len</code> characters from the given input, storing them in the byte sequence <code>s</code>, starting at position <code>p</code>. For consistency with <a href="../BatIO/index.html#type-input"><code>BatIO.input</code></a> it returns <code>len</code>. </p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">No_more_input</span> <p>if at least <code>len</code> characters are not available. </p><p>@raise Invalid_argument</p><p>if <code>p</code> and <code>len</code> do not designate a valid subsequence of <code>s</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-close_in" class="anchored"><a href="#val-close_in" class="anchor"></a><code><span><span class="keyword">val</span> close_in : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Close the input. It can no longer be read from.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write" class="anchored"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>char <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write a single char to an output.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-nwrite" class="anchored"><a href="#val-nwrite" class="anchor"></a><code><span><span class="keyword">val</span> nwrite : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write a string to an output.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-nwrite_bytes" class="anchored"><a href="#val-nwrite_bytes" class="anchor"></a><code><span><span class="keyword">val</span> nwrite_bytes : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write a byte sequence to an output.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.8.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-output" class="anchored"><a href="#val-output" class="anchor"></a><code><span><span class="keyword">val</span> output : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>output o s p len</code> writes up to <code>len</code> characters from byte sequence <code>len</code>, starting at offset <code>p</code>. It returns the number of characters written. It will raise <code>Invalid_argument</code> if <code>p</code> and <code>len</code> do not designate a valid subsequence of <code>s</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-output_substring" class="anchored"><a href="#val-output_substring" class="anchor"></a><code><span><span class="keyword">val</span> output_substring : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>like <code>output</code> above, but outputs from a substring instead of a subsequence of bytes</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.8.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-really_output" class="anchored"><a href="#val-really_output" class="anchor"></a><code><span><span class="keyword">val</span> really_output : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>really_output o s p len</code> writes exactly <code>len</code> characters from byte sequence <code>s</code> onto the the output, starting with the character at offset <code>p</code>. For consistency with <a href="../BatIO/index.html#type-output"><code>BatIO.output</code></a> it returns <code>len</code>. </p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if <code>p</code> and <code>len</code> do not designate a valid subsequence of <code>s</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-really_output_substring" class="anchored"><a href="#val-really_output_substring" class="anchor"></a><code><span><span class="keyword">val</span> really_output_substring : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>like <code>really_output</code> above, but outputs from a substring instead of a subsequence of bytes</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.8.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-flush" class="anchored"><a href="#val-flush" class="anchor"></a><code><span><span class="keyword">val</span> flush : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Flush an output.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-flush_all" class="anchored"><a href="#val-flush_all" class="anchor"></a><code><span><span class="keyword">val</span> flush_all : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Flush all outputs.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-close_out" class="anchored"><a href="#val-close_out" class="anchor"></a><code><span><span class="keyword">val</span> close_out : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Close the output and return its accumulator data. It can no longer be written.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-close_all" class="anchored"><a href="#val-close_all" class="anchor"></a><code><span><span class="keyword">val</span> close_all : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Close all outputs. Ignore errors.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-input_string" class="anchored"><a href="#val-input_string" class="anchor"></a><code><span><span class="keyword">val</span> input_string : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-input">input</a></span></code></div><div class="spec-doc"><p>Create an input that will read from a string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-output_string" class="anchored"><a href="#val-output_string" class="anchor"></a><code><span><span class="keyword">val</span> output_string : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-output">output</a></span></span></code></div><div class="spec-doc"><p>Create an output that will write into a string in an efficient way. When closed, the output returns all the data written into it.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-on_close_out" class="anchored"><a href="#val-on_close_out" class="anchor"></a><code><span><span class="keyword">val</span> on_close_out : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Register a function to be triggered just before an output is closed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create_in" class="anchored"><a href="#val-create_in" class="anchor"></a><code><span><span class="keyword">val</span> create_in : <span>read:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> char)</span> <span class="arrow">&#45;&gt;</span></span> <span>input:<span>(<span><a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span>
<span>close:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-input">input</a></span></code></div><div class="spec-doc"><p>Fully create an input by giving all the needed functions.</p><p><b>Note</b> Do <em>not</em> use this function for creating an input which reads from one or more underlying inputs. Rather, use <a href="#val-wrap_in"><code>wrap_in</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-inherit_in" class="anchored"><a href="#val-inherit_in" class="anchor"></a><code><span><span class="keyword">val</span> inherit_in : <span>?read:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> char)</span> <span class="arrow">&#45;&gt;</span></span> <span>?input:<span>(<span><a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span>
<span>?close:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-input">input</a></span></code></div><div class="spec-doc"><p>Simplified and optimized version of <a href="#val-wrap_in"><code>wrap_in</code></a> whenever only one input appears as dependency.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-wrap_in" class="anchored"><a href="#val-wrap_in" class="anchor"></a><code><span><span class="keyword">val</span> wrap_in : <span>read:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> char)</span> <span class="arrow">&#45;&gt;</span></span> <span>input:<span>(<span><a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span> <span>close:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
<span>underlying:<span><a href="#type-input">input</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-input">input</a></span></code></div><div class="spec-doc"><p>Fully create an input reading from other inputs by giving all the needed functions.</p><p>This function is a more general version of <a href="#val-create_in"><code>create_in</code></a> which also handles dependency management between inputs.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create_out" class="anchored"><a href="#val-create_out" class="anchor"></a><code><span><span class="keyword">val</span> create_out : <span>write:<span>(<span>char <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span>output:<span>(<span><a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span>
<span>flush:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span>close:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-output">output</a></span></span></code></div><div class="spec-doc"><p>Fully create an output by giving all the needed functions.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">write</span> <p>Write one character to the output (see <code>write</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">output</span> <p>Write a (sub)string to the output (see <code>output</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">flush</span> <p>Flush any buffers of this output (see <code>flush</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">close</span> <p>Close this output. The output will be automatically flushed.</p><p><b>Note</b> Do <em>not</em> use this function for creating an output which writes to one or more underlying outputs. Rather, use <code>wrap_out</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-inherit_out" class="anchored"><a href="#val-inherit_out" class="anchor"></a><code><span><span class="keyword">val</span> inherit_out : <span>?write:<span>(<span>char <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span>?output:<span>(<span><a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span>
<span>?flush:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span>?close:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">_</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-output">output</a></span></span></code></div><div class="spec-doc"><p>Simplified and optimized version of <a href="#val-wrap_out"><code>wrap_out</code></a> whenever only one output appears as dependency.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-wrap_out" class="anchored"><a href="#val-wrap_out" class="anchor"></a><code><span><span class="keyword">val</span> wrap_out : <span>write:<span>(<span>char <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span>output:<span>(<span><a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span>
<span>flush:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span>close:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>underlying:<span><span><span class="type-var">'b</span> <a href="#type-output">output</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-output">output</a></span></span></code></div><div class="spec-doc"><p>Fully create an output that writes to one or more underlying outputs.</p><p>This function is a more general version of <a href="#val-create_out"><code>create_out</code></a>, which also handles dependency management between outputs.</p><p>To illustrate the need for dependency management, let us consider the following values:</p><ul><li>an output <code>out</code></li><li>a function <code>f : _ output -&gt; _ output</code>, using <a href="#val-create_out"><code>create_out</code></a> to create a new output for writing some data to an underyling output (for instance, a function comparale to <code>tab_out</code> or a function performing transparent compression or transparent traduction between encodings)</li></ul><p>With these values, let us consider the following scenario</p><ul><li>a new output <code>f out</code> is created</li><li>some data is written to <code>f out</code> but not flushed</li><li>output <code>out</code> is closed, perhaps manually or as a consequence of garbage-collection, or because the program has ended</li><li>data written to <code>f out</code> is flushed.</li></ul><p>In this case, data reaches <code>out</code> only after <code>out</code> has been closed, which violates the protocol. Despite appearances, it is quite easy to reach such situation, especially in short programs.</p><p>The solution is to use <code>wrap_out</code> rather than <code>create_out</code> in <code>f</code>. Specifying that <code>f out</code> writes on <code>out</code> will then let the run-time flush and close <code>f out</code> when <code>out</code> is closed for any reason, which in turn avoids the issue.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">write</span> <p>Write one character to the output (see <code>write</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">output</span> <p>Write a (sub)string to the output (see <code>output</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">flush</span> <p>Flush any buffers of this output (see <code>flush</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">close</span> <p>Close this output. The output will be automatically flushed.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">underlying</span> <p>The list of outputs to which the new output will write.</p><p><b>Note</b> Function <code>close</code> should <em>not</em> close <code>underlying</code> yourself. This is a common mistake which may cause sockets or standard output to be closed while they are still being used by another part of the program.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-default_buffer_size" class="anchored"><a href="#val-default_buffer_size" class="anchor"></a><code><span><span class="keyword">val</span> default_buffer_size : int</span></code></div><div class="spec-doc"><p>The default size of buffers.</p></div></div><h6 id="binary-files-api"><a href="#binary-files-api" class="anchor"></a>Binary files API</h6><p>Here is some API useful for working with binary files, in particular binary files generated by C applications. By default, encoding of multibyte integers is low-endian. The BigEndian module provide multibyte operations with other encoding.</p><div class="odoc-spec"><div class="spec exception" id="exception-Overflow" class="anchored"><a href="#exception-Overflow" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Overflow</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>Exception raised when a read or write operation cannot be completed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_byte" class="anchored"><a href="#val-read_byte" class="anchor"></a><code><span><span class="keyword">val</span> read_byte : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Read an unsigned 8-bit integer.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_signed_byte" class="anchored"><a href="#val-read_signed_byte" class="anchor"></a><code><span><span class="keyword">val</span> read_signed_byte : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Read an signed 8-bit integer.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_ui16" class="anchored"><a href="#val-read_ui16" class="anchor"></a><code><span><span class="keyword">val</span> read_ui16 : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Read an unsigned 16-bit word.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_i16" class="anchored"><a href="#val-read_i16" class="anchor"></a><code><span><span class="keyword">val</span> read_i16 : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Read a signed 16-bit word.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_i32" class="anchored"><a href="#val-read_i32" class="anchor"></a><code><span><span class="keyword">val</span> read_i32 : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Read a signed 32-bit integer. </p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Overflow</span> <p>if the read integer cannot be represented as an OCaml 31-bit integer.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-read_real_i32" class="anchored"><a href="#val-read_real_i32" class="anchor"></a><code><span><span class="keyword">val</span> read_real_i32 : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> int32</span></code></div><div class="spec-doc"><p>Read a signed 32-bit integer as an OCaml int32.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_i64" class="anchored"><a href="#val-read_i64" class="anchor"></a><code><span><span class="keyword">val</span> read_i64 : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> int64</span></code></div><div class="spec-doc"><p>Read a signed 64-bit integer as an OCaml int64.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_float" class="anchored"><a href="#val-read_float" class="anchor"></a><code><span><span class="keyword">val</span> read_float : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> float</span></code></div><div class="spec-doc"><p>Read an IEEE single precision floating point value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_double" class="anchored"><a href="#val-read_double" class="anchor"></a><code><span><span class="keyword">val</span> read_double : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> float</span></code></div><div class="spec-doc"><p>Read an IEEE double precision floating point value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_string" class="anchored"><a href="#val-read_string" class="anchor"></a><code><span><span class="keyword">val</span> read_string : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Read a null-terminated string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_line" class="anchored"><a href="#val-read_line" class="anchor"></a><code><span><span class="keyword">val</span> read_line : <span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Read a LF or CRLF terminated string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_byte" class="anchored"><a href="#val-write_byte" class="anchor"></a><code><span><span class="keyword">val</span> write_byte : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write an unsigned 8-bit byte.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_ui16" class="anchored"><a href="#val-write_ui16" class="anchor"></a><code><span><span class="keyword">val</span> write_ui16 : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write an unsigned 16-bit word.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_i16" class="anchored"><a href="#val-write_i16" class="anchor"></a><code><span><span class="keyword">val</span> write_i16 : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write a signed 16-bit word.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_i32" class="anchored"><a href="#val-write_i32" class="anchor"></a><code><span><span class="keyword">val</span> write_i32 : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write a signed 32-bit integer.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_real_i32" class="anchored"><a href="#val-write_real_i32" class="anchor"></a><code><span><span class="keyword">val</span> write_real_i32 : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int32 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write an OCaml int32.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_i64" class="anchored"><a href="#val-write_i64" class="anchor"></a><code><span><span class="keyword">val</span> write_i64 : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int64 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write an OCaml int64.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_double" class="anchored"><a href="#val-write_double" class="anchor"></a><code><span><span class="keyword">val</span> write_double : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>float <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write an IEEE double precision floating point value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_float" class="anchored"><a href="#val-write_float" class="anchor"></a><code><span><span class="keyword">val</span> write_float : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>float <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write an IEEE single precision floating point value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_string" class="anchored"><a href="#val-write_string" class="anchor"></a><code><span><span class="keyword">val</span> write_string : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write a string and append an null character.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_line" class="anchored"><a href="#val-write_line" class="anchor"></a><code><span><span class="keyword">val</span> write_line : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write a line and append a LF (it might be converted to CRLF on some systems depending on the underlying BatIO).</p></div></div><div class="odoc-spec"><div class="spec value external" id="val-cast_output" class="anchored"><a href="#val-cast_output" class="anchor"></a><code><span><span class="keyword">val</span> cast_output : <span><span><span class="type-var">'a</span> <a href="#type-output">output</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-output">output</a></span></span></code></div><div class="spec-doc"><p>You can safely transform any output to an unit output in a safe way by using this function.</p></div></div><h6 id="for-compatibility-purposes"><a href="#for-compatibility-purposes" class="anchor"></a>For compatibility purposes</h6><div class="odoc-spec"><div class="spec value" id="val-input_channel" class="anchored"><a href="#val-input_channel" class="anchor"></a><code><span><span class="keyword">val</span> input_channel : <span>?autoclose:bool <span class="arrow">&#45;&gt;</span></span> <span>?cleanup:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="../../ocaml/Stdlib/index.html#type-in_channel">in_channel</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-input">input</a></span></code></div><div class="spec-doc"><p>Create an input that will read from a channel.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">autoclose</span> <p>If true or unspecified, the <code>input</code> will be automatically closed when the underlying <code>in_channel</code> has reached its end.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">cleanup</span> <p>If true, the channel will be automatically closed when the <code>input</code> is closed. Otherwise, you will need to close the channel manually.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-output_channel" class="anchored"><a href="#val-output_channel" class="anchor"></a><code><span><span class="keyword">val</span> output_channel : <span>?cleanup:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="../../ocaml/Stdlib/index.html#type-out_channel">out_channel</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-output">output</a></span></span></code></div><div class="spec-doc"><p>Create an output that will write into a channel.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">cleanup</span> <p>If true, the channel will be automatically closed when the <code>output</code> is closed. Otherwise, you will need to close the channel manually.</p></li></ul></div></div><h6 id="standard-inputs/outputs"><a href="#standard-inputs/outputs" class="anchor"></a>Standard inputs/outputs</h6><div class="odoc-spec"><div class="spec value" id="val-stdin" class="anchored"><a href="#val-stdin" class="anchor"></a><code><span><span class="keyword">val</span> stdin : <a href="#type-input">input</a></span></code></div><div class="spec-doc"><p>Standard input, as per Unix/Windows conventions (by default, keyboard).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-stdout" class="anchored"><a href="#val-stdout" class="anchor"></a><code><span><span class="keyword">val</span> stdout : <span>unit <a href="#type-output">output</a></span></span></code></div><div class="spec-doc"><p>Standard output, as per Unix/Windows conventions (by default, console).</p><p>Use this output to display regular messages.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-stderr" class="anchored"><a href="#val-stderr" class="anchor"></a><code><span><span class="keyword">val</span> stderr : <span>unit <a href="#type-output">output</a></span></span></code></div><div class="spec-doc"><p>Standard error output, as per Unix/Windows conventions.</p><p>Use this output to display warnings and error messages.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-stdnull" class="anchored"><a href="#val-stdnull" class="anchor"></a><code><span><span class="keyword">val</span> stdnull : <span>unit <a href="#type-output">output</a></span></span></code></div><div class="spec-doc"><p>An output which discards everything written to it.</p><p>Use this output to ignore messages.</p></div></div><h6 id="comparison"><a href="#comparison" class="anchor"></a>Comparison</h6><p>The following modules may be useful to create hashtables of inputs or outputs.</p><div class="odoc-spec"><div class="spec module" id="module-Input" class="anchored"><a href="#module-Input" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Input/index.html">Input</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Output" class="anchored"><a href="#module-Output" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Output/index.html">Output</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>