<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Otfm (otfm.Otfm)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../index.html">otfm</a> &#x00BB; Otfm</nav><header class="odoc-preamble"><h1>Module <code><span>Otfm</span></code></h1><p>OpenType font decoder.</p><p><b>WARNING.</b> This interface is subject to change in the future.</p><p><code>Otfm</code> is an in-memory decoder for the OpenType font data format. It provides low-level access to OpenType fonts tables and functions to decode some of them.</p><p>Consult the <a href="#limitations">limitations</a> and <a href="#examples">example</a> of use.</p><p><b>Note.</b> Unless otherwise specified the strings returned are UTF-8 encoded.</p></header><nav class="odoc-toc"><ul><li><a href="#references">References</a></li><li><a href="#tags">Tags</a></li><li><a href="#unicode-code-points">Unicode code points</a></li><li><a href="#decode">Decode</a></li><li><a href="#table-decoding">Table decoding</a><ul><li><a href="#convenience">Convenience decodes</a></li><li><a href="#cmap">cmap table</a></li><li><a href="#glyf">glyf table</a></li><li><a href="#head">head table</a></li><li><a href="#hhea">hhea table</a></li><li><a href="#hmtx">hmtx table</a></li><li><a href="#name">name table</a></li><li><a href="#os2">OS/2 table</a></li><li><a href="#kern">kern table</a></li><li><a href="#loca">loca table</a></li></ul></li><li><a href="#limitations">Limitations</a></li><li><a href="#examples">Examples</a></li></ul></nav><div class="odoc-content"><h4 id="references"><a href="#references" class="anchor"></a>References</h4><ul><li>Microsoft. <em><a href="http://www.microsoft.com/typography/otspec/default.htm">The OpenType Specification</a></em>, 2009.</li></ul><h2 id="tags"><a href="#tags" class="anchor"></a>Tags</h2><div class="odoc-spec"><div class="spec type" id="type-tag" class="anchored"><a href="#type-tag" class="anchor"></a><code><span><span class="keyword">type</span> tag</span></code></div><div class="spec-doc"><p>The type for OpenType tags.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Tag" class="anchored"><a href="#module-Tag" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Tag/index.html">Tag</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Tags.</p></div></div><h2 id="unicode-code-points"><a href="#unicode-code-points" class="anchor"></a>Unicode code points</h2><p>For some reason OpenType allows the (textually meaningless) <a href="http://unicode.org/glossary/#surrogate_code_point">surrogate code points</a> to be mapped to glyphs. Hence we deal with Unicode <a href="http://unicode.org/glossary/#code_point">code points</a> not <a href="http://unicode.org/glossary/#unicode_scalar_value">scalar values</a>.</p><div class="odoc-spec"><div class="spec type" id="type-cp" class="anchored"><a href="#type-cp" class="anchor"></a><code><span><span class="keyword">type</span> cp</span><span> = int</span></code></div><div class="spec-doc"><p>The type for Unicode <a href="http://unicode.org/glossary/#code_point">code points</a>, ranges from <code>0x0000</code> to <code>0x10_FFFF</code>. Any code point returned by <code>Otfm</code> is guaranteed to be in the range.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-cp_range" class="anchored"><a href="#type-cp_range" class="anchor"></a><code><span><span class="keyword">type</span> cp_range</span><span> = <a href="#type-cp">cp</a> * <a href="#type-cp">cp</a></span></code></div><div class="spec-doc"><p>The type for Unicode code point ranges. Any range <code>(u0, u1)</code> returned by <code>Otfm</code> has <code>u0 &lt;= u1</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_cp" class="anchored"><a href="#val-is_cp" class="anchor"></a><code><span><span class="keyword">val</span> is_cp : <span>int <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_cp i</code> is <code>true</code> if <code>i</code> is an Unicode <a href="http://unicode.org/glossary/#code_point">code point</a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pp_cp" class="anchored"><a href="#val-pp_cp" class="anchor"></a><code><span><span class="keyword">val</span> pp_cp : <span><a href="../../ocaml/Stdlib/Format/index.html#type-formatter">Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-cp">cp</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>pp_cp ppf cp</code> prints an unspecified representation of <code>cp</code> on <code>ppf</code>.</p></div></div><h2 id="decode"><a href="#decode" class="anchor"></a>Decode</h2><div class="odoc-spec"><div class="spec type" id="type-error_ctx" class="anchored"><a href="#type-error_ctx" class="anchor"></a><code><span><span class="keyword">type</span> error_ctx</span><span> = </span><span>[ </span></code><table><tr id="type-error_ctx.Table" class="anchored"><td class="def constructor"><a href="#type-error_ctx.Table" class="anchor"></a><code><span>| </span></code><code><span>`Table <span class="keyword">of</span> <a href="#type-tag">tag</a></span></code></td></tr><tr id="type-error_ctx.Offset_table" class="anchored"><td class="def constructor"><a href="#type-error_ctx.Offset_table" class="anchor"></a><code><span>| </span></code><code><span>`Offset_table</span></code></td></tr><tr id="type-error_ctx.Table_directory" class="anchored"><td class="def constructor"><a href="#type-error_ctx.Table_directory" class="anchor"></a><code><span>| </span></code><code><span>`Table_directory</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>The type for error contexts.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-error" class="anchored"><a href="#type-error" class="anchor"></a><code><span><span class="keyword">type</span> error</span><span> = </span><span>[ </span></code><table><tr id="type-error.Unknown_flavour" class="anchored"><td class="def constructor"><a href="#type-error.Unknown_flavour" class="anchor"></a><code><span>| </span></code><code><span>`Unknown_flavour <span class="keyword">of</span> <a href="#type-tag">tag</a></span></code></td></tr><tr id="type-error.Unsupported_TTC" class="anchored"><td class="def constructor"><a href="#type-error.Unsupported_TTC" class="anchor"></a><code><span>| </span></code><code><span>`Unsupported_TTC</span></code></td></tr><tr id="type-error.Unsupported_cmaps" class="anchored"><td class="def constructor"><a href="#type-error.Unsupported_cmaps" class="anchor"></a><code><span>| </span></code><code><span>`Unsupported_cmaps <span class="keyword">of</span> <span><span>(int * int * int)</span> list</span></span></code></td></tr><tr id="type-error.Unsupported_glyf_matching_points" class="anchored"><td class="def constructor"><a href="#type-error.Unsupported_glyf_matching_points" class="anchor"></a><code><span>| </span></code><code><span>`Unsupported_glyf_matching_points</span></code></td></tr><tr id="type-error.Missing_required_table" class="anchored"><td class="def constructor"><a href="#type-error.Missing_required_table" class="anchor"></a><code><span>| </span></code><code><span>`Missing_required_table <span class="keyword">of</span> <a href="#type-tag">tag</a></span></code></td></tr><tr id="type-error.Unknown_version" class="anchored"><td class="def constructor"><a href="#type-error.Unknown_version" class="anchor"></a><code><span>| </span></code><code><span>`Unknown_version <span class="keyword">of</span> <a href="#type-error_ctx">error_ctx</a> * int32</span></code></td></tr><tr id="type-error.Unknown_loca_format" class="anchored"><td class="def constructor"><a href="#type-error.Unknown_loca_format" class="anchor"></a><code><span>| </span></code><code><span>`Unknown_loca_format <span class="keyword">of</span> <a href="#type-error_ctx">error_ctx</a> * int</span></code></td></tr><tr id="type-error.Unknown_composite_format" class="anchored"><td class="def constructor"><a href="#type-error.Unknown_composite_format" class="anchor"></a><code><span>| </span></code><code><span>`Unknown_composite_format <span class="keyword">of</span> <a href="#type-error_ctx">error_ctx</a> * int</span></code></td></tr><tr id="type-error.Invalid_offset" class="anchored"><td class="def constructor"><a href="#type-error.Invalid_offset" class="anchor"></a><code><span>| </span></code><code><span>`Invalid_offset <span class="keyword">of</span> <a href="#type-error_ctx">error_ctx</a> * int</span></code></td></tr><tr id="type-error.Invalid_cp" class="anchored"><td class="def constructor"><a href="#type-error.Invalid_cp" class="anchor"></a><code><span>| </span></code><code><span>`Invalid_cp <span class="keyword">of</span> int</span></code></td></tr><tr id="type-error.Invalid_cp_range" class="anchored"><td class="def constructor"><a href="#type-error.Invalid_cp_range" class="anchor"></a><code><span>| </span></code><code><span>`Invalid_cp_range <span class="keyword">of</span> int * int</span></code></td></tr><tr id="type-error.Invalid_postscript_name" class="anchored"><td class="def constructor"><a href="#type-error.Invalid_postscript_name" class="anchor"></a><code><span>| </span></code><code><span>`Invalid_postscript_name <span class="keyword">of</span> string</span></code></td></tr><tr id="type-error.Unexpected_eoi" class="anchored"><td class="def constructor"><a href="#type-error.Unexpected_eoi" class="anchor"></a><code><span>| </span></code><code><span>`Unexpected_eoi <span class="keyword">of</span> <a href="#type-error_ctx">error_ctx</a></span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>The type for decoding errors.</p><p><b>Note.</b> In case of <code>`Invalid_poscript_name</code> a string of <em>bytes</em> is returned.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pp_error" class="anchored"><a href="#val-pp_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_error : <span><a href="../../ocaml/Stdlib/Format/index.html#type-formatter">Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><span>[&lt; <a href="#type-error">error</a> ]</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>pp_error ppf e</code> prints an uspecified representation of <code>e</code> on <code>ppf</code>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-src" class="anchored"><a href="#type-src" class="anchor"></a><code><span><span class="keyword">type</span> src</span><span> = </span><span>[ </span></code><table><tr id="type-src.String" class="anchored"><td class="def constructor"><a href="#type-src.String" class="anchor"></a><code><span>| </span></code><code><span>`String <span class="keyword">of</span> string</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>The type for input sources.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-decoder" class="anchored"><a href="#type-decoder" class="anchor"></a><code><span><span class="keyword">type</span> decoder</span></code></div><div class="spec-doc"><p>The type for OpenType font decoders.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-decoder" class="anchored"><a href="#val-decoder" class="anchor"></a><code><span><span class="keyword">val</span> decoder : <span><span>[&lt; <a href="#type-src">src</a> ]</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-decoder">decoder</a></span></code></div><div class="spec-doc"><p><code>decoder src</code> is a decoder decoding from <code>src</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-decoder_src" class="anchored"><a href="#val-decoder_src" class="anchor"></a><code><span><span class="keyword">val</span> decoder_src : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-src">src</a></span></code></div><div class="spec-doc"><p><code>decoder_src d</code> is <code>d</code>'s input source.</p></div></div><h2 id="table-decoding"><a href="#table-decoding" class="anchor"></a>Table decoding</h2><p>These functions can be used in any order and are robust: when they return an error the decoder is back to a consistent state and can be used further. However if <a href="#val-flavour"><code>flavour</code></a> or <a href="#val-table_list"><code>table_list</code></a> returns an error you can safely assume that all other functions will. The fields are in general not documented please refer to the OpenType <a href="http://www.microsoft.com/typography/otspec/default.htm">specification</a> for details.</p><div class="odoc-spec"><div class="spec type" id="type-flavour" class="anchored"><a href="#type-flavour" class="anchor"></a><code><span><span class="keyword">type</span> flavour</span><span> = </span><span>[ </span></code><table><tr id="type-flavour.TTF" class="anchored"><td class="def constructor"><a href="#type-flavour.TTF" class="anchor"></a><code><span>| </span></code><code><span>`TTF</span></code></td></tr><tr id="type-flavour.CFF" class="anchored"><td class="def constructor"><a href="#type-flavour.CFF" class="anchor"></a><code><span>| </span></code><code><span>`CFF</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>The type for OpenType flavours.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-flavour" class="anchored"><a href="#val-flavour" class="anchor"></a><code><span><span class="keyword">val</span> flavour : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-flavour">flavour</a>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>decode_flavour d</code> is the flavour of the font decoded by <code>d</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-table_list" class="anchored"><a href="#val-table_list" class="anchor"></a><code><span><span class="keyword">val</span> table_list : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-tag">tag</a> list</span>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>table_list t</code> is the list of tables of the font decoded by <code>d</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-table_mem" class="anchored"><a href="#val-table_mem" class="anchor"></a><code><span><span class="keyword">val</span> table_mem : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tag">tag</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(bool, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>table_mem d t</code> is <code>true</code> if table <code>t</code> is in the font decoded by <code>d</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-table_raw" class="anchored"><a href="#val-table_raw" class="anchor"></a><code><span><span class="keyword">val</span> table_raw : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tag">tag</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string option</span>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>table_raw d t</code> is the (unpadded) data of the table <code>t</code> as a string if the table <code>t</code> exists.</p></div></div><h3 id="convenience"><a href="#convenience" class="anchor"></a>Convenience decodes</h3><p>These functions lookup data in the right table.</p><div class="odoc-spec"><div class="spec value" id="val-glyph_count" class="anchored"><a href="#val-glyph_count" class="anchor"></a><code><span><span class="keyword">val</span> glyph_count : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(int, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>glyph_count d</code> is the number of glyphs in the font (bounded by <code>65535</code>).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-postscript_name" class="anchored"><a href="#val-postscript_name" class="anchor"></a><code><span><span class="keyword">val</span> postscript_name : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string option</span>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>poscript_name d</code> is the PostScript name of <code>d</code>. Looks up and validates as mandated by the OTF standard, don't rely on <a href="#val-name"><code>name</code></a> if you really need this information.</p></div></div><h3 id="cmap"><a href="#cmap" class="anchor"></a>cmap table</h3><div class="odoc-spec"><div class="spec type" id="type-glyph_id" class="anchored"><a href="#type-glyph_id" class="anchor"></a><code><span><span class="keyword">type</span> glyph_id</span><span> = int</span></code></div><div class="spec-doc"><p>The type for glyph ids, from <code>0</code> to <code>65534</code>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-map_kind" class="anchored"><a href="#type-map_kind" class="anchor"></a><code><span><span class="keyword">type</span> map_kind</span><span> = </span><span>[ </span></code><table><tr id="type-map_kind.Glyph" class="anchored"><td class="def constructor"><a href="#type-map_kind.Glyph" class="anchor"></a><code><span>| </span></code><code><span>`Glyph</span></code></td></tr><tr id="type-map_kind.Glyph_range" class="anchored"><td class="def constructor"><a href="#type-map_kind.Glyph_range" class="anchor"></a><code><span>| </span></code><code><span>`Glyph_range</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>The type for map kinds.</p><p>Determines how an unicode range <code>(u0, u1)</code> and a glyph id <code>gid</code> must be interpreted in the folding function of <a href="#val-cmap"><code>cmap</code></a>.</p><ul><li><code>`Glyph</code> all characters in the range map to to <code>gid</code>.</li><li><code>`Glyph_range</code>, <code>u0</code> maps to <code>gid</code>, <code>u0 + 1</code> to <code>gid + 1</code>, ... and <code>u1</code> to <code>gid + (u1 - u0)</code></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-cmap" class="anchored"><a href="#val-cmap" class="anchor"></a><code><span><span class="keyword">val</span> cmap : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-map_kind">map_kind</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-cp_range">cp_range</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-glyph_id">glyph_id</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>(int * int * int)</span> * <span class="type-var">'a</span>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>cmap d f acc</code> folds over a mapping from unicode scalar values to glyph ids by reading the <a href="http://www.microsoft.com/typography/otspec/cmap.htm">cmap</a> table. The returned triple of integer indicates the platform id, encoding id and format of the cmap used.</p><p><b>Limitations.</b> Only the format 13 (last resort font), format 12 (UCS-4) and format 4 (UCS-2) cmap table formats are supported.</p><p>If multiple tables are present, it favours 13 over 12 over 4. If multiple tables of the same format are present it takes the first one it finds.</p><p>If no supported cmap table is found the error <code>`Unsupported_cmaps</code> is returned with the list of platform id, encoding id, format available in the font.</p></div></div><h3 id="glyf"><a href="#glyf" class="anchor"></a>glyf table</h3><div class="odoc-spec"><div class="spec type" id="type-glyf_loc" class="anchored"><a href="#type-glyf_loc" class="anchor"></a><code><span><span class="keyword">type</span> glyf_loc</span></code></div><div class="spec-doc"><p>The type for glyph locations. See <a href="#val-loca"><code>loca</code></a> table.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-glyph_simple_descr" class="anchored"><a href="#type-glyph_simple_descr" class="anchor"></a><code><span><span class="keyword">type</span> glyph_simple_descr</span><span> = <span><span><span>(bool * int * int)</span> list</span> list</span></span></code></div><div class="spec-doc"><p>The type for simple glyph descriptions. Lists of contours, contours are list of points with a boolean indicating whether the point is on or off curve.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-glyph_composite_descr" class="anchored"><a href="#type-glyph_composite_descr" class="anchor"></a><code><span><span class="keyword">type</span> glyph_composite_descr</span><span> = <span><span>(<a href="#type-glyph_id">glyph_id</a> * <span>(int * int)</span> * <span><span>(float * float * float * float)</span> option</span>)</span> list</span></span></code></div><div class="spec-doc"><p>The type for glyph composites. A list of components made of a glyph id, a translation and an optional linear transform <code>a b c d</code> (column major).</p></div></div><div class="odoc-spec"><div class="spec type" id="type-glyph_descr" class="anchored"><a href="#type-glyph_descr" class="anchor"></a><code><span><span class="keyword">type</span> glyph_descr</span><span> = <span>[ <span>`Simple of <a href="#type-glyph_simple_descr">glyph_simple_descr</a></span> <span><span>| `Composite</span> of <a href="#type-glyph_composite_descr">glyph_composite_descr</a></span> ]</span> * <span>(int * int * int * int)</span></span></code></div><div class="spec-doc"><p>The type for glyph descriptions. A simple or composite descriptions with the glyph's <code>(minx, miny, maxx, maxy)</code>'s bounding box.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-glyf" class="anchored"><a href="#val-glyf" class="anchor"></a><code><span><span class="keyword">val</span> glyf : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-glyf_loc">glyf_loc</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-glyph_descr">glyph_descr</a>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>glyf d loc</code> is the glyph descroption located at <code>loc</code> by reading the <a href="http://www.microsoft.com/typography/otspec/glyf.htm">glyf</a> table. Glyph locations are obtainted via <a href="#val-loca"><code>loca</code></a>.</p></div></div><h3 id="head"><a href="#head" class="anchor"></a>head table</h3><div class="odoc-spec"><div class="spec type" id="type-head" class="anchored"><a href="#type-head" class="anchor"></a><code><span><span class="keyword">type</span> head</span><span> = </span><span>{</span></code><table><tr id="type-head.head_font_revision" class="anchored"><td class="def record field"><a href="#type-head.head_font_revision" class="anchor"></a><code><span>head_font_revision : int32;</span></code></td></tr><tr id="type-head.head_flags" class="anchored"><td class="def record field"><a href="#type-head.head_flags" class="anchor"></a><code><span>head_flags : int;</span></code></td></tr><tr id="type-head.head_units_per_em" class="anchored"><td class="def record field"><a href="#type-head.head_units_per_em" class="anchor"></a><code><span>head_units_per_em : int;</span></code></td></tr><tr id="type-head.head_created" class="anchored"><td class="def record field"><a href="#type-head.head_created" class="anchor"></a><code><span>head_created : float;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Unix timestamp.</p><span class="comment-delim">*)</span></td></tr><tr id="type-head.head_modified" class="anchored"><td class="def record field"><a href="#type-head.head_modified" class="anchor"></a><code><span>head_modified : float;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Unix timestamp.</p><span class="comment-delim">*)</span></td></tr><tr id="type-head.head_xmin" class="anchored"><td class="def record field"><a href="#type-head.head_xmin" class="anchor"></a><code><span>head_xmin : int;</span></code></td></tr><tr id="type-head.head_ymin" class="anchored"><td class="def record field"><a href="#type-head.head_ymin" class="anchor"></a><code><span>head_ymin : int;</span></code></td></tr><tr id="type-head.head_xmax" class="anchored"><td class="def record field"><a href="#type-head.head_xmax" class="anchor"></a><code><span>head_xmax : int;</span></code></td></tr><tr id="type-head.head_ymax" class="anchored"><td class="def record field"><a href="#type-head.head_ymax" class="anchor"></a><code><span>head_ymax : int;</span></code></td></tr><tr id="type-head.head_mac_style" class="anchored"><td class="def record field"><a href="#type-head.head_mac_style" class="anchor"></a><code><span>head_mac_style : int;</span></code></td></tr><tr id="type-head.head_lowest_rec_ppem" class="anchored"><td class="def record field"><a href="#type-head.head_lowest_rec_ppem" class="anchor"></a><code><span>head_lowest_rec_ppem : int;</span></code></td></tr><tr id="type-head.head_index_to_loc_format" class="anchored"><td class="def record field"><a href="#type-head.head_index_to_loc_format" class="anchor"></a><code><span>head_index_to_loc_format : int;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>The type for representing <a href="http://www.microsoft.com/typography/otspec/head.htm">head</a> tables.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-head" class="anchored"><a href="#val-head" class="anchor"></a><code><span><span class="keyword">val</span> head : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-head">head</a>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>head d</code> is the head table.</p></div></div><h3 id="hhea"><a href="#hhea" class="anchor"></a>hhea table</h3><div class="odoc-spec"><div class="spec type" id="type-hhea" class="anchored"><a href="#type-hhea" class="anchor"></a><code><span><span class="keyword">type</span> hhea</span><span> = </span><span>{</span></code><table><tr id="type-hhea.hhea_ascender" class="anchored"><td class="def record field"><a href="#type-hhea.hhea_ascender" class="anchor"></a><code><span>hhea_ascender : int;</span></code></td></tr><tr id="type-hhea.hhea_descender" class="anchored"><td class="def record field"><a href="#type-hhea.hhea_descender" class="anchor"></a><code><span>hhea_descender : int;</span></code></td></tr><tr id="type-hhea.hhea_line_gap" class="anchored"><td class="def record field"><a href="#type-hhea.hhea_line_gap" class="anchor"></a><code><span>hhea_line_gap : int;</span></code></td></tr><tr id="type-hhea.hhea_advance_width_max" class="anchored"><td class="def record field"><a href="#type-hhea.hhea_advance_width_max" class="anchor"></a><code><span>hhea_advance_width_max : int;</span></code></td></tr><tr id="type-hhea.hhea_min_left_side_bearing" class="anchored"><td class="def record field"><a href="#type-hhea.hhea_min_left_side_bearing" class="anchor"></a><code><span>hhea_min_left_side_bearing : int;</span></code></td></tr><tr id="type-hhea.hhea_min_right_side_bearing" class="anchored"><td class="def record field"><a href="#type-hhea.hhea_min_right_side_bearing" class="anchor"></a><code><span>hhea_min_right_side_bearing : int;</span></code></td></tr><tr id="type-hhea.hhea_xmax_extent" class="anchored"><td class="def record field"><a href="#type-hhea.hhea_xmax_extent" class="anchor"></a><code><span>hhea_xmax_extent : int;</span></code></td></tr><tr id="type-hhea.hhea_caret_slope_rise" class="anchored"><td class="def record field"><a href="#type-hhea.hhea_caret_slope_rise" class="anchor"></a><code><span>hhea_caret_slope_rise : int;</span></code></td></tr><tr id="type-hhea.hhea_caret_slope_run" class="anchored"><td class="def record field"><a href="#type-hhea.hhea_caret_slope_run" class="anchor"></a><code><span>hhea_caret_slope_run : int;</span></code></td></tr><tr id="type-hhea.hhea_caret_offset" class="anchored"><td class="def record field"><a href="#type-hhea.hhea_caret_offset" class="anchor"></a><code><span>hhea_caret_offset : int;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>The type for <a href="http://www.microsoft.com/typography/otspec/hhea.htm">hhea</a> tables.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-hhea" class="anchored"><a href="#val-hhea" class="anchor"></a><code><span><span class="keyword">val</span> hhea : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-hhea">hhea</a>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>hhea d</code> is the hhea table.</p></div></div><h3 id="hmtx"><a href="#hmtx" class="anchor"></a>hmtx table</h3><div class="odoc-spec"><div class="spec value" id="val-hmtx" class="anchored"><a href="#val-hmtx" class="anchor"></a><code><span><span class="keyword">val</span> hmtx : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-glyph_id">glyph_id</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>hmtx d f acc</code> folds over the horizontal metrics of the font by reading the <a href="http://www.microsoft.com/typography/otspec/hmtx.htm">hmtx</a> table. <code>f</code> is applied on each entry with <code>f acc' gid adv lsb</code> with <code>gid</code> the glyph id (guaranteed to range, in order, from <code>0</code> to glyph count minus one), <code>adv</code> the (unsigned) advance width, and <code>lsb</code> the (signed) left side bearing.</p></div></div><h3 id="name"><a href="#name" class="anchor"></a>name table</h3><div class="odoc-spec"><div class="spec type" id="type-lang" class="anchored"><a href="#type-lang" class="anchor"></a><code><span><span class="keyword">type</span> lang</span><span> = string</span></code></div><div class="spec-doc"><p>The type for <a href="http://tools.ietf.org/html/bcp47">BCP 47</a> language tags.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-name" class="anchored"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-lang">lang</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>name d f acc</code> folds over the name records of the font by reading the <a href="http://www.microsoft.com/typography/otspec/name.htm">name</a> table. <code>f</code> is applied on each name id entry with <code>f acc' nid lang name</code> with <code>nid</code> the name id, lang the language tag, and <code>name</code> the UTF-8 encoded name value.</p><p><b>Note.</b> The module normalizes Windows language ids to lowercased BCP 47 ids. Language tags found in language tag records should be BCP 47 language tags but are not checked for conformance.</p><p><b>Tip.</b> If you are looking for the postcript name use <a href="#val-postscript_name"><code>postscript_name</code></a>.</p><p><b>Limitations.</b> Lookups data only in platform ids 0, 2 and 3 (Unicode, ISO and Windows) with UTF-16BE encoding and reports only the data of the first one it finds for a given name id.</p></div></div><h3 id="os2"><a href="#os2" class="anchor"></a>OS/2 table</h3><div class="odoc-spec"><div class="spec type" id="type-os2" class="anchored"><a href="#type-os2" class="anchor"></a><code><span><span class="keyword">type</span> os2</span><span> = </span><span>{</span></code><table><tr id="type-os2.os2_x_avg_char_width" class="anchored"><td class="def record field"><a href="#type-os2.os2_x_avg_char_width" class="anchor"></a><code><span>os2_x_avg_char_width : int;</span></code></td></tr><tr id="type-os2.os2_us_weight_class" class="anchored"><td class="def record field"><a href="#type-os2.os2_us_weight_class" class="anchor"></a><code><span>os2_us_weight_class : int;</span></code></td></tr><tr id="type-os2.os2_us_width_class" class="anchored"><td class="def record field"><a href="#type-os2.os2_us_width_class" class="anchor"></a><code><span>os2_us_width_class : int;</span></code></td></tr><tr id="type-os2.os2_fs_type" class="anchored"><td class="def record field"><a href="#type-os2.os2_fs_type" class="anchor"></a><code><span>os2_fs_type : int;</span></code></td></tr><tr id="type-os2.os2_y_subscript_x_size" class="anchored"><td class="def record field"><a href="#type-os2.os2_y_subscript_x_size" class="anchor"></a><code><span>os2_y_subscript_x_size : int;</span></code></td></tr><tr id="type-os2.os2_y_subscript_y_size" class="anchored"><td class="def record field"><a href="#type-os2.os2_y_subscript_y_size" class="anchor"></a><code><span>os2_y_subscript_y_size : int;</span></code></td></tr><tr id="type-os2.os2_y_subscript_x_offset" class="anchored"><td class="def record field"><a href="#type-os2.os2_y_subscript_x_offset" class="anchor"></a><code><span>os2_y_subscript_x_offset : int;</span></code></td></tr><tr id="type-os2.os2_y_subscript_y_offset" class="anchored"><td class="def record field"><a href="#type-os2.os2_y_subscript_y_offset" class="anchor"></a><code><span>os2_y_subscript_y_offset : int;</span></code></td></tr><tr id="type-os2.os2_y_superscript_x_size" class="anchored"><td class="def record field"><a href="#type-os2.os2_y_superscript_x_size" class="anchor"></a><code><span>os2_y_superscript_x_size : int;</span></code></td></tr><tr id="type-os2.os2_y_superscript_y_size" class="anchored"><td class="def record field"><a href="#type-os2.os2_y_superscript_y_size" class="anchor"></a><code><span>os2_y_superscript_y_size : int;</span></code></td></tr><tr id="type-os2.os2_y_superscript_x_offset" class="anchored"><td class="def record field"><a href="#type-os2.os2_y_superscript_x_offset" class="anchor"></a><code><span>os2_y_superscript_x_offset : int;</span></code></td></tr><tr id="type-os2.os2_y_superscript_y_offset" class="anchored"><td class="def record field"><a href="#type-os2.os2_y_superscript_y_offset" class="anchor"></a><code><span>os2_y_superscript_y_offset : int;</span></code></td></tr><tr id="type-os2.os2_y_strikeout_size" class="anchored"><td class="def record field"><a href="#type-os2.os2_y_strikeout_size" class="anchor"></a><code><span>os2_y_strikeout_size : int;</span></code></td></tr><tr id="type-os2.os2_y_strikeout_position" class="anchored"><td class="def record field"><a href="#type-os2.os2_y_strikeout_position" class="anchor"></a><code><span>os2_y_strikeout_position : int;</span></code></td></tr><tr id="type-os2.os2_family_class" class="anchored"><td class="def record field"><a href="#type-os2.os2_family_class" class="anchor"></a><code><span>os2_family_class : int;</span></code></td></tr><tr id="type-os2.os2_panose" class="anchored"><td class="def record field"><a href="#type-os2.os2_panose" class="anchor"></a><code><span>os2_panose : string;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>10 bytes</p><span class="comment-delim">*)</span></td></tr><tr id="type-os2.os2_ul_unicode_range1" class="anchored"><td class="def record field"><a href="#type-os2.os2_ul_unicode_range1" class="anchor"></a><code><span>os2_ul_unicode_range1 : int32;</span></code></td></tr><tr id="type-os2.os2_ul_unicode_range2" class="anchored"><td class="def record field"><a href="#type-os2.os2_ul_unicode_range2" class="anchor"></a><code><span>os2_ul_unicode_range2 : int32;</span></code></td></tr><tr id="type-os2.os2_ul_unicode_range3" class="anchored"><td class="def record field"><a href="#type-os2.os2_ul_unicode_range3" class="anchor"></a><code><span>os2_ul_unicode_range3 : int32;</span></code></td></tr><tr id="type-os2.os2_ul_unicode_range4" class="anchored"><td class="def record field"><a href="#type-os2.os2_ul_unicode_range4" class="anchor"></a><code><span>os2_ul_unicode_range4 : int32;</span></code></td></tr><tr id="type-os2.os2_ach_vend_id" class="anchored"><td class="def record field"><a href="#type-os2.os2_ach_vend_id" class="anchor"></a><code><span>os2_ach_vend_id : int32;</span></code></td></tr><tr id="type-os2.os2_fs_selection" class="anchored"><td class="def record field"><a href="#type-os2.os2_fs_selection" class="anchor"></a><code><span>os2_fs_selection : int;</span></code></td></tr><tr id="type-os2.os2_us_first_char_index" class="anchored"><td class="def record field"><a href="#type-os2.os2_us_first_char_index" class="anchor"></a><code><span>os2_us_first_char_index : int;</span></code></td></tr><tr id="type-os2.os2_us_last_char_index" class="anchored"><td class="def record field"><a href="#type-os2.os2_us_last_char_index" class="anchor"></a><code><span>os2_us_last_char_index : int;</span></code></td></tr><tr id="type-os2.os2_s_typo_ascender" class="anchored"><td class="def record field"><a href="#type-os2.os2_s_typo_ascender" class="anchor"></a><code><span>os2_s_typo_ascender : int;</span></code></td></tr><tr id="type-os2.os2_s_type_descender" class="anchored"><td class="def record field"><a href="#type-os2.os2_s_type_descender" class="anchor"></a><code><span>os2_s_type_descender : int;</span></code></td></tr><tr id="type-os2.os2_s_typo_linegap" class="anchored"><td class="def record field"><a href="#type-os2.os2_s_typo_linegap" class="anchor"></a><code><span>os2_s_typo_linegap : int;</span></code></td></tr><tr id="type-os2.os2_us_win_ascent" class="anchored"><td class="def record field"><a href="#type-os2.os2_us_win_ascent" class="anchor"></a><code><span>os2_us_win_ascent : int;</span></code></td></tr><tr id="type-os2.os2_us_win_descent" class="anchored"><td class="def record field"><a href="#type-os2.os2_us_win_descent" class="anchor"></a><code><span>os2_us_win_descent : int;</span></code></td></tr><tr id="type-os2.os2_ul_code_page_range_1" class="anchored"><td class="def record field"><a href="#type-os2.os2_ul_code_page_range_1" class="anchor"></a><code><span>os2_ul_code_page_range_1 : <span>int32 option</span>;</span></code></td></tr><tr id="type-os2.os2_ul_code_page_range_2" class="anchored"><td class="def record field"><a href="#type-os2.os2_ul_code_page_range_2" class="anchor"></a><code><span>os2_ul_code_page_range_2 : <span>int32 option</span>;</span></code></td></tr><tr id="type-os2.os2_s_x_height" class="anchored"><td class="def record field"><a href="#type-os2.os2_s_x_height" class="anchor"></a><code><span>os2_s_x_height : <span>int option</span>;</span></code></td></tr><tr id="type-os2.os2_s_cap_height" class="anchored"><td class="def record field"><a href="#type-os2.os2_s_cap_height" class="anchor"></a><code><span>os2_s_cap_height : <span>int option</span>;</span></code></td></tr><tr id="type-os2.os2_us_default_char" class="anchored"><td class="def record field"><a href="#type-os2.os2_us_default_char" class="anchor"></a><code><span>os2_us_default_char : <span>int option</span>;</span></code></td></tr><tr id="type-os2.os2_us_break_char" class="anchored"><td class="def record field"><a href="#type-os2.os2_us_break_char" class="anchor"></a><code><span>os2_us_break_char : <span>int option</span>;</span></code></td></tr><tr id="type-os2.os2_us_max_context" class="anchored"><td class="def record field"><a href="#type-os2.os2_us_max_context" class="anchor"></a><code><span>os2_us_max_context : <span>int option</span>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>The type for <a href="http://www.microsoft.com/typography/otspec/os2.htm">OS/2</a> tables.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-os2" class="anchored"><a href="#val-os2" class="anchor"></a><code><span><span class="keyword">val</span> os2 : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-os2">os2</a>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>os2 d</code> is the OS/2 table.</p></div></div><h3 id="kern"><a href="#kern" class="anchor"></a>kern table</h3><div class="odoc-spec"><div class="spec type" id="type-kern_info" class="anchored"><a href="#type-kern_info" class="anchor"></a><code><span><span class="keyword">type</span> kern_info</span><span> = </span><span>{</span></code><table><tr id="type-kern_info.kern_dir" class="anchored"><td class="def record field"><a href="#type-kern_info.kern_dir" class="anchor"></a><code><span>kern_dir : <span>[ `H <span>| `V</span> ]</span>;</span></code></td></tr><tr id="type-kern_info.kern_kind" class="anchored"><td class="def record field"><a href="#type-kern_info.kern_kind" class="anchor"></a><code><span>kern_kind : <span>[ `Min <span>| `Kern</span> ]</span>;</span></code></td></tr><tr id="type-kern_info.kern_cross_stream" class="anchored"><td class="def record field"><a href="#type-kern_info.kern_cross_stream" class="anchor"></a><code><span>kern_cross_stream : bool;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>The type for kerning (sub)table information.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-kern" class="anchored"><a href="#val-kern" class="anchor"></a><code><span><span class="keyword">val</span> kern : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-kern_info">kern_info</a> <span class="arrow">&#45;&gt;</span></span> <span>[ `Skip <span>| `Fold</span> ]</span> * <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-glyph_id">glyph_id</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-glyph_id">glyph_id</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>kern d t p acc</code> folds over the kerning tables of <code>d</code> by reading the <a href="http://www.microsoft.com/typography/otspec/kern.htm">kern</a> table. <code>t</code> is called on each new (sub)table, the table pairs are skipped if it returns <code>`Skip</code> otherwise <code>p acc' left right value</code> is called on each kerning pair of the table. The function returns <code>acc</code> if there is no kern table.</p><p><b>Limitations.</b> Only format 0 kerning tables are supported.</p></div></div><h3 id="loca"><a href="#loca" class="anchor"></a>loca table</h3><div class="odoc-spec"><div class="spec value" id="val-loca" class="anchored"><a href="#val-loca" class="anchor"></a><code><span><span class="keyword">val</span> loca : <span><a href="#type-decoder">decoder</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-glyph_id">glyph_id</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-glyf_loc">glyf_loc</a> option</span>, <a href="#type-error">error</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>loca d gid</code> looks up the location of the glyph with id <code>gid</code> by reading the <a href="http://www.microsoft.com/typography/otspec/loca.htm">loca</a> table. The result can be used with <a href="#val-glyf"><code>glyf</code></a> to lookup the glyph.</p></div></div><h2 id="limitations"><a href="#limitations" class="anchor"></a>Limitations</h2><p>As it stands <code>Otfm</code> has the following limitations. Some of these may be lifted in the future and a few of these can be overcome by pre-processing your font (e.g. extract <code>.ttc</code> files to <code>.ttf</code>, or removing hinting information to reduce the font size). See also the individual table decoding functions for other limitations.</p><ul><li>True Type collections (<code>.ttc</code> files) are not supported</li><li>The whole font needs to be loaded in memory as a string. This may be a limiting factor on 32 bits platforms (but non <code>.ttc</code> font files tend to be smaller than 16 Mo).</li><li>Table checksums are not verified.</li></ul><h2 id="examples"><a href="#examples" class="anchor"></a>Examples</h2><p>The following code prints the postscript name of the font on stdout.</p><pre><code>let otf_postscript_name bytes =
  let d = Otfm.decoder (`String bytes) in
  match Otfm.postscript_name d with
  | Error e -&gt; Format.eprintf &quot;@[%a@]@.&quot; Otfm.pp_error e
  | Ok (Some n) -&gt; Format.printf &quot;%s@.&quot; n;
  | Ok None -&gt; ()</code></pre></div></body></html>