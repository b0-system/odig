<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Async_rpc_kernel__Writer_with_length (async_rpc_kernel.Async_rpc_kernel__Writer_with_length)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">async_rpc_kernel</a> &#x00BB; Async_rpc_kernel__Writer_with_length</nav><h1>Module <code>Async_rpc_kernel__Writer_with_length</code></h1><p>A hack to make the bin-prot representation of things look as though they are packed into bigstrings, for backwards compatibility.</p><p>The original version of the protocol used bigstrings to hide away user-defined types. The bin-prot representation of a record with such a bigstring in it looks like</p><pre>      {field1|field2|...|{length|content}}</pre><p>where the content is the bin-prot representation of the value being written, and the length is that content's length. This writer writes data in the same format without using an intermediate bigstring by first calculating the size of the content, then writing that as a Nat0 before writing the actual content.</p><p>When reading, we use the fact that the length can be interpreted as a bin-prot encoded Nat0. The grouping is changed from:</p><pre>      {field1|field2|...|{length|content}}</pre><p>(only one bin-prot read) to:</p><pre>      {field1|field2|...|length}|{content}</pre><p>(two bin-prot reads).</p><p>If the last field is a variant type, there will be a variant tag before the length, but the exact same change of grouping will work.</p><p>Note that this only works when the bigstrings are in the last field of a record (or a variant in the last field of a record). It's easy to verify that this is true.</p></header><dl><dt class="spec value" id="val-of_writer"><a href="#val-of_writer" class="anchor"></a><code><span class="keyword">val</span> of_writer : <span class="type-var">'a</span> <a href="../../bin_prot/Bin_prot/Type_class/index.html#type-writer">Bin_prot.Type_class.writer</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../bin_prot/Bin_prot/Type_class/index.html#type-writer">Bin_prot.Type_class.writer</a></code></dt><dt class="spec value" id="val-of_type_class"><a href="#val-of_type_class" class="anchor"></a><code><span class="keyword">val</span> of_type_class : <span class="type-var">'a</span> <a href="../../bin_prot/Bin_prot/Type_class/index.html#type-t">Bin_prot.Type_class.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../bin_prot/Bin_prot/Type_class/index.html#type-writer">Bin_prot.Type_class.writer</a></code></dt></dl></div></body></html>