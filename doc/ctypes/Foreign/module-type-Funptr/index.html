<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Funptr (ctypes.Foreign.Funptr)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">ctypes</a> &#x00BB; <a href="../index.html">Foreign</a> &#x00BB; Funptr</nav><header class="odoc-preamble"><h1>Module type <code><span>Foreign.Funptr</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-fn" class="anchored"><a href="#type-fn" class="anchor"></a><code><span><span class="keyword">type</span> fn</span></code></div><div class="spec-doc"><p><code>fn</code> is the signature of the underlying OCaml function.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Handle to an OCaml function that can be passed to C for use in callbacks.</p><p>Each value of type <a href="#val-t"><code>t</code></a> allocated by <a href="#val-of_fun"><code>of_fun</code></a> must be deallocated by calling <a href="#val-free"><code>free</code></a>. Alternatively <a href="#val-with_fun"><code>with_fun</code></a> encapsulates both allocation and deallocation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-t" class="anchored"><a href="#val-t" class="anchor"></a><code><span><span class="keyword">val</span> t : <span><a href="#type-t">t</a> <a href="../../Ctypes/index.html#type-typ">Ctypes.typ</a></span></span></code></div><div class="spec-doc"><p>A type representation for a function pointer type with explicit lifetime management.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-t_opt" class="anchored"><a href="#val-t_opt" class="anchor"></a><code><span><span class="keyword">val</span> t_opt : <span><span><a href="#type-t">t</a> option</span> <a href="../../Ctypes/index.html#type-typ">Ctypes.typ</a></span></span></code></div><div class="spec-doc"><p>This behaves like <a href="#val-t"><code>t</code></a>, except that null pointers appear in OCaml as <code>None</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-free" class="anchored"><a href="#val-free" class="anchor"></a><code><span><span class="keyword">val</span> free : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Indicate that the <code>fptr</code> is no longer needed.</p><p>Once <code>free</code> has been called any C calls to this <code>Dynamic_funptr.t</code> are unsafe. Only call <code>free</code> once the callback is no longer used from C.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-of_fun" class="anchored"><a href="#val-of_fun" class="anchor"></a><code><span><span class="keyword">val</span> of_fun : <span><a href="#type-fn">fn</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Turn an OCaml closure into a function pointer that can be passed to C.</p><p>The function pointer returned by <code>of_fun</code> should be deallocated by a call to <a href="#val-free"><code>free</code></a> once it is no longer in use. Failure to call <a href="#val-free"><code>free</code></a> is an error.</p><p>Alternatively, <a href="#val-with_fun"><code>with_fun</code></a> encapsulates both allocation and deallocation.</p><p>Implementation detail: to avoid crashes, if <a href="#val-free"><code>free</code></a> is not called then the implementation will retain a reference to the OCaml closure and report a warning. See <a href="../index.html#val-report_leaked_funptr"><code>report_leaked_funptr</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_fun" class="anchored"><a href="#val-with_fun" class="anchor"></a><code><span><span class="keyword">val</span> with_fun : <span><a href="#type-fn">fn</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span></span></code></div><div class="spec-doc"><p><code>with_fun fn (fun fptr -&gt; e)</code> - Turn an OCaml closure into a function pointer and perform simple life cycle management.</p><p><code>with_fun fn (fun fptr -&gt; e)</code> will call <code>free fptr</code> after <code>e</code> completes.</p><p><code>with_fun</code> is not safe to use if the C function ptr <code>fptr</code> may still be used after <code>e</code> completes.</p></div></div></div></body></html>