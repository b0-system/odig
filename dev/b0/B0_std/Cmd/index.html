<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Cmd (b0.B0_std.Cmd)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">b0</a> &#x00BB; <a href="../index.html">B0_std</a> &#x00BB; Cmd</nav><h1>Module <code>B0_std.Cmd</code></h1><p>Command lines.</p><p>Command line values specify the command line arguments given to tools spawns. In certain contexts the command line value is the full specification of the tool spawn, in this case the first element of the line defines the program to invoke. In other contexts the tool to invoke and its arguments are kept separate.</p><p><a href="index.html#examples"><span>Examples</span></a>.</p><p><b>B0 artefact.</b> This module allows to <a href="index.html#val-shield"><code>shield</code></a> command arguments. Shielded arguments have no special semantics as far as the command line is concerned they simply indicate that the argument value itself does not influence the file outputs of the tool. As such shielded arguments do not appear in the command line <a href="index.html#val-to_list_and_sig"><span>signature</span></a> which is used to memoize tool spawns. A typical example of shielded argument are file paths to inputs: it's often the file contents not the actual file path that determines the tool output; beware though that some tool use both the file path contents and the actual file path in their outputs.</p><nav class="toc"><ul><li><a href="#cl">Command lines</a></li><li><a href="#derived">Derived combinators</a></li><li><a href="#tool">Tools</a></li><li><a href="#preds">Predicates</a></li><li><a href="#converting">Converting</a></li><li><a href="#examples">Examples</a></li></ul></nav></header><section><header><h2 id="cl"><a href="#cl" class="anchor"></a>Command lines</h2></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>The type for command lines. A command line is a list of command line arguments.</p></dd></dl><dl><dt class="spec value" id="val-is_empty"><a href="#val-is_empty" class="anchor"></a><code><span class="keyword">val</span> is_empty : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>is_empty l</code> is <code>true</code> iff <code>l</code> is an empty list of arguments.</p></dd></dl><dl><dt class="spec value" id="val-empty"><a href="#val-empty" class="anchor"></a><code><span class="keyword">val</span> empty : <a href="index.html#type-t">t</a></code></dt><dd><p><code>empty</code> is an empty list of arguments.</p></dd></dl><dl><dt class="spec value" id="val-arg"><a href="#val-arg" class="anchor"></a><code><span class="keyword">val</span> arg : string <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>arg a</code> is the argument <code>a</code>.</p></dd></dl><dl><dt class="spec value" id="val-append"><a href="#val-append" class="anchor"></a><code><span class="keyword">val</span> append : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>append l1 l2</code> appends arguments <code>l2</code> to <code>l1</code>.</p></dd></dl><dl><dt class="spec value" id="val-shield"><a href="#val-shield" class="anchor"></a><code><span class="keyword">val</span> shield : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>shield l</code> indicates that arguments <code>l</code> do not influence the tool's invocation outputs. These arguments are omitted from the command line's <a href="index.html#val-to_list_and_sig"><span>signature</span></a>.</p></dd></dl></section><section><header><h2 id="derived"><a href="#derived" class="anchor"></a>Derived combinators</h2></header><dl><dt class="spec value" id="val-(%)"><a href="#val-(%)" class="anchor"></a><code><span class="keyword">val</span> (%) : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>l % a</code> is <code>append l (arg a)</code>.</p></dd></dl><dl><dt class="spec value" id="val-(%%)"><a href="#val-(%%)" class="anchor"></a><code><span class="keyword">val</span> (%%) : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>l1 % l2</code> is <code>append l1 l2</code>.</p></dd></dl><dl><dt class="spec value" id="val-if'"><a href="#val-if'" class="anchor"></a><code><span class="keyword">val</span> if' : bool <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>if' cond l</code> is <code>l</code> if <code>cond</code> is <code>true</code> and <a href="index.html#val-empty"><code>empty</code></a> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-path"><a href="#val-path" class="anchor"></a><code><span class="keyword">val</span> path : <a href="../Fpath/index.html#type-t">Fpath.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>path p</code> is <code>arg (Fpath.to_string p)</code>.</p></dd></dl><dl><dt class="spec value" id="val-spath"><a href="#val-spath" class="anchor"></a><code><span class="keyword">val</span> spath : <a href="../Fpath/index.html#type-t">Fpath.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>spath p</code> is <code>shield (path p)</code>.</p></dd></dl><dl><dt class="spec value" id="val-args"><a href="#val-args" class="anchor"></a><code><span class="keyword">val</span> args : ?&#8288;slip:string <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>args ?slip l</code> is a command line from the list of arguments <code>l</code>. If <code>slip</code> is specified it is added on the command line before each element of <code>l</code>.</p></dd></dl><dl><dt class="spec value" id="val-rev_args"><a href="#val-rev_args" class="anchor"></a><code><span class="keyword">val</span> rev_args : ?&#8288;slip:string <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>rev_args ?slip l</code> is <a href="index.html#val-args"><code>args</code></a><code> ?slip (List.rev l)</code>.</p></dd></dl><dl><dt class="spec value" id="val-of_list"><a href="#val-of_list" class="anchor"></a><code><span class="keyword">val</span> of_list : ?&#8288;slip:string <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> <span class="type-var">'a</span> list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>of_list ?slip conv l</code> is <a href="index.html#val-args"><code>args</code></a><code> ?slip (List.map conv l)</code>.</p></dd></dl><dl><dt class="spec value" id="val-of_rev_list"><a href="#val-of_rev_list" class="anchor"></a><code><span class="keyword">val</span> of_rev_list : ?&#8288;slip:string <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> <span class="type-var">'a</span> list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>of_rev_list ?slip conv l</code> is <a href="index.html#val-args"><code>args</code></a><code> ?slip (List.rev_map conv l)</code>.</p></dd></dl><dl><dt class="spec value" id="val-paths"><a href="#val-paths" class="anchor"></a><code><span class="keyword">val</span> paths : ?&#8288;slip:string <span>&#45;&gt;</span> <a href="../Fpath/index.html#type-t">Fpath.t</a> list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>paths ?slip ps</code> is <a href="index.html#val-of_list"><code>of_list</code></a><code> ?slip Fpath.to_string ps</code>.</p></dd></dl><dl><dt class="spec value" id="val-rev_paths"><a href="#val-rev_paths" class="anchor"></a><code><span class="keyword">val</span> rev_paths : ?&#8288;slip:string <span>&#45;&gt;</span> <a href="../Fpath/index.html#type-t">Fpath.t</a> list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>rev_paths ?slip ps</code> is <a href="index.html#val-of_rev_list"><code>of_rev_list</code></a><code> ?slip Fpath.to_string ps</code>.</p></dd></dl></section><section><header><h2 id="tool"><a href="#tool" class="anchor"></a>Tools</h2></header><dl><dt class="spec type" id="type-tool"><a href="#type-tool" class="anchor"></a><code><span class="keyword">type</span> tool</code><code> = <a href="../Fpath/index.html#type-t">Fpath.t</a></code></dt><dd><p>The type for command line tools. A command line tool is represented by a file path according to the POSIX convention for <code>exec(3)</code>. If it is made of a single segment, for example <code>Fpath.v &quot;ocaml&quot;</code>, it represents a program name to be looked up via a search procedure; for example in the <code>PATH</code> environment variable. If it is a file path with multiple segments (POSIX would say if they contain a slash characters) the program is the file itself.</p></dd></dl><dl><dt class="spec value" id="val-tool"><a href="#val-tool" class="anchor"></a><code><span class="keyword">val</span> tool : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-tool">tool</a> option</code></dt><dd><p><code>tool l</code> is <code>l</code>'s first element. This is <code>None</code> if the line is <a href="index.html#val-empty"><code>empty</code></a> or if the first element can't be parsed to a <a href="index.html#tool"><span>Tools</span></a>.</p></dd></dl><dl><dt class="spec value" id="val-set_tool"><a href="#val-set_tool" class="anchor"></a><code><span class="keyword">val</span> set_tool : <a href="index.html#type-tool">tool</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> option</code></dt><dd><p><code>set_tool tool l</code> replaces <code>l</code>'s first element with <code>tool</code>. This is <code>None</code> if <code>l</code> is <a href="index.html#val-empty"><code>empty</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-get_tool"><a href="#val-get_tool" class="anchor"></a><code><span class="keyword">val</span> get_tool : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-tool">tool</a></code></dt><dd><p><code>get_tool</code> is like <a href="index.html#tool"><span>Tools</span></a> but </p><dl><dt>raises Invalid_argument</dt><dd><p>in case of error.</p></dd></dl></dd></dl></section><section><header><h2 id="preds"><a href="#preds" class="anchor"></a>Predicates</h2></header><dl><dt class="spec value" id="val-is_singleton"><a href="#val-is_singleton" class="anchor"></a><code><span class="keyword">val</span> is_singleton : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>is_singleton l</code> is <code>true</code> iff <code>l</code> has a single argument.</p></dd></dl></section><section><header><h2 id="converting"><a href="#converting" class="anchor"></a>Converting</h2></header><dl><dt class="spec value" id="val-to_list"><a href="#val-to_list" class="anchor"></a><code><span class="keyword">val</span> to_list : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string list</code></dt><dd><p><code>to_list l</code> converts <code>l</code> to a list of strings.</p></dd></dl><dl><dt class="spec value" id="val-to_sig"><a href="#val-to_sig" class="anchor"></a><code><span class="keyword">val</span> to_sig : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string list</code></dt><dd><p><code>to_sig l</code> is the sequence of unshielded arguments.</p></dd></dl><dl><dt class="spec value" id="val-to_list_and_sig"><a href="#val-to_list_and_sig" class="anchor"></a><code><span class="keyword">val</span> to_list_and_sig : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string list * string list</code></dt><dd><p><code>to_list_and_sig l</code> is a <code>l</code> as a list of strings tuppled with its signature: the sequence of unshielded arguments.</p></dd></dl><dl><dt class="spec value" id="val-to_string"><a href="#val-to_string" class="anchor"></a><code><span class="keyword">val</span> to_string : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>to_string l</code> converts <code>l</code> to a string that can be passed to the <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/system.html"><code>command(3)</code></a> POSIX system call.</p></dd></dl><dl><dt class="spec value" id="val-of_string"><a href="#val-of_string" class="anchor"></a><code><span class="keyword">val</span> of_string : string <span>&#45;&gt;</span> (<a href="index.html#type-t">t</a>, string) <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></code></dt><dd><p><code>of_string s</code> tokenizes <code>s</code> into a command line. The tokens are recognized according to the <code>token</code> production of the following grammar which should be mostly be compatible with POSIX shell tokenization.</p><pre>white   ::= ' ' | '\t' | '\n' | '\x0B' | '\x0C' | '\r'
squot   ::= '\''
dquot   ::= '\&quot;'
bslash  ::= '\\'
tokens  ::= white+ tokens | token tokens | ϵ
token   ::= ([^squot dquot white] | squoted | dquoted) token | ϵ
squoted ::= squot [^squot]* squot
dquoted ::= dquot (qchar | [^dquot])* dquot
qchar   ::= bslash (bslash | dquot | '$' | '`' | '\n')</pre><p><code>qchar</code> are substitued by the byte they escape except for <code>'\n'</code> which removes the backslash and newline from the byte stream. <code>squoted</code> and <code>dquoted</code> represent the bytes they enclose.</p></dd></dl><dl><dt class="spec value" id="val-conv"><a href="#val-conv" class="anchor"></a><code><span class="keyword">val</span> conv : <a href="index.html#type-t">t</a> <a href="../Conv/index.html#type-t">Conv.t</a></code></dt><dd><p><code>conv</code> converts command lines.</p></dd></dl><dl><dt class="spec value" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span class="keyword">val</span> pp : <a href="index.html#type-t">t</a> <a href="../Fmt/index.html#type-t">Fmt.t</a></code></dt><dd><p><code>pp ppf l</code> formats an unspecified representation of <code>l</code> on <code>ppf</code>.</p></dd></dl><dl><dt class="spec value" id="val-dump"><a href="#val-dump" class="anchor"></a><code><span class="keyword">val</span> dump : <a href="index.html#type-t">t</a> <a href="../Fmt/index.html#type-t">Fmt.t</a></code></dt><dd><p><code>dump ppf l</code> dumps and unspecified representation of <code>l</code> on <code>ppf</code>.</p></dd></dl></section><section><header><h2 id="examples"><a href="#examples" class="anchor"></a>Examples</h2><pre><code class="ml">let ls p = Cmd.(arg &quot;ls&quot; % &quot;-a&quot; % path p)
let tar archive dir =
  Cmd.(arg &quot;tar&quot; % &quot;-cvf&quot; %% shield (path archive) %% path dir)

let opam cmd = Cmd.(arg &quot;opam&quot; % cmd)
let opam_install pkgs = Cmd.(opam &quot;install&quot; %% args pkgs)

let ocamlc ?(debug = false) file =
  Cmd.(arg &quot;ocamlc&quot; % &quot;-c&quot; % if' debug (arg &quot;-g&quot;) %% path file)

let ocamlopt ?(profile = false) ?(debug = false) incs file =
  let profile = Cmd.(if' profile (arg &quot;-p&quot;)) in
  let debug = Cmd.(if' debug (arg &quot;-g&quot;)) in
  let incs = Cmd.(shield (paths ~slip:&quot;-I&quot; incs)) in
  Cmd.(arg &quot;ocamlopt&quot; % &quot;-c&quot; %% debug %% profile %% incs %% shield (path file))</code></pre></header></section></div></body></html>