<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Hash (base.Base.Hash)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">base</a> &#x00BB; <a href="../index.html">Base</a> &#x00BB; Hash</nav><header class="odoc-preamble"><h1>Module <code><span>Base.Hash</span></code></h1></header><div class="odoc-content"><div class="odoc-include"><div class="odoc-spec"><div class="spec module-type" id="module-type-Full" class="anchored"><a href="#module-type-Full" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> </span><span><a href="module-type-Full/index.html">Full</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module-type" id="module-type-S" class="anchored"><a href="#module-type-S" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> </span><span><a href="module-type-S/index.html">S</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-F" class="anchored"><a href="#module-F" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="F/index.html">F</a></span><span> (<a href="F/argument-1-Hash/index.html">Hash</a> : <a href="module-type-S/index.html">S</a>) : <a href="module-type-Full/index.html">Full</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-Full/index.html#type-hash_value">hash_value</a> = <a href="F/argument-1-Hash/index.html#type-hash_value">Hash.hash_value</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-Full/index.html#type-state">state</a> = <a href="F/argument-1-Hash/index.html#type-state">Hash.state</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-Full/index.html#type-seed">seed</a> = <a href="F/argument-1-Hash/index.html#type-seed">Hash.seed</a></span></span></code></div></div><p>The code of <code>ppx_hash</code> is agnostic to the choice of hash algorithm that is used. However, it is not currently possible to mix various choices of hash algorithms in a given code base.</p><p>We experimented with:</p><ul><li>(a) custom hash algorithms implemented in OCaml and</li><li>(b) in C;</li><li>(c) OCaml's internal hash function (which is a custom version of Murmur3, implemented in C);</li><li>(d) siphash, a modern hash function implemented in C.</li></ul><p>Our findings were as follows:</p><ul><li>Implementing our own custom hash algorithms in OCaml and C yielded very little performance improvement over the (c) proposal, without providing the benefit of being a peer-reviewed, widely used hash function.</li></ul><ul><li>Siphash (a modern hash function with an internal state of 32 bytes) has a worse performance profile than (a,b,c) above (hashing takes more time). Since its internal state is bigger than an OCaml immediate value, one must either manage allocation of such state explicitly, or paying the cost of allocation each time a hash is computed. While being a supposedly good hash function (with good hash quality), this quality was not translated in measurable improvements in our macro benchmarks. (Also, based on the data available at the time of writing, it's unclear that other hash algorithms in this class would be more than marginally faster.)</li></ul><ul><li>By contrast, using the internal combinators of OCaml hash function means that we do not allocate (the internal state of this hash function is 32 bit) and have the same quality and performance as Hashtbl.hash.</li></ul><p>Hence, we are here making the choice of using this Internalhash (that is, Murmur3, the OCaml hash algorithm as of 4.03) as our hash algorithm. It means that the state of the hash function does not need to be preallocated, and makes for simpler use in hash tables and other structures.</p><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="module-type-Full/index.html">Full</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-Full/index.html#type-state">state</a> = <a href="../../Base_internalhash_types/index.html#type-state">Base_internalhash_types.state</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-Full/index.html#type-seed">seed</a> = <a href="../../Base_internalhash_types/index.html#type-seed">Base_internalhash_types.seed</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-Full/index.html#type-hash_value">hash_value</a> = <a href="../../Base_internalhash_types/index.html#type-hash_value">Base_internalhash_types.hash_value</a></span></span></code></summary><div class="odoc-include"><div class="odoc-spec"><div class="spec value" id="val-description" class="anchored"><a href="#val-description" class="anchor"></a><code><span><span class="keyword">val</span> description : string</span></code></div><div class="spec-doc"><p>Name of the hash-function, e.g., &quot;internalhash&quot;, &quot;siphash&quot;</p></div></div><div class="odoc-spec"><div class="spec type" id="type-state" class="anchored"><a href="#type-state" class="anchor"></a><code><span><span class="keyword">type</span> state</span><span> = <a href="../../Base_internalhash_types/index.html#type-state">Base_internalhash_types.state</a></span></code></div><div class="spec-doc"><p><code>state</code> is the internal hash-state used by the hash function.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fold_int" class="anchored"><a href="#val-fold_int" class="anchor"></a><code><span><span class="keyword">val</span> fold_int : <span><a href="#type-state">state</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-state">state</a></span></code></div><div class="spec-doc"><p><code>fold_&lt;T&gt; state v</code> incorporates a value <code>v</code> of type &lt;T&gt; into the hash-state, returning a modified hash-state. Implementations of the <code>fold_&lt;T&gt;</code> functions may mutate the <code>state</code> argument in place, and return a reference to it. Implementations of the fold_&lt;T&gt; functions should not allocate.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fold_int64" class="anchored"><a href="#val-fold_int64" class="anchor"></a><code><span><span class="keyword">val</span> fold_int64 : <span><a href="#type-state">state</a> <span class="arrow">&#45;&gt;</span></span> <span>int64 <span class="arrow">&#45;&gt;</span></span> <a href="#type-state">state</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-fold_float" class="anchored"><a href="#val-fold_float" class="anchor"></a><code><span><span class="keyword">val</span> fold_float : <span><a href="#type-state">state</a> <span class="arrow">&#45;&gt;</span></span> <span>float <span class="arrow">&#45;&gt;</span></span> <a href="#type-state">state</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-fold_string" class="anchored"><a href="#val-fold_string" class="anchor"></a><code><span><span class="keyword">val</span> fold_string : <span><a href="#type-state">state</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-state">state</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-seed" class="anchored"><a href="#type-seed" class="anchor"></a><code><span><span class="keyword">type</span> seed</span><span> = <a href="../../Base_internalhash_types/index.html#type-seed">Base_internalhash_types.seed</a></span></code></div><div class="spec-doc"><p><code>seed</code> is the type used to seed the initial hash-state.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-alloc" class="anchored"><a href="#val-alloc" class="anchor"></a><code><span><span class="keyword">val</span> alloc : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-state">state</a></span></code></div><div class="spec-doc"><p><code>alloc ()</code> returns a fresh uninitialized hash-state. May allocate.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-reset" class="anchored"><a href="#val-reset" class="anchor"></a><code><span><span class="keyword">val</span> reset : <span>?seed:<a href="#type-seed">seed</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-state">state</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-state">state</a></span></code></div><div class="spec-doc"><p><code>reset ?seed state</code> initializes/resets a hash-state with the given <code>seed</code>, or else a default-seed. Argument <code>state</code> may be mutated. Should not allocate.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-hash_value" class="anchored"><a href="#type-hash_value" class="anchor"></a><code><span><span class="keyword">type</span> hash_value</span><span> = <a href="../../Base_internalhash_types/index.html#type-hash_value">Base_internalhash_types.hash_value</a></span></code></div><div class="spec-doc"><p><code>hash_value</code> The type of hash values, returned by <code>get_hash_value</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_hash_value" class="anchored"><a href="#val-get_hash_value" class="anchor"></a><code><span><span class="keyword">val</span> get_hash_value : <span><a href="#type-state">state</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-hash_value">hash_value</a></span></code></div><div class="spec-doc"><p><code>get_hash_value</code> extracts a hash-value from the hash-state.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-For_tests" class="anchored"><a href="#module-For_tests" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="For_tests/index.html">For_tests</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div><div class="odoc-spec"><div class="spec type" id="type-folder" class="anchored"><a href="#type-folder" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a folder</span></span><span> = <span><a href="#type-state">state</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-state">state</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span>?seed:<a href="#type-seed">seed</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-state">state</a></span></code></div><div class="spec-doc"><p><code>create ?seed ()</code> is a convenience. Equivalent to <code>reset ?seed (alloc ())</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-of_fold" class="anchored"><a href="#val-of_fold" class="anchor"></a><code><span><span class="keyword">val</span> of_fold : <span><span>(<span><a href="#type-state">state</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-state">state</a>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-hash_value">hash_value</a></span></code></div><div class="spec-doc"><p><code>of_fold fold</code> constructs a standard hash function from an existing fold function.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Builtin" class="anchored"><a href="#module-Builtin" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Builtin/index.html">Builtin</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-run" class="anchored"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span>?seed:<a href="#type-seed">seed</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-folder">folder</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-hash_value">hash_value</a></span></code></div><div class="spec-doc"><p><code>run ?seed folder x</code> runs <code>folder</code> on <code>x</code> in a newly allocated hash-state, initialized using optional <code>seed</code> or a default-seed.</p><p>The following identity exists: <code>run [%hash_fold: T]</code> == <code>[%hash: T]</code></p><p><code>run</code> can be used if we wish to run a hash-folder with a non-default seed.</p></div></div></details></div></div></div></body></html>