<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Arg (bos.Bos.OS.Arg)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../index.html">bos</a> &#x00BB; <a href="../../index.html">Bos</a> &#x00BB; <a href="../index.html">OS</a> &#x00BB; Arg</nav><header class="odoc-preamble"><h1>Module <code><span>OS.Arg</span></code></h1><p>Quick and dirty program arguments parsing.</p><p>This is for quick hacks and scripts. If your program evolves to a tool for end users you should rather use <code>Cmdliner</code> to parse your command lines: it generates man pages and its parsing is more flexible and user friendly. The syntax of command lines parsed by this module is a subset of what <code>Cmdliner</code> is able to parse so migrating there should not be a problem for existing invocations of your program.</p><p>This module supports short and long options with option arguments either glued to the option or specified as the next program argument. It also supports the <code>--</code> program argument to notify that subsequent arguments have to be treated as positional arguments. Parsing functions always respond to the <code>-h</code>, <code>-help</code> or <code>--help</code> flags by showing the program's usage and command line options documentation.</p><p>See the <span class="xref-unresolved">basics</span>.</p><p><b>Warning.</b> This module is not thread-safe.</p></header><nav class="odoc-toc"><ul><li><a href="#executable-name">Executable name</a></li><li><a href="#conv">Argument converters</a></li><li><a href="#queries">Flag and option queries</a></li><li><a href="#parse">Parsing</a></li><li><a href="#predefconvs">Predefined argument converters</a></li><li><a href="#argbasics">Basics</a></li></ul></nav><div class="odoc-content"><h2 id="executable-name"><a href="#executable-name" class="anchor"></a>Executable name</h2><div class="odoc-spec"><div class="spec value" id="val-exec" class="anchored"><a href="#val-exec" class="anchor"></a><code><span><span class="keyword">val</span> exec : string</span></code></div><div class="spec-doc"><p><code>exec</code> is the name of the executable. This is <code>Sys.argv.(0)</code> if <code>Sys.argv</code> is non-empty or <code>Sys</code>.executable_name otherwise.</p></div></div><h2 id="conv"><a href="#conv" class="anchor"></a>Argument converters</h2><p>Argument converters transform string arguments of the command line to OCaml values. Consult the predefined <a href="#predefconvs">converters</a>.</p><div class="odoc-spec"><div class="spec type" id="type-conv" class="anchored"><a href="#type-conv" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a conv</span></span></code></div><div class="spec-doc"><p>The type for argument converters.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-conv" class="anchored"><a href="#val-conv" class="anchor"></a><code><span><span class="keyword">val</span> conv : <span>?docv:string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <a href="../../../../rresult/Rresult/R/index.html#type-msg">Rresult.R.msg</a>)</span> <a href="../index.html#type-result">result</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="../../../../ocaml/Stdlib/Format/index.html#type-formatter">Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>conv ~docv parse print</code> is an argument converter parsing values with <code>parse</code> and printing them with <code>print</code>. <code>docv</code> is a documentation meta-variable used in the documentation to stand for the argument value, defaults to <code>&quot;VALUE&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-conv_parser" class="anchored"><a href="#val-conv_parser" class="anchor"></a><code><span><span class="keyword">val</span> conv_parser : <span><span><span class="type-var">'a</span> <a href="#type-conv">conv</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <a href="../../../../rresult/Rresult/R/index.html#type-msg">Rresult.R.msg</a>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>conv_parser c</code> is <code>c</code>'s parser.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-conv_printer" class="anchored"><a href="#val-conv_printer" class="anchor"></a><code><span><span class="keyword">val</span> conv_printer : <span><span><span class="type-var">'a</span> <a href="#type-conv">conv</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../ocaml/Stdlib/Format/index.html#type-formatter">Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>conv_printer c</code> is <code>c</code>'s printer.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-conv_docv" class="anchored"><a href="#val-conv_docv" class="anchor"></a><code><span><span class="keyword">val</span> conv_docv : <span><span><span class="type-var">'a</span> <a href="#type-conv">conv</a></span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>conv_printer c</code> is <code>c</code>'s documentation meta-variable.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-parser_of_kind_of_string" class="anchored"><a href="#val-parser_of_kind_of_string" class="anchor"></a><code><span><span class="keyword">val</span> parser_of_kind_of_string : <span>kind:string <span class="arrow">&#45;&gt;</span></span>
<span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <a href="../../../../rresult/Rresult/R/index.html#type-msg">Rresult.R.msg</a>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>parser_of_kind_of_string ~kind kind_of_string</code> is an argument parser using the <code>kind_of_string</code> function for parsing and <code>kind</code> for errors (e.g. could be <code>&quot;an integer&quot;</code> for an <code>int</code> parser).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-some" class="anchored"><a href="#val-some" class="anchor"></a><code><span><span class="keyword">val</span> some : <span>?none:string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-conv">conv</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>some none c</code> is like the converter <code>c</code> but wraps its result in <code>Some</code>. This is used for command line arguments that default to <code>None</code> when absent. <code>none</code> is what should be printed by the printer for <code>None</code> (defaults to <code>&quot;&quot;</code>).</p></div></div><h2 id="queries"><a href="#queries" class="anchor"></a>Flag and option queries</h2><p><b>Flag and option names.</b> They are specified without dashes. A one character name defines a short option; <code>&quot;d&quot;</code> is <code>-d</code>. Longer names define long options <code>&quot;debug&quot;</code> is <code>--debug</code>.</p><p><b>Option argument specification.</b> On the command line, option arguments are either specified as the next program argument or glued to the option. For short options gluing is done directly: <code>-farchive.tar</code>. For long options an <code>&quot;=&quot;</code> characters stands between the option and the value: <code>--file=archive.tar</code>.</p><p><b>Warning.</b> These functions are effectful invoking them twice on the same option names will result in parse errors. All the following functions raise <code>Invalid_argument</code> if they are invoked after <a href="#parse">parsing</a>.</p><div class="odoc-spec"><div class="spec value" id="val-flag" class="anchored"><a href="#val-flag" class="anchor"></a><code><span><span class="keyword">val</span> flag : <span>?doc:string <span class="arrow">&#45;&gt;</span></span> <span>?env:string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>flag ~doc ~env names</code> is <code>true</code> if one of the flags in <code>names</code> is present on the command line <em>at most once</em> and <code>false</code> otherwise.</p><p>If there is no flag on the command line and <code>env</code> is specified and defined in the environment, its value is parsed with <a href="../Env/index.html#val-bool"><code>Env.bool</code></a> and the resulting value is used. <code>doc</code> is a documentation string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-flag_all" class="anchored"><a href="#val-flag_all" class="anchor"></a><code><span><span class="keyword">val</span> flag_all : <span>?doc:string <span class="arrow">&#45;&gt;</span></span> <span>?env:string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>flag_all</code> is like <a href="#val-flag"><code>flag</code></a> but counts the number of occurences of the flag on the command line. If there is no flag on the command line and <code>env</code> is specified and defined in the environment, its value is parsed with <a href="../Env/index.html#val-bool"><code>Env.bool</code></a> and converted to an integer.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-opt" class="anchored"><a href="#val-opt" class="anchor"></a><code><span><span class="keyword">val</span> opt : <span>?docv:string <span class="arrow">&#45;&gt;</span></span> <span>?doc:string <span class="arrow">&#45;&gt;</span></span> <span>?env:string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-conv">conv</a></span> <span class="arrow">&#45;&gt;</span></span> <span>absent:<span class="type-var">'a</span>
<span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>opt ~docv ~doc ~env names c ~absent</code> is a value defined by the value of an optional argument that may appear <em>at most once</em> on the command line under one of the names specified by <code>names</code>.</p><p>The argument of the option is converted with <code>c</code> and <code>absent</code> is used if the option is absent from the command line. If there is no option on the command line and <code>env</code> is specified and defined in the environment, its value is parsed with <code>parse</code> and that value is used instead of <code>absent</code>.</p><p><code>doc</code> is is a documentation string. <code>docv</code> a documentation meta-variable used in the documentation to stand for the option argument, if unspecified <code>c</code>'s <a href="#val-conv_docv"><code>conv_docv</code></a> is used. In <code>doc</code> occurences of the substring <code>&quot;$(docv)&quot;</code> in are replaced by the value of <code>docv</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-opt_all" class="anchored"><a href="#val-opt_all" class="anchor"></a><code><span><span class="keyword">val</span> opt_all : <span>?docv:string <span class="arrow">&#45;&gt;</span></span> <span>?doc:string <span class="arrow">&#45;&gt;</span></span> <span>?env:string <span class="arrow">&#45;&gt;</span></span>
<span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-conv">conv</a></span> <span class="arrow">&#45;&gt;</span></span> <span>absent:<span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> list</span></span></code></div><div class="spec-doc"><p><code>opt_all</code> is like <a href="#val-opt"><code>opt</code></a> but the optional argument can be repeated.</p></div></div><h2 id="parse"><a href="#parse" class="anchor"></a>Parsing</h2><p><b>Note.</b> Before parsing make sure you have invoked all the <a href="#queries">queries</a>.</p><p><b>Warning.</b> All the following functions raise <code>Invalid_argument</code> if they are reinvoked after <a href="#parse">parsing</a>.</p><div class="odoc-spec"><div class="spec value" id="val-parse_opts" class="anchored"><a href="#val-parse_opts" class="anchor"></a><code><span><span class="keyword">val</span> parse_opts : <span>?doc:string <span class="arrow">&#45;&gt;</span></span> <span>?usage:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>parse_opts ()</code> can:</p><ul><li>Return <code>()</code> if no command line error occured and <code>-help</code> or <code>--help</code> was not specified.</li><li>Never return and exit the program with <code>0</code> after having printed the help on <code>stdout</code>.</li><li>Never return and exit the program with <code>1</code> after having printed an error on <code>stderr</code> if a parsing error occured.</li></ul><p>A parsing error occurs either if an option parser failed, if a non repeatable option was specified more than once, if there is an unknown option on the line, if there is a positional argument on the command line (use <a href="#val-parse"><code>parse</code></a> to parse them). <code>usage</code> is the command argument synopsis (default is automatically inferred). <code>doc</code> is a documentation string for the program.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-parse" class="anchored"><a href="#val-parse" class="anchor"></a><code><span><span class="keyword">val</span> parse : <span>?doc:string <span class="arrow">&#45;&gt;</span></span> <span>?usage:string <span class="arrow">&#45;&gt;</span></span> <span>pos:<span><span class="type-var">'a</span> <a href="#type-conv">conv</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> list</span></span></code></div><div class="spec-doc"><p><code>parse ~pos</code> is like <a href="#val-parse_opts"><code>parse_opts</code></a> but returns and converts the positional arguments with <code>pos</code> rather than error on them. Note that any thing that comes after a <code>--</code> argument on the command line is deemed to be a positional argument.</p></div></div><h2 id="predefconvs"><a href="#predefconvs" class="anchor"></a>Predefined argument converters</h2><div class="odoc-spec"><div class="spec value" id="val-string" class="anchored"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>string <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>string</code> converts a string argument. This never errors.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-path" class="anchored"><a href="#val-path" class="anchor"></a><code><span><span class="keyword">val</span> path : <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>path</code> converts a path argument using <a href="../../../../fpath/Fpath/index.html#val-of_string"><code>Fpath.of_string</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bin" class="anchored"><a href="#val-bin" class="anchor"></a><code><span><span class="keyword">val</span> bin : <span><a href="../../Cmd/index.html#type-t">Cmd.t</a> <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>bin</code> is <a href="#val-string"><code>string</code></a> mapped by <code>Cmd</code>.v.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-cmd" class="anchored"><a href="#val-cmd" class="anchor"></a><code><span><span class="keyword">val</span> cmd : <span><a href="../../Cmd/index.html#type-t">Cmd.t</a> <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>cmd</code> converts a <b>non-empty</b> command line with <code>Cmd</code>.of_string</p></div></div><div class="odoc-spec"><div class="spec value" id="val-char" class="anchored"><a href="#val-char" class="anchor"></a><code><span><span class="keyword">val</span> char : <span>char <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>char</code> converts a single character.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bool" class="anchored"><a href="#val-bool" class="anchor"></a><code><span><span class="keyword">val</span> bool : <span>bool <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>bool</code> converts a boolean with <code>String</code>.to_bool.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int" class="anchored"><a href="#val-int" class="anchor"></a><code><span><span class="keyword">val</span> int : <span>int <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>int</code> converts an integer with <code>String</code>.to_int.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-nativeint" class="anchored"><a href="#val-nativeint" class="anchor"></a><code><span><span class="keyword">val</span> nativeint : <span>nativeint <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>int</code> converts a <code>nativeint</code> with <code>String</code>.to_nativeint.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int32" class="anchored"><a href="#val-int32" class="anchor"></a><code><span><span class="keyword">val</span> int32 : <span>int32 <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>int32</code> converts an <code>int32</code> with <code>String</code>.to_int32.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int64" class="anchored"><a href="#val-int64" class="anchor"></a><code><span><span class="keyword">val</span> int64 : <span>int64 <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>int64</code> converts an <code>int64</code> with <code>String</code>.to_int64.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-float" class="anchored"><a href="#val-float" class="anchor"></a><code><span><span class="keyword">val</span> float : <span>float <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>float</code> converts an float with <code>String</code>.to_float.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-enum" class="anchored"><a href="#val-enum" class="anchor"></a><code><span><span class="keyword">val</span> enum : <span><span><span>(string * <span class="type-var">'a</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>enum l p</code> converts values such that string names in <code>l</code> map to the corresponding value of type <code>'a</code>.</p><p><b>Warning.</b> The type <code>'a</code> must be comparable with <a href="../../../../ocaml/Stdlib/index.html#val-compare"><code>Stdlib.compare</code></a>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if <code>l</code> is empty.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-list" class="anchored"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : <span>?sep:string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-conv">conv</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>list ~sep c</code> converts a list of <code>c</code>. For parsing the argument is first <code>String</code>.cuts<code> ~sep</code> and the resulting string list is converted using <code>c</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-array" class="anchored"><a href="#val-array" class="anchor"></a><code><span><span class="keyword">val</span> array : <span>?sep:string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-conv">conv</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> array</span> <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>array ~sep c</code> is like <a href="#val-list"><code>list</code></a> but returns an array instead.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pair" class="anchored"><a href="#val-pair" class="anchor"></a><code><span><span class="keyword">val</span> pair : <span>?sep:string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-conv">conv</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-conv">conv</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="#type-conv">conv</a></span></span></code></div><div class="spec-doc"><p><code>pair ~sep fst snd</code> converts a pair of <code>fst</code> and <code>snd</code>. For parsing the argument is <code>String</code>.cut<code> ~sep</code> and the resulting strings are converted using <code>fst</code> and <code>snd</code>.</p></div></div><h2 id="argbasics"><a href="#argbasics" class="anchor"></a>Basics</h2><p>To parse a command line, <b>first</b> perform all the option <a href="#queries">queries</a> and then invoke one of the <a href="#parse">parsing</a> functions. Do not invoke any query after parsing has been done, this will raise <code>Invalid_argument</code>. This leads to the following program structure:</p><pre><code>(* It is possible to define things at the toplevel as follows. But do not
   abuse this. The following flag, if unspecified on the command line, can
   also be specified with the DEBUG environment variable. *)
let debug = OS.Arg.(flag [&quot;g&quot;; &quot;debug&quot;] ~env:&quot;DEBUG&quot; ~doc:&quot;debug mode.&quot;)
...

let main () =
  let depth =
    OS.Arg.(opt [&quot;d&quot;; &quot;depth&quot;] int ~absent:2 ~doc:&quot;recurses $(docv) times.&quot;)
  in
  let pos_args = OS.Arg.(parse ~pos:string ()) in
  (* No command line error or help request occured, run the program. *)
  ...

let main () = main ()</code></pre></div></body></html>