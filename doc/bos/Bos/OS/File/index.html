<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>File (bos.Bos.OS.File)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../index.html">bos</a> &#x00BB; <a href="../../index.html">Bos</a> &#x00BB; <a href="../index.html">OS</a> &#x00BB; File</nav><header class="odoc-preamble"><h1>Module <code><span>OS.File</span></code></h1><p>File operations.</p></header><nav class="odoc-toc"><ul><li><a href="#paths">Famous file paths</a></li><li><a href="#ops">Existence, deletion and properties</a></li><li><a href="#input">Input</a></li><li><a href="#output">Output</a></li><li><a href="#tmpfiles">Temporary files</a></li></ul></nav><div class="odoc-content"><h2 id="paths"><a href="#paths" class="anchor"></a>Famous file paths</h2><div class="odoc-spec"><div class="spec value" id="val-null" class="anchored"><a href="#val-null" class="anchor"></a><code><span><span class="keyword">val</span> null : <a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a></span></code></div><div class="spec-doc"><p><code>null</code> is <code>Fpath.v &quot;/dev/null&quot;</code> on POSIX and <code>Fpath.v &quot;NUL&quot;</code> on Windows. It represents a file on the OS that discards all writes and returns end of file on reads.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dash" class="anchored"><a href="#val-dash" class="anchor"></a><code><span><span class="keyword">val</span> dash : <a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a></span></code></div><div class="spec-doc"><p><code>dash</code> is <code>Fpath.v &quot;-&quot;</code>. This value is used by <a href="#input">input</a> and <a href="#output">output</a> functions to respectively denote <code>stdin</code> and <code>stdout</code>.</p><p><b>Note.</b> Representing <code>stdin</code> and <code>stdout</code> by this path is a widespread command line tool convention. However it is perfectly possible to have files that bear this name in the file system. If you need to operate on such path from the current directory you can simply specify them as <code>Fpath.(cur_dir / &quot;-&quot;)</code> and so can your users on the command line by using <code>&quot;./-&quot;</code>.</p></div></div><h2 id="ops"><a href="#ops" class="anchor"></a>Existence, deletion and properties</h2><div class="odoc-spec"><div class="spec value" id="val-exists" class="anchored"><a href="#val-exists" class="anchor"></a><code><span><span class="keyword">val</span> exists : <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(bool, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>exists file</code> is <code>true</code> if <code>file</code> is a regular file in the file system and <code>false</code> otherwise. Symbolic links are followed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-must_exist" class="anchored"><a href="#val-must_exist" class="anchor"></a><code><span><span class="keyword">val</span> must_exist : <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a>, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>must_exist file</code> is <code>Ok file</code> if <code>file</code> is a regular file in the file system and an error otherwise. Symbolic links are followed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-delete" class="anchored"><a href="#val-delete" class="anchor"></a><code><span><span class="keyword">val</span> delete : <span>?must_exist:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>delete ~must_exist file</code> deletes file <code>file</code>. If <code>must_exist</code> is <code>true</code> (defaults to <code>false</code>) an error is returned if <code>file</code> doesn't exist.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-truncate" class="anchored"><a href="#val-truncate" class="anchor"></a><code><span><span class="keyword">val</span> truncate : <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>truncate p size</code> truncates <code>p</code> to <code>s</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_executable" class="anchored"><a href="#val-is_executable" class="anchor"></a><code><span><span class="keyword">val</span> is_executable : <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_executable p</code> is <code>true</code> iff file <code>p</code> exists and is executable.</p></div></div><h2 id="input"><a href="#input" class="anchor"></a>Input</h2><p><b>Stdin.</b> In the following functions if the path is <a href="#val-dash"><code>dash</code></a>, bytes are read from <code>stdin</code>.</p><div class="odoc-spec"><div class="spec type" id="type-input" class="anchored"><a href="#type-input" class="anchor"></a><code><span><span class="keyword">type</span> input</span><span> = <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../../../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> * int * int)</span> option</span></span></code></div><div class="spec-doc"><p>The type for file inputs. The function is called by the client to input more bytes. It returns <code>Some (b, pos, len)</code> if the bytes <code>b</code> can be read in the range [<code>pos</code>;<code>pos+len</code>]; this byte range is immutable until the next function call. <code>None</code> is returned at the end of input.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_input" class="anchored"><a href="#val-with_input" class="anchor"></a><code><span><span class="keyword">val</span> with_input : <span>?bytes:<a href="../../../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-input">input</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>with_input ~bytes file f v</code> provides contents of <code>file</code> with an input <code>i</code> using <code>bytes</code> to read the data and returns <code>f i v</code>. After the function returns (normally or via an exception) a call to <code>i</code> by the client raises <code>Invalid_argument</code>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if the length of <code>bytes</code> is <code>0</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-with_ic" class="anchored"><a href="#val-with_ic" class="anchor"></a><code><span><span class="keyword">val</span> with_ic : <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="../../../../ocaml/Stdlib/index.html#type-in_channel">in_channel</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>with_ic file f v</code> opens <code>file</code> as a channel <code>ic</code> and returns <code>Ok (f ic v)</code>. After the function returns (normally or via an exception), <code>ic</code> is ensured to be closed. If <code>file</code> is <a href="#val-dash"><code>dash</code></a>, <code>ic</code> is <a href="../../../../ocaml/Stdlib/index.html#val-stdin"><code>Stdlib.stdin</code></a> and not closed when the function returns. <code>End_of_file</code> exceptions raised by <code>f</code> are turned it into an error message.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read" class="anchored"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(string, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>read file</code> is <code>file</code>'s content as a string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_lines" class="anchored"><a href="#val-read_lines" class="anchor"></a><code><span><span class="keyword">val</span> read_lines : <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string list</span>, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>read_lines file</code> is <code>file</code>'s content, split at each <code>'\n'</code> character.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fold_lines" class="anchored"><a href="#val-fold_lines" class="anchor"></a><code><span><span class="keyword">val</span> fold_lines : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>fold_lines f acc file</code> is like <code>List.fold_left f acc (read_lines p)</code>.</p></div></div><h2 id="output"><a href="#output" class="anchor"></a>Output</h2><p>The following applies to every function in this section.</p><p><b>Stdout.</b> If the path is <a href="#val-dash"><code>dash</code></a>, bytes are written to <code>stdout</code>.</p><p><b>Default permission mode.</b> The optional <code>mode</code> argument specifies the permissions of the created file. It defaults to <code>0o644</code> (readable by everyone writeable by the user).</p><p><b>Atomic writes.</b> Files are written atomically by the functions. They create a temporary file <code>t</code> in the directory of the file <code>f</code> to write, write the contents to <code>t</code> and renames it to <code>f</code> on success. In case of error <code>t</code> is deleted and <code>f</code> left intact.</p><div class="odoc-spec"><div class="spec type" id="type-output" class="anchored"><a href="#type-output" class="anchor"></a><code><span><span class="keyword">type</span> output</span><span> = <span><span><span>(<a href="../../../../ocaml/Stdlib/Bytes/index.html#type-t">Bytes.t</a> * int * int)</span> option</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>The type for file outputs. The function is called by the client with <code>Some (b, pos, len)</code> to output the bytes of <code>b</code> in the range [<code>pos</code>;<code>pos+len</code>]. <code>None</code> is called to denote end of output.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_output" class="anchored"><a href="#val-with_output" class="anchor"></a><code><span><span class="keyword">val</span> with_output : <span>?mode:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-output">output</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../index.html#type-result">result</a></span> <span class="keyword">as</span> 'b)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>with_output file f v</code> writes the contents of <code>file</code> using an output <code>o</code> given to <code>f</code> and returns <code>Ok (f o v)</code>. <code>file</code> is not written if <code>f</code> returns an error. After the function returns (normally or via an exception) a call to <code>o</code> by the client raises <code>Invalid_argument</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_oc" class="anchored"><a href="#val-with_oc" class="anchor"></a><code><span><span class="keyword">val</span> with_oc : <span>?mode:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="../../../../ocaml/Stdlib/index.html#type-out_channel">out_channel</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../index.html#type-result">result</a></span> <span class="keyword">as</span> 'b)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>with_oc file f v</code> opens <code>file</code> as a channel <code>oc</code> and returns <code>Ok (f oc v)</code>. After the function returns (normally or via an exception) <code>oc</code> is closed. <code>file</code> is not written if <code>f</code> returns an error. If <code>file</code> is <a href="#val-dash"><code>dash</code></a>, <code>oc</code> is <a href="../../../../ocaml/Stdlib/index.html#val-stdout"><code>Stdlib.stdout</code></a> and not closed when the function returns.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write" class="anchored"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span>?mode:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>write file content</code> outputs <code>content</code> to <code>file</code>. If <code>file</code> is <a href="#val-dash"><code>dash</code></a>, writes to <a href="../../../../ocaml/Stdlib/index.html#val-stdout"><code>Stdlib.stdout</code></a>. If an error is returned <code>file</code> is left untouched except if <a href="../../../../ocaml/Stdlib/index.html#val-stdout"><code>Stdlib.stdout</code></a> is written.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-writef" class="anchored"><a href="#val-writef" class="anchor"></a><code><span><span class="keyword">val</span> writef : <span>?mode:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <a href="../../../../ocaml/Stdlib/Format/index.html#type-formatter">Format.formatter</a>, unit, <span><span>(unit, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span>)</span> <a href="../../../../ocaml/Stdlib/index.html#type-format4">format4</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>write file fmt ...</code> is like <code>write file (Format.asprintf fmt ...)</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_lines" class="anchored"><a href="#val-write_lines" class="anchor"></a><code><span><span class="keyword">val</span> write_lines : <span>?mode:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>write_lines file lines</code> is like <code>write file (String.concat
        ~sep:&quot;\n&quot; lines)</code>.</p></div></div><h2 id="tmpfiles"><a href="#tmpfiles" class="anchor"></a>Temporary files</h2><div class="odoc-spec"><div class="spec type" id="type-tmp_name_pat" class="anchored"><a href="#type-tmp_name_pat" class="anchor"></a><code><span><span class="keyword">type</span> tmp_name_pat</span><span> = <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> string, <a href="../../../../ocaml/Stdlib/Format/index.html#type-formatter">Format.formatter</a>, unit, string)</span> <a href="../../../../ocaml/Stdlib/index.html#type-format4">format4</a></span></span></code></div><div class="spec-doc"><p>The type for temporary file name patterns. The string format is replaced by random characters.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tmp" class="anchored"><a href="#val-tmp" class="anchor"></a><code><span><span class="keyword">val</span> tmp : <span>?mode:int <span class="arrow">&#45;&gt;</span></span> <span>?dir:<a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tmp_name_pat">tmp_name_pat</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a>, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>tmp mode dir pat</code> is a new empty temporary file in <code>dir</code> (defaults to <a href="../Dir/index.html#val-default_tmp"><code>Dir.default_tmp</code></a>) named according to <code>pat</code> and created with permissions <code>mode</code> (defaults to <code>0o600</code> only readable and writable by the user). The file is deleted at the end of program execution using a <a href="../../../../ocaml/Stdlib/index.html#val-at_exit"><code>Stdlib.at_exit</code></a> handler.</p><p><b>Warning.</b> If you want to write to the file, using <a href="#val-with_tmp_output"><code>with_tmp_output</code></a> or <a href="#val-with_tmp_oc"><code>with_tmp_oc</code></a> is more secure as it ensures that noone replaces the file, e.g. by a symbolic link, between the time you create the file and open it.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_tmp_output" class="anchored"><a href="#val-with_tmp_output" class="anchor"></a><code><span><span class="keyword">val</span> with_tmp_output : <span>?mode:int <span class="arrow">&#45;&gt;</span></span> <span>?dir:<a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tmp_name_pat">tmp_name_pat</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-output">output</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>with_tmp_output dir pat f v</code> is a new temporary file in <code>dir</code> (defaults to <a href="../Dir/index.html#val-default_tmp"><code>Dir.default_tmp</code></a>) named according to <code>pat</code> and atomically created and opened with permissions <code>mode</code> (defaults to <code>0o600</code> only readable and writable by the user). Returns <code>Ok (f file o v)</code> with <code>file</code> the file path and <code>o</code> an output to write the file. After the function returns (normally or via an exception), calls to <code>o</code> raise <code>Invalid_argument</code> and <code>file</code> is deleted.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_tmp_oc" class="anchored"><a href="#val-with_tmp_oc" class="anchor"></a><code><span><span class="keyword">val</span> with_tmp_oc : <span>?mode:int <span class="arrow">&#45;&gt;</span></span> <span>?dir:<a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tmp_name_pat">tmp_name_pat</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../ocaml/Stdlib/index.html#type-out_channel">out_channel</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'e</span>)</span> <a href="../index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>with_tmp_oc mode dir pat f v</code> is a new temporary file in <code>dir</code> (defaults to <a href="../Dir/index.html#val-default_tmp"><code>Dir.default_tmp</code></a>) named according to <code>pat</code> and atomically created and opened with permission <code>mode</code> (defaults to <code>0o600</code> only readable and writable by the user). Returns <code>Ok (f file oc v)</code> with <code>file</code> the file path and <code>oc</code> an output channel to write the file. After the function returns (normally or via an exception), <code>oc</code> is closed and <code>file</code> is deleted.</p></div></div></div></body></html>