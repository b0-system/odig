<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Private (vg.Vg.Vgr.Private)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">vg</a> &#x00BB; <a href="../../index.html">Vg</a> &#x00BB; <a href="../index.html">Vgr</a> &#x00BB; Private</nav><header class="odoc-preamble"><h1>Module <code><span>Vgr.Private</span></code></h1><p>Private functions for implementing renderers.</p><p><b>Warning.</b> <code>Vg</code> users should not use these definitions, they exposes <code>Vg</code>'s internals for implementing renderers. This functionality is subject to change even between minor versions of the library.</p><p>In order to provide a consistant interface for <code>Vg</code> users, renderer writers should follow the guidelines below. You may want to drop an email to the maintainer for help and discussion.</p><ul><li>If you render to &quot;Bla&quot;, define you renderer in a module called <code>Vgr_bla</code> (lowercase).</li><li>The renderer target creation function must be named <code>Vgr_bla.target</code>.</li><li>Images must be rendered via the <a href="../index.html#val-render"><code>render</code></a> function. If you are writing a batch renderer provide support for each of the <a href="../index.html#type-dst"><code>dst</code></a> types and especially the non-blocking interface.</li><li>Respect Vg's linear sRGB color model.</li><li>Whenever possible use an XMP metadata packet for metadata, see <a href="../index.html#val-xmp"><code>Vgr.xmp</code></a>.</li><li>The renderer should implement the rendering cost model, see the <code>limit</code> parameter of <a href="../index.html#val-render"><code>render</code></a>.</li><li>Follow <code>Vg</code>'s <a href="../../index.html#coordinates">coordinate system conventions</a> to specify the relationship between a target and the view rectangle to render.</li><li>If the renderer doesn't support <code>Vg</code>'s full rendering model or diverges from its semantics it must ignore unsupported features and warn the client via the <a href="../index.html#type-warn"><code>warn</code></a> function.</li></ul></header><nav class="odoc-toc"><ul><li><a href="#internal-data">Internal data</a></li><li><a href="#renderers">Renderers</a></li><li><a href="#writing--destinations">Writing <em></em> destinations</a></li><li><a href="#miscellaneous">Miscellaneous</a></li></ul></nav><div class="odoc-content"><h2 id="internal-data"><a href="#internal-data" class="anchor"></a>Internal data</h2><div class="odoc-spec"><div class="spec module" id="module-Data" class="anchored"><a href="#module-Data" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Data/index.html">Data</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Internal data.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Font" class="anchored"><a href="#module-Font" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Font/index.html">Font</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Font helpers.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-P" class="anchored"><a href="#module-P" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="P/index.html">P</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Paths helpers.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-I" class="anchored"><a href="#module-I" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="I/index.html">I</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Image helpers</p></div></div><h2 id="renderers"><a href="#renderers" class="anchor"></a>Renderers</h2><div class="odoc-spec"><div class="spec type" id="type-renderer" class="anchored"><a href="#type-renderer" class="anchor"></a><code><span><span class="keyword">type</span> renderer</span></code></div><div class="spec-doc"><p>The type for renderers.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-k" class="anchored"><a href="#type-k" class="anchor"></a><code><span><span class="keyword">type</span> k</span><span> = <span><a href="#type-renderer">renderer</a> <span class="arrow">&#45;&gt;</span></span> <span>[ `Ok <span>| `Partial</span> ]</span></span></code></div><div class="spec-doc"><p>The type for renderer continuations.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-render_fun" class="anchored"><a href="#type-render_fun" class="anchor"></a><code><span><span class="keyword">type</span> render_fun</span><span> = <span><span>[ `End <span><span>| `Image</span> of <a href="../../../../gg/Gg/index.html#type-size2">Gg.size2</a> * <a href="../../../../gg/Gg/index.html#type-box2">Gg.box2</a> * <a href="Data/index.html#type-image">Data.image</a></span> ]</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-k">k</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-k">k</a></span></code></div><div class="spec-doc"><p>The type for rendering functions.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-render_target" class="anchored"><a href="#type-render_target" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a render_target</span></span><span> = <span><a href="#type-renderer">renderer</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool * <a href="#type-render_fun">render_fun</a></span><span> <span class="keyword">constraint</span> <span class="type-var">'a</span> = <span>[&lt; <a href="../index.html#type-dst">dst</a> ]</span></span></code></div><div class="spec-doc"><p>The type for render targets. The function takes a created renderer and its destination. It should return a boolean indicating whether multiple images can be rendered on the target, and a function that is invoked by the renderer to render a new image or end the rendering sequence.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create_target" class="anchored"><a href="#val-create_target" class="anchor"></a><code><span><span class="keyword">val</span> create_target : <span><span><span class="type-var">'a</span> <a href="#type-render_target">render_target</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../index.html#type-target">target</a></span></span></code></div><div class="spec-doc"><p><code>create_target t</code> makes an end-user render target from <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-renderer" class="anchored"><a href="#val-renderer" class="anchor"></a><code><span><span class="keyword">val</span> renderer : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-renderer">renderer</a></span></code></div><div class="spec-doc"><p><code>renderer r</code> is <code>r</code>'s internal representation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-limit" class="anchored"><a href="#val-limit" class="anchor"></a><code><span><span class="keyword">val</span> limit : <span><a href="#type-renderer">renderer</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>limit r</code> is <code>r</code>'s render limit.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-warn" class="anchored"><a href="#val-warn" class="anchor"></a><code><span><span class="keyword">val</span> warn : <span><a href="#type-renderer">renderer</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-warning">warning</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>warn r w</code> reports the warning <code>w</code> on <code>r</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-partial" class="anchored"><a href="#val-partial" class="anchor"></a><code><span><span class="keyword">val</span> partial : <span><a href="#type-k">k</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-renderer">renderer</a> <span class="arrow">&#45;&gt;</span></span> <span>[&gt; `Partial ]</span></span></code></div><div class="spec-doc"><p><code>partial k r</code> suspends the renderer <code>r</code> and returns <code>`Partial</code>. Rendering will continue with <code>k r</code>, on <a href="../index.html#val-render"><code>render</code></a> <code>`Await</code>.</p></div></div><h2 id="writing--destinations"><a href="#writing--destinations" class="anchor"></a>Writing <em></em> destinations</h2><div class="odoc-spec"><div class="spec value" id="val-flush" class="anchored"><a href="#val-flush" class="anchor"></a><code><span><span class="keyword">val</span> flush : <span><a href="#type-k">k</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-renderer">renderer</a> <span class="arrow">&#45;&gt;</span></span> <span>[ `Ok <span>| `Partial</span> ]</span></span></code></div><div class="spec-doc"><p><code>flush k r</code> flushes the renderer <code>r</code>. If <code>r</code> writes on a stored destination this function <b>must</b> be called by the rendering function on <code>`End</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-writeb" class="anchored"><a href="#val-writeb" class="anchor"></a><code><span><span class="keyword">val</span> writeb : <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-k">k</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-renderer">renderer</a> <span class="arrow">&#45;&gt;</span></span> <span>[ `Ok <span>| `Partial</span> ]</span></span></code></div><div class="spec-doc"><p><code>writeb b k r</code> writes the byte <code>b</code> and <code>k</code>ontinues.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-writes" class="anchored"><a href="#val-writes" class="anchor"></a><code><span><span class="keyword">val</span> writes : <span>string <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-k">k</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-renderer">renderer</a> <span class="arrow">&#45;&gt;</span></span> <span>[ `Ok <span>| `Partial</span> ]</span></span></code></div><div class="spec-doc"><p><code>writes s j l k r</code> writes <code>l</code> bytes from <code>s</code> starting at <code>j</code> and <code>k</code>ontinues.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-writebuf" class="anchored"><a href="#val-writebuf" class="anchor"></a><code><span><span class="keyword">val</span> writebuf : <span><a href="../../../../ocaml/Stdlib/Buffer/index.html#type-t">Buffer.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-k">k</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-renderer">renderer</a> <span class="arrow">&#45;&gt;</span></span> <span>[ `Ok <span>| `Partial</span> ]</span></span></code></div><div class="spec-doc"><p><code>writebuf buf j l k r</code> write <code>l</code> bytes from <code>buf</code> starting at <code>j</code> and <code>k</code>ontinues.</p></div></div><h2 id="miscellaneous"><a href="#miscellaneous" class="anchor"></a>Miscellaneous</h2><div class="odoc-spec"><div class="spec value" id="val-add_xml_data" class="anchored"><a href="#val-add_xml_data" class="anchor"></a><code><span><span class="keyword">val</span> add_xml_data : <span><a href="../../../../ocaml/Stdlib/Buffer/index.html#type-t">Buffer.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>add_xml_data b s</code> adds <code>s</code> to <code>b</code>, escapes <code>'&lt;', '&gt;', '&amp;'</code> and <code>'&quot;'</code> (but <b>not</b> single quotes) and maps illegal XML unicode characters to the replacement character U+FFFD.</p></div></div></div></body></html>