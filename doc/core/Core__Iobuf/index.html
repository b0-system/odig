<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Core__Iobuf (core.Core__Iobuf)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">core</a> &#x00BB; Core__Iobuf</nav><h1>Module <code>Core__Iobuf</code></h1><p>A non-moving (in the GC sense) contiguous range of bytes, useful for I/O operations.</p><p>An iobuf consists of:</p><ul><li>bigstring</li><li>limits -- a subrange of the bigstring</li><li>window -- a subrange of the limits</li></ul><p>All iobuf operations are restricted to operate within the limits. Initially, the window of an iobuf is identical to its limits. A phantom type, the &quot;seek&quot; permission, controls whether or not code is allowed to change the limits and window. With seek permission, the limits can be <code>narrow</code>ed, but can never be widened, and the window can be set to an arbitrary subrange of the limits.</p><p>A phantom type controls whether code can read and write bytes in the bigstring (within the limits) or can only read them.</p><p>To present a restricted view of an iobuf to a client, one can create a sub-iobuf or add a type constraint.</p><p>Functions operate on the window unless the documentation or naming indicates otherwise.</p><nav class="toc"><ul><li><a href="#creation">Creation</a></li><li><a href="#accessors">Accessors</a></li><li><a href="#changing-the-limits">Changing the limits</a></li><li><a href="#changing-the-window">Changing the window</a></li><li><a href="#getting-and-setting-data">Getting and setting data</a></li><li><a href="#i/o">I/O</a></li><li><a href="#expert">Expert</a></li></ul></nav></header><dl><dt class="spec type" id="type-seek"><a href="#type-seek" class="anchor"></a><code><span class="keyword">type</span> <span class="keyword">nonrec</span> seek</code><code> = <a href="../Core/Iobuf_intf/index.html#type-seek">Core.Iobuf_intf.seek</a></code></dt></dl><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></span></summary><dl><dt class="spec value" id="val-sexp_of_seek"><a href="#val-sexp_of_seek" class="anchor"></a><code><span class="keyword">val</span> sexp_of_seek : <a href="index.html#type-seek">seek</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></dt></dl></details></div></div></div><dl><dt class="spec type" id="type-no_seek"><a href="#type-no_seek" class="anchor"></a><code><span class="keyword">type</span> <span class="keyword">nonrec</span> no_seek</code><code> = <a href="../Core/Iobuf_intf/index.html#type-no_seek">Core.Iobuf_intf.no_seek</a></code></dt></dl><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></span></summary><dl><dt class="spec value" id="val-sexp_of_no_seek"><a href="#val-sexp_of_no_seek" class="anchor"></a><code><span class="keyword">val</span> sexp_of_no_seek : <a href="index.html#type-no_seek">no_seek</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></dt></dl></details></div></div></div><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> (-'data_perm_read_write, +'seek_permission) t</code></dt><dd><p>The first type parameter controls whether the iobuf can be written to. The second type parameter controls whether the window and limits can be changed.</p><p>See the <code>Perms</code> module for information on how the first type parameter is used.</p><p>To allow <code>no_seek</code> or <code>seek</code> access, a function's type uses <code>_</code> rather than <code>no_seek</code> as the type argument to <code>t</code>. Using <code>_</code> allows the function to be directly applied to either permission. Using a specific permission would require code to use coercion <code>:&gt;</code>.</p><p>There is no <code>t_of_sexp</code>. One should use <code>Iobuf.Hexdump.t_of_sexp</code> or <code>sexp_opaque</code> as desired.</p></dd></dl><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../../base/Base/Invariant/index.html#module-type-S2">Core__.Import.Invariant.S2</a> <span class="keyword">with</span> <span class="keyword">type</span> ('rw, 'seek) <a href="../../base/Base/Invariant/module-type-S2/index.html#type-t">t</a> := (<span class="type-var">'rw</span>, <span class="type-var">'seek</span>) <a href="index.html#type-t">t</a></code></span></summary><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> ('a, 'b) t</code></dt></dl><dl><dt class="spec value" id="val-invariant"><a href="#val-invariant" class="anchor"></a><code><span class="keyword">val</span> invariant : <span class="type-var">'a</span> <a href="../../base/Base__/Invariant_intf/index.html#type-inv">Base__.Invariant_intf.inv</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="../../base/Base__/Invariant_intf/index.html#type-inv">Base__.Invariant_intf.inv</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <a href="../../base/Base__/Invariant_intf/index.html#type-inv">Base__.Invariant_intf.inv</a></code></dt></dl></details></div></div></div><dl><dt class="spec module" id="module-Window"><a href="#module-Window" class="anchor"></a><code><span class="keyword">module</span> <a href="Window/index.html">Window</a> : <a href="../../core_kernel/Core_kernel/Hexdump/index.html#module-type-S2">Core__.Import.Hexdump.S2</a> <span class="keyword">with</span> <span class="keyword">type</span> ('rw, 'seek) <a href="../../core_kernel/Core_kernel/Hexdump/module-type-S2/index.html#type-t">t</a> := (<span class="type-var">'rw</span>, <span class="type-var">'seek</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Provides a <code>Window.Hexdump</code> submodule that renders the contents of <code>t</code>'s window.</p></dd></dl><dl><dt class="spec module" id="module-Limits"><a href="#module-Limits" class="anchor"></a><code><span class="keyword">module</span> <a href="Limits/index.html">Limits</a> : <a href="../../core_kernel/Core_kernel/Hexdump/index.html#module-type-S2">Core__.Import.Hexdump.S2</a> <span class="keyword">with</span> <span class="keyword">type</span> ('rw, 'seek) <a href="../../core_kernel/Core_kernel/Hexdump/module-type-S2/index.html#type-t">t</a> := (<span class="type-var">'rw</span>, <span class="type-var">'seek</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Provides a <code>Window.Hexdump</code> submodule that renders the contents of <code>t</code>'s limits.</p></dd></dl><div><div class="spec include"><div class="doc"><p>Provides a <code>Hexdump</code> submodule that renders the contents of <code>t</code>'s window and limits using indices relative to the limits.</p><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../Core/Iobuf_intf/index.html#module-type-Compound_hexdump">Core.Iobuf_intf.Compound_hexdump</a> <span class="keyword">with</span> <span class="keyword">type</span> ('rw, 'seek) <a href="../Core/Iobuf_intf/module-type-Compound_hexdump/index.html#type-t">t</a> := (<span class="type-var">'rw</span>, <span class="type-var">'seek</span>) <a href="index.html#type-t">t</a></code></span></summary><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> ('rw, 'seek) t</code></dt></dl><div class="spec module" id="module-Hexdump"><a href="#module-Hexdump" class="anchor"></a><code><span class="keyword">module</span> <a href="Hexdump/index.html">Hexdump</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></details></div></div></div><dl><dt class="spec module" id="module-Debug"><a href="#module-Debug" class="anchor"></a><code><span class="keyword">module</span> <a href="Debug/index.html">Debug</a> : <a href="../Core/Iobuf_intf/index.html#module-type-Compound_hexdump">Core.Iobuf_intf.Compound_hexdump</a> <span class="keyword">with</span> <span class="keyword">type</span> ('rw, 'seek) <a href="../Core/Iobuf_intf/module-type-Compound_hexdump/index.html#type-t">t</a> := (<span class="type-var">'rw</span>, <span class="type-var">'seek</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Provides a <code>Debug.Hexdump</code> submodule that renders the contents of <code>t</code>'s window, limits, and underlying bigstring using indices relative to the bigstring.</p></dd></dl><section><header><h3 id="creation"><a href="#creation" class="anchor"></a>Creation</h3></header><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : len:int <span>&#45;&gt;</span> (<span class="type-var">_</span>, <span class="type-var">_</span>) <a href="index.html#type-t">t</a></code></dt><dd><p><code>create ~len</code> creates a new iobuf, backed by a bigstring of length <code>len</code>, with the limits and window set to the entire bigstring.</p></dd></dl><dl><dt class="spec value" id="val-of_bigstring"><a href="#val-of_bigstring" class="anchor"></a><code><span class="keyword">val</span> of_bigstring : ?&#8288;pos:int <span>&#45;&gt;</span> ?&#8288;len:int <span>&#45;&gt;</span> <a href="../../core_kernel/Core_kernel/Bigstring/index.html#type-t">Core__.Import.Bigstring.t</a> <span>&#45;&gt;</span> ([&lt; <a href="../Core__/Import/index.html#type-read_write">Core__.Import.read_write</a> ], <span class="type-var">_</span>) <a href="index.html#type-t">t</a></code></dt><dd><p><code>of_bigstring bigstring ~pos ~len</code> returns an iobuf backed by <code>bigstring</code>, with the window and limits specified starting at <code>pos</code> and of length <code>len</code>.</p><p>forbid <code>immutable</code> to prevent aliasing</p></dd></dl><dl><dt class="spec value" id="val-of_string"><a href="#val-of_string" class="anchor"></a><code><span class="keyword">val</span> of_string : string <span>&#45;&gt;</span> (<span class="type-var">_</span>, <span class="type-var">_</span>) <a href="index.html#type-t">t</a></code></dt><dd><p><code>of_string s</code> returns a new iobuf whose contents are <code>s</code>.</p></dd></dl><dl><dt class="spec value" id="val-sub_shared"><a href="#val-sub_shared" class="anchor"></a><code><span class="keyword">val</span> sub_shared : ?&#8288;pos:int <span>&#45;&gt;</span> ?&#8288;len:int <span>&#45;&gt;</span> (<span class="type-var">'d</span>, <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'d</span>, <span class="type-var">_</span>) <a href="index.html#type-t">t</a></code></dt><dd><p><code>sub_shared t ~pos ~len</code> returns a new iobuf with limits and window set to the subrange of <code>t</code>'s window specified by <code>pos</code> and <code>len</code>. <code>sub_shared</code> preserves data permissions, but allows arbitrary seek permissions on the resulting iobuf.</p></dd></dl><dl><dt class="spec value" id="val-set_bounds_and_buffer"><a href="#val-set_bounds_and_buffer" class="anchor"></a><code><span class="keyword">val</span> set_bounds_and_buffer : src:([&gt; <a href="../Core__/Import/index.html#type-write">Core__.Import.write</a> ] <span class="keyword">as</span> data, <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> dst:(<span class="type-var">'data</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_bounds_and_buffer ~src ~dst</code> copies bounds metadata (i.e., limits and window) and shallowly copies the buffer (data pointer) from <code>src</code> to <code>dst</code>. It does not access data, but does allow access through <code>dst</code>. This makes <code>dst</code> an alias of <code>src</code>.</p><p>Because <code>set_bounds_and_buffer</code> creates an alias, we disallow immutable <code>src</code> and <code>dst</code> using <code>[&gt; write]</code>. Otherwise, one of <code>src</code> or <code>dst</code> could be <code>read_write :&gt;
    read</code> and the other <code>immutable :&gt; read</code>, which would allow you to write the <code>immutable</code> alias's data through the <code>read_write</code> alias.</p><p><code>set_bounds_and_buffer</code> is typically used with a frame iobuf that need only be allocated once. This frame can be updated repeatedly and handed to users, without further allocation. Allocation-sensitive applications need this.</p></dd></dl><dl><dt class="spec value" id="val-set_bounds_and_buffer_sub"><a href="#val-set_bounds_and_buffer_sub" class="anchor"></a><code><span class="keyword">val</span> set_bounds_and_buffer_sub : pos:int <span>&#45;&gt;</span> len:int <span>&#45;&gt;</span> src:([&gt; <a href="../Core__/Import/index.html#type-write">Core__.Import.write</a> ] <span class="keyword">as</span> data, <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> dst:(<span class="type-var">'data</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_bounds_and_buffer_sub ~pos ~len ~src ~dst</code> is a more efficient version of <code>set_bounds_and_buffer ~src:(Iobuf.sub_shared ~pos ~len src) ~dst</code>.</p><p><code>set_bounds_and_buffer ~src ~dst</code> is not the same as <code>set_bounds_and_buffer_sub ~dst
    ~src ~len:(Iobuf.length src)</code> because the limits are narrowed in the latter case.</p><p><code>~len</code> and <code>~pos</code> are mandatory for performance reasons, in concert with <code>@@inline</code>. If they were optional, allocation would be necessary when passing a non-default, non-constant value, which is an important use case.</p></dd></dl><dl><dt class="spec value" id="val-read_only"><a href="#val-read_only" class="anchor"></a><code><span class="keyword">val</span> read_only : ([&gt; <a href="../Core__/Import/index.html#type-read">Core__.Import.read</a> ], <span class="type-var">'s</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<a href="../Core__/Import/index.html#type-read">Core__.Import.read</a>, <span class="type-var">'s</span>) <a href="index.html#type-t">t</a></code></dt><dd><h3 id="generalization"><a href="#generalization" class="anchor"></a>Generalization</h3><p>One may wonder why you'd want to call <code>no_seek</code>, given that a cast is already possible, e.g., <code>t : (_, seek) t :&gt; (_, no_seek) t</code>. It turns out that if you want to define some <code>f : (_, _) t -&gt; unit</code> of your own that can be conveniently applied to <code>seek</code> iobufs without the user having to cast <code>seek</code> up, you need this <code>no_seek</code> function.</p><p><code>read_only</code> is more of a historical convenience now that <code>read_write</code> is a polymorphic variant, as one can now explicitly specify the general type for an argument with something like <code>t : (_ perms, _) t :&gt; (read, _) t</code>.</p></dd></dl><dl><dt class="spec value" id="val-no_seek"><a href="#val-no_seek" class="anchor"></a><code><span class="keyword">val</span> no_seek : (<span class="type-var">'r</span>, <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'r</span>, <a href="index.html#type-no_seek">no_seek</a>) <a href="index.html#type-t">t</a></code></dt></dl></section><section><header><h3 id="accessors"><a href="#accessors" class="anchor"></a>Accessors</h3></header><dl><dt class="spec value" id="val-capacity"><a href="#val-capacity" class="anchor"></a><code><span class="keyword">val</span> capacity : (<span class="type-var">_</span>, <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>capacity t</code> returns the size of <code>t</code>'s limits subrange. The capacity of an iobuf can be reduced via <code>narrow</code>.</p></dd></dl><dl><dt class="spec value" id="val-length"><a href="#val-length" class="anchor"></a><code><span class="keyword">val</span> length : (<span class="type-var">_</span>, <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>length t</code> returns the size of <code>t</code>'s window.</p></dd></dl><dl><dt class="spec value" id="val-is_empty"><a href="#val-is_empty" class="anchor"></a><code><span class="keyword">val</span> is_empty : (<span class="type-var">_</span>, <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>is_empty t</code> is <code>length t = 0</code>.</p></dd></dl></section><section><header><h3 id="changing-the-limits"><a href="#changing-the-limits" class="anchor"></a>Changing the limits</h3></header><dl><dt class="spec value" id="val-narrow"><a href="#val-narrow" class="anchor"></a><code><span class="keyword">val</span> narrow : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>narrow t</code> sets <code>t</code>'s limits to the current window.</p></dd></dl><dl><dt class="spec value" id="val-narrow_lo"><a href="#val-narrow_lo" class="anchor"></a><code><span class="keyword">val</span> narrow_lo : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>narrow_lo t</code> sets <code>t</code>'s lower limit to the beginning of the current window.</p></dd></dl><dl><dt class="spec value" id="val-narrow_hi"><a href="#val-narrow_hi" class="anchor"></a><code><span class="keyword">val</span> narrow_hi : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>narrow_hi t</code> sets <code>t</code>'s upper limit to the end of the current window.</p></dd></dl></section><section><header><h3 id="changing-the-window"><a href="#changing-the-window" class="anchor"></a>Changing the window</h3></header><aside><p>One can call <code>Lo_bound.window t</code> to get a snapshot of the lower bound of the window, and then later restore that snapshot with <code>Lo_bound.restore</code>. This is useful for speculatively parsing, and then rewinding when there isn't enough data to finish.</p><p>Similarly for <code>Hi_bound.window</code> and <code>Lo_bound.restore</code>.</p><p>Using a snapshot with a different iobuf, even a sub iobuf of the snapshotted one, has unspecified results. An exception may be raised, or a silent error may occur. However, the safety guarantees of the iobuf will not be violated, i.e., the attempt will not enlarge the limits of the subject iobuf.</p></aside><div class="spec module-type" id="module-type-Bound"><a href="#module-type-Bound" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Bound/index.html">Bound</a> : <a href="../Core/Iobuf_intf/index.html#module-type-Bound">Core.Iobuf_intf.Bound</a> <span class="keyword">with</span> <span class="keyword">type</span> ('d, 'w) <a href="module-type-Bound/index.html#type-iobuf">iobuf</a> := (<span class="type-var">'d</span>, <span class="type-var">'w</span>) <a href="index.html#type-t">t</a></code></div><div class="spec module" id="module-Lo_bound"><a href="#module-Lo_bound" class="anchor"></a><code><span class="keyword">module</span> <a href="Lo_bound/index.html">Lo_bound</a> : <a href="index.html#module-type-Bound">Bound</a></code></div><div class="spec module" id="module-Hi_bound"><a href="#module-Hi_bound" class="anchor"></a><code><span class="keyword">module</span> <a href="Hi_bound/index.html">Hi_bound</a> : <a href="index.html#module-type-Bound">Bound</a></code></div><dl><dt class="spec value" id="val-advance"><a href="#val-advance" class="anchor"></a><code><span class="keyword">val</span> advance : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> unit</code></dt><dd><p><code>advance t amount</code> advances the lower bound of the window by <code>amount</code>. It is an error to advance past the upper bound of the window or the lower limit.</p></dd></dl><dl><dt class="spec value" id="val-unsafe_advance"><a href="#val-unsafe_advance" class="anchor"></a><code><span class="keyword">val</span> unsafe_advance : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> unit</code></dt><dd><p><code>unsafe_advance</code> is like <code>advance</code> but with no bounds checking, so incorrect usage can easily cause segfaults.</p></dd></dl><dl><dt class="spec value" id="val-resize"><a href="#val-resize" class="anchor"></a><code><span class="keyword">val</span> resize : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> len:int <span>&#45;&gt;</span> unit</code></dt><dd><p><code>resize t</code> sets the length of <code>t</code>'s window, provided it does not exceed limits.</p></dd></dl><dl><dt class="spec value" id="val-unsafe_resize"><a href="#val-unsafe_resize" class="anchor"></a><code><span class="keyword">val</span> unsafe_resize : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> len:int <span>&#45;&gt;</span> unit</code></dt><dd><p><code>unsafe_resize</code> is like <code>resize</code> but with no bounds checking, so incorrect usage can easily cause segfaults.</p></dd></dl><dl><dt class="spec value" id="val-rewind"><a href="#val-rewind" class="anchor"></a><code><span class="keyword">val</span> rewind : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>rewind t</code> sets the lower bound of the window to the lower limit.</p></dd></dl><dl><dt class="spec value" id="val-reset"><a href="#val-reset" class="anchor"></a><code><span class="keyword">val</span> reset : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>reset t</code> sets the window to the limits.</p></dd></dl><dl><dt class="spec value" id="val-flip_lo"><a href="#val-flip_lo" class="anchor"></a><code><span class="keyword">val</span> flip_lo : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>flip_lo t</code> sets the window to range from the lower limit to the lower bound of the old window. This is typically called after a series of <code>Fill</code>s, to reposition the window in preparation to <code>Consume</code> the newly written data.</p><p>The bounded version narrows the effective limit. This can preserve some data near the limit, such as a hypothetical packet header (in the case of <code>bounded_flip_lo</code>) or unfilled suffix of a buffer (in <code>bounded_flip_hi</code>).</p></dd></dl><dl><dt class="spec value" id="val-bounded_flip_lo"><a href="#val-bounded_flip_lo" class="anchor"></a><code><span class="keyword">val</span> bounded_flip_lo : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Lo_bound/index.html#type-t">Lo_bound.t</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-compact"><a href="#val-compact" class="anchor"></a><code><span class="keyword">val</span> compact : (<a href="../Core__/Import/index.html#type-read_write">Core__.Import.read_write</a>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>compact t</code> copies data from the window to the lower limit of the iobuf and sets the window to range from the end of the copied data to the upper limit. This is typically called after a series of <code>Consume</code>s to save unread data and prepare for the next series of <code>Fill</code>s and <code>flip_lo</code>.</p></dd></dl><dl><dt class="spec value" id="val-bounded_compact"><a href="#val-bounded_compact" class="anchor"></a><code><span class="keyword">val</span> bounded_compact : (<a href="../Core__/Import/index.html#type-read_write">Core__.Import.read_write</a>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Lo_bound/index.html#type-t">Lo_bound.t</a> <span>&#45;&gt;</span> <a href="Hi_bound/index.html#type-t">Hi_bound.t</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-flip_hi"><a href="#val-flip_hi" class="anchor"></a><code><span class="keyword">val</span> flip_hi : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>flip_hi t</code> sets the window to range from the the upper bound of the current window to the upper limit. This operation is dual to <code>flip_lo</code> and is typically called when the data in the current (narrowed) window has been processed and the window needs to be positioned over the remaining data in the buffer. For example:</p><pre><code class="ml">(* ... determine initial_data_len ... *)
Iobuf.resize buf ~len:initial_data_len;
(* ... and process initial data ... *)
Iobuf.flip_hi buf;</code></pre><p>Now the window of <code>buf</code> ranges over the remainder of the data.</p></dd></dl><dl><dt class="spec value" id="val-bounded_flip_hi"><a href="#val-bounded_flip_hi" class="anchor"></a><code><span class="keyword">val</span> bounded_flip_hi : (<span class="type-var">_</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Hi_bound/index.html#type-t">Hi_bound.t</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-protect_window_and_bounds"><a href="#val-protect_window_and_bounds" class="anchor"></a><code><span class="keyword">val</span> protect_window_and_bounds : (<span class="type-var">'rw</span>, <a href="index.html#type-no_seek">no_seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> f:((<span class="type-var">'rw</span>, <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>protect_window_and_bounds t ~f</code> applies <code>f</code> to <code>t</code> and restores <code>t</code>'s bounds and buffer afterward.</p></dd></dl></section><section><header><h3 id="getting-and-setting-data"><a href="#getting-and-setting-data" class="anchor"></a>Getting and setting data</h3><p>&quot;consume&quot; and &quot;fill&quot; functions access data at the lower bound of the window and advance the lower bound of the window. &quot;peek&quot; and &quot;poke&quot; functions access data but do not advance the window.</p></header><dl><dt class="spec value" id="val-to_string"><a href="#val-to_string" class="anchor"></a><code><span class="keyword">val</span> to_string : ?&#8288;len:int <span>&#45;&gt;</span> ([&gt; <a href="../Core__/Import/index.html#type-read">Core__.Import.read</a> ], <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>to_string t</code> returns the bytes in <code>t</code> as a string. It does not alter the window.</p></dd></dl><dl><dt class="spec value" id="val-to_string_hum"><a href="#val-to_string_hum" class="anchor"></a><code><span class="keyword">val</span> to_string_hum : ?&#8288;max_lines:int <span>&#45;&gt;</span> (<span class="type-var">_</span>, <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Equivalent to <code>Hexdump.to_string_hum</code>. Renders <code>t</code>'s windows and limits.</p></dd></dl><dl><dt class="spec module" id="module-Consume"><a href="#module-Consume" class="anchor"></a><code><span class="keyword">module</span> <a href="Consume/index.html">Consume</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>Consume.string t ~len</code> reads <code>len</code> characters (all, by default) from <code>t</code> into a new string and advances the lower bound of the window accordingly.</p></dd></dl><dl><dt class="spec module" id="module-Fill"><a href="#module-Fill" class="anchor"></a><code><span class="keyword">module</span> <a href="Fill/index.html">Fill</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>Fill.bin_prot X.bin_write_t t x</code> writes <code>x</code> to <code>t</code> in bin-prot form, advancing past the bytes written.</p></dd></dl><dl><dt class="spec module" id="module-Peek"><a href="#module-Peek" class="anchor"></a><code><span class="keyword">module</span> <a href="Peek/index.html">Peek</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>Peek</code> and <code>Poke</code> functions access a value at <code>pos</code> from the lower bound of the window and do not advance.</p></dd></dl><dl><dt class="spec module" id="module-Poke"><a href="#module-Poke" class="anchor"></a><code><span class="keyword">module</span> <a href="Poke/index.html">Poke</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>Poke.bin_prot X.bin_write_t t x</code> writes <code>x</code> to the beginning of <code>t</code> in binary form without advancing. You can use <code>X.bin_size_t</code> to tell how long it was. <code>X.bin_write_t</code> is only allowed to write that portion of the buffer you have access to.</p></dd></dl><dl><dt class="spec module" id="module-Unsafe"><a href="#module-Unsafe" class="anchor"></a><code><span class="keyword">module</span> <a href="Unsafe/index.html">Unsafe</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>Unsafe</code> has submodules that are like their corresponding module, except with no range checks. Hence, mistaken uses can cause segfaults. Be careful!</p></dd></dl><dl><dt class="spec value" id="val-crc32"><a href="#val-crc32" class="anchor"></a><code><span class="keyword">val</span> crc32 : ([&gt; <a href="../Core__/Import/index.html#type-read">Core__.Import.read</a> ], <span class="type-var">_</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../core_kernel/Core_kernel/Int63/index.html#type-t">Core__.Import.Int63.t</a></code></dt><dt class="spec value" id="val-bin_prot_length_prefix_bytes"><a href="#val-bin_prot_length_prefix_bytes" class="anchor"></a><code><span class="keyword">val</span> bin_prot_length_prefix_bytes : int</code></dt><dd><p>The number of bytes in the length prefix of <code>consume_bin_prot</code> and <code>fill_bin_prot</code>.</p></dd></dl><dl><dt class="spec value" id="val-fill_bin_prot"><a href="#val-fill_bin_prot" class="anchor"></a><code><span class="keyword">val</span> fill_bin_prot : ([&gt; <a href="../Core__/Import/index.html#type-write">Core__.Import.write</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../bin_prot/Bin_prot/Type_class/index.html#type-writer">Bin_prot.Type_class.writer</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit <a href="../../core_kernel/Core_kernel/Or_error/index.html#type-t">Core__.Import.Or_error.t</a></code></dt><dd><p><code>fill_bin_prot</code> writes a bin-prot value to the lower bound of the window, prefixed by its length, and advances by the amount written. <code>fill_bin_prot</code> returns an error if the window is too small to write the value.</p><p><code>consume_bin_prot t reader</code> reads a bin-prot value from the lower bound of the window, which should have been written using <code>fill_bin_prot</code>, and advances the window by the amount read. <code>consume_bin_prot</code> returns an error if there is not a complete message in the window and in that case the window is left unchanged.</p><p>Don't use these without a good reason, as they are incompatible with similar functions in <code>Reader</code> and <code>Writer</code>. They use a 4-byte length rather than an 8-byte length.</p></dd></dl><dl><dt class="spec value" id="val-consume_bin_prot"><a href="#val-consume_bin_prot" class="anchor"></a><code><span class="keyword">val</span> consume_bin_prot : ([&gt; <a href="../Core__/Import/index.html#type-read">Core__.Import.read</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../bin_prot/Bin_prot/Type_class/index.html#type-reader">Bin_prot.Type_class.reader</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../core_kernel/Core_kernel/Or_error/index.html#type-t">Core__.Import.Or_error.t</a></code></dt></dl><dl><dt class="spec module" id="module-Blit"><a href="#module-Blit" class="anchor"></a><code><span class="keyword">module</span> <a href="Blit/index.html">Blit</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>Blit</code> copies between iobufs and advances neither <code>src</code> nor <code>dst</code>.</p></dd></dl><dl><dt class="spec module" id="module-Blit_consume"><a href="#module-Blit_consume" class="anchor"></a><code><span class="keyword">module</span> <a href="Blit_consume/index.html">Blit_consume</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>Blit_consume</code> copies between iobufs and advances <code>src</code> but does not advance <code>dst</code>.</p></dd></dl><dl><dt class="spec module" id="module-Blit_fill"><a href="#module-Blit_fill" class="anchor"></a><code><span class="keyword">module</span> <a href="Blit_fill/index.html">Blit_fill</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>Blit_fill</code> copies between iobufs and advances <code>dst</code> but does not advance <code>src</code>.</p></dd></dl><dl><dt class="spec module" id="module-Blit_consume_and_fill"><a href="#module-Blit_consume_and_fill" class="anchor"></a><code><span class="keyword">module</span> <a href="Blit_consume_and_fill/index.html">Blit_consume_and_fill</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>Blit_consume_and_fill</code> copies between iobufs and advances both <code>src</code> and <code>dst</code>.</p></dd></dl></section><section><header><h3 id="i/o"><a href="#i/o" class="anchor"></a>I/O</h3></header><dl><dt class="spec type" id="type-ok_or_eof"><a href="#type-ok_or_eof" class="anchor"></a><code><span class="keyword">type</span> ok_or_eof</code><code> = </code><table class="variant"><tr id="type-ok_or_eof.Ok" class="anchored"><td class="def constructor"><a href="#type-ok_or_eof.Ok" class="anchor"></a><code>| </code><code><span class="constructor">Ok</span></code></td></tr><tr id="type-ok_or_eof.Eof" class="anchored"><td class="def constructor"><a href="#type-ok_or_eof.Eof" class="anchor"></a><code>| </code><code><span class="constructor">Eof</span></code></td></tr></table></dt></dl><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></span></summary><dl><dt class="spec value" id="val-compare_ok_or_eof"><a href="#val-compare_ok_or_eof" class="anchor"></a><code><span class="keyword">val</span> compare_ok_or_eof : <a href="index.html#type-ok_or_eof">ok_or_eof</a> <span>&#45;&gt;</span> <a href="index.html#type-ok_or_eof">ok_or_eof</a> <span>&#45;&gt;</span> int</code></dt><dt class="spec value" id="val-sexp_of_ok_or_eof"><a href="#val-sexp_of_ok_or_eof" class="anchor"></a><code><span class="keyword">val</span> sexp_of_ok_or_eof : <a href="index.html#type-ok_or_eof">ok_or_eof</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></dt></dl></details></div></div></div><dl><dt class="spec value" id="val-input"><a href="#val-input" class="anchor"></a><code><span class="keyword">val</span> input : ([&gt; <a href="../Core__/Import/index.html#type-write">Core__.Import.write</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../stdio/Stdio/In_channel/index.html#type-t">Core__.Import.In_channel.t</a> <span>&#45;&gt;</span> <a href="index.html#type-ok_or_eof">ok_or_eof</a></code></dt><dd><p><code>Iobuf</code> has analogs of various <code>Bigstring</code> functions. These analogs advance by the amount written/read.</p></dd></dl><dl><dt class="spec value" id="val-read"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : ([&gt; <a href="../Core__/Import/index.html#type-write">Core__.Import.write</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Core__Core_unix/File_descr/index.html#type-t">Core.Iobuf_intf.Unix.File_descr.t</a> <span>&#45;&gt;</span> <a href="index.html#type-ok_or_eof">ok_or_eof</a></code></dt><dt class="spec value" id="val-read_assume_fd_is_nonblocking"><a href="#val-read_assume_fd_is_nonblocking" class="anchor"></a><code><span class="keyword">val</span> read_assume_fd_is_nonblocking : ([&gt; <a href="../Core__/Import/index.html#type-write">Core__.Import.write</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Core__Core_unix/File_descr/index.html#type-t">Core.Iobuf_intf.Unix.File_descr.t</a> <span>&#45;&gt;</span> <a href="../Core__Syscall_result/Unit/index.html#type-t">Core__.Syscall_result.Unit.t</a></code></dt><dt class="spec value" id="val-pread_assume_fd_is_nonblocking"><a href="#val-pread_assume_fd_is_nonblocking" class="anchor"></a><code><span class="keyword">val</span> pread_assume_fd_is_nonblocking : ([&gt; <a href="../Core__/Import/index.html#type-write">Core__.Import.write</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Core__Core_unix/File_descr/index.html#type-t">Core.Iobuf_intf.Unix.File_descr.t</a> <span>&#45;&gt;</span> offset:int <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-recvfrom_assume_fd_is_nonblocking"><a href="#val-recvfrom_assume_fd_is_nonblocking" class="anchor"></a><code><span class="keyword">val</span> recvfrom_assume_fd_is_nonblocking : ([&gt; <a href="../Core__/Import/index.html#type-write">Core__.Import.write</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Core__Core_unix/File_descr/index.html#type-t">Core.Iobuf_intf.Unix.File_descr.t</a> <span>&#45;&gt;</span> <a href="../Core__/Core_unix/index.html#type-sockaddr">Core.Iobuf_intf.Unix.sockaddr</a></code></dt></dl><dl><dt class="spec module" id="module-Recvmmsg_context"><a href="#module-Recvmmsg_context" class="anchor"></a><code><span class="keyword">module</span> <a href="Recvmmsg_context/index.html">Recvmmsg_context</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span> <span class="keyword">with</span> <span class="keyword">type</span> ('rw, 'seek) <a href="Recvmmsg_context/index.html#type-iobuf">iobuf</a> := (<span class="type-var">'rw</span>, <span class="type-var">'seek</span>) <a href="index.html#type-t">t</a></code></dt><dd><p><code>recvmmsg</code>'s context comprises data needed by the system call. Setup can be expensive, particularly for many buffers.</p></dd></dl><dl><dt class="spec value" id="val-recvmmsg_assume_fd_is_nonblocking"><a href="#val-recvmmsg_assume_fd_is_nonblocking" class="anchor"></a><code><span class="keyword">val</span> recvmmsg_assume_fd_is_nonblocking : (<a href="../Core__Core_unix/File_descr/index.html#type-t">Core.Iobuf_intf.Unix.File_descr.t</a> <span>&#45;&gt;</span> <a href="Recvmmsg_context/index.html#type-t">Recvmmsg_context.t</a> <span>&#45;&gt;</span> <a href="../Core__Syscall_result/Int/index.html#type-t">Core.Iobuf_intf.Unix.Syscall_result.Int.t</a>) <a href="../../core_kernel/Core_kernel/Or_error/index.html#type-t">Core__.Import.Or_error.t</a></code></dt><dd><p><code>recvmmsg_assume_fd_is_nonblocking fd context</code> returns the number of <code>context</code> iobufs read into (or <code>errno</code>). <code>fd</code> must not block. <code>THREAD_IO_CUTOFF</code> is ignored.</p><p><code>EINVAL</code> is returned if an <code>Iobuf</code> passed to <code>Recvmmsg_context.create</code> has its <code>buf</code> or limits changed.</p></dd></dl><dl><dt class="spec value" id="val-send_nonblocking_no_sigpipe"><a href="#val-send_nonblocking_no_sigpipe" class="anchor"></a><code><span class="keyword">val</span> send_nonblocking_no_sigpipe : unit <span>&#45;&gt;</span> (([&gt; <a href="../Core__/Import/index.html#type-read">Core__.Import.read</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Core__Core_unix/File_descr/index.html#type-t">Core.Iobuf_intf.Unix.File_descr.t</a> <span>&#45;&gt;</span> <a href="../Core__Syscall_result/Unit/index.html#type-t">Core.Iobuf_intf.Unix.Syscall_result.Unit.t</a>) <a href="../../core_kernel/Core_kernel/Or_error/index.html#type-t">Core__.Import.Or_error.t</a></code></dt><dt class="spec value" id="val-sendto_nonblocking_no_sigpipe"><a href="#val-sendto_nonblocking_no_sigpipe" class="anchor"></a><code><span class="keyword">val</span> sendto_nonblocking_no_sigpipe : unit <span>&#45;&gt;</span> (([&gt; <a href="../Core__/Import/index.html#type-read">Core__.Import.read</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Core__Core_unix/File_descr/index.html#type-t">Core.Iobuf_intf.Unix.File_descr.t</a> <span>&#45;&gt;</span> <a href="../Core__/Core_unix/index.html#type-sockaddr">Core.Iobuf_intf.Unix.sockaddr</a> <span>&#45;&gt;</span> <a href="../Core__Syscall_result/Unit/index.html#type-t">Core.Iobuf_intf.Unix.Syscall_result.Unit.t</a>) <a href="../../core_kernel/Core_kernel/Or_error/index.html#type-t">Core__.Import.Or_error.t</a></code></dt><dt class="spec value" id="val-output"><a href="#val-output" class="anchor"></a><code><span class="keyword">val</span> output : ([&gt; <a href="../Core__/Import/index.html#type-read">Core__.Import.read</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../stdio/Stdio/Out_channel/index.html#type-t">Core__.Import.Out_channel.t</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-write"><a href="#val-write" class="anchor"></a><code><span class="keyword">val</span> write : ([&gt; <a href="../Core__/Import/index.html#type-read">Core__.Import.read</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Core__Core_unix/File_descr/index.html#type-t">Core.Iobuf_intf.Unix.File_descr.t</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-write_assume_fd_is_nonblocking"><a href="#val-write_assume_fd_is_nonblocking" class="anchor"></a><code><span class="keyword">val</span> write_assume_fd_is_nonblocking : ([&gt; <a href="../Core__/Import/index.html#type-read">Core__.Import.read</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Core__Core_unix/File_descr/index.html#type-t">Core.Iobuf_intf.Unix.File_descr.t</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-pwrite_assume_fd_is_nonblocking"><a href="#val-pwrite_assume_fd_is_nonblocking" class="anchor"></a><code><span class="keyword">val</span> pwrite_assume_fd_is_nonblocking : ([&gt; <a href="../Core__/Import/index.html#type-read">Core__.Import.read</a> ], <a href="index.html#type-seek">seek</a>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Core__Core_unix/File_descr/index.html#type-t">Core.Iobuf_intf.Unix.File_descr.t</a> <span>&#45;&gt;</span> offset:int <span>&#45;&gt;</span> unit</code></dt></dl></section><section><header><h3 id="expert"><a href="#expert" class="anchor"></a>Expert</h3></header><dl><dt class="spec module" id="module-Expert"><a href="#module-Expert" class="anchor"></a><code><span class="keyword">module</span> <a href="Expert/index.html">Expert</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>The <code>Expert</code> module is for building efficient out-of-module <code>Iobuf</code> abstractions.</p></dd></dl></section></div></body></html>