<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Guard (b0.B00.Guard)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">b0</a> &#x00BB; <a href="../index.html">B00</a> &#x00BB; Guard</nav><h1>Module <code>B00.Guard</code></h1><p>Build operations guards.</p><p>A guard ensure that a build operation is allowed to proceed. This means either that:</p><ul><li>It is <em>ready</em> and can be submitted for execution. This happens once all the files the operation <a href="../Op/index.html#val-reads"><span>reads</span></a> are <a href="index.html#val-set_file_ready"><span>ready</span></a>: they exist and are up-to-date.</li><li>It is <em>aborted</em>. This happens if a file it needs to read <a href="index.html#val-set_file_never"><span>never</span></a> becomes ready.</li></ul><nav class="toc"><ul><li><a href="#guards">Guards</a></li><li><a href="#stuck">Stuck build analysis</a></li></ul></nav></header><section><header><h2 id="guards"><a href="#guards" class="anchor"></a>Guards</h2></header><dl><dt class="spec type" id="type-feedback"><a href="#type-feedback" class="anchor"></a><code><span class="keyword">type</span> feedback</code> = <code>[ </code><table class="variant"><tr id="type-feedback.File_status_repeat" class="anchored"><td class="def constructor"><a href="#type-feedback.File_status_repeat" class="anchor"></a><code>| </code><code>`File_status_repeat <span class="keyword">of</span> <a href="../../B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a></code></td></tr><tr id="type-feedback.File_status_unstable" class="anchored"><td class="def constructor"><a href="#type-feedback.File_status_unstable" class="anchor"></a><code>| </code><code>`File_status_unstable <span class="keyword">of</span> <a href="../../B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a></code></td></tr></table><code> ]</code></dt><dd><p>The type for guard feedbacks:</p><ul><li><code>`File_status_repeat f</code> indicates that the file status of <code>f</code> was set more than once.</li><li><code>`File_status_unstable f</code> indicates that the file status of <code>f</code> was set more than once and in an inconsistent manner</li></ul></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>The type for build operations guards.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : ?&#8288;feedback:(<a href="index.html#type-feedback">feedback</a> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>create ~feedback ()</code> is a new guard, using <code>feedback</code> to report inconsistencies (default is a nop.).</p></dd></dl><dl><dt class="spec value" id="val-set_file_ready"><a href="#val-set_file_ready" class="anchor"></a><code><span class="keyword">val</span> set_file_ready : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_file_ready g f</code> indicates to <code>g</code> that file <code>f</code> is ready, i.e. that it exists and is up-to-date.</p></dd></dl><dl><dt class="spec value" id="val-set_file_never"><a href="#val-set_file_never" class="anchor"></a><code><span class="keyword">val</span> set_file_never : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_file_never g f</code> indicate to <code>g</code> that file <code>f</code> will never become ready.</p></dd></dl><dl><dt class="spec value" id="val-add"><a href="#val-add" class="anchor"></a><code><span class="keyword">val</span> add : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Op/index.html#type-t">Op.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>add g o</code> guards <code>o</code> in <code>g</code> until it is <a href="index.html#val-allowed"><span>allowed</span></a>.</p></dd></dl><dl><dt class="spec value" id="val-allowed"><a href="#val-allowed" class="anchor"></a><code><span class="keyword">val</span> allowed : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Op/index.html#type-t">Op.t</a> option</code></dt><dd><p><code>allowed g</code> is an operation that is either ready or aborted in <code>g</code> (if any). In the second case the <span class="xref-unresolved" title="unresolved reference to &quot;Op.exec_status&quot;"><a href="../index.html#module-Op"><code>Op</code></a>.exec_status</span> is <code>Op.Aborted</code>.</p></dd></dl></section><section><header><h2 id="stuck"><a href="#stuck" class="anchor"></a>Stuck build analysis</h2><p>The following functions are not efficient, only use for stuck build anaylsis or debugging.</p></header><dl><dt class="spec value" id="val-guarded_ops"><a href="#val-guarded_ops" class="anchor"></a><code><span class="keyword">val</span> guarded_ops : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Op/index.html#type-t">Op.t</a> list</code></dt><dd><p><code>guarded_opts g</code> is the list of operations that are not ready in <code>g</code>.</p></dd></dl><dl><dt class="spec value" id="val-ready_files"><a href="#val-ready_files" class="anchor"></a><code><span class="keyword">val</span> ready_files : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B0_std/Fpath/Set/index.html#type-t">B0_std.Fpath.Set.t</a></code></dt><dd><p><code>ready_files g</code> are the files that got ready in <code>g</code>.</p></dd></dl><dl><dt class="spec value" id="val-never_files"><a href="#val-never_files" class="anchor"></a><code><span class="keyword">val</span> never_files : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B0_std/Fpath/Set/index.html#type-t">B0_std.Fpath.Set.t</a></code></dt><dd><p><code>never_files g</code> are the files that never got ready in <code>g</code>.</p></dd></dl><dl><dt class="spec value" id="val-undecided_files"><a href="#val-undecided_files" class="anchor"></a><code><span class="keyword">val</span> undecided_files : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B0_std/Fpath/Set/index.html#type-t">B0_std.Fpath.Set.t</a></code></dt><dd><p><code>undecided_files g</code> are the files that are neither got ready nor never got ready in <code>g</code>.</p></dd></dl><dl><dt class="spec value" id="val-root_undecided_files"><a href="#val-root_undecided_files" class="anchor"></a><code><span class="keyword">val</span> root_undecided_files : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B0_std/Fpath/Set/index.html#type-t">B0_std.Fpath.Set.t</a></code></dt><dd><p><code>root_undecided_file g</code> is like <a href="index.html#val-undecided_files"><code>undecided_files</code></a> but has only the files that are not written by a <code>guarded_op</code> of <code>g</code>. If a build is stuck these are files that are not undecided as the result of a guarded operation.</p></dd></dl></section></div></body></html>