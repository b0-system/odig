<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamFilename (opam-core.OpamFilename)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">opam-core</a> &#x00BB; OpamFilename</nav><header class="odoc-preamble"><h1>Module <code><span>OpamFilename</span></code></h1><p>Higher level file and directory name manipulation AND file operations, wrappers on OpamSystem using the filename type</p></header><nav class="odoc-toc"><ul><li><a href="#locking">Locking</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec module" id="module-Base" class="anchored"><a href="#module-Base" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Base/index.html">Base</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Basenames</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Dir" class="anchored"><a href="#module-Dir" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Dir/index.html">Dir</a></span><span> : <a href="../OpamStd/module-type-ABSTRACT/index.html">OpamStd.ABSTRACT</a></span></code></div><div class="spec-doc"><p>Directory names</p></div></div><div class="odoc-spec"><div class="spec value" id="val-cwd" class="anchored"><a href="#val-cwd" class="anchor"></a><code><span><span class="keyword">val</span> cwd : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="Dir/index.html#type-t">Dir.t</a></span></code></div><div class="spec-doc"><p>Return the current working directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-rmdir" class="anchored"><a href="#val-rmdir" class="anchor"></a><code><span><span class="keyword">val</span> rmdir : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Remove a directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-cleandir" class="anchored"><a href="#val-cleandir" class="anchor"></a><code><span><span class="keyword">val</span> cleandir : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Cleans the contents of a directory, but keeps the directory in place.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-rmdir_cleanup" class="anchored"><a href="#val-rmdir_cleanup" class="anchor"></a><code><span><span class="keyword">val</span> rmdir_cleanup : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Removes an empty directory, as well as any empty leading path components. Must be called only on a directory that is known to not have empty parents, only internal opam directory (and not tmp dir).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mkdir" class="anchored"><a href="#val-mkdir" class="anchor"></a><code><span><span class="keyword">val</span> mkdir : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Create a directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-rec_dirs" class="anchored"><a href="#val-rec_dirs" class="anchor"></a><code><span><span class="keyword">val</span> rec_dirs : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> list</span></span></code></div><div class="spec-doc"><p>List the sub-directory recursively</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dir_is_empty" class="anchored"><a href="#val-dir_is_empty" class="anchor"></a><code><span><span class="keyword">val</span> dir_is_empty : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-dirs" class="anchored"><a href="#val-dirs" class="anchor"></a><code><span><span class="keyword">val</span> dirs : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> list</span></span></code></div><div class="spec-doc"><p>List the sub-directory (do not recurse)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-in_dir" class="anchored"><a href="#val-in_dir" class="anchor"></a><code><span><span class="keyword">val</span> in_dir : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Evaluate a function in a given directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-env_of_list" class="anchored"><a href="#val-env_of_list" class="anchor"></a><code><span><span class="keyword">val</span> env_of_list : <span><span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>string array</span></span></code></div><div class="spec-doc"><p>Turns an assoc list into an array suitable to be provided as environment</p></div></div><div class="odoc-spec"><div class="spec value" id="val-exec" class="anchored"><a href="#val-exec" class="anchor"></a><code><span><span class="keyword">val</span> exec : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?env:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?name:string <span class="arrow">&#45;&gt;</span></span>
<span>?metadata:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>?keep_going:bool <span class="arrow">&#45;&gt;</span></span> <span><span><span>string list</span> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Execute a list of commands in a given directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-move_dir" class="anchored"><a href="#val-move_dir" class="anchor"></a><code><span><span class="keyword">val</span> move_dir : <span>src:<a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span>dst:<a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Move a directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-copy_dir" class="anchored"><a href="#val-copy_dir" class="anchor"></a><code><span><span class="keyword">val</span> copy_dir : <span>src:<a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span>dst:<a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Copy directory <code>src</code> to <code>dst</code>, that is, recursively copy the contents of <code>src</code> into <code>dst</code>, overwriting any existing files.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-link_dir" class="anchored"><a href="#val-link_dir" class="anchor"></a><code><span><span class="keyword">val</span> link_dir : <span>target:<a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span>link:<a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Link a directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-exists_dir" class="anchored"><a href="#val-exists_dir" class="anchor"></a><code><span><span class="keyword">val</span> exists_dir : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Does the directory exist?</p></div></div><div class="odoc-spec"><div class="spec value" id="val-opt_dir" class="anchored"><a href="#val-opt_dir" class="anchor"></a><code><span><span class="keyword">val</span> opt_dir : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> option</span></span></code></div><div class="spec-doc"><p>Returns the argument as option, if the directory exists</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dirname_dir" class="anchored"><a href="#val-dirname_dir" class="anchor"></a><code><span><span class="keyword">val</span> dirname_dir : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="Dir/index.html#type-t">Dir.t</a></span></code></div><div class="spec-doc"><p>Return the parent directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-basename_dir" class="anchored"><a href="#val-basename_dir" class="anchor"></a><code><span><span class="keyword">val</span> basename_dir : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="Base/index.html#type-t">Base.t</a></span></code></div><div class="spec-doc"><p>Return the deeper directory name</p></div></div><div class="odoc-spec"><div class="spec value" id="val-to_list_dir" class="anchored"><a href="#val-to_list_dir" class="anchor"></a><code><span><span class="keyword">val</span> to_list_dir : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> list</span></span></code></div><div class="spec-doc"><p>Turn a full path into a list of directory names</p></div></div><div class="odoc-spec"><div class="spec value" id="val-raw_dir" class="anchored"><a href="#val-raw_dir" class="anchor"></a><code><span><span class="keyword">val</span> raw_dir : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="Dir/index.html#type-t">Dir.t</a></span></code></div><div class="spec-doc"><p>Creation from a raw string, without resolving symlinks etc.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_tmp_dir" class="anchored"><a href="#val-with_tmp_dir" class="anchor"></a><code><span><span class="keyword">val</span> with_tmp_dir : <span><span>(<span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Execute a function in a temp directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_tmp_dir_job" class="anchored"><a href="#val-with_tmp_dir_job" class="anchor"></a><code><span><span class="keyword">val</span> with_tmp_dir_job : <span><span>(<span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../OpamProcess/index.html#type-job">OpamProcess.job</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../OpamProcess/index.html#type-job">OpamProcess.job</a></span></span></code></div><div class="spec-doc"><p>Provide an automatically cleaned up temp directory to a job</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mk_tmp_dir" class="anchored"><a href="#val-mk_tmp_dir" class="anchor"></a><code><span><span class="keyword">val</span> mk_tmp_dir : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="Dir/index.html#type-t">Dir.t</a></span></code></div><div class="spec-doc"><p>Raw function to create a temporary directory. No automatic cleanup</p></div></div><div class="odoc-spec"><div class="spec value" id="val-concat_and_resolve" class="anchored"><a href="#val-concat_and_resolve" class="anchor"></a><code><span><span class="keyword">val</span> concat_and_resolve : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="Dir/index.html#type-t">Dir.t</a></span></code></div><div class="spec-doc"><p>Create a new Dir.t and resolve symlinks</p></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../OpamStd/module-type-ABSTRACT/index.html">OpamStd.ABSTRACT</a></span></code></summary><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-of_string" class="anchored"><a href="#val-of_string" class="anchor"></a><code><span><span class="keyword">val</span> of_string : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-to_string" class="anchored"><a href="#val-to_string" class="anchor"></a><code><span><span class="keyword">val</span> to_string : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-to_json" class="anchored"><a href="#val-to_json" class="anchor"></a><code><span><span class="keyword">val</span> to_json : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../OpamJson/index.html#type-t">OpamJson.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-of_json" class="anchored"><a href="#val-of_json" class="anchor"></a><code><span><span class="keyword">val</span> of_json : <span><a href="../OpamJson/index.html#type-t">OpamJson.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> option</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Set" class="anchored"><a href="#module-Set" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Set/index.html">Set</a></span><span> : <a href="../OpamStd/module-type-SET/index.html">OpamStd.SET</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../OpamStd/module-type-SET/index.html#type-elt">elt</a> = <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Map" class="anchored"><a href="#module-Map" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Map/index.html">Map</a></span><span> : <a href="../OpamStd/module-type-MAP/index.html">OpamStd.MAP</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../OpamStd/module-type-MAP/index.html#type-key">key</a> = <a href="#type-t">t</a></span></span></code></div></div></details></div><div class="odoc-spec"><div class="spec type" id="type-generic_file" class="anchored"><a href="#type-generic_file" class="anchor"></a><code><span><span class="keyword">type</span> generic_file</span><span> = </span></code><table><tr id="type-generic_file.D" class="anchored"><td class="def variant constructor"><a href="#type-generic_file.D" class="anchor"></a><code><span>| </span><span><span class="constructor">D</span> <span class="keyword">of</span> <a href="Dir/index.html#type-t">Dir.t</a></span></code></td></tr><tr id="type-generic_file.F" class="anchored"><td class="def variant constructor"><a href="#type-generic_file.F" class="anchor"></a><code><span>| </span><span><span class="constructor">F</span> <span class="keyword">of</span> <a href="#type-t">t</a></span></code></td></tr></table></div><div class="spec-doc"><p>Generic filename</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Base/index.html#type-t">Base.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Create a filename from a Dir.t and a basename</p></div></div><div class="odoc-spec"><div class="spec value" id="val-of_basename" class="anchored"><a href="#val-of_basename" class="anchor"></a><code><span><span class="keyword">val</span> of_basename : <span><a href="Base/index.html#type-t">Base.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Create a file from a basename and the current working directory as dirname</p></div></div><div class="odoc-spec"><div class="spec value" id="val-raw" class="anchored"><a href="#val-raw" class="anchor"></a><code><span><span class="keyword">val</span> raw : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Creation from a raw string, without resolving symlinks, etc.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-prettify" class="anchored"><a href="#val-prettify" class="anchor"></a><code><span><span class="keyword">val</span> prettify : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Prettify a filename:</p><ul><li>replace /path/to/opam/foo by &lt;opam&gt;/foo</li><li>replace /path/to/home/foo by ~/foo</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-prettify_dir" class="anchored"><a href="#val-prettify_dir" class="anchor"></a><code><span><span class="keyword">val</span> prettify_dir : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Prettify a dirname.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dirname" class="anchored"><a href="#val-dirname" class="anchor"></a><code><span><span class="keyword">val</span> dirname : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="Dir/index.html#type-t">Dir.t</a></span></code></div><div class="spec-doc"><p>Return the directory name</p></div></div><div class="odoc-spec"><div class="spec value" id="val-basename" class="anchored"><a href="#val-basename" class="anchor"></a><code><span><span class="keyword">val</span> basename : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="Base/index.html#type-t">Base.t</a></span></code></div><div class="spec-doc"><p>Return the base name</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read" class="anchored"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Retrieves the contents from the hard disk.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-open_in" class="anchored"><a href="#val-open_in" class="anchor"></a><code><span><span class="keyword">val</span> open_in : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../ocaml/Stdlib/index.html#type-in_channel">in_channel</a></span></code></div><div class="spec-doc"><p>Open a channel from a given file.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-open_in_bin" class="anchored"><a href="#val-open_in_bin" class="anchor"></a><code><span><span class="keyword">val</span> open_in_bin : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../ocaml/Stdlib/index.html#type-in_channel">in_channel</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-open_out" class="anchored"><a href="#val-open_out" class="anchor"></a><code><span><span class="keyword">val</span> open_out : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../ocaml/Stdlib/index.html#type-out_channel">out_channel</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-open_out_bin" class="anchored"><a href="#val-open_out_bin" class="anchor"></a><code><span><span class="keyword">val</span> open_out_bin : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../ocaml/Stdlib/index.html#type-out_channel">out_channel</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-remove" class="anchored"><a href="#val-remove" class="anchor"></a><code><span><span class="keyword">val</span> remove : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Removes everything in <code>filename</code> if existed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write" class="anchored"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Removes everything in <code>filename</code> if existed, then write <code>contents</code> instead.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-exists" class="anchored"><a href="#val-exists" class="anchor"></a><code><span><span class="keyword">val</span> exists : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Returns true if the file exists and is a regular file or a symlink to one</p></div></div><div class="odoc-spec"><div class="spec value" id="val-opt_file" class="anchored"><a href="#val-opt_file" class="anchor"></a><code><span><span class="keyword">val</span> opt_file : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> option</span></span></code></div><div class="spec-doc"><p>Returns the argument as option if it exists and is either a regular file or a symlink to one</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check_suffix" class="anchored"><a href="#val-check_suffix" class="anchor"></a><code><span><span class="keyword">val</span> check_suffix : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check whether a file has a given suffix</p></div></div><div class="odoc-spec"><div class="spec value" id="val-add_extension" class="anchored"><a href="#val-add_extension" class="anchor"></a><code><span><span class="keyword">val</span> add_extension : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Adds a dot and the given file extension</p></div></div><div class="odoc-spec"><div class="spec value" id="val-chop_extension" class="anchored"><a href="#val-chop_extension" class="anchor"></a><code><span><span class="keyword">val</span> chop_extension : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Remove the file extension</p></div></div><div class="odoc-spec"><div class="spec value" id="val-rec_files" class="anchored"><a href="#val-rec_files" class="anchor"></a><code><span><span class="keyword">val</span> rec_files : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p>List all the filenames, recursively</p></div></div><div class="odoc-spec"><div class="spec value" id="val-files" class="anchored"><a href="#val-files" class="anchor"></a><code><span><span class="keyword">val</span> files : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p>List all the filename. Do not recurse.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_contents" class="anchored"><a href="#val-with_contents" class="anchor"></a><code><span><span class="keyword">val</span> with_contents : <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Apply a function on the contents of a file</p></div></div><div class="odoc-spec"><div class="spec value" id="val-copy_in" class="anchored"><a href="#val-copy_in" class="anchor"></a><code><span><span class="keyword">val</span> copy_in : <span>?root:<a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Copy a file in a directory. If <code>root</code> is set, copy also the sub-directories. For instance, <code>copy_in ~root:&quot;/foo&quot; &quot;/foo/bar/gni&quot;
    &quot;/toto&quot;</code> creates <code>&quot;/toto/bar/gni&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-move" class="anchored"><a href="#val-move" class="anchor"></a><code><span><span class="keyword">val</span> move : <span>src:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>dst:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Move a file</p></div></div><div class="odoc-spec"><div class="spec value" id="val-readlink" class="anchored"><a href="#val-readlink" class="anchor"></a><code><span><span class="keyword">val</span> readlink : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Read a symlinked file</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_symlink" class="anchored"><a href="#val-is_symlink" class="anchor"></a><code><span><span class="keyword">val</span> is_symlink : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Is a symlink?</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_symlink_dir" class="anchored"><a href="#val-is_symlink_dir" class="anchor"></a><code><span><span class="keyword">val</span> is_symlink_dir : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-is_exec" class="anchored"><a href="#val-is_exec" class="anchor"></a><code><span><span class="keyword">val</span> is_exec : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Is an executable?</p></div></div><div class="odoc-spec"><div class="spec value" id="val-copy" class="anchored"><a href="#val-copy" class="anchor"></a><code><span><span class="keyword">val</span> copy : <span>src:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>dst:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Copy a file</p></div></div><div class="odoc-spec"><div class="spec value" id="val-install" class="anchored"><a href="#val-install" class="anchor"></a><code><span><span class="keyword">val</span> install : <span>?warning:<a href="../OpamSystem/index.html#type-install_warning_fn">OpamSystem.install_warning_fn</a> <span class="arrow">&#45;&gt;</span></span> <span>?exec:bool <span class="arrow">&#45;&gt;</span></span> <span>src:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>dst:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Installs a file to a destination. Optionally set if the destination should be set executable</p></div></div><div class="odoc-spec"><div class="spec value" id="val-link" class="anchored"><a href="#val-link" class="anchor"></a><code><span><span class="keyword">val</span> link : <span>?relative:bool <span class="arrow">&#45;&gt;</span></span> <span>target:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>link:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Symlink a file. If symlink is not possible on the system, use copy instead. With <code>relative</code>, creates a relative link through the closest common ancestor directory if possible. Otherwise, the symlink is absolute.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_archive" class="anchored"><a href="#val-is_archive" class="anchor"></a><code><span><span class="keyword">val</span> is_archive : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Returns true if the given file is an archive (zip or tar)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-extract" class="anchored"><a href="#val-extract" class="anchor"></a><code><span><span class="keyword">val</span> extract : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Extract an archive in a given directory (it rewrites the root to match <code>Dir.t</code> dir if needed)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-extract_job" class="anchored"><a href="#val-extract_job" class="anchor"></a><code><span><span class="keyword">val</span> extract_job : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>exn option</span> <a href="../OpamProcess/index.html#type-job">OpamProcess.job</a></span></span></code></div><div class="spec-doc"><p>Same as <code>extract</code>, as an OpamProcess.job</p></div></div><div class="odoc-spec"><div class="spec value" id="val-extract_in" class="anchored"><a href="#val-extract_in" class="anchor"></a><code><span><span class="keyword">val</span> extract_in : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Extract an archive in a given directory</p></div></div><div class="odoc-spec"><div class="spec value" id="val-extract_in_job" class="anchored"><a href="#val-extract_in_job" class="anchor"></a><code><span><span class="keyword">val</span> extract_in_job : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>exn option</span> <a href="../OpamProcess/index.html#type-job">OpamProcess.job</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-make_tar_gz_job" class="anchored"><a href="#val-make_tar_gz_job" class="anchor"></a><code><span><span class="keyword">val</span> make_tar_gz_job : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>exn option</span> <a href="../OpamProcess/index.html#type-job">OpamProcess.job</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-extract_generic_file" class="anchored"><a href="#val-extract_generic_file" class="anchor"></a><code><span><span class="keyword">val</span> extract_generic_file : <span><a href="#type-generic_file">generic_file</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Extract a generic file</p></div></div><div class="odoc-spec"><div class="spec value" id="val-starts_with" class="anchored"><a href="#val-starts_with" class="anchor"></a><code><span><span class="keyword">val</span> starts_with : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check whether a filename starts by a given Dir.t</p></div></div><div class="odoc-spec"><div class="spec value" id="val-ends_with" class="anchored"><a href="#val-ends_with" class="anchor"></a><code><span><span class="keyword">val</span> ends_with : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check whether a filename ends with a given suffix</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dir_starts_with" class="anchored"><a href="#val-dir_starts_with" class="anchor"></a><code><span><span class="keyword">val</span> dir_starts_with : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>dir starts_with pfx dir</code> Check whether <code>dir</code> starts with <code>pfx</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-dir_ends_with" class="anchored"><a href="#val-dir_ends_with" class="anchor"></a><code><span><span class="keyword">val</span> dir_ends_with : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check whether a dirname ends with a given suffix</p></div></div><div class="odoc-spec"><div class="spec value" id="val-remove_prefix" class="anchored"><a href="#val-remove_prefix" class="anchor"></a><code><span><span class="keyword">val</span> remove_prefix : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Remove a prefix from a file name</p></div></div><div class="odoc-spec"><div class="spec value" id="val-remove_prefix_dir" class="anchored"><a href="#val-remove_prefix_dir" class="anchor"></a><code><span><span class="keyword">val</span> remove_prefix_dir : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-remove_suffix" class="anchored"><a href="#val-remove_suffix" class="anchor"></a><code><span><span class="keyword">val</span> remove_suffix : <span><a href="Base/index.html#type-t">Base.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Remove a suffix from a filename</p></div></div><div class="odoc-spec"><div class="spec value" id="val-patch" class="anchored"><a href="#val-patch" class="anchor"></a><code><span><span class="keyword">val</span> patch : <span>?preprocess:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>exn option</span> <a href="../OpamProcess/index.html#type-job">OpamProcess.job</a></span></span></code></div><div class="spec-doc"><p>Apply a patch in a directory. If <code>preprocess</code> is set to false, there is no CRLF translation. Returns <code>None</code> on success, the process error otherwise</p></div></div><div class="odoc-spec"><div class="spec value" id="val-touch" class="anchored"><a href="#val-touch" class="anchor"></a><code><span><span class="keyword">val</span> touch : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Create an empty file</p></div></div><div class="odoc-spec"><div class="spec value" id="val-chmod" class="anchored"><a href="#val-chmod" class="anchor"></a><code><span><span class="keyword">val</span> chmod : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Change file permissions</p></div></div><div class="odoc-spec"><div class="spec value" id="val-written_since" class="anchored"><a href="#val-written_since" class="anchor"></a><code><span><span class="keyword">val</span> written_since : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> float</span></code></div><div class="spec-doc"><p>Returns delay since last file update, based on mtime</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find_in_parents" class="anchored"><a href="#val-find_in_parents" class="anchor"></a><code><span><span class="keyword">val</span> find_in_parents : <span><span>(<span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Dir/index.html#type-t">Dir.t</a> option</span></span></code></div><div class="spec-doc"><p>Returns the closest parent of a directory (including itself) for which the predicate holds, if any</p></div></div><h3 id="locking"><a href="#locking" class="anchor"></a>Locking</h3><div class="odoc-spec"><div class="spec value" id="val-flock" class="anchored"><a href="#val-flock" class="anchor"></a><code><span><span class="keyword">val</span> flock : <span><span>[&lt; <a href="../OpamSystem/index.html#type-lock_flag">OpamSystem.lock_flag</a> ]</span> <span class="arrow">&#45;&gt;</span></span> <span>?dontblock:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../OpamSystem/index.html#type-lock">OpamSystem.lock</a></span></code></div><div class="spec-doc"><p>See <code>OpamSystem.flock</code>. Prefer the higher level <code>with_flock</code> functions when possible</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_flock" class="anchored"><a href="#val-with_flock" class="anchor"></a><code><span><span class="keyword">val</span> with_flock : <span><span>[&lt; <a href="../OpamSystem/index.html#type-lock_flag">OpamSystem.lock_flag</a> ]</span> <span class="arrow">&#45;&gt;</span></span> <span>?dontblock:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Calls <code>f</code> while holding a lock file. Ensures the lock is properly released on <code>f</code> exit. Raises <code>OpamSystem.Locked</code> if <code>dontblock</code> is set and the lock can't be acquired. <code>f</code> is passed the file_descr of the lock.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_flock_upgrade" class="anchored"><a href="#val-with_flock_upgrade" class="anchor"></a><code><span><span class="keyword">val</span> with_flock_upgrade : <span><span>[&lt; <a href="../OpamSystem/index.html#type-actual_lock_flag">OpamSystem.actual_lock_flag</a> ]</span> <span class="arrow">&#45;&gt;</span></span> <span>?dontblock:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="../OpamSystem/index.html#type-lock">OpamSystem.lock</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Calls <code>f</code> with the file lock upgraded to at least <code>flag</code>, then restores the previous lock level. Upgrade to <code>`Lock_write</code> should never be used in blocking mode as it would deadlock. Raises <code>OpamSystem.Locked</code> (but keeps the lock as is) if <code>dontblock</code> is set and the lock can't be upgraded.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_flock_write_then_read" class="anchored"><a href="#val-with_flock_write_then_read" class="anchor"></a><code><span><span class="keyword">val</span> with_flock_write_then_read : <span>?dontblock:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span></span></code></div><div class="spec-doc"><p>Runs first function with a write lock on the given file, then releases it to a read lock and runs the second function.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Op" class="anchored"><a href="#module-Op" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Op/index.html">Op</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Attribute" class="anchored"><a href="#module-Attribute" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Attribute/index.html">Attribute</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Simple structure to handle file attributes</p></div></div><div class="odoc-spec"><div class="spec value" id="val-to_attribute" class="anchored"><a href="#val-to_attribute" class="anchor"></a><code><span><span class="keyword">val</span> to_attribute : <span><a href="Dir/index.html#type-t">Dir.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="Attribute/index.html#type-t">Attribute.t</a></span></code></div><div class="spec-doc"><p>Convert a filename to an attribute, relatively to a root</p></div></div></div></body></html>