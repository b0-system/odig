<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamPp (opam-format.OpamPp)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">opam-format</a> &#x00BB; OpamPp</nav><h1>Module <code>OpamPp</code></h1><p>Generic bidirectional transformation toolbox for parsing/printing</p><nav class="toc"><ul><li><a href="#parsing-positions-and-error-reporting-helpers">Parsing positions and error reporting helpers</a></li><li><a href="#parser/printers">Parser/printers</a><ul><li><a href="#various-pp-constructors">Various pp constructors</a></li><li><a href="#combinators-to-parse-to-a-record-from-a-list-of-(field-name,-field-setter,-field-getter)">Combinators to parse to a record from a list of (field name, field setter, field getter)</a></li></ul></li></ul></nav></header><section><header><h3 id="parsing-positions-and-error-reporting-helpers"><a href="#parsing-positions-and-error-reporting-helpers" class="anchor"></a>Parsing positions and error reporting helpers</h3></header><dl><dt class="spec type" id="type-bad_format"><a href="#type-bad_format" class="anchor"></a><code><span class="keyword">type</span> bad_format</code><code> = <a href="../OpamTypes/index.html#type-pos">OpamTypes.pos</a> option * string</code></dt><dd><p>Format error reporting: position and message</p></dd></dl><dl><dt class="spec exception" id="exception-Bad_format"><a href="#exception-Bad_format" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Bad_format</span> <span class="keyword">of</span> <a href="index.html#type-bad_format">bad_format</a></code></dt><dd><p>All the following parsing function raise <code>Bad_format</code> in case the input does not have the right format.</p></dd></dl><dl><dt class="spec exception" id="exception-Bad_format_list"><a href="#exception-Bad_format_list" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Bad_format_list</span> <span class="keyword">of</span> <a href="index.html#type-bad_format">bad_format</a> list</code></dt></dl><dl><dt class="spec value" id="val-bad_format"><a href="#val-bad_format" class="anchor"></a><code><span class="keyword">val</span> bad_format : ?&#8288;pos:<a href="../OpamTypes/index.html#type-pos">OpamTypes.pos</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, unit, string, <span class="type-var">'b</span>) <a href="../../ocaml/Stdlib/index.html#type-format4">Stdlib.format4</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Raise <code>Bad_format</code>.</p></dd></dl><dl><dt class="spec value" id="val-string_of_bad_format"><a href="#val-string_of_bad_format" class="anchor"></a><code><span class="keyword">val</span> string_of_bad_format : ?&#8288;file:string <span>&#45;&gt;</span> exn <span>&#45;&gt;</span> string</code></dt><dt class="spec value" id="val-add_pos"><a href="#val-add_pos" class="anchor"></a><code><span class="keyword">val</span> add_pos : <a href="../OpamTypes/index.html#type-pos">OpamTypes.pos</a> <span>&#45;&gt;</span> exn <span>&#45;&gt;</span> exn</code></dt><dd><p>Adds a position to a Bad_format exception if it doesn't have one yet</p></dd></dl></section><section><header><h3 id="parser/printers"><a href="#parser/printers" class="anchor"></a>Parser/printers</h3></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> ('a, 'b) t</code><code> = <span class="keyword">private</span> </code><code>{</code><table class="record"><tr id="type-t.parse" class="anchored"><td class="def field"><a href="#type-t.parse" class="anchor"></a><code>parse : pos:<a href="../OpamTypes/index.html#type-pos">OpamTypes.pos</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>;</code></td></tr><tr id="type-t.print" class="anchored"><td class="def field"><a href="#type-t.print" class="anchor"></a><code>print : <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>;</code></td></tr><tr id="type-t.ppname" class="anchored"><td class="def field"><a href="#type-t.ppname" class="anchor"></a><code>ppname : string;</code></td></tr><tr id="type-t.name_constr" class="anchored"><td class="def field"><a href="#type-t.name_constr" class="anchor"></a><code>name_constr : string <span>&#45;&gt;</span> string;</code></td></tr></table><code>}</code></dt><dd><p>The type of bidirectional parsers from <code>'a</code> to <code>'b</code>. We abuse the terms and describe going from <code>'a</code> to <code>'b</code> as &quot;parsing&quot;, and going from <code>'b</code> to <code>'a</code> as &quot;printing&quot;. Parsing is generally error-prone, while printing is not expected to fail, so the handling isn't really symmetrical.</p><p><code>parse (print x)</code> should always be the identity, while no guarantee is given regarding <code>print (parse x)</code></p></dd></dl><dl><dt class="spec value" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span class="keyword">val</span> pp : ?&#8288;name:string <span>&#45;&gt;</span> ?&#8288;name_constr:(string <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> (pos:<a href="../OpamTypes/index.html#type-pos">OpamTypes.pos</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> (<span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Base constructor for Pp.t, from a parser function and a printer function. <code>name_constr</code> is used to construct the resulting name when on the left of a pipe. Names are for tracing errors.</p></dd></dl><dl><dt class="spec value" id="val-of_pair"><a href="#val-of_pair" class="anchor"></a><code><span class="keyword">val</span> of_pair : string <span>&#45;&gt;</span> ((<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) * (<span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>)) <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Constructor of Pp.t from a name and a pair</p></dd></dl><dl><dt class="spec value" id="val-parse"><a href="#val-parse" class="anchor"></a><code><span class="keyword">val</span> parse : (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> pos:<a href="../OpamTypes/index.html#type-pos">OpamTypes.pos</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><p>Base call for parsing with a pp</p></dd></dl><dl><dt class="spec value" id="val-print"><a href="#val-print" class="anchor"></a><code><span class="keyword">val</span> print : (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Base call for printing with a pp</p></dd></dl><aside><p>Error handling</p></aside><dl><dt class="spec value" id="val-unexpected"><a href="#val-unexpected" class="anchor"></a><code><span class="keyword">val</span> unexpected : ?&#8288;pos:<a href="../OpamTypes/index.html#type-pos">OpamTypes.pos</a> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Raises an exception handled by parser calls</p></dd></dl><section><header><h4 id="various-pp-constructors"><a href="#various-pp-constructors" class="anchor"></a>Various pp constructors</h4></header><div class="spec module" id="module-Op"><a href="#module-Op" class="anchor"></a><code><span class="keyword">module</span> <a href="Op/index.html">Op</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-identity"><a href="#val-identity" class="anchor"></a><code><span class="keyword">val</span> identity : (<span class="type-var">'a</span>, <span class="type-var">'a</span>) <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-ignore"><a href="#val-ignore" class="anchor"></a><code><span class="keyword">val</span> ignore : (<span class="type-var">'a</span>, <span class="type-var">'b</span> option) <a href="index.html#type-t">t</a></code></dt><dd><p>Always parses to <code>None</code></p></dd></dl><dl><dt class="spec value" id="val-check"><a href="#val-check" class="anchor"></a><code><span class="keyword">val</span> check : ?&#8288;name:string <span>&#45;&gt;</span> ?&#8288;errmsg:string <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> bool) <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'a</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Identity pp, unless the check fails. The check is turned into an assertion when printing</p></dd></dl><dl><dt class="spec value" id="val-map_pair"><a href="#val-map_pair" class="anchor"></a><code><span class="keyword">val</span> map_pair : ?&#8288;name:string <span>&#45;&gt;</span> ?&#8288;posf1:(<span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="../OpamTypes/index.html#type-pos">OpamTypes.pos</a>) <span>&#45;&gt;</span> ?&#8288;posf2:(<span class="type-var">'b</span> <span>&#45;&gt;</span> <a href="../OpamTypes/index.html#type-pos">OpamTypes.pos</a>) <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'c</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'b</span>, <span class="type-var">'d</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> * <span class="type-var">'b</span>, <span class="type-var">'c</span> * <span class="type-var">'d</span>) <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-map_fst"><a href="#val-map_fst" class="anchor"></a><code><span class="keyword">val</span> map_fst : (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> * <span class="type-var">'c</span>, <span class="type-var">'b</span> * <span class="type-var">'c</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Builds a pp of pairs by passing the second term along</p></dd></dl><dl><dt class="spec value" id="val-map_snd"><a href="#val-map_snd" class="anchor"></a><code><span class="keyword">val</span> map_snd : (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'c</span> * <span class="type-var">'a</span>, <span class="type-var">'c</span> * <span class="type-var">'b</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Builds a pp of pairs by passing the first term along</p></dd></dl><dl><dt class="spec value" id="val-map_list"><a href="#val-map_list" class="anchor"></a><code><span class="keyword">val</span> map_list : ?&#8288;name:string <span>&#45;&gt;</span> ?&#8288;posf:(<span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="../OpamTypes/index.html#type-pos">OpamTypes.pos</a>) <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> list, <span class="type-var">'b</span> list) <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-map_option"><a href="#val-map_option" class="anchor"></a><code><span class="keyword">val</span> map_option : ?&#8288;name:string <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> option, <span class="type-var">'b</span> option) <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-singleton"><a href="#val-singleton" class="anchor"></a><code><span class="keyword">val</span> singleton : (<span class="type-var">'a</span> list, <span class="type-var">'a</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Parsing fails on non-singleton lists</p></dd></dl><dl><dt class="spec value" id="val-last"><a href="#val-last" class="anchor"></a><code><span class="keyword">val</span> last : (<span class="type-var">'a</span> list, <span class="type-var">'a</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Use for the rightmost element to close a <code>^+</code> sequence, e.g. <code>pp1 ^+ pp2 ^+ last -| pp3</code></p></dd></dl><div class="spec module-type" id="module-type-STR"><a href="#module-type-STR" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-STR/index.html">STR</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-of_module"><a href="#val-of_module" class="anchor"></a><code><span class="keyword">val</span> of_module : string <span>&#45;&gt;</span> (<span class="keyword">module</span> <a href="module-type-STR/index.html">STR</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-STR/index.html#type-t">t</a> = <span class="type-var">'a</span>) <span>&#45;&gt;</span> (string, <span class="type-var">'a</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Generates a string pp from a module with of/to string functions</p></dd></dl><dl><dt class="spec value" id="val-opt"><a href="#val-opt" class="anchor"></a><code><span class="keyword">val</span> opt : (<span class="type-var">'a</span> list, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> list, <span class="type-var">'b</span> option) <a href="index.html#type-t">t</a></code></dt><dd><p>Parses to None on the empty list. Often combined with singleton (<code>opt (singleton _)</code>)</p></dd></dl><dl><dt class="spec value" id="val-default"><a href="#val-default" class="anchor"></a><code><span class="keyword">val</span> default : <span class="type-var">'a</span> <span>&#45;&gt;</span> (<span class="type-var">'a</span> option, <span class="type-var">'a</span>) <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-fallback"><a href="#val-fallback" class="anchor"></a><code><span class="keyword">val</span> fallback : (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-t">t</a></code></dt><dd><p><code>fallback p1 p2</code> is <code>p1</code>, except that parsing is allowed to fail and will in that case try to parse through <code>p2</code>. Can be useful for backwards compatibility, but use with care</p></dd></dl></section><section><header><h4 id="combinators-to-parse-to-a-record-from-a-list-of-(field-name,-field-setter,-field-getter)"><a href="#combinators-to-parse-to-a-record-from-a-list-of-(field-name,-field-setter,-field-getter)" class="anchor"></a>Combinators to parse to a record from a list of (field name, field setter, field getter)</h4></header><dl><dt class="spec type" id="type-field_parser"><a href="#type-field_parser" class="anchor"></a><code><span class="keyword">type</span> ('a, 'value) field_parser</code><code> = (<span class="type-var">'a</span> * <span class="type-var">'value</span> option, <span class="type-var">'a</span>) <a href="index.html#type-t">t</a></code></dt><dd><p>Used to parse a single field of a record: <code>'a</code> on the left is the accumulator, or value of the record parsed so far. (in lens terms, <code>get</code> would be the print operation that extracts the field for the record, while <code>set</code> would be the parse operation that takes the input and record, and updates a given field in the record)</p></dd></dl><dl><dt class="spec value" id="val-ppacc"><a href="#val-ppacc" class="anchor"></a><code><span class="keyword">val</span> ppacc : ?&#8288;cleanup:(pos:<a href="../OpamTypes/index.html#type-pos">OpamTypes.pos</a> <span>&#45;&gt;</span> <span class="type-var">'acc</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'acc</span> <span>&#45;&gt;</span> <span class="type-var">'acc</span>) <span>&#45;&gt;</span> (<span class="type-var">'acc</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> (<span class="type-var">'value</span>, <span class="type-var">'a</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'acc</span>, <span class="type-var">'value</span>) <a href="index.html#type-field_parser">field_parser</a></code></dt><dd><p>Make a field parser from setter, getter and base pp. <code>cleanup</code> is an optional sanitisation function that is called on parsed elements before calling the setter.</p></dd></dl><dl><dt class="spec value" id="val-ppacc_opt"><a href="#val-ppacc_opt" class="anchor"></a><code><span class="keyword">val</span> ppacc_opt : ?&#8288;cleanup:(pos:<a href="../OpamTypes/index.html#type-pos">OpamTypes.pos</a> <span>&#45;&gt;</span> <span class="type-var">'acc</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'acc</span> <span>&#45;&gt;</span> <span class="type-var">'acc</span>) <span>&#45;&gt;</span> (<span class="type-var">'acc</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> option) <span>&#45;&gt;</span> (<span class="type-var">'value</span>, <span class="type-var">'a</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'acc</span>, <span class="type-var">'value</span>) <a href="index.html#type-field_parser">field_parser</a></code></dt><dd><p>Same as <code>ppacc</code>, but when the field may be unset in the record, i.e. the getter returns an option</p></dd></dl><dl><dt class="spec value" id="val-ppacc_ignore"><a href="#val-ppacc_ignore" class="anchor"></a><code><span class="keyword">val</span> ppacc_ignore : (<span class="type-var">'a</span>, <a href="../OpamTypes/index.html#type-value">OpamTypes.value</a>) <a href="index.html#type-field_parser">field_parser</a></code></dt><dd><p>A field parser that ignores its argument</p></dd></dl><dl><dt class="spec value" id="val-embed"><a href="#val-embed" class="anchor"></a><code><span class="keyword">val</span> embed : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'acc</span> <span>&#45;&gt;</span> <span class="type-var">'acc</span>) <span>&#45;&gt;</span> (<span class="type-var">'acc</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'value</span>) <a href="index.html#type-field_parser">field_parser</a> <span>&#45;&gt;</span> (<span class="type-var">'acc</span>, <span class="type-var">'value</span>) <a href="index.html#type-field_parser">field_parser</a></code></dt></dl></section></section></div></body></html>